import{s as ot,e as w,b as V,c as y,d as N,o as Q,h as B,g as k,p as W,j as et,k as f,q as ut,u as ht,m as gt,t as it,f as ct,l as dt,n as pt}from"../chunks/scheduler.DfSyNHuu.js";import{S as ft,i as mt,c as T,a as F,m as L,t as O,b as U,d as X}from"../chunks/index.NQ40Qhwc.js";import{t as _t}from"../chunks/_commonjsHelpers.DTn6fqMd.js";import{e as lt,i as vt}from"../chunks/PositionalEncodingPopover.svelte_svelte_type_style_lang.Dq8P_sUS.js";import{M as Y,r as wt,t as yt,s as tt,a as G}from"../chunks/Matrix.Ci_VE6l7.js";import{g as $t}from"../chunks/index.BDA6QqVY.js";function at(a,t,n){const e=a.slice();return e[14]=t[n],e[16]=n,e}function st(a){let t,n;return{c(){t=w("div"),n=it(a[0]),this.h()},l(e){t=y(e,"DIV",{class:!0});var o=N(t);n=ct(o,a[0]),o.forEach(k),this.h()},h(){W(t,"class","title")},m(e,o){et(e,t,o),f(t,n)},p(e,o){o&1&&dt(n,e[0])},d(e){e&&k(t)}}}function rt(a){let t,n,e=a[14]+"",o;return{c(){t=w("div"),n=w("span"),o=it(e),this.h()},l(i){t=y(i,"DIV",{class:!0});var h=N(t);n=y(h,"SPAN",{});var s=N(n);o=ct(s,e),s.forEach(k),h.forEach(k),this.h()},h(){W(t,"class","label")},m(i,h){et(i,t,h),f(t,n),f(n,o)},p(i,h){h&2&&e!==(e=i[14]+"")&&dt(o,e)},d(i){i&&k(t)}}}function bt(a){let t,n,e="animation start",o,i,h,s,C,x,$,q,A,J="X",P,E,c,p,K="+",R,g,I,_,z="=",M,v,S,j,H,m=a[0]&&st(a),D=lt(a[1]),u=[];for(let l=0;l<D.length;l+=1)u[l]=rt(at(a,D,l));return $=new Y({props:{className:"token-embedding",data:Array(8).fill(0).map(a[7]),showSize:"(4, 768)",cellHeight:10,cellWidth:10}}),E=new Y({props:{className:"key-weights",data:Array(10).fill(0).map(a[8]),showSize:"(768, 64)",groupBy:"col",cellHeight:a[2]*3,cellWidth:a[2]*3,rowGap:0}}),g=new Y({props:{className:"key-weights",data:Array(1).fill(0).map(a[9]),showSize:"(768, 64)",groupBy:"col",cellHeight:a[2]*3,cellWidth:a[2]*3,rowGap:0}}),v=new Y({props:{className:"key-output",data:Array(4).fill(0).map(a[10]),cellHeight:a[2]*3,cellWidth:a[2]*3,showSize:"(4, 64)"}}),{c(){t=w("div"),n=w("button"),n.textContent=e,o=V(),i=w("div"),m&&m.c(),h=V(),s=w("div"),C=w("div");for(let l=0;l<u.length;l+=1)u[l].c();x=V(),T($.$$.fragment),q=V(),A=w("div"),A.textContent=J,P=V(),T(E.$$.fragment),c=V(),p=w("div"),p.textContent=K,R=V(),T(g.$$.fragment),I=V(),_=w("div"),_.textContent=z,M=V(),T(v.$$.fragment),this.h()},l(l){t=y(l,"DIV",{class:!0});var b=N(t);n=y(b,"BUTTON",{"data-svelte-h":!0}),Q(n)!=="svelte-l1vv80"&&(n.textContent=e),o=B(b),i=y(b,"DIV",{class:!0});var r=N(i);m&&m.l(r),h=B(r),s=y(r,"DIV",{class:!0});var d=N(s);C=y(d,"DIV",{class:!0});var nt=N(C);for(let Z=0;Z<u.length;Z+=1)u[Z].l(nt);nt.forEach(k),x=B(d),F($.$$.fragment,d),q=B(d),A=y(d,"DIV",{class:!0,"data-svelte-h":!0}),Q(A)!=="svelte-dypn91"&&(A.textContent=J),P=B(d),F(E.$$.fragment,d),c=B(d),p=y(d,"DIV",{class:!0,"data-svelte-h":!0}),Q(p)!=="svelte-62uxvu"&&(p.textContent=K),R=B(d),F(g.$$.fragment,d),I=B(d),_=y(d,"DIV",{class:!0,"data-svelte-h":!0}),Q(_)!=="svelte-2aqf14"&&(_.textContent=z),M=B(d),F(v.$$.fragment,d),d.forEach(k),r.forEach(k),b.forEach(k),this.h()},h(){W(C,"class","tokens"),W(A,"class","operator"),W(p,"class","operator"),W(_,"class","operator"),W(s,"class","weight-popover-content flex items-center justify-start"),W(i,"class","p-3"),W(t,"class","weight-content")},m(l,b){et(l,t,b),f(t,n),f(t,o),f(t,i),m&&m.m(i,null),f(i,h),f(i,s),f(s,C);for(let r=0;r<u.length;r+=1)u[r]&&u[r].m(C,null);f(s,x),L($,s,null),f(s,q),f(s,A),f(s,P),L(E,s,null),f(s,c),f(s,p),f(s,R),L(g,s,null),f(s,I),f(s,_),f(s,M),L(v,s,null),S=!0,j||(H=ut(n,"click",a[6]),j=!0)},p(l,[b]){if(l[0]?m?m.p(l,b):(m=st(l),m.c(),m.m(i,h)):m&&(m.d(1),m=null),b&2){D=lt(l[1]);let r;for(r=0;r<D.length;r+=1){const d=at(l,D,r);u[r]?u[r].p(d,b):(u[r]=rt(d),u[r].c(),u[r].m(C,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=D.length}},i(l){S||(O($.$$.fragment,l),O(E.$$.fragment,l),O(g.$$.fragment,l),O(v.$$.fragment,l),S=!0)},o(l){U($.$$.fragment,l),U(E.$$.fragment,l),U(g.$$.fragment,l),U(v.$$.fragment,l),S=!1},d(l){l&&k(t),m&&m.d(),ht(u,l),X($),X(E),X(g),X(v),j=!1,H()}}}function kt(a,t,n){let e;gt(a,_t,c=>n(1,e=c));const{theme:o}=wt(yt);let{triggeredBy:i}=t,{title:h=void 0}=t,{data:s}=t,C=10*1.5;const x=vt("white",o.colors.primary[600]),$=()=>{const c=tt(".weight-popover-content .token-embedding g.g-row").nodes(),p=tt(".weight-popover-content .key-weights g.g-col").nodes(),K=tt(".weight-popover-content .key-output g.g-row").nodes(),R=$t.timeline();let g=null;if(K.forEach(function(I,_){const z=G(I).selectAll("rect").nodes();if(g!==null&&g!==_){const M=G(c[g]).selectAll("rect").nodes();R.to(M,{fill:(v,S)=>x(S.__data__),duration:.05})}z.forEach((M,v)=>{const S=G(p[v]).selectAll("rect").nodes(),j=G(c[_]).selectAll("rect").nodes(),H=v===0&&_===0;R.to([S,j],{fill:(m,D)=>o.colors.secondary[600],duration:H?.5:.01}),R.to(S,{fill:(m,D)=>x(D.__data__),duration:H?.5:.01},"<50%"),R.from(M,{fill:"white",duration:H?.5:.01},"<50%")}),g=_}),g!==null){const I=G(c[g]).selectAll("rect").nodes();R.to(I,{fill:(_,z)=>x(z.__data__),duration:.01})}},q=()=>{$()},A=c=>Array(20).fill(0).map(p=>Math.random()),J=c=>Array(10).fill(0).map(p=>Math.random()),P=c=>Array(10).fill(0).map(p=>Math.random()),E=c=>Array(12).fill(0).map(p=>Math.random());return a.$$set=c=>{"triggeredBy"in c&&n(4,i=c.triggeredBy),"title"in c&&n(0,h=c.title),"data"in c&&n(5,s=c.data)},[h,e,C,$,i,s,q,A,J,P,E]}class Ct extends ft{constructor(t){super(),mt(this,t,kt,bt,ot,{triggeredBy:4,title:0,data:5})}}function At(a){let t,n;return t=new Ct({props:{open:!0,triggeredBy:"body"}}),{c(){T(t.$$.fragment)},l(e){F(t.$$.fragment,e)},m(e,o){L(t,e,o),n=!0},p:pt,i(e){n||(O(t.$$.fragment,e),n=!0)},o(e){U(t.$$.fragment,e),n=!1},d(e){X(t,e)}}}class Wt extends ft{constructor(t){super(),mt(this,t,null,At,ot,{})}}export{Wt as component};
