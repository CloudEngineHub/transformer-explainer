import{s as je,G as cl,D as $l,H as bl,I as sr,J as Rn,M as Gn,N as Fn,O as Un,a4 as Ce,j as U,a5 as De,a as T,d as $,k as x,p as m,i as W,n as qe,m as ye,z as vt,C as Ot,A as Qe,e as B,c as z,q as Ae,w as ut,u as oe,f as k,ah as de,t as ve,o as Ie,b as ge,P as Lt,ai as xn,v as ke,l as Le,r as Fe,ad as el,E as tl,ab as wl,aj as or}from"../chunks/scheduler.DvgnvtHA.js";import{S as Oe,i as Re,c as te,a as le,m as ne,t as H,b as O,d as re,g as Ne,e as Se,h as kl,j as ir,f as Mt}from"../chunks/index.DUhmag0b.js";import{r as wt,a as kt,t as gt,m as zt,u as fl,e as be,v as $t,b as ue,g as xe,w as Tt,x as Jt,y as jt,z as Wn,p as Rt,d as Bt,n as Xt,A as ar,f as ul,Z as cr,i as El,M as fr,B as Xn,P as ur,j as hr,k as dr,C as pr,D as vr,E as gr}from"../chunks/index.DLu6PrMZ.js";import{b as ll,d as mr,c as _r}from"../chunks/transform.yYZBLT4W.js";import{s as Kt,a as Je,M as At,K as Et,F as bt,f as at,Q as $r}from"../chunks/QKVWeightPopover.0BQ8pJAi.js";import{g as br,a as wr,t as kr,b as pt}from"../chunks/index.lruJjzEY.js";import{P as Er,a as nl,H as yl,A as Kn}from"../chunks/image.BtjWjWg8.js";import{a as yr,i as Zn,b as Ir,c as Cr,l as hl}from"../chunks/linear.D3KXbiNi.js";import{b as Dr}from"../chunks/paths.Bg9daY_d.js";function Vr(n){let e;const l=n[4].default,t=Rn(l,n,n[6],null);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,s){t&&t.p&&(!e||s&64)&&Gn(t,l,r,r[6],e?Un(l,r[6],s,null):Fn(r[6]),null)},i(r){e||(H(t,r),e=!0)},o(r){O(t,r),e=!1},d(r){t&&t.d(r)}}}function Nr(n){let e,l;const t=[{rounded:!0},{shadow:!0},n[1],{class:n[0]}];let r={$$slots:{default:[Vr]},$$scope:{ctx:n}};for(let s=0;s<t.length;s+=1)r=cl(r,t[s]);return e=new Er({props:r}),e.$on("show",n[5]),{c(){te(e.$$.fragment)},l(s){le(e.$$.fragment,s)},m(s,o){ne(e,s,o),l=!0},p(s,[o]){const c=o&3?br(t,[t[0],t[1],o&2&&wr(s[1]),o&1&&{class:s[0]}]):{};o&64&&(c.$$scope={dirty:o,ctx:s}),e.$set(c)},i(s){l||(H(e.$$.fragment,s),l=!0)},o(s){O(e.$$.fragment,s),l=!1},d(s){re(e,s)}}}function Sr(n,e,l){const t=["type","defaultClass"];let r=$l(e,t),{$$slots:s={},$$scope:o}=e,{type:c="dark"}=e,{defaultClass:a="py-2 px-3 text-sm font-medium"}=e;const f={dark:"bg-gray-900 text-white dark:bg-gray-700",light:"border-gray-200 bg-white text-gray-900",auto:" bg-white text-gray-900 dark:bg-gray-700 dark:text-white border-gray-200 dark:border-gray-700",custom:""};let p;function d(u){sr.call(this,n,u)}return n.$$set=u=>{l(8,e=cl(cl({},e),bl(u))),l(1,r=$l(e,t)),"type"in u&&l(2,c=u.type),"defaultClass"in u&&l(3,a=u.defaultClass),"$$scope"in u&&l(6,o=u.$$scope)},n.$$.update=()=>{r.color?l(2,c="custom"):l(1,r.color="none",r),["light","auto"].includes(c)&&l(1,r.border=!0,r),l(0,p=kr("tooltip",a,f[c],e.class))},e=bl(e),[p,r,c,a,s,d,o]}class He extends Oe{constructor(e){super(),Re(this,e,Sr,Nr,je,{type:2,defaultClass:3})}}function Yn(n=[],e){const l=n.map(o=>o.logit/e),t=l.map(o=>Math.exp(o)),r=t.reduce((o,c)=>o+c,0);return n.map((o,c)=>({...o,adjustedLogit:l[c],adjustedProbability:t[c]/r,adjustedExp:t[c]}))}function Qn(n,e){const l=n.slice(0,e),t=[];let r=0;for(const o of l)r+=o.probability,t.push(r);const s=Math.random();for(let o=0;o<t.length;o++)if(s<t[o])return l[o];return l[0]}const Mr=!0,si=Object.freeze(Object.defineProperty({__proto__:null,prerender:Mr},Symbol.toStringTag,{value:"Module"}));function Ar(n,e){let l,t;for(const r of n)r!=null&&(l===void 0?r>=r&&(l=t=r):(l>r&&(l=r),t<r&&(t=r)));return[l,t]}function qr(n,e){let l;if(e===void 0)for(const t of n)t!=null&&(l<t||l===void 0&&t>=t)&&(l=t);else{let t=-1;for(let r of n)(r=e(r,++t,n))!=null&&(l<r||l===void 0&&r>=r)&&(l=r)}return l}function Lr(n,e){e===void 0&&(e=n,n=ll);for(var l=0,t=e.length-1,r=e[0],s=new Array(t<0?0:t);l<t;)s[l]=n(r,r=e[++l]);return function(o){var c=Math.max(0,Math.min(t-1,Math.floor(o*=t)));return s[c](o-c)}}function Br(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function zr(){var n=0,e=.5,l=1,t=1,r,s,o,c,a,f=Zn,p,d=!1,u;function _(P){return isNaN(P=+P)?u:(P=.5+((P=+p(P))-s)*(t*P<t*s?c:a),f(d?Math.max(0,Math.min(1,P)):P))}_.domain=function(P){return arguments.length?([n,e,l]=P,r=p(n=+n),s=p(e=+e),o=p(l=+l),c=r===s?0:.5/(s-r),a=s===o?0:.5/(o-s),t=s<r?-1:1,_):[n,e,l]},_.clamp=function(P){return arguments.length?(d=!!P,_):d},_.interpolator=function(P){return arguments.length?(f=P,_):f};function S(P){return function(j){var F,V,R;return arguments.length?([F,V,R]=j,f=Lr(P,[F,V,R]),_):[f(0),f(.5),f(1)]}}return _.range=S(ll),_.rangeRound=S(Cr),_.unknown=function(P){return arguments.length?(u=P,_):u},function(P){return p=P,r=P(n),s=P(e),o=P(l),c=r===s?0:.5/(s-r),a=s===o?0:.5/(o-s),t=s<r?-1:1,_}}function Jn(){var n=yr(zr()(Zn));return n.copy=function(){return Br(n,Jn())},Ir.apply(n,arguments)}const{theme:ae}=wt(kt),_e=200,Il={"gray-blue":{0:ae.colors.gray[_e],100:ae.colors.blue[_e]},"gray-blue-last":{0:ae.colors.gray[_e],100:ae.colors.blue[_e]},"purple-indigo":{0:ae.colors.purple[_e],100:ae.colors.indigo[_e]},"purple-indigo-last":{0:ae.colors.purple[_e],100:ae.colors.indigo[_e]},"indigo-blue":{0:ae.colors.indigo[_e],100:ae.colors.blue[_e]},"indigo-blue-last":{0:ae.colors.indigo[_e],100:ae.colors.blue[_e]},"blue-white":{0:ae.colors.blue[_e],100:ae.colors.white},"red-white":{0:ae.colors.red[_e],100:ae.colors.white},"green-white":{0:ae.colors.green[_e],100:ae.colors.white},"red-purple":{0:ae.colors.red[_e],100:ae.colors.purple[_e]},"blue-purple":{90:ae.colors.blue[_e],100:ae.colors.purple[_e]},"green-purple":{0:ae.colors.green[_e],100:ae.colors.purple[_e]},"blue-gray":{0:ae.colors.blue[_e],50:ae.colors.gray[_e]},"blue-white-blue":{0:ae.colors.blue[_e],40:ae.colors.white,60:ae.colors.white,100:ae.colors.blue[_e]},"blue-white-blue-last":{0:ae.colors.blue[_e],40:ae.colors.white,60:ae.colors.white,100:ae.colors.blue[_e]},"transparent-purple":{0:{color:ae.colors.purple[100],opacity:0},100:{color:ae.colors.purple[200],opacity:1}},"transparent-purple2":{0:{color:ae.colors.purple[400],opacity:0},100:{color:ae.colors.purple[200],opacity:1}},"transparent-purple-last":{0:{color:ae.colors.purple[100],opacity:0},100:{color:ae.colors.purple[200],opacity:1}},"transparent-purple2-last":{0:{color:ae.colors.purple[400],opacity:0},100:{color:ae.colors.purple[200],opacity:1}},"blue-blue":{0:ae.colors.blue[_e],100:ae.colors.blue[_e]},"red-red":{0:ae.colors.red[_e],100:ae.colors.red[_e]},"green-green":{0:ae.colors.green[_e],100:ae.colors.green[_e]},"blue-blue2":{0:ae.colors.blue[_e],100:ae.colors.blue[_e]},"red-red2":{0:ae.colors.red[_e],100:ae.colors.red[_e]},"green-green2":{0:ae.colors.green[_e],100:ae.colors.green[_e]},"blue-blue-last":{0:ae.colors.blue[_e],100:ae.colors.blue[_e]},"red-red-last":{0:ae.colors.red[_e],100:ae.colors.red[_e]},"green-green-last":{0:ae.colors.green[_e],100:ae.colors.green[_e]},"blue-blue2-last":{0:ae.colors.blue[_e],100:ae.colors.blue[_e]},"red-red2-last":{0:ae.colors.red[_e],100:ae.colors.red[_e]},"green-green2-last":{0:ae.colors.green[_e],100:ae.colors.green[_e]},"gray-gray":{0:ae.colors.gray[_e],100:ae.colors.gray[_e]},"purple-purple":{0:ae.colors.purple[_e],100:ae.colors.purple[_e]},"purple-purple-last":{0:ae.colors.purple[_e],100:ae.colors.purple[_e]}},Zt=.5,Tr=.8,qt=1,Cl=.5,Dl=.4,Pr=.8,Hr=.5;function jr(n){let e,l,t,r,s;return{c(){e=Ce("svg"),t=U(),r=Ce("svg"),this.h()},l(o){e=De(o,"svg",{id:!0,class:!0,style:!0}),T(e).forEach($),t=x(o),r=De(o,"svg",{class:!0,style:!0}),T(r).forEach($),this.h()},h(){m(e,"id","back"),m(e,"class","sankey-back absolute left-0 top-0 h-full w-full"),m(e,"style",l=`z-index:${n[2].attention_head_num-1};`),m(r,"class","sankey-top absolute left-0 top-0 h-full w-full"),m(r,"style",s=`z-index:${n[2].attention_head_num};`)},m(o,c){W(o,e,c),n[4](e),W(o,t,c),W(o,r,c),n[5](r)},p(o,[c]){c&4&&l!==(l=`z-index:${o[2].attention_head_num-1};`)&&m(e,"style",l),c&4&&s!==(s=`z-index:${o[2].attention_head_num};`)&&m(r,"style",s)},i:qe,o:qe,d(o){o&&($(e),$(t),$(r)),n[4](null),n[5](null)}}}const Or=80;function Rr(n,e,l){let t,r,s;ye(n,gt,N=>l(3,r=N)),ye(n,zt,N=>l(2,s=N));const{theme:o}=wt(kt);let c,a,f;const p={attention:[{from:".attention .query .head-rest",to:".head-block .query .vector",gradientId:"blue-blue2",opacity:Zt},{from:".attention .key .head-rest",to:".head-block .key .vector",gradientId:"red-red2",opacity:Zt},{from:".attention .value .head-rest",to:".head-block .value .vector",gradientId:"green-green2",opacity:Zt},{from:".attention .head-out .vector",to:".mlp .initial .vector .head-rest",gradientId:"transparent-purple",opacity:Zt}]},d=()=>{const D=Je(a).append("defs");Object.keys(Il).forEach(A=>{const i=Il[A],h=D.append("linearGradient").attr("id",A).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");Object.keys(i).forEach(g=>{let w,E;typeof i[g]!="string"?(w=i[g].color,E=i[g].opacity):(w=i[g],E=1),h.append("stop").attr("offset",`${g}%`).attr("stop-color",w).attr("stop-opacity",E)})})};let u=1,_;const S=(N,D)=>{var A,i;if(clearTimeout(_),fl.set(D),(i=(A=t[D])==null?void 0:A[0])!=null&&i.hoverable){const h=Je(`g.${D}`).selectAll("path");u=h.nodes()[0].getAttribute("opacity"),h.transition().duration(200).style("opacity",Number(u)+.3)}},P=(N,D)=>{var A,i;_=setTimeout(()=>{fl.set(null)},300),(i=(A=t[D])==null?void 0:A[0])!=null&&i.hoverable&&Je(`g.${D}`).selectAll("path").transition().duration(200).style("opacity",u)},j=async()=>{await Ot();const N=Je(a),D=Je(c);[{dataMap:t,svg:N},{dataMap:p,svg:D}].forEach(({dataMap:A,svg:i})=>{i.selectAll("g.path-group").data(Object.keys(A)).join("g").attr("class",g=>`path-group ${g}`).on("mouseenter",S).on("mouseleave",P).selectAll("path.sankey-path").data(g=>A[g].map(E=>{const y=Kt(E.from).nodes(),M=Kt(E.to).nodes();return y.map((v,I)=>{const b=v.getBoundingClientRect(),C=M[I].getBoundingClientRect(),L=E.curve||Or,G=(E.pathGenerator||F)(b,C,L),K=M.length>1&&I===y.length-1;let he=E.gradientId;return K&&!E.unique&&document.getElementById(E.gradientId+"-last")&&(he=E.gradientId+"-last"),{id:E.id,isLast:I===y.length-1,path:G,fill:E.type==="stroke"?"none":E.gradientId?`url(#${he})`:E.fill,opacity:E.opacity,stroke:E.type==="stroke"?E.gradientId?`url(#${E.gradientId})`:E.fill:"none"}})}).flat()).join("path").attr("class",g=>`sankey-path ${g.id||""} ${g.isLast?"last":""}`).attr("fill",g=>g.fill).attr("stroke",g=>g.stroke).attr("stroke-width",2).attr("opacity",g=>g.opacity||1).attr("d",g=>g.path)})},F=(N,D,A)=>{const i=window.scrollY,h=window.scrollX;return`
        M ${N.right+h},${N.top+i}
        C ${N.right+h+A},${N.top+i} ${D.left+h-A},${D.top+i} ${D.left+h},${D.top+i}
        L ${D.left+h},${D.bottom+i}
        C ${D.left+h-A},${D.bottom+i} ${N.right+h+A},${N.bottom+i} ${N.right+h},${N.bottom+i}
        Z
    `};vt(()=>(d(),f=new ResizeObserver(D=>{j(),V()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(D=>f.observe(D)),()=>{f.disconnect()}));const V=()=>{const N=Je(a),D=Kt(".residual-start path.head").nodes(),A=Kt(".residual-end path.head").nodes(),i=D.map((h,g)=>{const w=h.getBoundingClientRect(),E=A[g].getBoundingClientRect(),y=w.right,M=w.top,v=E.left,I=E.top;return{x1:y,y1:M,x2:v,y2:I,id:h.id}});N.selectAll("line.residual-connector").data(i).join("line").attr("class",h=>`residual-connector ${h.id}`).attr("x1",h=>h.x1).attr("y1",h=>h.y1).attr("x2",h=>h.x2).attr("y2",h=>h.y2).attr("stroke",o.colors.gray[400]).attr("stroke-width",1).attr("stroke-dasharray","8,4").style("opacity",0)};function R(N){Qe[N?"unshift":"push"](()=>{c=N,l(0,c)})}function J(N){Qe[N?"unshift":"push"](()=>{a=N,l(1,a)})}return n.$$.update=()=>{n.$$.dirty&8&&(t={embedding:[{hoverable:!0,from:".embedding .vector-column .column.vectors .vector",to:".attention .vector",gradientId:"gray-blue",opacity:Tr,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX,g=30;return`
					M ${N.right+h},${N.top+i}
					L ${N.right+g+h},${N.top+i}
					C ${N.right+g+h+A},${N.top+i} ${D.left+h-A},${D.top+i} ${D.left+h},${D.top+i}
					L ${D.left+h},${D.bottom+i}
					C ${D.left+h-A},${D.bottom+i} ${N.right+g+h+A},${N.bottom+i} ${N.right+g+h},${N.bottom+i}
					L ${N.right+h},${N.bottom+i}
					Z
				`}}],attention:[{from:".attention .query .sub-vector.head1",to:".head-block .query .vector",gradientId:"blue-blue",opacity:qt},{from:".attention .key .sub-vector.head1",to:".head-block .key .vector",gradientId:"red-red",opacity:qt},{from:".attention .value .sub-vector.head1",to:".head-block .value .vector",gradientId:"green-green",opacity:qt},{from:".attention .head-out .vector",to:".mlp .initial .head1",gradientId:"purple-purple",opacity:qt},{from:".head-block .key .vector",to:".attention-initial .main g.g-row",id:"key-to-attention",type:"stroke",gradientId:"red-purple",opacity:qt,unique:!0,curve:30,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX,g=N.top+i+N.height/2,w=D.top+i+D.height/2,E=N.right+h+A,y=D.left+h-A;return`
			    M ${N.right+h},${g}
			    C ${E},${g} ${y},${w} ${D.left+h},${w}
					L ${D.right+h},${w}
			`}},{from:".head-block .query .vector",to:`.attention-matrix.attention-initial .main g.g-row-${r.length-1} circle`,gradientId:"blue-purple",id:"query-to-attention",unique:!0,type:"stroke",opacity:qt,curve:20,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX,g=N.top+i+N.height/2,w=D.left+h+D.width/2;return`
			    M ${N.right+h},${g}
			    L ${w-A},${g}
			    A ${A},${A} 0 0 1 ${w},${g+A}
			    L ${w},${D.bottom+i}
			`}},{from:".attention-matrix.attention-out .main svg",to:".attention .head-out",gradientId:"transparent-purple2",id:"to-attention-out",unique:!0,opacity:Cl,curve:20,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX;return`
			    M ${N.right+h},${N.top+i}
			    C ${N.right+h+A},${N.top+i} ${D.left+h-A},${D.top+i} ${D.left+h},${D.top+i}
			    L ${D.left+h},${D.bottom+i}
			    C ${D.left+h-A},${D.bottom+i} ${N.right+h+A},${N.bottom+i} ${N.right+h},${N.bottom+i}
			    Z
			`}},{from:".head-block .value",to:".attention .head-out",gradientId:"green-purple",id:"to-attention-out",unique:!0,opacity:Cl,curve:60,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX;return`
        M ${N.right+h},${N.top+i} 
        C ${D.left-A},${N.top+i} ${D.left+h-A},${N.top+i} ${D.left+h},${D.top+i}
        L ${D.left+h},${D.bottom+i}
        C ${D.left+h-A},${N.bottom+i} ${D.left-A},${N.bottom+i} ${N.right+h},${N.bottom+i}
        Z
    `}}],mlp:[{from:".mlp .column.initial .vector",to:".mlp .projections .vector",gradientId:"purple-indigo",curve:50,opacity:Dl,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX,g=49;return`
					M ${N.right+h},${N.top+i}
					L ${N.right+g+h},${N.top+i}
					C ${N.right+g+h+A},${N.top+i} ${D.left+h-A},${D.top+i} ${D.left+h},${D.top+i}
					L ${D.left+h},${D.bottom+i}
					C ${D.left+h-A},${D.bottom+i} ${N.right+g+h+A},${N.bottom+i} ${N.right+g+h},${N.bottom+i}
					L ${N.right+h},${N.bottom+i}
					Z
				`}},{from:".mlp .projections .vector",to:".mlp .column.out .vector",gradientId:"indigo-blue",curve:50,opacity:Dl,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX,g=20;return`
					M ${N.right+h},${N.top+i}
					C ${N.right+h+A},${N.top+i} ${D.left-g+h-A},${D.top+i} ${D.left-g+h},${D.top+i}
					L ${D.left+h},${D.top+i}
					L ${D.left+h},${D.bottom+i}
					L ${D.left-g+h},${D.bottom+i}
					C ${D.left-g+h-A},${D.bottom+i} ${N.right+h+A},${N.bottom+i} ${N.right+h},${N.bottom+i}
					L ${N.right+h},${N.bottom+i}
					Z
				`}}],"transformer-blocks":[{from:".mlp .out .vector",to:".transformer-blocks .column.final .vector",gradientId:"blue-white-blue",opacity:Pr,pathGenerator:(N,D,A)=>{const i=window.scrollY,h=window.scrollX;return`
        M ${N.right+h},${N.top+i}
        C ${N.right+h+A},${N.top+i} ${D.left+h-A},${D.top+i} ${D.left+h},${D.top+i}
        L ${D.left+h},${D.bottom+i}
        C ${D.left+h-A},${D.bottom+i} ${N.right+h+A},${N.bottom+i} ${N.right+h},${N.bottom+i}
        Z
    `}}],"linear-softmax":[{from:".transformer-blocks .final .vector.last-token ",to:".softmax .content .vector",gradientId:"blue-gray",opacity:Hr,unique:!0}]}),n.$$.dirty&8&&typeof window<"u"&&r&&(j(),V())},[c,a,s,r,R,J]}class Gr extends Oe{constructor(e){super(),Re(this,e,Rr,jr,je,{})}}function Vl(n,e,l){const t=n.slice();return t[6]=e[l],t[8]=l,t}function Fr(n){let e,l,t,r,s;return{c(){e=B("div"),l=B("div"),r=U(),this.h()},l(o){e=z(o,"DIV",{class:!0,style:!0});var c=T(e);l=z(c,"DIV",{class:!0,style:!0}),T(l).forEach($),r=x(c),c.forEach($),this.h()},h(){m(l,"class","card svelte-1k8s99h"),m(l,"style",t=`width: ${n[1].width}px; height: ${n[1].height}px;`),m(e,"class","rest absolute"),m(e,"style",s=`transform:translate(${n[8]*$t.x}px,${n[8]*$t.y}px) scale(${1-$t.scale*n[8]}); 
      z-index: ${n[2].attention_head_num-n[8]};opacity:${Math.max(.1,1-n[8]*Sl)};`),oe(e,"first",n[8]===1)},m(o,c){W(o,e,c),k(e,l),k(e,r)},p(o,c){c&2&&t!==(t=`width: ${o[1].width}px; height: ${o[1].height}px;`)&&m(l,"style",t),c&4&&s!==(s=`transform:translate(${o[8]*$t.x}px,${o[8]*$t.y}px) scale(${1-$t.scale*o[8]}); 
      z-index: ${o[2].attention_head_num-o[8]};opacity:${Math.max(.1,1-o[8]*Sl)};`)&&m(e,"style",s)},i:qe,o:qe,d(o){o&&$(e)}}}function Ur(n){let e,l,t;const r=n[4].default,s=Rn(r,n,n[3],null);return{c(){e=B("div"),s&&s.c(),l=U(),this.h()},l(o){e=z(o,"DIV",{class:!0});var c=T(e);s&&s.l(c),l=x(c),c.forEach($),this.h()},h(){m(e,"class",de("first-head-content")+" svelte-1k8s99h")},m(o,c){W(o,e,c),s&&s.m(e,null),k(e,l),n[5](e),t=!0},p(o,c){s&&s.p&&(!t||c&8)&&Gn(s,r,o,o[3],t?Un(r,o[3],c,null):Fn(o[3]),null)},i(o){t||(H(s,o),t=!0)},o(o){O(s,o),t=!1},d(o){o&&$(e),s&&s.d(o),n[5](null)}}}function Nl(n){let e,l,t,r;const s=[Ur,Fr],o=[];function c(a,f){return a[8]===0?0:1}return e=c(n),l=o[e]=s[e](n),{c(){l.c(),t=ut()},l(a){l.l(a),t=ut()},m(a,f){o[e].m(a,f),W(a,t,f),r=!0},p(a,f){l.p(a,f)},i(a){r||(H(l),r=!0)},o(a){O(l),r=!1},d(a){a&&$(t),o[e].d(a)}}}function xr(n){let e,l,t=be(Array(n[2].attention_head_num+1).fill(0)),r=[];for(let o=0;o<t.length;o+=1)r[o]=Nl(Vl(n,t,o));const s=o=>O(r[o],1,1,()=>{r[o]=null});return{c(){e=B("div");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){e=z(o,"DIV",{class:!0});var c=T(e);for(let a=0;a<r.length;a+=1)r[a].l(c);c.forEach($),this.h()},h(){m(e,"class","multi-head flex w-full svelte-1k8s99h")},m(o,c){W(o,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);l=!0},p(o,[c]){if(c&15){t=be(Array(o[2].attention_head_num+1).fill(0));let a;for(a=0;a<t.length;a+=1){const f=Vl(o,t,a);r[a]?(r[a].p(f,c),H(r[a],1)):(r[a]=Nl(f),r[a].c(),H(r[a],1),r[a].m(e,null))}for(Ne(),a=t.length;a<r.length;a+=1)s(a);Se()}},i(o){if(!l){for(let c=0;c<t.length;c+=1)H(r[c]);l=!0}},o(o){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)O(r[c]);l=!1},d(o){o&&$(e),Ae(r,o)}}}let Sl=.1;function Wr(n,e,l){let t;ye(n,zt,f=>l(2,t=f));let{$$slots:r={},$$scope:s}=e,o,c={width:0,height:0};vt(()=>{const f=new ResizeObserver(p=>{for(let d of p){const{width:u,height:_}=d.contentRect;l(1,c={width:u,height:_})}});return f.observe(o),()=>{f.unobserve(o)}});function a(f){Qe[f?"unshift":"push"](()=>{o=f,l(0,o)})}return n.$$set=f=>{"$$scope"in f&&l(3,s=f.$$scope)},[o,c,t,s,r,a]}class Xr extends Oe{constructor(e){super(),Re(this,e,Wr,xr,je,{})}}const Kr=(n,e)=>{const l=e.filter(r=>r!==1),t=(r,s)=>{if(s.length===1)return r.splice(0,s[0]);const o=s[0],c=s.slice(1);return Array.from({length:o},()=>t(r,c))};return t(n,l)},mt=n=>n.map((e,l)=>{let t=new Array(e.length).fill(-1/0);for(let r=0;r<=l&&r<e.length;r++)t[r]=e[r];return t});function Zr(n){let e,l;return e=new Et({props:{math:"Q \\cdot K^T"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Yr(n){let e,l;return e=new Et({props:{math:"\\frac{QK^T}{\\sqrt{d_k}} + M"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Qr(n){let e,l;return e=new Et({props:{math:"\\text{Dropout}(\\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}} + M))"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Jr(n){var ml,_l;let e,l,t,r,s,o,c="Dot product",a,f,p,d,u,_=((ml=n[1][0])==null?void 0:ml.toFixed(1))+"",S,P,j,F,V,R=((_l=n[1][1])==null?void 0:_l.toFixed(1))+"",J,N,D,A,i,h,g,w,E,y,M,v,I,b="Scaling · Mask",C,L,q,G,K='<span class="val svelte-1v8zpbw">-3.0</span> <div class="bar svelte-1v8zpbw"></div> <span class="val svelte-1v8zpbw">3.0</span>',he,Y,fe,pe,ce,Ue,ee,se,X,$e,Me,Z="Softmax · Dropout",ie,Q,Ve,Ke,Be='<span class="val svelte-1v8zpbw">-1.0</span> <div class="bar svelte-1v8zpbw"></div> <span class="val svelte-1v8zpbw">1.0</span>',ht,Nt,Pe,rt,St,ze,pl="Attention",Ft,vl,Ut,xt,st,rl,gl;return r=new At({props:{className:"main",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),f=new He({props:{class:"popover tooltip",$$slots:{default:[Zr]},$$scope:{ctx:n}}}),E=new At({props:{className:"prev absolute top-0 left-0 pointer-events-none",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),M=new At({props:{className:"main opacity-0",data:mt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),L=new He({props:{class:"popover tooltip",$$slots:{default:[Yr]},$$scope:{ctx:n}}}),ee=new At({props:{className:"prev absolute top-0 left-0  pointer-events-none",data:mt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),X=new At({props:{className:"main opacity-0",data:mt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),Q=new He({props:{class:"popover tooltip",$$slots:{default:[Qr]},$$scope:{ctx:n}}}),rt=new At({props:{className:"main",data:mt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),{c(){e=B("div"),l=B("div"),t=B("div"),te(r.$$.fragment),s=U(),o=B("div"),o.textContent=c,a=U(),te(f.$$.fragment),p=U(),d=B("div"),u=B("span"),S=ve(_),P=U(),j=B("div"),F=U(),V=B("span"),J=ve(R),D=U(),A=B("div"),i=Ce("svg"),h=Ce("path"),g=U(),w=B("div"),te(E.$$.fragment),y=U(),te(M.$$.fragment),v=U(),I=B("div"),I.textContent=b,C=U(),te(L.$$.fragment),q=U(),G=B("div"),G.innerHTML=K,he=U(),Y=B("div"),fe=Ce("svg"),pe=Ce("path"),ce=U(),Ue=B("div"),te(ee.$$.fragment),se=U(),te(X.$$.fragment),$e=U(),Me=B("div"),Me.textContent=Z,ie=U(),te(Q.$$.fragment),Ve=U(),Ke=B("div"),Ke.innerHTML=Be,Nt=U(),Pe=B("div"),te(rt.$$.fragment),St=U(),ze=B("div"),ze.textContent=pl,this.h()},l(me){e=z(me,"DIV",{class:!0,style:!0});var Ee=T(e);l=z(Ee,"DIV",{role:!0,class:!0});var Ze=T(l);t=z(Ze,"DIV",{class:!0});var ot=T(t);le(r.$$.fragment,ot),s=x(ot),o=z(ot,"DIV",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-8hsrtb"&&(o.textContent=c),a=x(ot),le(f.$$.fragment,ot),p=x(ot),d=z(ot,"DIV",{class:!0});var et=T(d);u=z(et,"SPAN",{class:!0});var yt=T(u);S=ge(yt,_),yt.forEach($),P=x(et),j=z(et,"DIV",{class:!0}),T(j).forEach($),F=x(et),V=z(et,"SPAN",{class:!0});var Pt=T(V);J=ge(Pt,R),Pt.forEach($),et.forEach($),ot.forEach($),D=x(Ze),A=z(Ze,"DIV",{class:!0});var We=T(A);i=De(We,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var It=T(i);h=De(It,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(h).forEach($),It.forEach($),g=x(We),w=z(We,"DIV",{});var Ct=T(w);le(E.$$.fragment,Ct),y=x(Ct),le(M.$$.fragment,Ct),Ct.forEach($),v=x(We),I=z(We,"DIV",{class:!0,"data-svelte-h":!0}),Ie(I)!=="svelte-15vmxu9"&&(I.textContent=b),C=x(We),le(L.$$.fragment,We),q=x(We),G=z(We,"DIV",{class:!0,"data-svelte-h":!0}),Ie(G)!=="svelte-bz6asq"&&(G.innerHTML=K),We.forEach($),he=x(Ze),Y=z(Ze,"DIV",{class:!0});var Xe=T(Y);fe=De(Xe,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var Ht=T(fe);pe=De(Ht,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(pe).forEach($),Ht.forEach($),ce=x(Xe),Ue=z(Xe,"DIV",{});var Dt=T(Ue);le(ee.$$.fragment,Dt),se=x(Dt),le(X.$$.fragment,Dt),Dt.forEach($),$e=x(Xe),Me=z(Xe,"DIV",{class:!0,"data-svelte-h":!0}),Ie(Me)!=="svelte-1fyrzav"&&(Me.textContent=Z),ie=x(Xe),le(Q.$$.fragment,Xe),Ve=x(Xe),Ke=z(Xe,"DIV",{class:!0,"data-svelte-h":!0}),Ie(Ke)!=="svelte-1lh8vbm"&&(Ke.innerHTML=Be),Xe.forEach($),Nt=x(Ze),Pe=z(Ze,"DIV",{class:!0});var Wt=T(Pe);le(rt.$$.fragment,Wt),St=x(Wt),ze=z(Wt,"DIV",{class:!0,"data-svelte-h":!0}),Ie(ze)!=="svelte-10aghm9"&&(ze.textContent=pl),Wt.forEach($),Ze.forEach($),Ee.forEach($),this.h()},h(){m(o,"class","matrix-label svelte-1v8zpbw"),m(u,"class","val svelte-1v8zpbw"),m(j,"class","bar svelte-1v8zpbw"),m(V,"class","val svelte-1v8zpbw"),m(d,"class","color-scale svelte-1v8zpbw"),m(t,"class",N=de(ue("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":n[0]}))+" svelte-1v8zpbw"),m(h,"stroke","currentColor"),m(h,"stroke-linecap","round"),m(h,"stroke-linejoin","round"),m(h,"stroke-width","2"),m(h,"d","M19 12H5m14 0-4 4m4-4-4-4"),m(i,"class","arrow svelte-1v8zpbw"),m(i,"aria-hidden","true"),m(i,"xmlns","http://www.w3.org/2000/svg"),m(i,"width","24"),m(i,"height","24"),m(i,"fill","none"),m(i,"viewBox","0 0 24 24"),m(I,"class","matrix-label svelte-1v8zpbw"),m(G,"class","color-scale svelte-1v8zpbw"),m(A,"class","attention-matrix attention-mask flex flex-col items-center svelte-1v8zpbw"),m(pe,"stroke","currentColor"),m(pe,"stroke-linecap","round"),m(pe,"stroke-linejoin","round"),m(pe,"stroke-width","2"),m(pe,"d","M19 12H5m14 0-4 4m4-4-4-4"),m(fe,"class","arrow svelte-1v8zpbw"),m(fe,"aria-hidden","true"),m(fe,"xmlns","http://www.w3.org/2000/svg"),m(fe,"width","24"),m(fe,"height","24"),m(fe,"fill","none"),m(fe,"viewBox","0 0 24 24"),m(Me,"class","matrix-label svelte-1v8zpbw"),m(Ke,"class","color-scale svelte-1v8zpbw"),m(Y,"class",ht=de(ue("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":n[0]}))+" svelte-1v8zpbw"),m(ze,"class","matrix-label svelte-1v8zpbw"),m(Pe,"class",Ft=de(ue("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!n[0],"attention-out":!n[0]}))+" svelte-1v8zpbw"),Lt(()=>n[24].call(Pe)),m(l,"role","none"),m(l,"class",Ut=de(ue("attention-matrix-container relative flex",{active:n[0]}))+" svelte-1v8zpbw"),m(e,"class","flex items-center gap-8 px-5"),m(e,"style",xt=`--attention-matrix-width: ${n[7]}px;`)},m(me,Ee){W(me,e,Ee),k(e,l),k(l,t),ne(r,t,null),k(t,s),k(t,o),k(t,a),ne(f,t,null),k(t,p),k(t,d),k(d,u),k(u,S),k(d,P),k(d,j),k(d,F),k(d,V),k(V,J),n[20](t),k(l,D),k(l,A),k(A,i),k(i,h),k(A,g),k(A,w),ne(E,w,null),k(w,y),ne(M,w,null),k(A,v),k(A,I),k(A,C),ne(L,A,null),k(A,q),k(A,G),n[21](A),k(l,he),k(l,Y),k(Y,fe),k(fe,pe),k(Y,ce),k(Y,Ue),ne(ee,Ue,null),k(Ue,se),ne(X,Ue,null),k(Y,$e),k(Y,Me),k(Y,ie),ne(Q,Y,null),k(Y,Ve),k(Y,Ke),n[22](Y),k(l,Nt),k(l,Pe),ne(rt,Pe,null),k(Pe,St),k(Pe,ze),n[23](Pe),vl=xn(Pe,n[24].bind(Pe)),n[25](l),st=!0,rl||(gl=[ke(l,"click",n[13]),ke(l,"keydown",n[13])],rl=!0)},p(me,Ee){var Ht,Dt;const Ze={};Ee[0]&4&&(Ze.data=me[2]),Ee[0]&1024&&(Ze.cellHeight=me[10]),Ee[0]&1024&&(Ze.cellWidth=me[10]),Ee[0]&512&&(Ze.colorScale=me[9]),r.$set(Ze);const ot={};Ee[1]&4&&(ot.$$scope={dirty:Ee,ctx:me}),f.$set(ot),(!st||Ee[0]&2)&&_!==(_=((Ht=me[1][0])==null?void 0:Ht.toFixed(1))+"")&&Le(S,_),(!st||Ee[0]&2)&&R!==(R=((Dt=me[1][1])==null?void 0:Dt.toFixed(1))+"")&&Le(J,R),(!st||Ee[0]&1&&N!==(N=de(ue("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":me[0]}))+" svelte-1v8zpbw"))&&m(t,"class",N);const et={};Ee[0]&4&&(et.data=me[2]),Ee[0]&1024&&(et.cellHeight=me[10]),Ee[0]&1024&&(et.cellWidth=me[10]),Ee[0]&512&&(et.colorScale=me[9]),E.$set(et);const yt={};Ee[0]&4096&&(yt.data=mt(me[12])),Ee[0]&1024&&(yt.cellHeight=me[10]),Ee[0]&1024&&(yt.cellWidth=me[10]),M.$set(yt);const Pt={};Ee[1]&4&&(Pt.$$scope={dirty:Ee,ctx:me}),L.$set(Pt);const We={};Ee[0]&4096&&(We.data=mt(me[12])),Ee[0]&1024&&(We.cellHeight=me[10]),Ee[0]&1024&&(We.cellWidth=me[10]),ee.$set(We);const It={};Ee[0]&2048&&(It.data=mt(me[11])),Ee[0]&1024&&(It.cellHeight=me[10]),Ee[0]&1024&&(It.cellWidth=me[10]),X.$set(It);const Ct={};Ee[1]&4&&(Ct.$$scope={dirty:Ee,ctx:me}),Q.$set(Ct),(!st||Ee[0]&1&&ht!==(ht=de(ue("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":me[0]}))+" svelte-1v8zpbw"))&&m(Y,"class",ht);const Xe={};Ee[0]&2048&&(Xe.data=mt(me[11])),Ee[0]&1024&&(Xe.cellHeight=me[10]),Ee[0]&1024&&(Xe.cellWidth=me[10]),rt.$set(Xe),(!st||Ee[0]&1&&Ft!==(Ft=de(ue("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!me[0],"attention-out":!me[0]}))+" svelte-1v8zpbw"))&&m(Pe,"class",Ft),(!st||Ee[0]&1&&Ut!==(Ut=de(ue("attention-matrix-container relative flex",{active:me[0]}))+" svelte-1v8zpbw"))&&m(l,"class",Ut),(!st||Ee[0]&128&&xt!==(xt=`--attention-matrix-width: ${me[7]}px;`))&&m(e,"style",xt)},i(me){st||(H(r.$$.fragment,me),H(f.$$.fragment,me),H(E.$$.fragment,me),H(M.$$.fragment,me),H(L.$$.fragment,me),H(ee.$$.fragment,me),H(X.$$.fragment,me),H(Q.$$.fragment,me),H(rt.$$.fragment,me),st=!0)},o(me){O(r.$$.fragment,me),O(f.$$.fragment,me),O(E.$$.fragment,me),O(M.$$.fragment,me),O(L.$$.fragment,me),O(ee.$$.fragment,me),O(X.$$.fragment,me),O(Q.$$.fragment,me),O(rt.$$.fragment,me),st=!1},d(me){me&&$(e),re(r),re(f),n[20](null),re(E),re(M),re(L),n[21](null),re(ee),re(X),re(Q),n[22](null),re(rt),n[23](null),vl(),n[25](null),rl=!1,Fe(gl)}}}let es=16,ts=20,ls=10;function ns(n,e,l){let t,r,s,o,c,a,f,p,d,u;ye(n,gt,q=>l(17,p=q)),ye(n,xe,q=>l(18,d=q)),ye(n,Tt,q=>l(19,u=q));const{theme:_}=wt(kt);let S,P,j,F,V=0,R=!1;const J=el("block-id"),N=()=>{R||(xe.set({id:J}),g())};let D;function A(q){R&&!D.contains(q.target)&&xe.set({id:null})}vt(()=>(document.body.addEventListener("click",A),()=>{document.body.removeEventListener("click",A)}));let i=pt.timeline(),h=pt.timeline();const g=()=>{l(0,R=!0),h.progress(1);const q=document.querySelectorAll("div.sankey g.attention path.key-to-attention"),G=document.querySelectorAll("div.sankey g.attention path.query-to-attention"),K=document.querySelectorAll("div.sankey g.attention path.to-attention-out");[...q,...G].forEach(fe=>{const pe=fe.getTotalLength();fe.style.strokeDasharray=pe,fe.style.strokeDashoffset=pe});const he=1.2,Y=Number((he/p.length).toFixed(2));i.set([P.querySelector(".prev"),j.querySelector(".prev")],{opacity:1}).set([P.querySelector(".main"),j.querySelector(".main")],{opacity:0}),i.set(K,{opacity:0}),i.to(F,{opacity:0,display:"none",duration:.2}),i.set(S,{width:"auto",display:"flex",opacity:0}).to(S,{opacity:1,duration:.5}).to(q,{strokeDashoffset:0,stagger:Y,duration:he,ease:"power2.out"}).to(G,{strokeDashoffset:0,stagger:Y,duration:he,ease:"power2.out"},"<").from(S.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:he/p.length,stagger:Number((he/Math.pow(p.length,2)).toFixed(2)),ease:"power2.out",duration:he},"<"),i.set(P,{width:0,x:V*-1,opacity:0}).to(P,{opacity:1,display:"flex",width:V,x:0,duration:.5}).to(P.querySelector(".prev"),{opacity:0,duration:1}).to(P.querySelector(".main"),{opacity:1,duration:1},"<"),i.set(j,{width:0,x:V*-1,opacity:0}).to(j,{opacity:1,display:"flex",width:V,x:0,duration:.4}).to(j.querySelector(".prev"),{opacity:0,duration:1}).to(j.querySelector(".main"),{opacity:1,duration:1},"<"),i.to(K,{opacity:.4})},w=()=>{l(0,R=!1),i.progress(1),h.to([S,P,j],{opacity:0,display:"none",width:0,duration:.5}),h.to(F,{opacity:1,display:"flex",duration:.5},0)},E=(q,G)=>hl().domain([-3,3]).range(["white",_.colors.purple[700]])(q),y=(q,G)=>ll("white",_.colors.purple[700])(q);function M(q){Qe[q?"unshift":"push"](()=>{S=q,l(3,S)})}function v(q){Qe[q?"unshift":"push"](()=>{P=q,l(4,P)})}function I(q){Qe[q?"unshift":"push"](()=>{j=q,l(5,j)})}function b(q){Qe[q?"unshift":"push"](()=>{F=q,l(6,F)})}function C(){V=this.offsetWidth,l(7,V)}function L(q){Qe[q?"unshift":"push"](()=>{D=q,l(8,D)})}return n.$$.update=()=>{var q,G,K,he,Y,fe;n.$$.dirty[0]&131072&&l(16,t=Array(p.length).fill(0).map(pe=>Array(p.length).fill(-1/0))),n.$$.dirty[0]&589824&&l(2,r=((G=(q=u==null?void 0:u.outputs)==null?void 0:q.block_0_attn_head_0_attn)==null?void 0:G.data)||t),n.$$.dirty[0]&589824&&l(12,s=((he=(K=u==null?void 0:u.outputs)==null?void 0:K.block_0_attn_head_0_attn_masked)==null?void 0:he.data)||t),n.$$.dirty[0]&589824&&l(11,o=((fe=(Y=u==null?void 0:u.outputs)==null?void 0:Y.block_0_attn_head_0_attn_dropout)==null?void 0:fe.data)||t),n.$$.dirty[0]&131072&&l(10,c=Math.min(ts,Math.max(1/p.length*es*6,ls))),n.$$.dirty[0]&262145&&d.id!==J&&R&&(l(0,R=!1),w()),n.$$.dirty[0]&4&&l(1,a=Ar(r.flat())),n.$$.dirty[0]&2&&l(9,f=(pe,ce)=>hl().domain(a).range(["white",_.colors.purple[700]])(pe))},[R,a,r,S,P,j,F,V,D,f,c,o,s,N,E,y,t,p,d,u,M,v,I,b,C,L]}class rs extends Oe{constructor(e){super(),Re(this,e,ns,Jr,je,{},null,[-1,-1])}}function ss(n){let e;return{c(){e=B("canvas"),this.h()},l(l){e=z(l,"CANVAS",{class:!0}),T(e).forEach($),this.h()},h(){m(e,"class","svelte-ex5m8"),oe(e,"active",n[0])},m(l,t){W(l,e,t),n[4](e)},p(l,[t]){t&1&&oe(e,"active",l[0])},i:qe,o:qe,d(l){l&&$(e),n[4](null)}}}let os=100;const sl=1;function is(n,e,l){const{theme:t}=wt(kt);let{active:r=!1}=e,{data:s=new Array(os).fill(0).map(u=>Math.random())}=e,{colorScale:o=void 0}=e,c;const a=typeof o=="string"?o:"gray",f=typeof o=="function"?o:ll(t.colors[a][100],t.colors[a][400]);function p(){const u=c.getContext("2d");if(!u)return;const _=c.parentElement.clientWidth,S=c.parentElement.clientHeight;u.clearRect(0,0,_,S);let P=4;l(1,c.width=_*P,c),l(1,c.height=S*P,c),l(1,c.style.width=`${_}px`,c),l(1,c.style.height=`${S}px`,c);for(let j=0;j<S/sl;j++){const F=s[j];u.fillStyle=f(F),u.fillRect(0,j*sl*P,_*P,sl*P)}}vt(()=>{const u=Jt.subscribe(p);return()=>{u()}});function d(u){Qe[u?"unshift":"push"](()=>{c=u,l(1,c)})}return n.$$set=u=>{"active"in u&&l(0,r=u.active),"data"in u&&l(2,s=u.data),"colorScale"in u&&l(3,o=u.colorScale)},n.$$.update=()=>{n.$$.dirty&6&&s&&c&&p()},[r,c,s,o,d]}class ft extends Oe{constructor(e){super(),Re(this,e,is,ss,je,{active:0,data:2,colorScale:3})}}function Ml(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Al(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function ql(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Ll(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Bl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function zl(n){let e,l="Q";return{c(){e=B("span"),e.textContent=l},l(t){e=z(t,"SPAN",{"data-svelte-h":!0}),Ie(e)!=="svelte-10ub4hf"&&(e.textContent=l)},m(t,r){W(t,e,r)},d(t){t&&$(e)}}}function Tl(n){let e,l="K";return{c(){e=B("span"),e.textContent=l},l(t){e=z(t,"SPAN",{"data-svelte-h":!0}),Ie(e)!=="svelte-1c09r6x"&&(e.textContent=l)},m(t,r){W(t,e,r)},d(t){t&&$(e)}}}function Pl(n){let e,l="V";return{c(){e=B("span"),e.textContent=l},l(t){e=z(t,"SPAN",{"data-svelte-h":!0}),Ie(e)!=="svelte-j40kxg"&&(e.textContent=l)},m(t,r){W(t,e,r)},d(t){t&&$(e)}}}function as(n){let e,l=n[5].dimension*3+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension*3+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Hl(n){let e,l,t,r,s,o,c,a,f,p,d,u,_,S,P,j,F,V,R,J,N,D,A,i,h,g;t=new ft({props:{colorScale:"blue",active:n[2]===n[16]}});let w=n[2]!==n[16]&&zl();p=new ft({props:{colorScale:"red",active:n[2]===n[16]}});let E=n[2]!==n[16]&&Tl();F=new ft({props:{colorScale:"green",active:n[2]===n[16]}});let y=n[2]!==n[16]&&Pl();function M(){return n[11](n[16])}return A=new He({props:{placement:"right",class:"popover",$$slots:{default:[as]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),te(t.$$.fragment),r=U(),s=B("div"),o=U(),c=B("div"),w&&w.c(),a=U(),f=B("div"),te(p.$$.fragment),d=U(),u=B("div"),_=U(),S=B("div"),E&&E.c(),P=U(),j=B("div"),te(F.$$.fragment),V=U(),R=B("div"),J=U(),N=B("div"),y&&y.c(),D=U(),te(A.$$.fragment),this.h()},l(v){e=z(v,"DIV",{class:!0,role:!0});var I=T(e);l=z(I,"DIV",{class:!0});var b=T(l);le(t.$$.fragment,b),r=x(b),s=z(b,"DIV",{class:!0}),T(s).forEach($),o=x(b),c=z(b,"DIV",{class:!0});var C=T(c);w&&w.l(C),C.forEach($),b.forEach($),a=x(I),f=z(I,"DIV",{class:!0});var L=T(f);le(p.$$.fragment,L),d=x(L),u=z(L,"DIV",{class:!0}),T(u).forEach($),_=x(L),S=z(L,"DIV",{class:!0});var q=T(S);E&&E.l(q),q.forEach($),L.forEach($),P=x(I),j=z(I,"DIV",{class:!0});var G=T(j);le(F.$$.fragment,G),V=x(G),R=z(G,"DIV",{class:!0}),T(R).forEach($),J=x(G),N=z(G,"DIV",{class:!0});var K=T(N);y&&y.l(K),K.forEach($),G.forEach($),I.forEach($),D=x(v),le(A.$$.fragment,v),this.h()},h(){m(s,"class",de(`sub-vector x1-12 head1 ${er}`)+" svelte-1hsibq9"),m(c,"class","sub-vector head-rest grow svelte-1hsibq9"),m(l,"class",de(`sub-vector query relative flex grow flex-col ${vs}`)+" svelte-1hsibq9"),m(u,"class",de(`sub-vector x1-12 head1 ${tr}`)+" svelte-1hsibq9"),m(S,"class","sub-vector head-rest grow svelte-1hsibq9"),m(f,"class",de(`sub-vector key relative flex grow flex-col ${gs}`)+" svelte-1hsibq9"),m(R,"class",de(`sub-vector x1-12 head1 ${lr}`)+" svelte-1hsibq9"),m(N,"class","sub-vector head-rest grow svelte-1hsibq9"),m(j,"class",de(`sub-vector value relative flex grow flex-col ${ms}`)+" svelte-1hsibq9"),m(e,"class","qkv-weighted vector x3 flex flex-col"),m(e,"role","group"),oe(e,"last",n[16]===n[6].length-1)},m(v,I){W(v,e,I),k(e,l),ne(t,l,null),k(l,r),k(l,s),k(l,o),k(l,c),w&&w.m(c,null),k(e,a),k(e,f),ne(p,f,null),k(f,d),k(f,u),k(f,_),k(f,S),E&&E.m(S,null),k(e,P),k(e,j),ne(F,j,null),k(j,V),k(j,R),k(j,J),k(j,N),y&&y.m(N,null),W(v,D,I),ne(A,v,I),i=!0,h||(g=[ke(e,"mouseenter",M),ke(e,"mouseleave",n[12])],h=!0)},p(v,I){n=v;const b={};I&4&&(b.active=n[2]===n[16]),t.$set(b),n[2]!==n[16]?w||(w=zl(),w.c(),w.m(c,null)):w&&(w.d(1),w=null);const C={};I&4&&(C.active=n[2]===n[16]),p.$set(C),n[2]!==n[16]?E||(E=Tl(),E.c(),E.m(S,null)):E&&(E.d(1),E=null);const L={};I&4&&(L.active=n[2]===n[16]),F.$set(L),n[2]!==n[16]?y||(y=Pl(),y.c(),y.m(N,null)):y&&(y.d(1),y=null),(!i||I&64)&&oe(e,"last",n[16]===n[6].length-1);const q={};I&2097184&&(q.$$scope={dirty:I,ctx:n}),A.$set(q)},i(v){i||(H(t.$$.fragment,v),H(p.$$.fragment,v),H(F.$$.fragment,v),H(A.$$.fragment,v),i=!0)},o(v){O(t.$$.fragment,v),O(p.$$.fragment,v),O(F.$$.fragment,v),O(A.$$.fragment,v),i=!1},d(v){v&&($(e),$(D)),re(t),w&&w.d(),re(p),E&&E.d(),re(F),y&&y.d(),re(A,v),h=!1,Fe(g)}}}function cs(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,r;return{c(){e=ve("Query, Head 1, vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"Query, Head 1, vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension/s[5].attention_head_num+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function jl(n){let e,l,t=n[14]+"",r,s,o,c,a,f;return a=new He({props:{placement:"right",class:"popover",$$slots:{default:[cs]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),o=B("div"),c=U(),te(a.$$.fragment),this.h()},l(p){e=z(p,"DIV",{class:!0});var d=T(e);l=z(d,"SPAN",{class:!0});var u=T(l);r=ge(u,t),u.forEach($),s=x(d),o=z(d,"DIV",{class:!0}),T(o).forEach($),d.forEach($),c=x(p),le(a.$$.fragment,p),this.h()},h(){m(l,"class","label float svelte-1hsibq9"),m(o,"class",de(`vector x1-12  ${er}`)+" svelte-1hsibq9"),m(e,"class","head1 cell x1-12 text-xs"),oe(e,"last",n[16]===n[6].length-1)},m(p,d){W(p,e,d),k(e,l),k(l,r),k(e,s),k(e,o),W(p,c,d),ne(a,p,d),f=!0},p(p,d){(!f||d&64)&&t!==(t=p[14]+"")&&Le(r,t),(!f||d&64)&&oe(e,"last",p[16]===p[6].length-1);const u={};d&2097184&&(u.$$scope={dirty:d,ctx:p}),a.$set(u)},i(p){f||(H(a.$$.fragment,p),f=!0)},o(p){O(a.$$.fragment,p),f=!1},d(p){p&&($(e),$(c)),re(a,p)}}}function fs(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,r;return{c(){e=ve("Key, Head 1, vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"Key, Head 1, vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension/s[5].attention_head_num+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Ol(n){let e,l,t=n[14]+"",r,s,o,c,a,f,p;return f=new He({props:{placement:"right",class:"popover",$$slots:{default:[fs]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),o=B("div"),a=U(),te(f.$$.fragment),this.h()},l(d){e=z(d,"DIV",{class:!0});var u=T(e);l=z(u,"SPAN",{class:!0});var _=T(l);r=ge(_,t),_.forEach($),s=x(u),o=z(u,"DIV",{class:!0}),T(o).forEach($),u.forEach($),a=x(d),le(f.$$.fragment,d),this.h()},h(){m(l,"class","label float svelte-1hsibq9"),m(o,"class",de(`vector x1-12 ${tr}`)+" svelte-1hsibq9"),m(e,"class",c="head1 cell x1-12 text-xs class:last="+(n[16]===n[6].length-1)+" svelte-1hsibq9")},m(d,u){W(d,e,u),k(e,l),k(l,r),k(e,s),k(e,o),W(d,a,u),ne(f,d,u),p=!0},p(d,u){(!p||u&64)&&t!==(t=d[14]+"")&&Le(r,t),(!p||u&64&&c!==(c="head1 cell x1-12 text-xs class:last="+(d[16]===d[6].length-1)+" svelte-1hsibq9"))&&m(e,"class",c);const _={};u&2097184&&(_.$$scope={dirty:u,ctx:d}),f.$set(_)},i(d){p||(H(f.$$.fragment,d),p=!0)},o(d){O(f.$$.fragment,d),p=!1},d(d){d&&($(e),$(a)),re(f,d)}}}function us(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,r;return{c(){e=ve("Value, Head 1, vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"Value, Head 1, vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension/s[5].attention_head_num+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Rl(n){let e,l,t=n[14]+"",r,s,o,c,a,f;return a=new He({props:{placement:"right",class:"popover",$$slots:{default:[us]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),o=B("div"),c=U(),te(a.$$.fragment),this.h()},l(p){e=z(p,"DIV",{class:!0});var d=T(e);l=z(d,"SPAN",{class:!0});var u=T(l);r=ge(u,t),u.forEach($),s=x(d),o=z(d,"DIV",{class:!0}),T(o).forEach($),d.forEach($),c=x(p),le(a.$$.fragment,p),this.h()},h(){m(l,"class","label float svelte-1hsibq9"),m(o,"class",de(`vector x1-12 ${lr}`)+" svelte-1hsibq9"),m(e,"class","head1 cell x1-12 text-xs"),oe(e,"last",n[16]===n[6].length-1)},m(p,d){W(p,e,d),k(e,l),k(l,r),k(e,s),k(e,o),W(p,c,d),ne(a,p,d),f=!0},p(p,d){(!f||d&64)&&t!==(t=p[14]+"")&&Le(r,t),(!f||d&64)&&oe(e,"last",p[16]===p[6].length-1);const u={};d&2097184&&(u.$$scope={dirty:d,ctx:p}),a.$set(u)},i(p){f||(H(a.$$.fragment,p),f=!0)},o(p){O(a.$$.fragment,p),f=!1},d(p){p&&($(e),$(c)),re(a,p)}}}function hs(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,r;return{c(){e=ve("Attention Out, Head 1, vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"Attention Out, Head 1, vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension/s[5].attention_head_num+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Gl(n){let e,l,t,r,s;return r=new He({props:{placement:"right",class:"popover",$$slots:{default:[hs]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),t=U(),te(r.$$.fragment),this.h()},l(o){e=z(o,"DIV",{class:!0});var c=T(e);l=z(c,"DIV",{class:!0}),T(l).forEach($),c.forEach($),t=x(o),le(r.$$.fragment,o),this.h()},h(){m(l,"class",de(`vector x1-12 ${_s}`)+" svelte-1hsibq9"),m(e,"class","head1 cell x1-12"),oe(e,"last",n[16]===n[6].length-1)},m(o,c){W(o,e,c),k(e,l),W(o,t,c),ne(r,o,c),s=!0},p(o,c){(!s||c&64)&&oe(e,"last",o[16]===o[6].length-1);const a={};c&2097184&&(a.$$scope={dirty:c,ctx:o}),r.$set(a)},i(o){s||(H(r.$$.fragment,o),s=!0)},o(o){O(r.$$.fragment,o),s=!1},d(o){o&&($(e),$(t)),re(r,o)}}}function ds(n){let e,l,t,r,s="Query",o,c,a,f,p="Key",d,u,_,S,P="Value",j,F,V,R,J,N,D,A,i="Out",h,g,w,E,y=n[5].attention_head_num+"",M,v,I,b=be(n[6]),C=[];for(let ee=0;ee<b.length;ee+=1)C[ee]=jl(Ll(n,b,ee));const L=ee=>O(C[ee],1,1,()=>{C[ee]=null});let q=be(n[6]),G=[];for(let ee=0;ee<q.length;ee+=1)G[ee]=Ol(ql(n,q,ee));const K=ee=>O(G[ee],1,1,()=>{G[ee]=null});let he=be(n[6]),Y=[];for(let ee=0;ee<he.length;ee+=1)Y[ee]=Rl(Al(n,he,ee));const fe=ee=>O(Y[ee],1,1,()=>{Y[ee]=null});R=new rs({});let pe=be(n[6]),ce=[];for(let ee=0;ee<pe.length;ee+=1)ce[ee]=Gl(Ml(n,pe,ee));const Ue=ee=>O(ce[ee],1,1,()=>{ce[ee]=null});return{c(){e=B("div"),l=B("div"),t=B("div"),r=B("div"),r.textContent=s,o=U();for(let ee=0;ee<C.length;ee+=1)C[ee].c();c=U(),a=B("div"),f=B("div"),f.textContent=p,d=U();for(let ee=0;ee<G.length;ee+=1)G[ee].c();u=U(),_=B("div"),S=B("div"),S.textContent=P,j=U();for(let ee=0;ee<Y.length;ee+=1)Y[ee].c();F=U(),V=B("div"),te(R.$$.fragment),J=U(),N=B("div"),D=B("div"),A=B("div"),A.textContent=i,h=U();for(let ee=0;ee<ce.length;ee+=1)ce[ee].c();g=U(),w=B("div"),E=ve("Head 1 of "),M=ve(y),this.h()},l(ee){e=z(ee,"DIV",{class:!0,style:!0});var se=T(e);l=z(se,"DIV",{class:!0});var X=T(l);t=z(X,"DIV",{class:!0});var $e=T(t);r=z($e,"DIV",{class:!0,"data-svelte-h":!0}),Ie(r)!=="svelte-1a2739d"&&(r.textContent=s),o=x($e);for(let Be=0;Be<C.length;Be+=1)C[Be].l($e);$e.forEach($),c=x(X),a=z(X,"DIV",{class:!0});var Me=T(a);f=z(Me,"DIV",{class:!0,"data-svelte-h":!0}),Ie(f)!=="svelte-bmmhtu"&&(f.textContent=p),d=x(Me);for(let Be=0;Be<G.length;Be+=1)G[Be].l(Me);Me.forEach($),u=x(X),_=z(X,"DIV",{class:!0});var Z=T(_);S=z(Z,"DIV",{class:!0,"data-svelte-h":!0}),Ie(S)!=="svelte-17pe084"&&(S.textContent=P),j=x(Z);for(let Be=0;Be<Y.length;Be+=1)Y[Be].l(Z);Z.forEach($),X.forEach($),F=x(se),V=z(se,"DIV",{class:!0});var ie=T(V);le(R.$$.fragment,ie),ie.forEach($),J=x(se),N=z(se,"DIV",{class:!0});var Q=T(N);D=z(Q,"DIV",{class:!0});var Ve=T(D);A=z(Ve,"DIV",{class:!0,"data-svelte-h":!0}),Ie(A)!=="svelte-68unf9"&&(A.textContent=i),h=x(Ve);for(let Be=0;Be<ce.length;Be+=1)ce[Be].l(Ve);Ve.forEach($),Q.forEach($),g=x(se),w=z(se,"DIV",{class:!0});var Ke=T(w);E=ge(Ke,"Head 1 of "),M=ge(Ke,y),Ke.forEach($),se.forEach($),this.h()},h(){m(r,"class","title svelte-1hsibq9"),m(t,"class","column query"),m(f,"class","title svelte-1hsibq9"),m(a,"class","column key"),m(S,"class","title svelte-1hsibq9"),m(_,"class","column value"),m(l,"class","qkv flex h-full flex-col justify-center gap-[5rem] pl-[6rem]"),m(V,"class","resize-watch attention-matrix flex"),m(A,"class","title svelte-1hsibq9"),m(D,"class","column out"),m(N,"class","head-out mx-[2rem]"),m(w,"class","head-title absolute bottom-2 right-3 text-right text-gray-400"),m(e,"class","head-block flex w-full items-center justify-between px-2"),m(e,"style",v=`height:${n[7]}px;`)},m(ee,se){W(ee,e,se),k(e,l),k(l,t),k(t,r),k(t,o);for(let X=0;X<C.length;X+=1)C[X]&&C[X].m(t,null);k(l,c),k(l,a),k(a,f),k(a,d);for(let X=0;X<G.length;X+=1)G[X]&&G[X].m(a,null);k(l,u),k(l,_),k(_,S),k(_,j);for(let X=0;X<Y.length;X+=1)Y[X]&&Y[X].m(_,null);k(e,F),k(e,V),ne(R,V,null),k(e,J),k(e,N),k(N,D),k(D,A),k(D,h);for(let X=0;X<ce.length;X+=1)ce[X]&&ce[X].m(D,null);k(e,g),k(e,w),k(w,E),k(w,M),I=!0},p(ee,se){if(se&96){b=be(ee[6]);let X;for(X=0;X<b.length;X+=1){const $e=Ll(ee,b,X);C[X]?(C[X].p($e,se),H(C[X],1)):(C[X]=jl($e),C[X].c(),H(C[X],1),C[X].m(t,null))}for(Ne(),X=b.length;X<C.length;X+=1)L(X);Se()}if(se&96){q=be(ee[6]);let X;for(X=0;X<q.length;X+=1){const $e=ql(ee,q,X);G[X]?(G[X].p($e,se),H(G[X],1)):(G[X]=Ol($e),G[X].c(),H(G[X],1),G[X].m(a,null))}for(Ne(),X=q.length;X<G.length;X+=1)K(X);Se()}if(se&96){he=be(ee[6]);let X;for(X=0;X<he.length;X+=1){const $e=Al(ee,he,X);Y[X]?(Y[X].p($e,se),H(Y[X],1)):(Y[X]=Rl($e),Y[X].c(),H(Y[X],1),Y[X].m(_,null))}for(Ne(),X=he.length;X<Y.length;X+=1)fe(X);Se()}if(se&96){pe=be(ee[6]);let X;for(X=0;X<pe.length;X+=1){const $e=Ml(ee,pe,X);ce[X]?(ce[X].p($e,se),H(ce[X],1)):(ce[X]=Gl($e),ce[X].c(),H(ce[X],1),ce[X].m(D,null))}for(Ne(),X=pe.length;X<ce.length;X+=1)Ue(X);Se()}(!I||se&32)&&y!==(y=ee[5].attention_head_num+"")&&Le(M,y),(!I||se&128&&v!==(v=`height:${ee[7]}px;`))&&m(e,"style",v)},i(ee){if(!I){for(let se=0;se<b.length;se+=1)H(C[se]);for(let se=0;se<q.length;se+=1)H(G[se]);for(let se=0;se<he.length;se+=1)H(Y[se]);H(R.$$.fragment,ee);for(let se=0;se<pe.length;se+=1)H(ce[se]);I=!0}},o(ee){C=C.filter(Boolean);for(let se=0;se<C.length;se+=1)O(C[se]);G=G.filter(Boolean);for(let se=0;se<G.length;se+=1)O(G[se]);Y=Y.filter(Boolean);for(let se=0;se<Y.length;se+=1)O(Y[se]);O(R.$$.fragment,ee),ce=ce.filter(Boolean);for(let se=0;se<ce.length;se+=1)O(ce[se]);I=!1},d(ee){ee&&$(e),Ae(C,ee),Ae(G,ee),Ae(Y,ee),re(R),Ae(ce,ee)}}}function ps(n){let e,l,t="<div>Multi-head Self Attention</div>",r,s,o,c='<div class="bounding-title svelte-1hsibq9">Transformer Block 1</div>',a,f,p,d,u,_,S,P,j,F,V,R,J=be(n[6]),N=[];for(let A=0;A<J.length;A+=1)N[A]=Hl(Bl(n,J,A));const D=A=>O(N[A],1,1,()=>{N[A]=null});return P=new Xr({props:{$$slots:{default:[ds]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),s=B("div"),o=B("div"),o.innerHTML=c,a=U(),f=B("div"),d=U(),u=B("div");for(let A=0;A<N.length;A+=1)N[A].c();_=U(),S=B("div"),te(P.$$.fragment),this.h()},l(A){e=z(A,"DIV",{class:!0});var i=T(e);l=z(i,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-n6swon"&&(l.innerHTML=t),r=x(i),s=z(i,"DIV",{class:!0});var h=T(s);o=z(h,"DIV",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-vte4ua"&&(o.innerHTML=c),a=x(h),f=z(h,"DIV",{class:!0,style:!0}),T(f).forEach($),d=x(h),u=z(h,"DIV",{class:!0});var g=T(u);for(let E=0;E<N.length;E+=1)N[E].l(g);g.forEach($),_=x(h),S=z(h,"DIV",{class:!0});var w=T(S);le(P.$$.fragment,w),w.forEach($),h.forEach($),i.forEach($),this.h()},h(){m(l,"class","title svelte-1hsibq9"),m(l,"role","group"),m(o,"class","bounding transformer-bounding svelte-1hsibq9"),oe(o,"active",n[4]),m(f,"class","bounding attention-bounding svelte-1hsibq9"),m(f,"style",p=`padding-bottom:${n[5].attention_head_num*$t.y}px`),oe(f,"active",n[1]&&!n[3]),m(u,"class","column"),m(S,"class","heads svelte-1hsibq9"),m(s,"class","content relative svelte-1hsibq9"),m(e,"class",j=de(ue("attention",n[0],{expanded:n[3]}))+" svelte-1hsibq9")},m(A,i){W(A,e,i),k(e,l),k(e,r),k(e,s),k(s,o),k(s,a),k(s,f),k(s,d),k(s,u);for(let h=0;h<N.length;h+=1)N[h]&&N[h].m(u,null);k(s,_),k(s,S),ne(P,S,null),F=!0,V||(R=[ke(l,"mouseenter",n[8]),ke(l,"mouseleave",n[9])],V=!0)},p(A,[i]){if((!F||i&16)&&oe(o,"active",A[4]),(!F||i&32&&p!==(p=`padding-bottom:${A[5].attention_head_num*$t.y}px`))&&m(f,"style",p),(!F||i&10)&&oe(f,"active",A[1]&&!A[3]),i&100){J=be(A[6]);let g;for(g=0;g<J.length;g+=1){const w=Bl(A,J,g);N[g]?(N[g].p(w,i),H(N[g],1)):(N[g]=Hl(w),N[g].c(),H(N[g],1),N[g].m(u,null))}for(Ne(),g=J.length;g<N.length;g+=1)D(g);Se()}const h={};i&2097376&&(h.$$scope={dirty:i,ctx:A}),P.$set(h),(!F||i&9&&j!==(j=de(ue("attention",A[0],{expanded:A[3]}))+" svelte-1hsibq9"))&&m(e,"class",j)},i(A){if(!F){for(let i=0;i<J.length;i+=1)H(N[i]);H(P.$$.fragment,A),F=!0}},o(A){N=N.filter(Boolean);for(let i=0;i<N.length;i+=1)O(N[i]);O(P.$$.fragment,A),F=!1},d(A){A&&$(e),Ae(N,A),re(P),V=!1,Fe(R)}}}const vs="bg-blue-200",gs="bg-red-200",ms="bg-green-200",er="bg-blue-300",tr="bg-red-300",lr="bg-green-300",_s="bg-purple-300";function $s(n,e,l){let t,r,s,o,c,a;ye(n,xe,F=>l(10,r=F)),ye(n,jt,F=>l(4,s=F)),ye(n,zt,F=>l(5,o=F)),ye(n,gt,F=>l(6,c=F)),ye(n,Wn,F=>l(7,a=F));let{className:f=void 0}=e;tl("block-id","attention");const p=el("block-id");let d=!1;function u(){l(1,d=!0)}function _(){l(1,d=!1)}let S=null;const P=F=>{l(2,S=F)},j=()=>{l(2,S=null)};return n.$$set=F=>{"className"in F&&l(0,f=F.className)},n.$$.update=()=>{n.$$.dirty&1024&&l(3,t=r.id===p)},[f,d,S,t,s,o,c,a,u,_,r,P,j]}class bs extends Oe{constructor(e){super(),Re(this,e,$s,ps,je,{className:0})}}function ws(n){let e,l,t,r,s,o,c,a=n[3]&&Fl(n);return{c(){e=B("div"),l=B("div"),t=U(),r=Ce("svg"),a&&a.c(),s=Ce("path"),this.h()},l(f){e=z(f,"DIV",{class:!0});var p=T(e);l=z(p,"DIV",{class:!0}),T(l).forEach($),t=x(p),r=De(p,"svg",{class:!0});var d=T(r);a&&a.l(d),s=De(d,"path",{d:!0,class:!0}),T(s).forEach($),d.forEach($),p.forEach($),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(s,"d",o=`M0,0 L0,${n[6]}`),m(s,"class","svelte-1jqlo12"),m(r,"class","main svelte-1jqlo12"),m(e,"class",c=de(ue("residual residual-end cell",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(f,p){W(f,e,p),k(e,l),k(e,t),k(e,r),a&&a.m(r,null),k(r,s)},p(f,p){f[3]?a?a.p(f,p):(a=Fl(f),a.c(),a.m(r,s)):a&&(a.d(1),a=null),p&64&&o!==(o=`M0,0 L0,${f[6]}`)&&m(s,"d",o),p&2&&c!==(c=de(ue("residual residual-end cell",f[1]))+" svelte-1jqlo12")&&m(e,"class",c),p&34&&oe(e,"active",f[5])},d(f){f&&$(e),a&&a.d()}}}function ks(n){let e,l,t,r,s,o,c,a=n[3]&&Ul(n);return{c(){e=B("div"),l=B("div"),t=U(),r=Ce("svg"),a&&a.c(),s=Ce("path"),this.h()},l(f){e=z(f,"DIV",{class:!0});var p=T(e);l=z(p,"DIV",{class:!0}),T(l).forEach($),t=x(p),r=De(p,"svg",{class:!0});var d=T(r);a&&a.l(d),s=De(d,"path",{d:!0,class:!0}),T(s).forEach($),d.forEach($),p.forEach($),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(s,"d",o=`M0,0 L0,${n[6]}`),m(s,"class","svelte-1jqlo12"),m(r,"class","main svelte-1jqlo12"),m(e,"class",c=de(ue("residual residual-start cell",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(f,p){W(f,e,p),k(e,l),k(e,t),k(e,r),a&&a.m(r,null),k(r,s)},p(f,p){f[3]?a?a.p(f,p):(a=Ul(f),a.c(),a.m(r,s)):a&&(a.d(1),a=null),p&64&&o!==(o=`M0,0 L0,${f[6]}`)&&m(s,"d",o),p&2&&c!==(c=de(ue("residual residual-start cell",f[1]))+" svelte-1jqlo12")&&m(e,"class",c),p&34&&oe(e,"active",f[5])},d(f){f&&$(e),a&&a.d()}}}function Es(n){let e,l,t,r,s,o,c,a,f,p=n[4]&&xl();return{c(){e=B("div"),l=B("div"),t=U(),r=Ce("svg"),s=Ce("circle"),o=Ce("path"),a=U(),p&&p.c(),this.h()},l(d){e=z(d,"DIV",{class:!0});var u=T(e);l=z(u,"DIV",{class:!0}),T(l).forEach($),t=x(u),r=De(u,"svg",{class:!0});var _=T(r);s=De(_,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(s).forEach($),o=De(_,"path",{class:!0,d:!0}),T(o).forEach($),_.forEach($),a=x(u),p&&p.l(u),u.forEach($),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(s,"class","icon svelte-1jqlo12"),m(s,"cx","50%"),m(s,"cy","50%"),m(s,"r","3"),m(o,"class","line svelte-1jqlo12"),m(o,"d",c=`
     M 0 0
    C 0 ${n[6]*.25}, ${n[6]*.2} ${n[6]*.25}, ${n[6]*.2} ${n[6]*.5}
    C ${n[6]*.2} ${n[6]*.75}, 0 ${n[6]*.75}, 0 ${n[6]}
  `),m(r,"class","main svelte-1jqlo12"),m(e,"class",f=de(ue("cell ln",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(d,u){W(d,e,u),k(e,l),k(e,t),k(e,r),k(r,s),k(r,o),k(e,a),p&&p.m(e,null)},p(d,u){u&64&&c!==(c=`
     M 0 0
    C 0 ${d[6]*.25}, ${d[6]*.2} ${d[6]*.25}, ${d[6]*.2} ${d[6]*.5}
    C ${d[6]*.2} ${d[6]*.75}, 0 ${d[6]*.75}, 0 ${d[6]}
  `)&&m(o,"d",c),d[4]?p||(p=xl(),p.c(),p.m(e,null)):p&&(p.d(1),p=null),u&2&&f!==(f=de(ue("cell ln",d[1]))+" svelte-1jqlo12")&&m(e,"class",f),u&34&&oe(e,"active",d[5])},d(d){d&&$(e),p&&p.d()}}}function ys(n){let e,l,t,r,s,o,c,a,f,p=n[4]&&Wl();return{c(){e=B("div"),l=B("div"),t=U(),r=Ce("svg"),s=Ce("path"),c=Ce("circle"),a=U(),p&&p.c(),this.h()},l(d){e=z(d,"DIV",{class:!0});var u=T(e);l=z(u,"DIV",{class:!0}),T(l).forEach($),t=x(u),r=De(u,"svg",{class:!0});var _=T(r);s=De(_,"path",{class:!0,d:!0}),T(s).forEach($),c=De(_,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(c).forEach($),_.forEach($),a=x(u),p&&p.l(u),u.forEach($),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(s,"class","line svelte-1jqlo12"),m(s,"d",o=`M0,0 L0,${n[6]}`),m(c,"class","icon svelte-1jqlo12"),m(c,"cx","50%"),m(c,"cy","50%"),m(c,"r","3"),m(r,"class","main svelte-1jqlo12"),m(e,"class",f=de(ue("cell dropout",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(d,u){W(d,e,u),k(e,l),k(e,t),k(e,r),k(r,s),k(r,c),k(e,a),p&&p.m(e,null)},p(d,u){u&64&&o!==(o=`M0,0 L0,${d[6]}`)&&m(s,"d",o),d[4]?p||(p=Wl(),p.c(),p.m(e,null)):p&&(p.d(1),p=null),u&2&&f!==(f=de(ue("cell dropout",d[1]))+" svelte-1jqlo12")&&m(e,"class",f),u&34&&oe(e,"active",d[5])},d(d){d&&$(e),p&&p.d()}}}function Is(n){let e,l,t,r,s,o,c;return{c(){e=B("div"),l=B("div"),t=U(),r=Ce("svg"),s=Ce("path"),o=Ce("circle"),this.h()},l(a){e=z(a,"DIV",{class:!0});var f=T(e);l=z(f,"DIV",{class:!0}),T(l).forEach($),t=x(f),r=De(f,"svg",{class:!0});var p=T(r);s=De(p,"path",{class:!0,d:!0}),T(s).forEach($),o=De(p,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(o).forEach($),p.forEach($),f.forEach($),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(s,"class","line line1 svelte-1jqlo12"),m(s,"d","M0,0 L0,90%"),m(o,"class","icon svelte-1jqlo12"),m(o,"cx","50%"),m(o,"cy","50%"),m(o,"r","3"),m(r,"class","main svelte-1jqlo12"),m(e,"class",c=de(ue("cell activation",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(a,f){W(a,e,f),k(e,l),k(e,t),k(e,r),k(r,s),k(r,o)},p(a,f){f&2&&c!==(c=de(ue("cell activation",a[1]))+" svelte-1jqlo12")&&m(e,"class",c),f&34&&oe(e,"active",a[5])},d(a){a&&$(e)}}}function Fl(n){let e;return{c(){e=Ce("path"),this.h()},l(l){e=De(l,"path",{id:!0,class:!0,d:!0}),T(e).forEach($),this.h()},h(){m(e,"id",n[0]),m(e,"class","head svelte-1jqlo12"),m(e,"d","M0,0 Q0,-16 -30,-16")},m(l,t){W(l,e,t)},p(l,t){t&1&&m(e,"id",l[0])},d(l){l&&$(e)}}}function Ul(n){let e,l,t;return{c(){e=Ce("path"),l=Ce("text"),t=ve("Residual"),this.h()},l(r){e=De(r,"path",{id:!0,class:!0,d:!0}),T(e).forEach($),l=De(r,"text",{x:!0,y:!0,dy:!0,dx:!0,class:!0});var s=T(l);t=ge(s,"Residual"),s.forEach($),this.h()},h(){m(e,"id",n[0]),m(e,"class","head svelte-1jqlo12"),m(e,"d","M0,0 Q0,-16 30,-16"),m(l,"x","30"),m(l,"y","-26"),m(l,"dy","4"),m(l,"dx","4"),m(l,"class","svelte-1jqlo12")},m(r,s){W(r,e,s),W(r,l,s),k(l,t)},p(r,s){s&1&&m(e,"id",r[0])},d(r){r&&($(e),$(l))}}}function xl(n){let e,l,t,r;return{c(){e=Ce("svg"),l=Ce("path"),t=Ce("text"),r=ve("Layer Normalization"),this.h()},l(s){e=De(s,"svg",{class:!0,width:!0});var o=T(e);l=De(o,"path",{d:!0,class:!0}),T(l).forEach($),t=De(o,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=T(t);r=ge(c,"Layer Normalization"),c.forEach($),o.forEach($),this.h()},h(){m(l,"d","M27.3536 4.35355C27.5488 4.15829 27.5488 3.84171 27.3536 3.64645L24.1716 0.46447C23.9763 0.269208 23.6597 0.269208 23.4645 0.464471C23.2692 0.659733 23.2692 0.976316 23.4645 1.17158L26.2929 4L23.4645 6.82843C23.2692 7.02369 23.2692 7.34028 23.4645 7.53554C23.6597 7.7308 23.9763 7.7308 24.1716 7.53554L27.3536 4.35355ZM27 3.5C20.3125 3.50001 15.2969 6.63952 11.5638 11.7944C7.84616 16.9278 5.39057 24.0677 3.75991 32.1346C0.498061 48.2711 0.5 68.3247 0.5 84H1.5C1.5 68.2984 1.50194 48.352 4.74009 32.3328C6.35943 24.3218 8.77884 17.3448 12.3737 12.3809C15.9531 7.4384 20.6875 4.50001 27 4.5V3.5Z"),m(l,"class","svelte-1jqlo12"),m(t,"x","4"),m(t,"y","95"),m(t,"text-anchor","middle"),m(t,"class","svelte-1jqlo12"),m(e,"class","guide svelte-1jqlo12"),m(e,"width","27px"),oe(e,"active",!1)},m(s,o){W(s,e,o),k(e,l),k(e,t),k(t,r)},d(s){s&&$(e)}}}function Wl(n){let e,l,t,r;return{c(){e=Ce("svg"),l=Ce("path"),t=Ce("text"),r=ve("Dropout"),this.h()},l(s){e=De(s,"svg",{class:!0,width:!0});var o=T(e);l=De(o,"path",{d:!0,class:!0}),T(l).forEach($),t=De(o,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=T(t);r=ge(c,"Dropout"),c.forEach($),o.forEach($),this.h()},h(){m(l,"d","M44.3186 4.46399C44.5314 4.28801 44.5613 3.97284 44.3853 3.76004L41.5175 0.292199C41.3416 0.0793953 41.0264 0.0495441 40.8136 0.225525C40.6008 0.401505 40.5709 0.716677 40.7469 0.929481L43.296 4.012L40.2135 6.56113C40.0007 6.73711 39.9709 7.05228 40.1468 7.26509C40.3228 7.47789 40.638 7.50774 40.8508 7.33176L44.3186 4.46399ZM44.0471 3.58091C38.7621 3.08034 27.8926 4.80481 18.3357 11.5838C8.74613 18.386 0.5 30.2626 0.5 50H1.5C1.5 30.5889 9.58721 19.0154 18.9143 12.3994C28.2741 5.76023 38.9045 4.0983 43.9529 4.57645L44.0471 3.58091Z"),m(l,"class","svelte-1jqlo12"),m(t,"x","4"),m(t,"y","60"),m(t,"text-anchor","middle"),m(t,"class","svelte-1jqlo12"),m(e,"class","guide svelte-1jqlo12"),m(e,"width","44px"),oe(e,"active",!1)},m(s,o){W(s,e,o),k(e,l),k(e,t),k(t,r)},d(s){s&&$(e)}}}function Cs(n){let e;function l(s,o){if(s[2]==="activation")return Is;if(s[2]==="dropout")return ys;if(s[2]==="ln")return Es;if(s[2]==="residual-start")return ks;if(s[2]==="residual-end")return ws}let t=l(n),r=t&&t(n);return{c(){r&&r.c(),e=ut()},l(s){r&&r.l(s),e=ut()},m(s,o){r&&r.m(s,o),W(s,e,o)},p(s,[o]){t===(t=l(s))&&r?r.p(s,o):(r&&r.d(1),r=t&&t(s),r&&(r.c(),r.m(e.parentNode,e)))},i:qe,o:qe,d(s){s&&$(e),r&&r.d(s)}}}function Ds(n,e,l){let t;ye(n,Jt,p=>l(6,t=p));let{id:r=void 0}=e,{className:s=void 0}=e,{type:o=void 0}=e,{head:c=!1}=e,{tail:a=!1}=e,{active:f=!1}=e;return n.$$set=p=>{"id"in p&&l(0,r=p.id),"className"in p&&l(1,s=p.className),"type"in p&&l(2,o=p.type),"head"in p&&l(3,c=p.head),"tail"in p&&l(4,a=p.tail),"active"in p&&l(5,f=p.active)},[r,s,o,c,a,f,t]}class Gt extends Oe{constructor(e){super(),Re(this,e,Ds,Cs,je,{id:0,className:1,type:2,head:3,tail:4,active:5})}}function Xl(n,e,l){const t=n.slice();return t[7]=e[l],t[9]=l,t}function Vs(n){let e,l=n[3].dimension+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&8&&l!==(l=s[3].dimension+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Kl(n){let e,l,t,r,s,o,c,a;return t=new ft({props:{colorScale:"blue"}}),o=new He({props:{placement:"right",class:"popover",$$slots:{default:[Vs]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),te(t.$$.fragment),s=U(),te(o.$$.fragment),c=U(),this.h()},l(f){e=z(f,"DIV",{class:!0});var p=T(e);l=z(p,"DIV",{class:!0});var d=T(l);le(t.$$.fragment,d),d.forEach($),s=x(p),le(o.$$.fragment,p),c=x(p),p.forEach($),this.h()},h(){m(l,"class",r=de(ue("vector shrink-0 bg-blue-200",{"last-token":n[9]===n[4].length-1}))+" svelte-1jtwro5"),m(e,"class","cell svelte-1jtwro5"),oe(e,"last",n[9]===n[4].length-1)},m(f,p){W(f,e,p),k(e,l),ne(t,l,null),k(e,s),ne(o,e,null),k(e,c),a=!0},p(f,p){(!a||p&16&&r!==(r=de(ue("vector shrink-0 bg-blue-200",{"last-token":f[9]===f[4].length-1}))+" svelte-1jtwro5"))&&m(l,"class",r);const d={};p&1032&&(d.$$scope={dirty:p,ctx:f}),o.$set(d),(!a||p&16)&&oe(e,"last",f[9]===f[4].length-1)},i(f){a||(H(t.$$.fragment,f),H(o.$$.fragment,f),a=!0)},o(f){O(t.$$.fragment,f),O(o.$$.fragment,f),a=!1},d(f){f&&$(e),re(t),re(o)}}}function Ns(n){let e,l,t,r,s,o,c,a=n[3].layer_num-1+"",f,p,d,u,_="Transformer<br/>Blocks",S,P,j,F,V,R,J,N,D,A,i,h,g=be(n[4]),w=[];for(let y=0;y<g.length;y+=1)w[y]=Kl(Xl(n,g,y));const E=y=>O(w[y],1,1,()=>{w[y]=null});return{c(){e=B("div"),l=B("div"),t=U(),r=B("div"),s=B("div"),o=B("div"),c=B("div"),f=ve(a),p=ve(" more identical"),d=B("br"),u=B("span"),u.innerHTML=_,S=ve("."),P=U(),j=Ce("svg"),F=Ce("path"),V=U();for(let y=0;y<w.length;y+=1)w[y].c();R=U(),J=B("div"),N=B("div"),this.h()},l(y){e=z(y,"DIV",{class:!0,role:!0});var M=T(e);l=z(M,"DIV",{class:!0}),T(l).forEach($),t=x(M),r=z(M,"DIV",{class:!0});var v=T(r);s=z(v,"DIV",{class:!0});var I=T(s);o=z(I,"DIV",{class:!0});var b=T(o);c=z(b,"DIV",{class:!0});var C=T(c);f=ge(C,a),p=ge(C," more identical"),d=z(C,"BR",{}),u=z(C,"SPAN",{class:!0,"data-svelte-h":!0}),Ie(u)!=="svelte-m89yhc"&&(u.innerHTML=_),S=ge(C,"."),C.forEach($),P=x(b),j=De(b,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var L=T(j);F=De(L,"path",{d:!0,fill:!0}),T(F).forEach($),L.forEach($),b.forEach($),V=x(I);for(let G=0;G<w.length;G+=1)w[G].l(I);I.forEach($),R=x(v),J=z(v,"DIV",{class:!0});var q=T(J);N=z(q,"DIV",{class:!0}),T(N).forEach($),q.forEach($),v.forEach($),M.forEach($),this.h()},h(){m(l,"class","title"),m(u,"class","highlight svelte-1jtwro5"),m(c,"class","text svelte-1jtwro5"),oe(c,"active",n[2]),m(F,"d","M1.18221 4.58047C1.23103 4.62928 1.31017 4.62928 1.35899 4.58047L2.15448 3.78497C2.2033 3.73616 2.2033 3.65701 2.15448 3.6082C2.10567 3.55938 2.02652 3.55938 1.97771 3.6082L1.2706 4.3153L0.563493 3.6082C0.514677 3.55938 0.435531 3.55938 0.386716 3.6082C0.3379 3.65701 0.3379 3.73616 0.386716 3.78497L1.18221 4.58047ZM1.1456 0.285461V4.49208H1.3956V0.285461H1.1456Z"),m(F,"fill","currentColor"),m(j,"xmlns","http://www.w3.org/2000/svg"),m(j,"class","h-6 w-6 text-gray-300"),m(j,"viewBox","0 0 3 5"),m(j,"fill","none"),m(o,"class","guide flex flex-col items-start gap-1 svelte-1jtwro5"),m(s,"class","column final relative svelte-1jtwro5"),m(N,"class","prob-dim svelte-1jtwro5"),oe(N,"expanded",n[1].id==="softmax"),m(J,"class","second-column svelte-1jtwro5"),m(r,"class","content svelte-1jtwro5"),m(e,"class",D=de(ue("transformer-blocks",n[0],{expanded:n[1].id!==null}))+" svelte-1jtwro5"),m(e,"role","group")},m(y,M){W(y,e,M),k(e,l),k(e,t),k(e,r),k(r,s),k(s,o),k(o,c),k(c,f),k(c,p),k(c,d),k(c,u),k(c,S),k(o,P),k(o,j),k(j,F),k(s,V);for(let v=0;v<w.length;v+=1)w[v]&&w[v].m(s,null);k(r,R),k(r,J),k(J,N),A=!0,i||(h=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],i=!0)},p(y,[M]){if((!A||M&8)&&a!==(a=y[3].layer_num-1+"")&&Le(f,a),(!A||M&4)&&oe(c,"active",y[2]),M&24){g=be(y[4]);let v;for(v=0;v<g.length;v+=1){const I=Xl(y,g,v);w[v]?(w[v].p(I,M),H(w[v],1)):(w[v]=Kl(I),w[v].c(),H(w[v],1),w[v].m(s,null))}for(Ne(),v=g.length;v<w.length;v+=1)E(v);Se()}(!A||M&2)&&oe(N,"expanded",y[1].id==="softmax"),(!A||M&3&&D!==(D=de(ue("transformer-blocks",y[0],{expanded:y[1].id!==null}))+" svelte-1jtwro5"))&&m(e,"class",D)},i(y){if(!A){for(let M=0;M<g.length;M+=1)H(w[M]);A=!0}},o(y){w=w.filter(Boolean);for(let M=0;M<w.length;M+=1)O(w[M]);A=!1},d(y){y&&$(e),Ae(w,y),i=!1,Fe(h)}}}function Ss(n,e,l){let t,r,s,o;ye(n,xe,p=>l(1,t=p)),ye(n,jt,p=>l(2,r=p)),ye(n,zt,p=>l(3,s=p)),ye(n,gt,p=>l(4,o=p));let{className:c=void 0}=e;const a=()=>{jt.set(!0)},f=()=>{jt.set(!1)};return n.$$set=p=>{"className"in p&&l(0,c=p.className)},[c,t,r,s,o,a,f]}class Ms extends Oe{constructor(e){super(),Re(this,e,Ss,Ns,je,{className:0})}}function As(n){let e,l,t,r;return{c(){e=B("div"),l=Ce("svg"),t=Ce("g"),r=Ce("g"),this.h()},l(s){e=z(s,"DIV",{class:!0});var o=T(e);l=De(o,"svg",{class:!0});var c=T(l);t=De(c,"g",{class:!0}),T(t).forEach($),r=De(c,"g",{class:!0}),T(r).forEach($),c.forEach($),o.forEach($),this.h()},h(){m(t,"class","bars"),m(r,"class","bar-labels"),m(l,"class","h-full w-full"),m(e,"class","content-box probability grow svelte-8s3yoj")},m(s,o){W(s,e,o),k(e,l),k(l,t),k(l,r),n[7](l)},p:qe,i:qe,o:qe,d(s){s&&$(e),n[7](null)}}}const Zl=4;let qs=1;function Ls(n,e,l){let t,r;ye(n,Rt,P=>l(5,t=P)),ye(n,Tt,P=>l(6,r=P));const{theme:s}=wt(kt);let{rowHeight:o}=e,{rowGap:c}=e,{hoveredIndex:a=null}=e,f,p=s.colors.gray[300],d=s.colors.purple[400],{drawBars:u=()=>{const P=r==null?void 0:r.prediction,j=Je(f);let F=hl().domain([0,qr(P,V=>V.adjustedProbability)]).range([0,(f==null?void 0:f.clientWidth)-Bt*3]);j.select("g.bars").selectAll("rect").data(P).join("rect").attr("x",0).attr("y",(V,R)=>R*o+R*c+o/2-Zl/2).attr("height",Zl).attr("width",V=>F(V.adjustedProbability)).attr("rx",1).attr("ry",1).attr("fill",(V,R)=>R===a?d:(t==null?void 0:t.rank)===R?Xt:p).on("mouseenter",function(V,R){l(1,a=R.rank),Je(this).style("cursor","pointer")}).on("mouseleave",()=>l(1,a=null)).transition().ease(mr).duration(500).attr("width",V=>F(V.adjustedProbability)),j.select("g.bar-labels").selectAll("text").data(P).join("text").attr("class","bar-label").attr("fill",(V,R)=>R===a?d:(t==null?void 0:t.rank)===R?Xt:p).on("mouseenter",function(V,R){l(1,a=R.rank),Je(this).style("cursor","pointer")}).on("mouseleave",()=>{l(1,a=null)}).attr("x",V=>.4*Bt+F(V.adjustedProbability)).attr("y",(V,R)=>R*o+R*c).attr("dy",o/2+3).attr("text-anchor","start").style("font-size","0.8rem").transition().duration(500).tween("text",function(V){const R=Je(this),J=_r(R.text().replace("%",""),V.adjustedProbability*100);return function(N){R.text(J(N).toFixed(qs)+"%")}})}}=e;vt(()=>{u()});const _=()=>{if(!f)return;const P=Je(f);P.selectAll("g.bars rect").attr("fill",(j,F)=>F===a?d:(t==null?void 0:t.rank)===F?Xt:p),P.selectAll("g.bar-labels text").attr("fill",(j,F)=>F===a?d:(t==null?void 0:t.rank)===F?Xt:p)};function S(P){Qe[P?"unshift":"push"](()=>{f=P,l(0,f)})}return n.$$set=P=>{"rowHeight"in P&&l(2,o=P.rowHeight),"rowGap"in P&&l(3,c=P.rowGap),"hoveredIndex"in P&&l(1,a=P.hoveredIndex),"drawBars"in P&&l(4,u=P.drawBars)},n.$$.update=()=>{n.$$.dirty&81&&r&&f&&u(),n.$$.dirty&2&&a!==void 0&&_(),n.$$.dirty&32&&t&&_()},[f,a,o,c,u,t,r,S]}class Bs extends Oe{constructor(e){super(),Re(this,e,Ls,As,je,{rowHeight:2,rowGap:3,hoveredIndex:1,drawBars:4})}}function Yl(n,e,l){const t=n.slice();return t[36]=e[l],t[38]=l,t}function Ql(n,e,l){const t=n.slice();return t[39]=e[l],t[38]=l,t}function Jl(n,e,l){const t=n.slice();return t[41]=e[l],t[38]=l,t}function zs(n){let e,l,t=n[9][n[38]]+"",r;return{c(){e=ve("Token ID: "),l=B("span"),r=ve(t),this.h()},l(s){e=ge(s,"Token ID: "),l=z(s,"SPAN",{class:!0});var o=T(l);r=ge(o,t),o.forEach($),this.h()},h(){m(l,"class","number svelte-1dtizln")},m(s,o){W(s,e,o),W(s,l,o),k(l,r)},p(s,o){o[0]&512&&t!==(t=s[9][s[38]]+"")&&Le(r,t)},d(s){s&&($(e),$(l))}}}function en(n){let e,l,t=(n[41].token.trim()===""?" ":n[41].token)+"",r,s,o,c,a,f,p;o=new He({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[zs]},$$scope:{ctx:n}}});function d(){return n[21](n[38])}return{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),te(o.$$.fragment),c=U(),this.h()},l(u){e=z(u,"DIV",{role:!0,class:!0});var _=T(e);l=z(_,"SPAN",{});var S=T(l);r=ge(S,t),S.forEach($),s=x(_),le(o.$$.fragment,_),c=x(_),_.forEach($),this.h()},h(){var u;m(e,"role","group"),m(e,"class","text-box svelte-1dtizln"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,_){W(u,e,_),k(e,l),k(l,r),k(e,s),ne(o,e,null),k(e,c),a=!0,f||(p=[ke(e,"mouseenter",d),ke(e,"mouseleave",n[22])],f=!0)},p(u,_){var P;n=u,(!a||_[0]&4)&&t!==(t=(n[41].token.trim()===""?" ":n[41].token)+"")&&Le(r,t);const S={};_[0]&512|_[1]&4096&&(S.$$scope={dirty:_,ctx:n}),o.$set(S),(!a||_[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!a||_[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!a||_[0]&2048)&&oe(e,"final_token_highlight",((P=n[11])==null?void 0:P.rank)===n[38])},i(u){a||(H(o.$$.fragment,u),a=!0)},o(u){O(o.$$.fragment,u),a=!1},d(u){u&&$(e),re(o),f=!1,Fe(p)}}}function tn(n){let e,l,t='<div class="title-text svelte-1dtizln">Tokens</div>',r,s,o,c="Logits",a,f,p,d,u,_="Exponents",S,P,j,F,V,R="Softmax",J,N,D;return f=new He({props:{class:"popover tooltip",$$slots:{default:[Ts]},$$scope:{ctx:n}}}),P=new He({props:{class:"popover tooltip",$$slots:{default:[Ps]},$$scope:{ctx:n}}}),N=new He({props:{class:"popover tooltip",$$slots:{default:[Hs]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),s=B("div"),o=B("div"),o.textContent=c,a=U(),te(f.$$.fragment),p=U(),d=B("div"),u=B("div"),u.textContent=_,S=U(),te(P.$$.fragment),j=U(),F=B("div"),V=B("div"),V.textContent=R,J=U(),te(N.$$.fragment),this.h()},l(A){e=z(A,"DIV",{class:!0});var i=T(e);l=z(i,"DIV",{class:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-g6ze80"&&(l.innerHTML=t),r=x(i),s=z(i,"DIV",{class:!0});var h=T(s);o=z(h,"DIV",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-1dhde15"&&(o.textContent=c),a=x(h),le(f.$$.fragment,h),h.forEach($),p=x(i),d=z(i,"DIV",{class:!0});var g=T(d);u=z(g,"DIV",{class:!0,"data-svelte-h":!0}),Ie(u)!=="svelte-v04dzj"&&(u.textContent=_),S=x(g),le(P.$$.fragment,g),g.forEach($),j=x(i),F=z(i,"DIV",{class:!0});var w=T(F);V=z(w,"DIV",{class:!0,"data-svelte-h":!0}),Ie(V)!=="svelte-jbrx8p"&&(V.textContent=R),J=x(w),le(N.$$.fragment,w),w.forEach($),i.forEach($),this.h()},h(){m(l,"class","title-box token-string !justify-end svelte-1dtizln"),m(o,"class","title-text svelte-1dtizln"),m(s,"class","title-box logits svelte-1dtizln"),m(u,"class","title-text svelte-1dtizln"),m(d,"class","title-box exponents svelte-1dtizln"),m(V,"class","title-text svelte-1dtizln"),m(F,"class","title-box probability svelte-1dtizln"),m(e,"class","softmax-subtitle softmax-detail flex text-center text-xs opacity-0 svelte-1dtizln")},m(A,i){W(A,e,i),k(e,l),k(e,r),k(e,s),k(s,o),k(s,a),ne(f,s,null),k(e,p),k(e,d),k(d,u),k(d,S),ne(P,d,null),k(e,j),k(e,F),k(F,V),k(F,J),ne(N,F,null),D=!0},i(A){D||(H(f.$$.fragment,A),H(P.$$.fragment,A),H(N.$$.fragment,A),D=!0)},o(A){O(f.$$.fragment,A),O(P.$$.fragment,A),O(N.$$.fragment,A),D=!1},d(A){A&&$(e),re(f),re(P),re(N)}}}function Ts(n){let e,l;return e=new Et({props:{math:"\\text{logits} = \\text{hidden state} \\times \\text{LM Head Weights}"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Ps(n){let e,l;return e=new Et({props:{math:"e^{logit_i / temperature}"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Hs(n){let e,l;return e=new Et({props:{math:"\\frac{e^{\\text{logit}_i / T}}{\\sum_{j} e^{\\text{logit}_j / T}}"}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p:qe,i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function ln(n){let e,l,t,r,s=be(n[8]),o=[];for(let d=0;d<s.length;d+=1)o[d]=rn(Ql(n,s,d));const c=d=>O(o[d],1,1,()=>{o[d]=null});let a=be(n[7]),f=[];for(let d=0;d<a.length;d+=1)f[d]=sn(Yl(n,a,d));const p=d=>O(f[d],1,1,()=>{f[d]=null});return{c(){e=B("div");for(let d=0;d<o.length;d+=1)o[d].c();l=U(),t=B("div");for(let d=0;d<f.length;d+=1)f[d].c();this.h()},l(d){e=z(d,"DIV",{class:!0});var u=T(e);for(let S=0;S<o.length;S+=1)o[S].l(u);u.forEach($),l=x(d),t=z(d,"DIV",{class:!0});var _=T(t);for(let S=0;S<f.length;S+=1)f[S].l(_);_.forEach($),this.h()},h(){m(e,"class","content-box vector-box logits ml-2 svelte-1dtizln"),m(t,"class","content-box vector-box exponents svelte-1dtizln")},m(d,u){W(d,e,u);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(e,null);W(d,l,u),W(d,t,u);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(t,null);r=!0},p(d,u){if(u[0]&3872){s=be(d[8]);let _;for(_=0;_<s.length;_+=1){const S=Ql(d,s,_);o[_]?(o[_].p(S,u),H(o[_],1)):(o[_]=rn(S),o[_].c(),H(o[_],1),o[_].m(e,null))}for(Ne(),_=s.length;_<o.length;_+=1)c(_);Se()}if(u[0]&7584){a=be(d[7]);let _;for(_=0;_<a.length;_+=1){const S=Yl(d,a,_);f[_]?(f[_].p(S,u),H(f[_],1)):(f[_]=sn(S),f[_].c(),H(f[_],1),f[_].m(t,null))}for(Ne(),_=a.length;_<f.length;_+=1)p(_);Se()}},i(d){if(!r){for(let u=0;u<s.length;u+=1)H(o[u]);for(let u=0;u<a.length;u+=1)H(f[u]);r=!0}},o(d){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)O(o[u]);f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)O(f[u]);r=!1},d(d){d&&($(e),$(l),$(t)),Ae(o,d),Ae(f,d)}}}function nn(n){let e,l,t=n[39].toFixed(2)+"",r,s,o,c,a,f;function p(){return n[23](n[38])}return o=new He({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[js]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),te(o.$$.fragment),this.h()},l(d){e=z(d,"DIV",{role:!0,class:!0});var u=T(e);l=z(u,"SPAN",{class:!0});var _=T(l);r=ge(_,t),_.forEach($),u.forEach($),s=x(d),le(o.$$.fragment,d),this.h()},h(){var d;m(l,"class","number svelte-1dtizln"),m(e,"role","group"),m(e,"class","text-box text-center svelte-1dtizln"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((d=n[11])==null?void 0:d.rank)===n[38])},m(d,u){W(d,e,u),k(e,l),k(l,r),W(d,s,u),ne(o,d,u),c=!0,a||(f=[ke(e,"mouseenter",p),ke(e,"mouseleave",n[24])],a=!0)},p(d,u){var S;n=d,(!c||u[0]&256)&&t!==(t=n[39].toFixed(2)+"")&&Le(r,t),(!c||u[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!c||u[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!c||u[0]&2048)&&oe(e,"final_token_highlight",((S=n[11])==null?void 0:S.rank)===n[38]);const _={};u[0]&512|u[1]&4096&&(_.$$scope={dirty:u,ctx:n}),o.$set(_)},i(d){c||(H(o.$$.fragment,d),c=!0)},o(d){O(o.$$.fragment,d),c=!1},d(d){d&&($(e),$(s)),re(o,d),a=!1,Fe(f)}}}function js(n){let e,l,t;return e=new Et({props:{math:`\\text{logit}_{${n[9][n[38]]}}`}}),{c(){te(e.$$.fragment),l=U()},l(r){le(e.$$.fragment,r),l=x(r)},m(r,s){ne(e,r,s),W(r,l,s),t=!0},p(r,s){const o={};s[0]&512&&(o.math=`\\text{logit}_{${r[9][r[38]]}}`),e.$set(o)},i(r){t||(H(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){r&&$(l),re(e,r)}}}function rn(n){let e,l,t=n[39]!==void 0&&nn(n);return{c(){t&&t.c(),e=ut()},l(r){t&&t.l(r),e=ut()},m(r,s){t&&t.m(r,s),W(r,e,s),l=!0},p(r,s){r[39]!==void 0?t?(t.p(r,s),s[0]&256&&H(t,1)):(t=nn(r),t.c(),H(t,1),t.m(e.parentNode,e)):t&&(Ne(),O(t,1,1,()=>{t=null}),Se())},i(r){l||(H(t),l=!0)},o(r){O(t),l=!1},d(r){r&&$(e),t&&t.d(r)}}}function Os(n){var r;let e,l,t;return e=new Et({props:{math:`e^{${(r=n[8][n[38]])==null?void 0:r.toFixed(2)} / ${n[12]}}`}}),{c(){te(e.$$.fragment),l=U()},l(s){le(e.$$.fragment,s),l=x(s)},m(s,o){ne(e,s,o),W(s,l,o),t=!0},p(s,o){var a;const c={};o[0]&4352&&(c.math=`e^{${(a=s[8][s[38]])==null?void 0:a.toFixed(2)} / ${s[12]}}`),e.$set(c)},i(s){t||(H(e.$$.fragment,s),t=!0)},o(s){O(e.$$.fragment,s),t=!1},d(s){s&&$(l),re(e,s)}}}function sn(n){let e,l,t=n[36].toExponential(2)+"",r,s,o,c,a,f;function p(){return n[25](n[38])}return o=new He({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[Os]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),te(o.$$.fragment),this.h()},l(d){e=z(d,"DIV",{role:!0,class:!0});var u=T(e);l=z(u,"SPAN",{class:!0});var _=T(l);r=ge(_,t),_.forEach($),u.forEach($),s=x(d),le(o.$$.fragment,d),this.h()},h(){var d;m(l,"class","number svelte-1dtizln"),m(e,"role","group"),m(e,"class","text-box text-center svelte-1dtizln"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((d=n[11])==null?void 0:d.rank)===n[38])},m(d,u){W(d,e,u),k(e,l),k(l,r),W(d,s,u),ne(o,d,u),c=!0,a||(f=[ke(e,"mouseenter",p),ke(e,"mouseleave",n[26])],a=!0)},p(d,u){var S;n=d,(!c||u[0]&128)&&t!==(t=n[36].toExponential(2)+"")&&Le(r,t),(!c||u[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!c||u[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!c||u[0]&2048)&&oe(e,"final_token_highlight",((S=n[11])==null?void 0:S.rank)===n[38]);const _={};u[0]&4352|u[1]&4096&&(_.$$scope={dirty:u,ctx:n}),o.$set(_)},i(d){c||(H(o.$$.fragment,d),c=!0)},o(d){O(o.$$.fragment,d),c=!1},d(d){d&&($(e),$(s)),re(o,d),a=!1,Fe(f)}}}function Rs(n){let e,l,t="<div>Probabilities</div>",r,s,o,c,a,f,p,d,u,_,S,P,j,F,V,R,J,N,D,A,i,h=be(n[2]),g=[];for(let b=0;b<h.length;b+=1)g[b]=en(Jl(n,h,b));const w=b=>O(g[b],1,1,()=>{g[b]=null});let E=n[1]&&tn(n),y=n[1]&&ln(n);function M(b){n[27](b)}function v(b){n[28](b)}let I={rowGap:n[16],rowHeight:n[15]};return n[5]!==void 0&&(I.hoveredIndex=n[5]),n[4]!==void 0&&(I.drawBars=n[4]),V=new Bs({props:I}),Qe.push(()=>kl(V,"hoveredIndex",M)),Qe.push(()=>kl(V,"drawBars",v)),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),s=B("div"),o=B("div"),c=U(),a=B("div"),f=B("div");for(let b=0;b<g.length;b+=1)g[b].c();p=U(),d=B("div"),u=U(),_=B("div"),E&&E.c(),S=U(),P=B("div"),j=B("div"),y&&y.c(),F=U(),te(V.$$.fragment),this.h()},l(b){e=z(b,"DIV",{class:!0,role:!0});var C=T(e);l=z(C,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-1d64i2n"&&(l.innerHTML=t),r=x(C),s=z(C,"DIV",{class:!0,style:!0});var L=T(s);o=z(L,"DIV",{class:!0}),T(o).forEach($),c=x(L),a=z(L,"DIV",{class:!0});var q=T(a);f=z(q,"DIV",{class:!0});var G=T(f);for(let fe=0;fe<g.length;fe+=1)g[fe].l(G);G.forEach($),p=x(q),d=z(q,"DIV",{class:!0}),T(d).forEach($),q.forEach($),u=x(L),_=z(L,"DIV",{class:!0});var K=T(_);E&&E.l(K),S=x(K),P=z(K,"DIV",{class:!0});var he=T(P);j=z(he,"DIV",{class:!0});var Y=T(j);y&&y.l(Y),Y.forEach($),F=x(he),le(V.$$.fragment,he),he.forEach($),K.forEach($),L.forEach($),C.forEach($),this.h()},h(){m(l,"class","title expandable svelte-1dtizln"),m(l,"role","none"),m(o,"class","bounding softmax-bounding svelte-1dtizln"),oe(o,"active",n[6]&&!n[1]),m(f,"class","content-box token-string svelte-1dtizln"),m(d,"class","vector vocab opacity-1 w-0"),m(a,"class","first-column relative flex justify-end"),m(j,"class","softmax-detail expandable flex gap-2 opacity-0"),m(P,"class","content-row flex gap-2"),m(_,"class","second-column flex flex-col svelte-1dtizln"),m(s,"class","content resize-watch relative svelte-1dtizln"),m(s,"style",`--softmax-row-height: ${n[15]}px;--softmax-row-gap: ${n[16]}px`),m(e,"class",N=de(ue("softmax",n[0],{expanded:n[1]}))+" svelte-1dtizln"),m(e,"role","none")},m(b,C){W(b,e,C),k(e,l),k(e,r),k(e,s),k(s,o),k(s,c),k(s,a),k(a,f);for(let L=0;L<g.length;L+=1)g[L]&&g[L].m(f,null);k(a,p),k(a,d),k(s,u),k(s,_),E&&E.m(_,null),k(_,S),k(_,P),k(P,j),y&&y.m(j,null),k(P,F),ne(V,P,null),n[29](e),D=!0,A||(i=[ke(l,"click",n[14]),ke(l,"keydown",n[14]),ke(l,"mouseenter",n[17]),ke(l,"mouseleave",n[18]),ke(e,"click",n[13]),ke(e,"keydown",n[13])],A=!0)},p(b,C){if((!D||C[0]&66)&&oe(o,"active",b[6]&&!b[1]),C[0]&3620){h=be(b[2]);let q;for(q=0;q<h.length;q+=1){const G=Jl(b,h,q);g[q]?(g[q].p(G,C),H(g[q],1)):(g[q]=en(G),g[q].c(),H(g[q],1),g[q].m(f,null))}for(Ne(),q=h.length;q<g.length;q+=1)w(q);Se()}b[1]?E?C[0]&2&&H(E,1):(E=tn(b),E.c(),H(E,1),E.m(_,S)):E&&(Ne(),O(E,1,1,()=>{E=null}),Se()),b[1]?y?(y.p(b,C),C[0]&2&&H(y,1)):(y=ln(b),y.c(),H(y,1),y.m(j,null)):y&&(Ne(),O(y,1,1,()=>{y=null}),Se());const L={};!R&&C[0]&32&&(R=!0,L.hoveredIndex=b[5],wl(()=>R=!1)),!J&&C[0]&16&&(J=!0,L.drawBars=b[4],wl(()=>J=!1)),V.$set(L),(!D||C[0]&3&&N!==(N=de(ue("softmax",b[0],{expanded:b[1]}))+" svelte-1dtizln"))&&m(e,"class",N)},i(b){if(!D){for(let C=0;C<h.length;C+=1)H(g[C]);H(E),H(y),H(V.$$.fragment,b),D=!0}},o(b){g=g.filter(Boolean);for(let C=0;C<g.length;C+=1)O(g[C]);O(E),O(y),O(V.$$.fragment,b),D=!1},d(b){b&&$(e),Ae(g,b),E&&E.d(),y&&y.d(),re(V),n[29](null),A=!1,Fe(i)}}}function Gs(n,e,l){let t,r,s,o,c,a,f,p,d;ye(n,Tt,K=>l(19,c=K)),ye(n,xe,K=>l(20,a=K)),ye(n,ar,K=>l(10,f=K)),ye(n,Rt,K=>l(11,p=K)),ye(n,ul,K=>l(12,d=K));let{className:u=void 0}=e;wt(kt),tl("block-id","softmax");const _=el("block-id");let S=!1;const P=()=>{S||(xe.set({id:_}),N())},j=K=>{K.stopPropagation(),K.preventDefault(),S?(xe.set({id:null}),D()):(xe.set({id:_}),N())};let F;function V(K){S&&!F.contains(K.target)&&xe.set({id:null})}vt(()=>(document.body.addEventListener("click",V),()=>{document.body.removeEventListener("click",V)}));let R,J;const N=async()=>{R=bt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,S=!0),await Ot(),pt.set(".steps",{justifyContent:"end"}),pt.set(".softmax-detail",{opacity:0}),bt.Flip.from(R,{duration:.5,ease:"power2.inOut",onComplete:()=>{J==null||J()}}),pt.to(".softmax-detail",{opacity:1,duration:.2,delay:.5})},D=async()=>{R=bt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,S=!1),await Ot(),await bt.Flip.from(R,{duration:.5,ease:"power2.inOut",onComplete:()=>{J==null||J()}}),pt.to(".softmax-detail",{opacity:0,duration:.2}),pt.set(".steps",{justifyContent:"start"})};let A=Bt*1.4,i=.5*Bt,h=null,g=!1;function w(){l(6,g=!0)}function E(){l(6,g=!1)}const y=K=>l(5,h=K),M=()=>l(5,h=null),v=K=>l(5,h=K),I=()=>l(5,h=null),b=K=>l(5,h=K),C=()=>l(5,h=null);function L(K){h=K,l(5,h)}function q(K){J=K,l(4,J)}function G(K){Qe[K?"unshift":"push"](()=>{F=K,l(3,F)})}return n.$$set=K=>{"className"in K&&l(0,u=K.className)},n.$$.update=()=>{n.$$.dirty[0]&1048578&&a.id!==_&&S&&(l(1,S=!1),D()),n.$$.dirty[0]&524288&&l(2,t=(c==null?void 0:c.prediction)||[]),n.$$.dirty[0]&4&&l(9,r=t==null?void 0:t.map(K=>K.tokenId)),n.$$.dirty[0]&4&&l(8,s=(t==null?void 0:t.map(K=>K.logit))||[]),n.$$.dirty[0]&4&&l(7,o=(t==null?void 0:t.map(K=>K.adjustedExp))||[])},[u,S,t,F,J,h,g,o,s,r,f,p,d,P,j,A,i,w,E,c,a,y,M,v,I,b,C,L,q,G]}class Fs extends Oe{constructor(e){super(),Re(this,e,Gs,Rs,je,{className:0},null,[-1,-1])}}function Us(n){let e,l="Drop out is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-ohkp45"&&(e.textContent=l),this.h()},h(){m(e,"class","dropout-content")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function xs(n){let e,l;return e=new nl({props:{class:ue("popover dropout-popover text-sm",n[1]),title:"Drop out",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:at,params:{duration:0},$$slots:{default:[Us]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,[r]){const s={};r&2&&(s.class=ue("popover dropout-popover text-sm",t[1])),r&1&&(s.offset=t[0]),r&4&&(s.triggeredBy=t[2]),r&8&&(s.trigger=t[3]),r&16&&(s.placement=t[4]),r&32&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Ws(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:s=void 0}=e,{trigger:o="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,s=a.triggeredBy),"trigger"in a&&l(3,o=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,r,s,o,c]}class Xs extends Oe{constructor(e){super(),Re(this,e,Ws,xs,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Ks(n){let e,l="Layer normalization is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-qw3l61"&&(e.textContent=l),this.h()},h(){m(e,"class","ln-content")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function Zs(n){let e,l;return e=new nl({props:{class:ue("popover ln-popover text-sm",n[1]),title:"Layer Normalization",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:at,params:{duration:0},$$slots:{default:[Ks]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,[r]){const s={};r&2&&(s.class=ue("popover ln-popover text-sm",t[1])),r&1&&(s.offset=t[0]),r&4&&(s.triggeredBy=t[2]),r&8&&(s.trigger=t[3]),r&16&&(s.placement=t[4]),r&32&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function Ys(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:s=void 0}=e,{trigger:o="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,s=a.triggeredBy),"trigger"in a&&l(3,o=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,r,s,o,c]}class Qs extends Oe{constructor(e){super(),Re(this,e,Ys,Zs,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Js(n){let e,l=`The GELU (Gaussian Error Linear Unit) activation function combines linear and non-linear
		behavior by scaling inputs using the Gaussian cumulative distribution function. It retains small
		negative values for smoother gradients and is effective in models like BERT.`;return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-1ri460b"&&(e.textContent=l),this.h()},h(){m(e,"class","activation-content svelte-60plg2")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function eo(n){let e,l;return e=new nl({props:{class:ue("popover activation-popover text-sm",n[1]),title:"GeLu Activation",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:at,params:{duration:0},$$slots:{default:[Js]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,[r]){const s={};r&2&&(s.class=ue("popover activation-popover text-sm",t[1])),r&1&&(s.offset=t[0]),r&4&&(s.triggeredBy=t[2]),r&8&&(s.trigger=t[3]),r&16&&(s.placement=t[4]),r&32&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function to(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:s=void 0}=e,{trigger:o="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,s=a.triggeredBy),"trigger"in a&&l(3,o=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,r,s,o,c]}class lo extends Oe{constructor(e){super(),Re(this,e,to,eo,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function no(n){let e,l=`A shortcut that facilitates the flow of information by adding the input of a layer to its
		output, allowing important information to skip the layer and preventing its loss.`;return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-1c9topx"&&(e.textContent=l),this.h()},h(){m(e,"class","residual-content svelte-9mwree")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function ro(n){let e,l;return e=new nl({props:{class:ue("popover residual-popover text-sm",n[1]),title:"Residual Connection",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:at,params:{duration:0},reference:n[5],$$slots:{default:[no]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,[r]){const s={};r&2&&(s.class=ue("popover residual-popover text-sm",t[1])),r&1&&(s.offset=t[0]),r&4&&(s.triggeredBy=t[2]),r&8&&(s.trigger=t[3]),r&16&&(s.placement=t[4]),r&32&&(s.reference=t[5]),r&64&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function so(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:s=void 0}=e,{trigger:o="hover"}=e,{placement:c="right"}=e,{reference:a}=e;return n.$$set=f=>{"offset"in f&&l(0,t=f.offset),"className"in f&&l(1,r=f.className),"triggeredBy"in f&&l(2,s=f.triggeredBy),"trigger"in f&&l(3,o=f.trigger),"placement"in f&&l(4,c=f.placement),"reference"in f&&l(5,a=f.reference)},[t,r,s,o,c,a]}class oo extends Oe{constructor(e){super(),Re(this,e,so,ro,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4,reference:5})}}function on(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function an(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function cn(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function fn(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function un(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function io(n){let e,l,t,r,s,o,c=be(n[4]),a=[];for(let p=0;p<c.length;p+=1)a[p]=hn(on(n,c,p));const f=p=>O(a[p],1,1,()=>{a[p]=null});return{c(){e=B("div");for(let p=0;p<a.length;p+=1)a[p].c();this.h()},l(p){e=z(p,"DIV",{id:!0,class:!0,role:!0});var d=T(e);for(let u=0;u<a.length;u+=1)a[u].l(d);d.forEach($),this.h()},h(){m(e,"id",l=`${n[0]}-end`),m(e,"class",t=de(ue("operation-col column residual",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(p,d){W(p,e,d);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);r=!0,s||(o=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],s=!0)},p(p,d){if(d&27){c=be(p[4]);let u;for(u=0;u<c.length;u+=1){const _=on(p,c,u);a[u]?(a[u].p(_,d),H(a[u],1)):(a[u]=hn(_),a[u].c(),H(a[u],1),a[u].m(e,null))}for(Ne(),u=c.length;u<a.length;u+=1)f(u);Se()}(!r||d&1&&l!==(l=`${p[0]}-end`))&&m(e,"id",l),(!r||d&2&&t!==(t=de(ue("operation-col column residual",p[1]))+" svelte-cfq6hx"))&&m(e,"class",t)},i(p){if(!r){for(let d=0;d<c.length;d+=1)H(a[d]);r=!0}},o(p){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)O(a[d]);r=!1},d(p){p&&$(e),Ae(a,p),s=!1,Fe(o)}}}function ao(n){let e,l,t,r,s,o,c,a,f=be(n[4]),p=[];for(let u=0;u<f.length;u+=1)p[u]=dn(an(n,f,u));const d=u=>O(p[u],1,1,()=>{p[u]=null});return t=new oo({props:{reference:`#${n[0]}-start`,triggeredBy:`[id^='${n[0]}-']`,offset:1}}),{c(){e=B("div");for(let u=0;u<p.length;u+=1)p[u].c();l=U(),te(t.$$.fragment),this.h()},l(u){e=z(u,"DIV",{id:!0,class:!0,role:!0});var _=T(e);for(let S=0;S<p.length;S+=1)p[S].l(_);l=x(_),le(t.$$.fragment,_),_.forEach($),this.h()},h(){m(e,"id",r=`${n[0]}-start`),m(e,"class",s=de(ue("operation-col column residual",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(u,_){W(u,e,_);for(let S=0;S<p.length;S+=1)p[S]&&p[S].m(e,null);k(e,l),ne(t,e,null),o=!0,c||(a=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],c=!0)},p(u,_){if(_&27){f=be(u[4]);let P;for(P=0;P<f.length;P+=1){const j=an(u,f,P);p[P]?(p[P].p(j,_),H(p[P],1)):(p[P]=dn(j),p[P].c(),H(p[P],1),p[P].m(e,l))}for(Ne(),P=f.length;P<p.length;P+=1)d(P);Se()}const S={};_&1&&(S.reference=`#${u[0]}-start`),_&1&&(S.triggeredBy=`[id^='${u[0]}-']`),t.$set(S),(!o||_&1&&r!==(r=`${u[0]}-start`))&&m(e,"id",r),(!o||_&2&&s!==(s=de(ue("operation-col column residual",u[1]))+" svelte-cfq6hx"))&&m(e,"class",s)},i(u){if(!o){for(let _=0;_<f.length;_+=1)H(p[_]);H(t.$$.fragment,u),o=!0}},o(u){p=p.filter(Boolean);for(let _=0;_<p.length;_+=1)O(p[_]);O(t.$$.fragment,u),o=!1},d(u){u&&$(e),Ae(p,u),re(t),c=!1,Fe(a)}}}function co(n){let e,l,t,r,s,o,c,a=be(n[4]),f=[];for(let d=0;d<a.length;d+=1)f[d]=pn(cn(n,a,d));const p=d=>O(f[d],1,1,()=>{f[d]=null});return t=new Qs({props:{triggeredBy:`#${n[0]}`}}),{c(){e=B("div");for(let d=0;d<f.length;d+=1)f[d].c();l=U(),te(t.$$.fragment),this.h()},l(d){e=z(d,"DIV",{id:!0,class:!0,role:!0});var u=T(e);for(let _=0;_<f.length;_+=1)f[_].l(u);l=x(u),le(t.$$.fragment,u),u.forEach($),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ue("operation-col column ln",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(d,u){W(d,e,u);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(e,null);k(e,l),ne(t,e,null),s=!0,o||(c=[ke(e,"mouseenter",n[11]),ke(e,"mouseleave",n[12])],o=!0)},p(d,u){if(u&26){a=be(d[4]);let S;for(S=0;S<a.length;S+=1){const P=cn(d,a,S);f[S]?(f[S].p(P,u),H(f[S],1)):(f[S]=pn(P),f[S].c(),H(f[S],1),f[S].m(e,l))}for(Ne(),S=a.length;S<f.length;S+=1)p(S);Se()}const _={};u&1&&(_.triggeredBy=`#${d[0]}`),t.$set(_),(!s||u&1)&&m(e,"id",d[0]),(!s||u&2&&r!==(r=de(ue("operation-col column ln",d[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(d){if(!s){for(let u=0;u<a.length;u+=1)H(f[u]);H(t.$$.fragment,d),s=!0}},o(d){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)O(f[u]);O(t.$$.fragment,d),s=!1},d(d){d&&$(e),Ae(f,d),re(t),o=!1,Fe(c)}}}function fo(n){let e,l,t,r,s,o,c,a=be(n[4]),f=[];for(let d=0;d<a.length;d+=1)f[d]=vn(fn(n,a,d));const p=d=>O(f[d],1,1,()=>{f[d]=null});return t=new Xs({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let d=0;d<f.length;d+=1)f[d].c();l=U(),te(t.$$.fragment),this.h()},l(d){e=z(d,"DIV",{id:!0,class:!0,role:!0});var u=T(e);for(let _=0;_<f.length;_+=1)f[_].l(u);l=x(u),le(t.$$.fragment,u),u.forEach($),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ue("operation-col column dropout",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(d,u){W(d,e,u);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(e,null);k(e,l),ne(t,e,null),s=!0,o||(c=[ke(e,"mouseenter",n[9]),ke(e,"mouseleave",n[10])],o=!0)},p(d,u){if(u&26){a=be(d[4]);let S;for(S=0;S<a.length;S+=1){const P=fn(d,a,S);f[S]?(f[S].p(P,u),H(f[S],1)):(f[S]=vn(P),f[S].c(),H(f[S],1),f[S].m(e,l))}for(Ne(),S=a.length;S<f.length;S+=1)p(S);Se()}const _={};u&1&&(_.triggeredBy=`#${d[0]}`),t.$set(_),(!s||u&1)&&m(e,"id",d[0]),(!s||u&2&&r!==(r=de(ue("operation-col column dropout",d[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(d){if(!s){for(let u=0;u<a.length;u+=1)H(f[u]);H(t.$$.fragment,d),s=!0}},o(d){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)O(f[u]);O(t.$$.fragment,d),s=!1},d(d){d&&$(e),Ae(f,d),re(t),o=!1,Fe(c)}}}function uo(n){let e,l,t,r,s,o,c,a=be(n[4]),f=[];for(let d=0;d<a.length;d+=1)f[d]=gn(un(n,a,d));const p=d=>O(f[d],1,1,()=>{f[d]=null});return t=new lo({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let d=0;d<f.length;d+=1)f[d].c();l=U(),te(t.$$.fragment),this.h()},l(d){e=z(d,"DIV",{id:!0,class:!0,role:!0});var u=T(e);for(let _=0;_<f.length;_+=1)f[_].l(u);l=x(u),le(t.$$.fragment,u),u.forEach($),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ue("operation-col column activation",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(d,u){W(d,e,u);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(e,null);k(e,l),ne(t,e,null),s=!0,o||(c=[ke(e,"mouseenter",n[7]),ke(e,"mouseleave",n[8])],o=!0)},p(d,u){if(u&26){a=be(d[4]);let S;for(S=0;S<a.length;S+=1){const P=un(d,a,S);f[S]?(f[S].p(P,u),H(f[S],1)):(f[S]=gn(P),f[S].c(),H(f[S],1),f[S].m(e,l))}for(Ne(),S=a.length;S<f.length;S+=1)p(S);Se()}const _={};u&1&&(_.triggeredBy=`#${d[0]}`),t.$set(_),(!s||u&1)&&m(e,"id",d[0]),(!s||u&2&&r!==(r=de(ue("operation-col column activation",d[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(d){if(!s){for(let u=0;u<a.length;u+=1)H(f[u]);H(t.$$.fragment,d),s=!0}},o(d){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)O(f[u]);O(t.$$.fragment,d),s=!1},d(d){d&&$(e),Ae(f,d),re(t),o=!1,Fe(c)}}}function hn(n){let e,l;return e=new Gt({props:{id:n[0],className:ue(n[1],{last:n[17]===n[4].length-1}),type:"residual-end",head:n[17]===0,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,r){const s={};r&1&&(s.id=t[0]),r&18&&(s.className=ue(t[1],{last:t[17]===t[4].length-1})),r&8&&(s.active=t[3]),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function dn(n){let e,l;return e=new Gt({props:{id:n[0],className:ue(n[1],{last:n[17]===n[4].length-1}),type:"residual-start",head:n[17]===0,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,r){const s={};r&1&&(s.id=t[0]),r&18&&(s.className=ue(t[1],{last:t[17]===t[4].length-1})),r&8&&(s.active=t[3]),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function pn(n){let e,l;return e=new Gt({props:{className:ue(n[1],{last:n[17]===n[4].length-1}),type:"ln",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,r){const s={};r&18&&(s.className=ue(t[1],{last:t[17]===t[4].length-1})),r&16&&(s.tail=t[17]===t[4].length-1),r&8&&(s.active=t[3]),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function vn(n){let e,l;return e=new Gt({props:{className:ue(n[1],{last:n[17]===n[4].length-1}),type:"dropout",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,r){const s={};r&18&&(s.className=ue(t[1],{last:t[17]===t[4].length-1})),r&16&&(s.tail=t[17]===t[4].length-1),r&8&&(s.active=t[3]),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function gn(n){let e,l;return e=new Gt({props:{className:ue(n[1],{last:n[17]===n[4].length-1}),type:"activation",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,r){ne(e,t,r),l=!0},p(t,r){const s={};r&18&&(s.className=ue(t[1],{last:t[17]===t[4].length-1})),r&16&&(s.tail=t[17]===t[4].length-1),r&8&&(s.active=t[3]),e.$set(s)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){re(e,t)}}}function ho(n){let e,l,t,r;const s=[uo,fo,co,ao,io],o=[];function c(a,f){return a[2]==="activation"?0:a[2]==="dropout"?1:a[2]==="ln"?2:a[2]==="residual-start"?3:a[2]==="residual-end"?4:-1}return~(e=c(n))&&(l=o[e]=s[e](n)),{c(){l&&l.c(),t=ut()},l(a){l&&l.l(a),t=ut()},m(a,f){~e&&o[e].m(a,f),W(a,t,f),r=!0},p(a,[f]){let p=e;e=c(a),e===p?~e&&o[e].p(a,f):(l&&(Ne(),O(o[p],1,1,()=>{o[p]=null}),Se()),~e?(l=o[e],l?l.p(a,f):(l=o[e]=s[e](a),l.c()),H(l,1),l.m(t.parentNode,t)):l=null)},i(a){r||(H(l),r=!0)},o(a){O(l),r=!1},d(a){a&&$(t),~e&&o[e].d(a)}}}function po(n,e,l){let t;ye(n,gt,V=>l(4,t=V));let{id:r}=e,{className:s=void 0}=e,{type:o=void 0}=e,c=!1;const a=()=>{l(3,c=!0);const V=document.querySelector(`#${r}-start`),R=document.querySelector(`#${r}-end`),J=Je(`.residual-connector.${r}`);J.style("opacity",1),d(J),V==null||V.classList.add("active"),R==null||R.classList.add("active")};let f;const p=()=>{l(3,c=!1);const V=document.querySelector(`#${r}-start`),R=document.querySelector(`#${r}-end`),J=Je(`.residual-connector.${r}`);J.style("opacity",0),f&&(f.kill(),J.style("stroke-dashoffset",0)),V==null||V.classList.remove("active"),R==null||R.classList.remove("active")},d=V=>{f=pt.to(V.node(),{strokeDashoffset:-50,duration:1,repeat:-1,ease:"none"})},u=()=>{l(3,c=!0)},_=()=>{l(3,c=!1)},S=()=>{l(3,c=!0)},P=()=>{l(3,c=!1)},j=()=>{l(3,c=!0)},F=()=>{l(3,c=!1)};return n.$$set=V=>{"id"in V&&l(0,r=V.id),"className"in V&&l(1,s=V.className),"type"in V&&l(2,o=V.type)},[r,s,o,c,t,a,p,u,_,S,P,j,F]}class ct extends Oe{constructor(e){super(),Re(this,e,po,ho,je,{id:0,className:1,type:2})}}function mn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function _n(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function $n(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function bn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function wn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function kn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function En(n){let e,l="Token";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-6k2z6t"&&(e.textContent=l),this.h()},h(){m(e,"class","subtitle embedding-detail svelte-1iayxn1")},m(t,r){W(t,e,r)},d(t){t&&$(e)}}}function yn(n){let e,l,t=n[19]+"",r;return{c(){e=B("div"),l=B("span"),r=ve(t),this.h()},l(s){e=z(s,"DIV",{class:!0});var o=T(e);l=z(o,"SPAN",{class:!0});var c=T(l);r=ge(c,t),c.forEach($),o.forEach($),this.h()},h(){m(l,"class","label svelte-1iayxn1"),m(e,"class","cell svelte-1iayxn1"),oe(e,"last",n[21]===n[4].length-1)},m(s,o){W(s,e,o),k(e,l),k(l,r)},p(s,o){o&16&&t!==(t=s[19]+"")&&Le(r,t),o&16&&oe(e,"last",s[21]===s[4].length-1)},d(s){s&&$(e)}}}function In(n){let e,l,t,r,s,o="Token<br/>Embedding",c,a,f,p,d,u,_,S,P="Positional<br/>Encoding",j,F,V,R,J;e=new He({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover",$$slots:{default:[vo]},$$scope:{ctx:n}}}),c=new yl({props:{id:"token-embedding",$$slots:{default:[go]},$$scope:{ctx:n}}});let N=be(n[4]),D=[];for(let v=0;v<N.length;v+=1)D[v]=Cn(wn(n,N,v));const A=v=>O(D[v],1,1,()=>{D[v]=null});let i=be(n[4]),h=[];for(let v=0;v<i.length;v+=1)h[v]=Dn(bn(n,i,v));j=new yl({props:{id:"position-embedding",$$slots:{default:[_o]},$$scope:{ctx:n}}});let g=be(n[4]),w=[];for(let v=0;v<g.length;v+=1)w[v]=Vn($n(n,g,v));const E=v=>O(w[v],1,1,()=>{w[v]=null});let y=be(n[4]),M=[];for(let v=0;v<y.length;v+=1)M[v]=Nn(_n(n,y,v));return{c(){te(e.$$.fragment),l=U(),t=B("div"),r=B("div"),s=B("span"),s.innerHTML=o,te(c.$$.fragment),a=U();for(let v=0;v<D.length;v+=1)D[v].c();f=U(),p=B("div");for(let v=0;v<h.length;v+=1)h[v].c();d=U(),u=B("div"),_=B("div"),S=B("span"),S.innerHTML=P,te(j.$$.fragment),F=U();for(let v=0;v<w.length;v+=1)w[v].c();V=U(),R=B("div");for(let v=0;v<M.length;v+=1)M[v].c();this.h()},l(v){le(e.$$.fragment,v),l=x(v),t=z(v,"DIV",{class:!0});var I=T(t);r=z(I,"DIV",{class:!0});var b=T(r);s=z(b,"SPAN",{"data-svelte-h":!0}),Ie(s)!=="svelte-1vtrff3"&&(s.innerHTML=o),le(c.$$.fragment,b),b.forEach($),a=x(I);for(let K=0;K<D.length;K+=1)D[K].l(I);I.forEach($),f=x(v),p=z(v,"DIV",{class:!0});var C=T(p);for(let K=0;K<h.length;K+=1)h[K].l(C);C.forEach($),d=x(v),u=z(v,"DIV",{class:!0});var L=T(u);_=z(L,"DIV",{class:!0});var q=T(_);S=z(q,"SPAN",{"data-svelte-h":!0}),Ie(S)!=="svelte-12blhrw"&&(S.innerHTML=P),le(j.$$.fragment,q),q.forEach($),F=x(L);for(let K=0;K<w.length;K+=1)w[K].l(L);L.forEach($),V=x(v),R=z(v,"DIV",{class:!0});var G=T(R);for(let K=0;K<M.length;K+=1)M[K].l(G);G.forEach($),this.h()},h(){m(r,"class","subtitle flex items-center gap-1 svelte-1iayxn1"),m(t,"class","column token-embedding embedding-detail svelte-1iayxn1"),m(p,"class","column symbol embedding-detail svelte-1iayxn1"),m(_,"class","subtitle flex gap-1 svelte-1iayxn1"),m(u,"class","column embedding-detail position-embedding svelte-1iayxn1"),m(R,"class","column symbol embedding-detail svelte-1iayxn1")},m(v,I){ne(e,v,I),W(v,l,I),W(v,t,I),k(t,r),k(r,s),ne(c,r,null),k(t,a);for(let b=0;b<D.length;b+=1)D[b]&&D[b].m(t,null);W(v,f,I),W(v,p,I);for(let b=0;b<h.length;b+=1)h[b]&&h[b].m(p,null);W(v,d,I),W(v,u,I),k(u,_),k(_,S),ne(j,_,null),k(u,F);for(let b=0;b<w.length;b+=1)w[b]&&w[b].m(u,null);W(v,V,I),W(v,R,I);for(let b=0;b<M.length;b+=1)M[b]&&M[b].m(R,null);J=!0},p(v,I){const b={};I&134217760&&(b.$$scope={dirty:I,ctx:v}),e.$set(b);const C={};if(I&134217728&&(C.$$scope={dirty:I,ctx:v}),c.$set(C),I&16){N=be(v[4]);let q;for(q=0;q<N.length;q+=1){const G=wn(v,N,q);D[q]?(D[q].p(G,I),H(D[q],1)):(D[q]=Cn(G),D[q].c(),H(D[q],1),D[q].m(t,null))}for(Ne(),q=N.length;q<D.length;q+=1)A(q);Se()}if(I&16){i=be(v[4]);let q;for(q=0;q<i.length;q+=1){const G=bn(v,i,q);h[q]?h[q].p(G,I):(h[q]=Dn(),h[q].c(),h[q].m(p,null))}for(;q<h.length;q+=1)h[q].d(1);h.length=i.length}const L={};if(I&134217728&&(L.$$scope={dirty:I,ctx:v}),j.$set(L),I&80){g=be(v[4]);let q;for(q=0;q<g.length;q+=1){const G=$n(v,g,q);w[q]?(w[q].p(G,I),H(w[q],1)):(w[q]=Vn(G),w[q].c(),H(w[q],1),w[q].m(u,null))}for(Ne(),q=g.length;q<w.length;q+=1)E(q);Se()}if(I&16){y=be(v[4]);let q;for(q=0;q<y.length;q+=1){const G=_n(v,y,q);M[q]?M[q].p(G,I):(M[q]=Nn(),M[q].c(),M[q].m(R,null))}for(;q<M.length;q+=1)M[q].d(1);M.length=y.length}},i(v){if(!J){H(e.$$.fragment,v),H(c.$$.fragment,v);for(let I=0;I<N.length;I+=1)H(D[I]);H(j.$$.fragment,v);for(let I=0;I<g.length;I+=1)H(w[I]);J=!0}},o(v){O(e.$$.fragment,v),O(c.$$.fragment,v),D=D.filter(Boolean);for(let I=0;I<D.length;I+=1)O(D[I]);O(j.$$.fragment,v),w=w.filter(Boolean);for(let I=0;I<w.length;I+=1)O(w[I]);J=!1},d(v){v&&($(l),$(t),$(f),$(p),$(d),$(u),$(V),$(R)),re(e,v),re(c),Ae(D,v),Ae(h,v),re(j),Ae(w,v),Ae(M,v)}}}function vo(n){let e,l=n[5].dimension+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function go(n){let e;return{c(){e=ve("Token Embedding is")},l(l){e=ge(l,"Token Embedding is")},m(l,t){W(l,e,t)},d(l){l&&$(e)}}}function mo(n){let e,l="id",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(r){e=z(r,"SPAN",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-1e13gni"&&(e.textContent=l),t=z(r,"BR",{}),this.h()},h(){m(e,"class","label svelte-1iayxn1")},m(r,s){W(r,e,s),W(r,t,s)},d(r){r&&($(e),$(t))}}}function Cn(n){let e,l,t='<div class="flex flex-col items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 31 9" fill="none" class="w-10 text-gray-300"><path fill="currentColor" d="M30.3886 4.74352C30.5839 4.54826 30.5839 4.23168 30.3886 4.03642L27.2067 0.854435C27.0114 0.659173 26.6948 0.659173 26.4996 0.854435C26.3043 1.0497 26.3043 1.36628 26.4996 1.56154L29.328 4.38997L26.4996 7.2184C26.3043 7.41366 26.3043 7.73024 26.4996 7.9255C26.6948 8.12076 27.0114 8.12076 27.2067 7.9255L30.3886 4.74352ZM0.31958 4.88997H30.0351V3.88997H0.31958V4.88997Z"></path></svg></div>',r,s,o,c,a,f,p,d,u=(Math.random()*1e4).toFixed()+"",_,S,P;c=new ft({props:{active:!0}});let j=n[21]===0&&mo();return{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),s=B("div"),o=B("div"),te(c.$$.fragment),a=U(),f=B("span"),j&&j.c(),p=U(),d=B("span"),_=ve(u),S=U(),this.h()},l(F){e=z(F,"DIV",{class:!0});var V=T(e);l=z(V,"DIV",{class:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-lh48yp"&&(l.innerHTML=t),r=x(V),s=z(V,"DIV",{class:!0});var R=T(s);o=z(R,"DIV",{class:!0});var J=T(o);le(c.$$.fragment,J),J.forEach($),a=x(R),f=z(R,"SPAN",{class:!0});var N=T(f);j&&j.l(N),p=x(N),d=z(N,"SPAN",{class:!0});var D=T(d);_=ge(D,u),D.forEach($),N.forEach($),R.forEach($),S=x(V),V.forEach($),this.h()},h(){m(l,"class","vocab-index ellipsis flex items-center text-right text-xs text-gray-400 svelte-1iayxn1"),m(o,"class",de(`vector ${dl}`)+" svelte-1iayxn1"),m(d,"class","val svelte-1iayxn1"),m(f,"class","index-val text-xs svelte-1iayxn1"),m(s,"class","cell flex items-center svelte-1iayxn1"),m(e,"class","token-id flex items-center")},m(F,V){W(F,e,V),k(e,l),k(e,r),k(e,s),k(s,o),ne(c,o,null),k(s,a),k(s,f),j&&j.m(f,null),k(f,p),k(f,d),k(d,_),k(e,S),P=!0},p:qe,i(F){P||(H(c.$$.fragment,F),P=!0)},o(F){O(c.$$.fragment,F),P=!1},d(F){F&&$(e),re(c),j&&j.d()}}}function Dn(n){let e,l="+";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-124y0va"&&(e.textContent=l),this.h()},h(){m(e,"class","cell svelte-1iayxn1")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function _o(n){let e;return{c(){e=ve("Positional Embedding is")},l(l){e=ge(l,"Positional Embedding is")},m(l,t){W(l,e,t)},d(l){l&&$(e)}}}function $o(n){let e,l="position",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(r){e=z(r,"SPAN",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-4n0g90"&&(e.textContent=l),t=z(r,"BR",{}),this.h()},h(){m(e,"class","label svelte-1iayxn1")},m(r,s){W(r,e,s),W(r,t,s)},d(r){r&&($(e),$(t))}}}function Vn(n){let e,l,t,r,s,o,c,a,f,p;t=new ft({props:{active:!0,colorScale:n[12]}});let d=n[21]===0&&$o();return{c(){e=B("div"),l=B("div"),te(t.$$.fragment),r=U(),s=B("span"),d&&d.c(),o=U(),c=B("span"),a=ve(n[21]),f=U(),this.h()},l(u){e=z(u,"DIV",{class:!0});var _=T(e);l=z(_,"DIV",{class:!0});var S=T(l);le(t.$$.fragment,S),S.forEach($),r=x(_),s=z(_,"SPAN",{class:!0});var P=T(s);d&&d.l(P),o=x(P),c=z(P,"SPAN",{class:!0});var j=T(c);a=ge(j,n[21]),j.forEach($),P.forEach($),f=x(_),_.forEach($),this.h()},h(){m(l,"class",de(`vector ${dl}`)+" svelte-1iayxn1"),m(c,"class","val svelte-1iayxn1"),m(s,"class","index-val text-xs svelte-1iayxn1"),m(e,"class","cell flex items-center svelte-1iayxn1")},m(u,_){W(u,e,_),k(e,l),ne(t,l,null),k(e,r),k(e,s),d&&d.m(s,null),k(s,o),k(s,c),k(c,a),k(e,f),p=!0},p:qe,i(u){p||(H(t.$$.fragment,u),p=!0)},o(u){O(t.$$.fragment,u),p=!1},d(u){u&&$(e),re(t),d&&d.d()}}}function Nn(n){let e,l="=";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=z(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-1btrmmo"&&(e.textContent=l),this.h()},h(){m(e,"class","cell svelte-1iayxn1")},m(t,r){W(t,e,r)},p:qe,d(t){t&&$(e)}}}function bo(n){let e,l=n[5].dimension+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Sn(n){let e,l,t,r,s;return l=new ft({props:{active:n[3]||n[1]}}),r=new He({props:{placement:"right",class:"popover",$$slots:{default:[bo]},$$scope:{ctx:n}}}),{c(){e=B("div"),te(l.$$.fragment),t=U(),te(r.$$.fragment),this.h()},l(o){e=z(o,"DIV",{class:!0});var c=T(e);le(l.$$.fragment,c),c.forEach($),t=x(o),le(r.$$.fragment,o),this.h()},h(){m(e,"class",de(`vector ${dl}`)+" svelte-1iayxn1"),oe(e,"last",n[21]===n[4].length-1)},m(o,c){W(o,e,c),ne(l,e,null),W(o,t,c),ne(r,o,c),s=!0},p(o,c){const a={};c&10&&(a.active=o[3]||o[1]),l.$set(a),(!s||c&16)&&oe(e,"last",o[21]===o[4].length-1);const f={};c&134217760&&(f.$$scope={dirty:c,ctx:o}),r.$set(f)},i(o){s||(H(l.$$.fragment,o),H(r.$$.fragment,o),s=!0)},o(o){O(l.$$.fragment,o),O(r.$$.fragment,o),s=!1},d(o){o&&($(e),$(t)),re(l),re(r,o)}}}function wo(n){let e,l,t="<div>Embedding</div>",r,s,o,c,a,f,p,d,u,_,S,P,j,F,V,R,J,N,D,A,i,h,g=n[1]&&En(),w=be(n[4]),E=[];for(let b=0;b<w.length;b+=1)E[b]=yn(kn(n,w,b));let y=n[1]&&In(n),M=be(n[4]),v=[];for(let b=0;b<M.length;b+=1)v[b]=Sn(mn(n,M,b));const I=b=>O(v[b],1,1,()=>{v[b]=null});return F=new ct({props:{type:"dropout",id:"embedding-dropout"}}),R=new ct({props:{type:"residual-start",id:"residual-first"}}),N=new ct({props:{type:"ln",id:"embedding-ln"}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),s=B("div"),o=B("div"),c=B("div"),g&&g.c(),a=U();for(let b=0;b<E.length;b+=1)E[b].c();f=U(),p=B("div"),d=U(),y&&y.c(),u=U(),_=B("div"),S=B("div");for(let b=0;b<v.length;b+=1)v[b].c();P=U(),j=B("div"),te(F.$$.fragment),V=U(),te(R.$$.fragment),J=U(),te(N.$$.fragment),this.h()},l(b){e=z(b,"DIV",{class:!0,role:!0});var C=T(e);l=z(C,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-szi5cj"&&(l.innerHTML=t),r=x(C),s=z(C,"DIV",{class:!0});var L=T(s);o=z(L,"DIV",{class:!0});var q=T(o);c=z(q,"DIV",{class:!0});var G=T(c);g&&g.l(G),a=x(G);for(let fe=0;fe<E.length;fe+=1)E[fe].l(G);f=x(G),p=z(G,"DIV",{class:!0}),T(p).forEach($),G.forEach($),d=x(q),y&&y.l(q),q.forEach($),u=x(L),_=z(L,"DIV",{class:!0});var K=T(_);S=z(K,"DIV",{class:!0});var he=T(S);for(let fe=0;fe<v.length;fe+=1)v[fe].l(he);he.forEach($),P=x(K),j=z(K,"DIV",{class:!0});var Y=T(j);le(F.$$.fragment,Y),V=x(Y),le(R.$$.fragment,Y),J=x(Y),le(N.$$.fragment,Y),Y.forEach($),K.forEach($),L.forEach($),C.forEach($),this.h()},h(){m(l,"class","title expandable svelte-1iayxn1"),m(l,"role","none"),m(p,"class","bounding embedding-bounding svelte-1iayxn1"),oe(p,"active",n[3]&&!n[1]),m(c,"class","column token-string relative svelte-1iayxn1"),m(o,"class","token-column resizable resize-watch flex"),m(S,"class","column vectors svelte-1iayxn1"),m(j,"class","operations flex svelte-1iayxn1"),m(_,"class","vector-column relative flex"),m(s,"class","content relative svelte-1iayxn1"),m(e,"class",D=de(ue("embedding",n[0],{expanded:n[1]}))+" svelte-1iayxn1"),m(e,"role","none")},m(b,C){W(b,e,C),k(e,l),k(e,r),k(e,s),k(s,o),k(o,c),g&&g.m(c,null),k(c,a);for(let L=0;L<E.length;L+=1)E[L]&&E[L].m(c,null);k(c,f),k(c,p),k(o,d),y&&y.m(o,null),k(s,u),k(s,_),k(_,S);for(let L=0;L<v.length;L+=1)v[L]&&v[L].m(S,null);k(_,P),k(_,j),ne(F,j,null),k(j,V),ne(R,j,null),k(j,J),ne(N,j,null),n[13](e),A=!0,i||(h=[ke(l,"click",n[8]),ke(l,"keydown",n[8]),ke(l,"mouseenter",n[9]),ke(l,"mouseleave",n[10]),ke(e,"click",n[7]),ke(e,"keydown",n[7])],i=!0)},p(b,[C]){if(b[1]?g||(g=En(),g.c(),g.m(c,a)):g&&(g.d(1),g=null),C&16){w=be(b[4]);let L;for(L=0;L<w.length;L+=1){const q=kn(b,w,L);E[L]?E[L].p(q,C):(E[L]=yn(q),E[L].c(),E[L].m(c,f))}for(;L<E.length;L+=1)E[L].d(1);E.length=w.length}if((!A||C&10)&&oe(p,"active",b[3]&&!b[1]),b[1]?y?(y.p(b,C),C&2&&H(y,1)):(y=In(b),y.c(),H(y,1),y.m(o,null)):y&&(Ne(),O(y,1,1,()=>{y=null}),Se()),C&58){M=be(b[4]);let L;for(L=0;L<M.length;L+=1){const q=mn(b,M,L);v[L]?(v[L].p(q,C),H(v[L],1)):(v[L]=Sn(q),v[L].c(),H(v[L],1),v[L].m(S,null))}for(Ne(),L=M.length;L<v.length;L+=1)I(L);Se()}(!A||C&3&&D!==(D=de(ue("embedding",b[0],{expanded:b[1]}))+" svelte-1iayxn1"))&&m(e,"class",D)},i(b){if(!A){H(y);for(let C=0;C<M.length;C+=1)H(v[C]);H(F.$$.fragment,b),H(R.$$.fragment,b),H(N.$$.fragment,b),A=!0}},o(b){O(y),v=v.filter(Boolean);for(let C=0;C<v.length;C+=1)O(v[C]);O(F.$$.fragment,b),O(R.$$.fragment,b),O(N.$$.fragment,b),A=!1},d(b){b&&$(e),g&&g.d(),Ae(E,b),y&&y.d(),Ae(v,b),re(F),re(R),re(N),n[13](null),i=!1,Fe(h)}}}const dl="bg-gray-300";function ko(n,e,l){let t,r,s;ye(n,xe,D=>l(11,t=D)),ye(n,gt,D=>l(4,r=D)),ye(n,zt,D=>l(5,s=D));const{theme:o}=wt(kt);let{className:c=void 0}=e;tl("block-id","embedding");const a=el("block-id");let f=!1;const p=()=>{f||(xe.set({id:a}),P())},d=D=>{D.stopPropagation(),D.preventDefault(),f?(xe.set({id:null}),j()):(xe.set({id:a}),P())};let u;function _(D){f&&!u.contains(D.target)&&xe.set({id:null})}vt(()=>(document.body.addEventListener("click",_),()=>{document.body.removeEventListener("click",_)}));let S;const P=async()=>{S=bt.Flip.getState(".embedding .token-column"),l(1,f=!0),await Ot(),bt.Flip.from(S,{duration:.5,ease:"power2.inOut"}),pt.to(".embedding-detail",{opacity:1,duration:.5,delay:.5})},j=async()=>{S=bt.Flip.getState(".embedding .token-column"),l(1,f=!1),await Ot(),bt.Flip.from(S,{duration:.5,ease:"power2.inOut"})};let F=!1;function V(){l(3,F=!0)}function R(){l(3,F=!1)}const J=(D,A)=>Jn().domain([0,.5,1]).range([o.colors.red[400],"white",o.colors.blue[400]])(D);function N(D){Qe[D?"unshift":"push"](()=>{u=D,l(2,u)})}return n.$$set=D=>{"className"in D&&l(0,c=D.className)},n.$$.update=()=>{n.$$.dirty&2050&&t.id!==a&&f&&(l(1,f=!1),j())},[c,f,u,F,r,s,o,p,d,V,R,t,J,N]}class Eo extends Oe{constructor(e){super(),Re(this,e,ko,wo,je,{className:0})}}function Mn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function An(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function qn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function Ln(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function yo(n){let e,l=n[5].dimension+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Bn(n){let e,l,t=n[10]+"",r,s,o,c,a,f,p,d,u,_,S,P,j;c=new ft({props:{colorScale:"purple",active:n[2]===n[12]}});function F(){return n[8](n[12])}return _=new He({props:{placement:"right",class:"popover",$$slots:{default:[yo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),o=B("div"),te(c.$$.fragment),a=U(),f=B("div"),p=U(),d=B("div"),u=U(),te(_.$$.fragment),this.h()},l(V){e=z(V,"DIV",{class:!0,role:!0});var R=T(e);l=z(R,"SPAN",{class:!0});var J=T(l);r=ge(J,t),J.forEach($),s=x(R),o=z(R,"DIV",{class:!0});var N=T(o);le(c.$$.fragment,N),a=x(N),f=z(N,"DIV",{class:!0}),T(f).forEach($),p=x(N),d=z(N,"DIV",{class:!0}),T(d).forEach($),N.forEach($),R.forEach($),u=x(V),le(_.$$.fragment,V),this.h()},h(){m(l,"class","label float svelte-13p50c2"),m(f,"class","sub-vector x1-12 head1"),m(d,"class","sub-vector head-rest grow"),m(o,"class",de(`vector flex flex-col  ${Vo}`)+" svelte-13p50c2"),m(e,"class","cell"),m(e,"role","group"),oe(e,"last",n[12]===n[4].length-1)},m(V,R){W(V,e,R),k(e,l),k(l,r),k(e,s),k(e,o),ne(c,o,null),k(o,a),k(o,f),k(o,p),k(o,d),W(V,u,R),ne(_,V,R),S=!0,P||(j=[ke(e,"mouseenter",F),ke(e,"mouseleave",n[9])],P=!0)},p(V,R){n=V,(!S||R&16)&&t!==(t=n[10]+"")&&Le(r,t);const J={};R&4&&(J.active=n[2]===n[12]),c.$set(J),(!S||R&16)&&oe(e,"last",n[12]===n[4].length-1);const N={};R&65568&&(N.$$scope={dirty:R,ctx:n}),_.$set(N)},i(V){S||(H(c.$$.fragment,V),H(_.$$.fragment,V),S=!0)},o(V){O(c.$$.fragment,V),O(_.$$.fragment,V),S=!1},d(V){V&&($(e),$(u)),re(c),re(_,V),P=!1,Fe(j)}}}function Io(n){let e,l=n[5].dimension*4+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension*4+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function zn(n){let e,l,t,r,s,o,c;return t=new ft({props:{colorScale:"indigo"}}),o=new He({props:{placement:"right",class:"popover",$$slots:{default:[Io]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),te(t.$$.fragment),s=U(),te(o.$$.fragment),this.h()},l(a){e=z(a,"DIV",{class:!0});var f=T(e);l=z(f,"DIV",{class:!0});var p=T(l);le(t.$$.fragment,p),p.forEach($),f.forEach($),s=x(a),le(o.$$.fragment,a),this.h()},h(){m(l,"class",de(ue(`vector x4 ${No} opacity-80`))+" svelte-13p50c2"),m(e,"class",r=de(ue("cell x4",{small:n[12]!==0&&n[12]!==n[4].length-1}))+" svelte-13p50c2"),oe(e,"last",n[12]===n[4].length-1)},m(a,f){W(a,e,f),k(e,l),ne(t,l,null),W(a,s,f),ne(o,a,f),c=!0},p(a,f){(!c||f&16&&r!==(r=de(ue("cell x4",{small:a[12]!==0&&a[12]!==a[4].length-1}))+" svelte-13p50c2"))&&m(e,"class",r),(!c||f&16)&&oe(e,"last",a[12]===a[4].length-1);const p={};f&65568&&(p.$$scope={dirty:f,ctx:a}),o.$set(p)},i(a){c||(H(t.$$.fragment,a),H(o.$$.fragment,a),c=!0)},o(a){O(t.$$.fragment,a),O(o.$$.fragment,a),c=!1},d(a){a&&($(e),$(s)),re(t),re(o,a)}}}function Tn(n){let e,l,t=n[10]+"",r,s;return{c(){e=B("div"),l=B("span"),r=ve(t),s=U(),this.h()},l(o){e=z(o,"DIV",{class:!0});var c=T(e);l=z(c,"SPAN",{class:!0});var a=T(l);r=ge(a,t),a.forEach($),s=x(c),c.forEach($),this.h()},h(){m(l,"class","label float svelte-13p50c2"),m(e,"class","cell"),oe(e,"last",n[12]===n[4].length-1)},m(o,c){W(o,e,c),k(e,l),k(l,r),k(e,s)},p(o,c){c&16&&t!==(t=o[10]+"")&&Le(r,t),c&16&&oe(e,"last",o[12]===o[4].length-1)},d(o){o&&$(e)}}}function Co(n){let e,l=n[5].dimension+"",t,r;return{c(){e=ve("vector("),t=ve(l),r=ve(")")},l(s){e=ge(s,"vector("),t=ge(s,l),r=ge(s,")")},m(s,o){W(s,e,o),W(s,t,o),W(s,r,o)},p(s,o){o&32&&l!==(l=s[5].dimension+"")&&Le(t,l)},d(s){s&&($(e),$(t),$(r))}}}function Pn(n){let e,l,t,r,s,o;return t=new ft({props:{colorScale:"blue"}}),s=new He({props:{placement:"right",class:"popover",$$slots:{default:[Co]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),te(t.$$.fragment),r=U(),te(s.$$.fragment),this.h()},l(c){e=z(c,"DIV",{class:!0});var a=T(e);l=z(a,"DIV",{class:!0});var f=T(l);le(t.$$.fragment,f),f.forEach($),a.forEach($),r=x(c),le(s.$$.fragment,c),this.h()},h(){m(l,"class",de(`vector ${So}`)+" svelte-13p50c2"),m(e,"class","cell"),oe(e,"last",n[12]===n[4].length-1)},m(c,a){W(c,e,a),k(e,l),ne(t,l,null),W(c,r,a),ne(s,c,a),o=!0},p(c,a){(!o||a&16)&&oe(e,"last",c[12]===c[4].length-1);const f={};a&65568&&(f.$$scope={dirty:a,ctx:c}),s.$set(f)},i(c){o||(H(t.$$.fragment,c),H(s.$$.fragment,c),o=!0)},o(c){O(t.$$.fragment,c),O(s.$$.fragment,c),o=!1},d(c){c&&($(e),$(r)),re(t),re(s,c)}}}function Do(n){let e,l,t="MLP",r,s,o,c,a,f,p,d,u,_,S,P,j,F,V,R,J,N,D,A,i,h,g,w,E,y,M,v,I,b,C,L,q,G,K,he=be(n[4]),Y=[];for(let Z=0;Z<he.length;Z+=1)Y[Z]=Bn(Ln(n,he,Z));const fe=Z=>O(Y[Z],1,1,()=>{Y[Z]=null});_=new ct({props:{type:"dropout",id:"mlp-first-dropout"}}),P=new ct({props:{type:"residual-end",id:"residual-first"}}),F=new ct({props:{type:"ln",id:"mlp-first-ln"}}),R=new ct({props:{type:"residual-start",id:"residual-second"}});let pe=be(n[4]),ce=[];for(let Z=0;Z<pe.length;Z+=1)ce[Z]=zn(qn(n,pe,Z));const Ue=Z=>O(ce[Z],1,1,()=>{ce[Z]=null});h=new ct({props:{type:"activation",id:"mlp-activation",className:"x4"}});let ee=be(n[4]),se=[];for(let Z=0;Z<ee.length;Z+=1)se[Z]=Tn(An(n,ee,Z));M=new ct({props:{type:"residual-end",id:"residual-second"}}),I=new ct({props:{type:"ln",id:"mlp-second-ln"}});let X=be(n[4]),$e=[];for(let Z=0;Z<X.length;Z+=1)$e[Z]=Pn(Mn(n,X,Z));const Me=Z=>O($e[Z],1,1,()=>{$e[Z]=null});return{c(){e=B("div"),l=B("div"),l.textContent=t,r=U(),s=B("div"),o=B("div"),c=U(),a=B("div"),f=U(),p=B("div"),d=B("div");for(let Z=0;Z<Y.length;Z+=1)Y[Z].c();u=U(),te(_.$$.fragment),S=U(),te(P.$$.fragment),j=U(),te(F.$$.fragment),V=U(),te(R.$$.fragment),J=U(),N=B("div"),D=B("div"),A=B("div");for(let Z=0;Z<ce.length;Z+=1)ce[Z].c();i=U(),te(h.$$.fragment),g=U(),w=B("div"),E=B("div");for(let Z=0;Z<se.length;Z+=1)se[Z].c();y=U(),te(M.$$.fragment),v=U(),te(I.$$.fragment),b=U(),C=B("div");for(let Z=0;Z<$e.length;Z+=1)$e[Z].c();this.h()},l(Z){e=z(Z,"DIV",{class:!0});var ie=T(e);l=z(ie,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ie(l)!=="svelte-50ab67"&&(l.textContent=t),r=x(ie),s=z(ie,"DIV",{class:!0});var Q=T(s);o=z(Q,"DIV",{class:!0}),T(o).forEach($),c=x(Q),a=z(Q,"DIV",{class:!0}),T(a).forEach($),f=x(Q),p=z(Q,"DIV",{class:!0});var Ve=T(p);d=z(Ve,"DIV",{class:!0});var Ke=T(d);for(let ze=0;ze<Y.length;ze+=1)Y[ze].l(Ke);Ke.forEach($),u=x(Ve),le(_.$$.fragment,Ve),S=x(Ve),le(P.$$.fragment,Ve),j=x(Ve),le(F.$$.fragment,Ve),V=x(Ve),le(R.$$.fragment,Ve),Ve.forEach($),J=x(Q),N=z(Q,"DIV",{class:!0});var Be=T(N);D=z(Be,"DIV",{class:!0});var ht=T(D);A=z(ht,"DIV",{class:!0});var Nt=T(A);for(let ze=0;ze<ce.length;ze+=1)ce[ze].l(Nt);Nt.forEach($),i=x(ht),le(h.$$.fragment,ht),ht.forEach($),g=x(Be),w=z(Be,"DIV",{class:!0});var Pe=T(w);E=z(Pe,"DIV",{class:!0});var rt=T(E);for(let ze=0;ze<se.length;ze+=1)se[ze].l(rt);rt.forEach($),y=x(Pe),le(M.$$.fragment,Pe),v=x(Pe),le(I.$$.fragment,Pe),b=x(Pe),C=z(Pe,"DIV",{class:!0});var St=T(C);for(let ze=0;ze<$e.length;ze+=1)$e[ze].l(St);St.forEach($),Pe.forEach($),Be.forEach($),Q.forEach($),ie.forEach($),this.h()},h(){m(l,"class","title"),m(l,"role","group"),m(o,"class","bounding transformer-bounding svelte-13p50c2"),oe(o,"active",n[3]),m(a,"class","bounding mlp-bounding svelte-13p50c2"),oe(a,"active",n[1]),m(d,"class","column initial"),m(p,"class","layer first-layer flex svelte-13p50c2"),m(A,"class","column"),m(D,"class","projections flex"),m(E,"class","column out-label"),m(C,"class","column out"),m(w,"class","ouputs flex"),m(N,"class","layer second-layer flex justify-between svelte-13p50c2"),m(s,"class","content relative svelte-13p50c2"),m(e,"class",L=de(ue("mlp",n[0]))+" svelte-13p50c2")},m(Z,ie){W(Z,e,ie),k(e,l),k(e,r),k(e,s),k(s,o),k(s,c),k(s,a),k(s,f),k(s,p),k(p,d);for(let Q=0;Q<Y.length;Q+=1)Y[Q]&&Y[Q].m(d,null);k(p,u),ne(_,p,null),k(p,S),ne(P,p,null),k(p,j),ne(F,p,null),k(p,V),ne(R,p,null),k(s,J),k(s,N),k(N,D),k(D,A);for(let Q=0;Q<ce.length;Q+=1)ce[Q]&&ce[Q].m(A,null);k(D,i),ne(h,D,null),k(N,g),k(N,w),k(w,E);for(let Q=0;Q<se.length;Q+=1)se[Q]&&se[Q].m(E,null);k(w,y),ne(M,w,null),k(w,v),ne(I,w,null),k(w,b),k(w,C);for(let Q=0;Q<$e.length;Q+=1)$e[Q]&&$e[Q].m(C,null);q=!0,G||(K=[ke(l,"mouseenter",n[6]),ke(l,"mouseleave",n[7])],G=!0)},p(Z,[ie]){if((!q||ie&8)&&oe(o,"active",Z[3]),(!q||ie&2)&&oe(a,"active",Z[1]),ie&52){he=be(Z[4]);let Q;for(Q=0;Q<he.length;Q+=1){const Ve=Ln(Z,he,Q);Y[Q]?(Y[Q].p(Ve,ie),H(Y[Q],1)):(Y[Q]=Bn(Ve),Y[Q].c(),H(Y[Q],1),Y[Q].m(d,null))}for(Ne(),Q=he.length;Q<Y.length;Q+=1)fe(Q);Se()}if(ie&48){pe=be(Z[4]);let Q;for(Q=0;Q<pe.length;Q+=1){const Ve=qn(Z,pe,Q);ce[Q]?(ce[Q].p(Ve,ie),H(ce[Q],1)):(ce[Q]=zn(Ve),ce[Q].c(),H(ce[Q],1),ce[Q].m(A,null))}for(Ne(),Q=pe.length;Q<ce.length;Q+=1)Ue(Q);Se()}if(ie&16){ee=be(Z[4]);let Q;for(Q=0;Q<ee.length;Q+=1){const Ve=An(Z,ee,Q);se[Q]?se[Q].p(Ve,ie):(se[Q]=Tn(Ve),se[Q].c(),se[Q].m(E,null))}for(;Q<se.length;Q+=1)se[Q].d(1);se.length=ee.length}if(ie&48){X=be(Z[4]);let Q;for(Q=0;Q<X.length;Q+=1){const Ve=Mn(Z,X,Q);$e[Q]?($e[Q].p(Ve,ie),H($e[Q],1)):($e[Q]=Pn(Ve),$e[Q].c(),H($e[Q],1),$e[Q].m(C,null))}for(Ne(),Q=X.length;Q<$e.length;Q+=1)Me(Q);Se()}(!q||ie&1&&L!==(L=de(ue("mlp",Z[0]))+" svelte-13p50c2"))&&m(e,"class",L)},i(Z){if(!q){for(let ie=0;ie<he.length;ie+=1)H(Y[ie]);H(_.$$.fragment,Z),H(P.$$.fragment,Z),H(F.$$.fragment,Z),H(R.$$.fragment,Z);for(let ie=0;ie<pe.length;ie+=1)H(ce[ie]);H(h.$$.fragment,Z),H(M.$$.fragment,Z),H(I.$$.fragment,Z);for(let ie=0;ie<X.length;ie+=1)H($e[ie]);q=!0}},o(Z){Y=Y.filter(Boolean);for(let ie=0;ie<Y.length;ie+=1)O(Y[ie]);O(_.$$.fragment,Z),O(P.$$.fragment,Z),O(F.$$.fragment,Z),O(R.$$.fragment,Z),ce=ce.filter(Boolean);for(let ie=0;ie<ce.length;ie+=1)O(ce[ie]);O(h.$$.fragment,Z),O(M.$$.fragment,Z),O(I.$$.fragment,Z),$e=$e.filter(Boolean);for(let ie=0;ie<$e.length;ie+=1)O($e[ie]);q=!1},d(Z){Z&&$(e),Ae(Y,Z),re(_),re(P),re(F),re(R),Ae(ce,Z),re(h),Ae(se,Z),re(M),re(I),Ae($e,Z),G=!1,Fe(K)}}}const Vo="bg-purple-200",No="bg-indigo-200",So="bg-blue-200";function Mo(n,e,l){let t,r,s;ye(n,jt,_=>l(3,t=_)),ye(n,gt,_=>l(4,r=_)),ye(n,zt,_=>l(5,s=_));let{className:o=void 0}=e;tl("block-id","mlp");let c=!1;function a(){l(1,c=!0)}function f(){l(1,c=!1)}let p=null;const d=_=>{l(2,p=_)},u=()=>{l(2,p=null)};return n.$$set=_=>{"className"in _&&l(0,o=_.className)},[o,c,p,t,r,s,a,f,d,u]}class Ao extends Oe{constructor(e){super(),Re(this,e,Mo,Do,je,{className:0})}}var qo=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ol=Math.ceil,lt=Math.floor,Ye="[BigNumber Error] ",Hn=Ye+"Number primitive has more than 15 significant digits: ",it=1e14,we=14,il=9007199254740991,al=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],_t=1e7,Ge=1e9;function nr(n){var e,l,t,r=V.prototype={constructor:V,toString:null,valueOf:null},s=new V(1),o=20,c=4,a=-7,f=21,p=-1e7,d=1e7,u=!1,_=1,S=0,P={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},j="0123456789abcdefghijklmnopqrstuvwxyz",F=!0;function V(i,h){var g,w,E,y,M,v,I,b,C=this;if(!(C instanceof V))return new V(i,h);if(h==null){if(i&&i._isBigNumber===!0){C.s=i.s,!i.c||i.e>d?C.c=C.e=null:i.e<p?C.c=[C.e=0]:(C.e=i.e,C.c=i.c.slice());return}if((v=typeof i=="number")&&i*0==0){if(C.s=1/i<0?(i=-i,-1):1,i===~~i){for(y=0,M=i;M>=10;M/=10,y++);y>d?C.c=C.e=null:(C.e=y,C.c=[i]);return}b=String(i)}else{if(!qo.test(b=String(i)))return t(C,b,v);C.s=b.charCodeAt(0)==45?(b=b.slice(1),-1):1}(y=b.indexOf("."))>-1&&(b=b.replace(".","")),(M=b.search(/e/i))>0?(y<0&&(y=M),y+=+b.slice(M+1),b=b.substring(0,M)):y<0&&(y=b.length)}else{if(Te(h,2,j.length,"Base"),h==10&&F)return C=new V(i),D(C,o+C.e+1,c);if(b=String(i),v=typeof i=="number"){if(i*0!=0)return t(C,b,v,h);if(C.s=1/i<0?(b=b.slice(1),-1):1,V.DEBUG&&b.replace(/^0\.0*|\./,"").length>15)throw Error(Hn+i)}else C.s=b.charCodeAt(0)===45?(b=b.slice(1),-1):1;for(g=j.slice(0,h),y=M=0,I=b.length;M<I;M++)if(g.indexOf(w=b.charAt(M))<0){if(w=="."){if(M>y){y=I;continue}}else if(!E&&(b==b.toUpperCase()&&(b=b.toLowerCase())||b==b.toLowerCase()&&(b=b.toUpperCase()))){E=!0,M=-1,y=0;continue}return t(C,String(i),v,h)}v=!1,b=l(b,h,10,C.s),(y=b.indexOf("."))>-1?b=b.replace(".",""):y=b.length}for(M=0;b.charCodeAt(M)===48;M++);for(I=b.length;b.charCodeAt(--I)===48;);if(b=b.slice(M,++I)){if(I-=M,v&&V.DEBUG&&I>15&&(i>il||i!==lt(i)))throw Error(Hn+C.s*i);if((y=y-M-1)>d)C.c=C.e=null;else if(y<p)C.c=[C.e=0];else{if(C.e=y,C.c=[],M=(y+1)%we,y<0&&(M+=we),M<I){for(M&&C.c.push(+b.slice(0,M)),I-=we;M<I;)C.c.push(+b.slice(M,M+=we));M=we-(b=b.slice(M)).length}else M-=I;for(;M--;b+="0");C.c.push(+b)}}else C.c=[C.e=0]}V.clone=nr,V.ROUND_UP=0,V.ROUND_DOWN=1,V.ROUND_CEIL=2,V.ROUND_FLOOR=3,V.ROUND_HALF_UP=4,V.ROUND_HALF_DOWN=5,V.ROUND_HALF_EVEN=6,V.ROUND_HALF_CEIL=7,V.ROUND_HALF_FLOOR=8,V.EUCLID=9,V.config=V.set=function(i){var h,g;if(i!=null)if(typeof i=="object"){if(i.hasOwnProperty(h="DECIMAL_PLACES")&&(g=i[h],Te(g,0,Ge,h),o=g),i.hasOwnProperty(h="ROUNDING_MODE")&&(g=i[h],Te(g,0,8,h),c=g),i.hasOwnProperty(h="EXPONENTIAL_AT")&&(g=i[h],g&&g.pop?(Te(g[0],-Ge,0,h),Te(g[1],0,Ge,h),a=g[0],f=g[1]):(Te(g,-Ge,Ge,h),a=-(f=g<0?-g:g))),i.hasOwnProperty(h="RANGE"))if(g=i[h],g&&g.pop)Te(g[0],-Ge,-1,h),Te(g[1],1,Ge,h),p=g[0],d=g[1];else if(Te(g,-Ge,Ge,h),g)p=-(d=g<0?-g:g);else throw Error(Ye+h+" cannot be zero: "+g);if(i.hasOwnProperty(h="CRYPTO"))if(g=i[h],g===!!g)if(g)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))u=g;else throw u=!g,Error(Ye+"crypto unavailable");else u=g;else throw Error(Ye+h+" not true or false: "+g);if(i.hasOwnProperty(h="MODULO_MODE")&&(g=i[h],Te(g,0,9,h),_=g),i.hasOwnProperty(h="POW_PRECISION")&&(g=i[h],Te(g,0,Ge,h),S=g),i.hasOwnProperty(h="FORMAT"))if(g=i[h],typeof g=="object")P=g;else throw Error(Ye+h+" not an object: "+g);if(i.hasOwnProperty(h="ALPHABET"))if(g=i[h],typeof g=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(g))F=g.slice(0,10)=="0123456789",j=g;else throw Error(Ye+h+" invalid: "+g)}else throw Error(Ye+"Object expected: "+i);return{DECIMAL_PLACES:o,ROUNDING_MODE:c,EXPONENTIAL_AT:[a,f],RANGE:[p,d],CRYPTO:u,MODULO_MODE:_,POW_PRECISION:S,FORMAT:P,ALPHABET:j}},V.isBigNumber=function(i){if(!i||i._isBigNumber!==!0)return!1;if(!V.DEBUG)return!0;var h,g,w=i.c,E=i.e,y=i.s;e:if({}.toString.call(w)=="[object Array]"){if((y===1||y===-1)&&E>=-Ge&&E<=Ge&&E===lt(E)){if(w[0]===0){if(E===0&&w.length===1)return!0;break e}if(h=(E+1)%we,h<1&&(h+=we),String(w[0]).length==h){for(h=0;h<w.length;h++)if(g=w[h],g<0||g>=it||g!==lt(g))break e;if(g!==0)return!0}}}else if(w===null&&E===null&&(y===null||y===1||y===-1))return!0;throw Error(Ye+"Invalid BigNumber: "+i)},V.maximum=V.max=function(){return J(arguments,-1)},V.minimum=V.min=function(){return J(arguments,1)},V.random=function(){var i=9007199254740992,h=Math.random()*i&2097151?function(){return lt(Math.random()*i)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(g){var w,E,y,M,v,I=0,b=[],C=new V(s);if(g==null?g=o:Te(g,0,Ge),M=ol(g/we),u)if(crypto.getRandomValues){for(w=crypto.getRandomValues(new Uint32Array(M*=2));I<M;)v=w[I]*131072+(w[I+1]>>>11),v>=9e15?(E=crypto.getRandomValues(new Uint32Array(2)),w[I]=E[0],w[I+1]=E[1]):(b.push(v%1e14),I+=2);I=M/2}else if(crypto.randomBytes){for(w=crypto.randomBytes(M*=7);I<M;)v=(w[I]&31)*281474976710656+w[I+1]*1099511627776+w[I+2]*4294967296+w[I+3]*16777216+(w[I+4]<<16)+(w[I+5]<<8)+w[I+6],v>=9e15?crypto.randomBytes(7).copy(w,I):(b.push(v%1e14),I+=7);I=M/7}else throw u=!1,Error(Ye+"crypto unavailable");if(!u)for(;I<M;)v=h(),v<9e15&&(b[I++]=v%1e14);for(M=b[--I],g%=we,M&&g&&(v=al[we-g],b[I]=lt(M/v)*v);b[I]===0;b.pop(),I--);if(I<0)b=[y=0];else{for(y=-1;b[0]===0;b.splice(0,1),y-=we);for(I=1,v=b[0];v>=10;v/=10,I++);I<we&&(y-=we-I)}return C.e=y,C.c=b,C}}(),V.sum=function(){for(var i=1,h=arguments,g=new V(h[0]);i<h.length;)g=g.plus(h[i++]);return g},l=function(){var i="0123456789";function h(g,w,E,y){for(var M,v=[0],I,b=0,C=g.length;b<C;){for(I=v.length;I--;v[I]*=w);for(v[0]+=y.indexOf(g.charAt(b++)),M=0;M<v.length;M++)v[M]>E-1&&(v[M+1]==null&&(v[M+1]=0),v[M+1]+=v[M]/E|0,v[M]%=E)}return v.reverse()}return function(g,w,E,y,M){var v,I,b,C,L,q,G,K,he=g.indexOf("."),Y=o,fe=c;for(he>=0&&(C=S,S=0,g=g.replace(".",""),K=new V(w),q=K.pow(g.length-he),S=C,K.c=h(dt(tt(q.c),q.e,"0"),10,E,i),K.e=K.c.length),G=h(g,w,E,M?(v=j,i):(v=i,j)),b=C=G.length;G[--C]==0;G.pop());if(!G[0])return v.charAt(0);if(he<0?--b:(q.c=G,q.e=b,q.s=y,q=e(q,K,Y,fe,E),G=q.c,L=q.r,b=q.e),I=b+Y+1,he=G[I],C=E/2,L=L||I<0||G[I+1]!=null,L=fe<4?(he!=null||L)&&(fe==0||fe==(q.s<0?3:2)):he>C||he==C&&(fe==4||L||fe==6&&G[I-1]&1||fe==(q.s<0?8:7)),I<1||!G[0])g=L?dt(v.charAt(1),-Y,v.charAt(0)):v.charAt(0);else{if(G.length=I,L)for(--E;++G[--I]>E;)G[I]=0,I||(++b,G=[1].concat(G));for(C=G.length;!G[--C];);for(he=0,g="";he<=C;g+=v.charAt(G[he++]));g=dt(g,b,v.charAt(0))}return g}}(),e=function(){function i(w,E,y){var M,v,I,b,C=0,L=w.length,q=E%_t,G=E/_t|0;for(w=w.slice();L--;)I=w[L]%_t,b=w[L]/_t|0,M=G*I+b*q,v=q*I+M%_t*_t+C,C=(v/y|0)+(M/_t|0)+G*b,w[L]=v%y;return C&&(w=[C].concat(w)),w}function h(w,E,y,M){var v,I;if(y!=M)I=y>M?1:-1;else for(v=I=0;v<y;v++)if(w[v]!=E[v]){I=w[v]>E[v]?1:-1;break}return I}function g(w,E,y,M){for(var v=0;y--;)w[y]-=v,v=w[y]<E[y]?1:0,w[y]=v*M+w[y]-E[y];for(;!w[0]&&w.length>1;w.splice(0,1));}return function(w,E,y,M,v){var I,b,C,L,q,G,K,he,Y,fe,pe,ce,Ue,ee,se,X,$e,Me=w.s==E.s?1:-1,Z=w.c,ie=E.c;if(!Z||!Z[0]||!ie||!ie[0])return new V(!w.s||!E.s||(Z?ie&&Z[0]==ie[0]:!ie)?NaN:Z&&Z[0]==0||!ie?Me*0:Me/0);for(he=new V(Me),Y=he.c=[],b=w.e-E.e,Me=y+b+1,v||(v=it,b=nt(w.e/we)-nt(E.e/we),Me=Me/we|0),C=0;ie[C]==(Z[C]||0);C++);if(ie[C]>(Z[C]||0)&&b--,Me<0)Y.push(1),L=!0;else{for(ee=Z.length,X=ie.length,C=0,Me+=2,q=lt(v/(ie[0]+1)),q>1&&(ie=i(ie,q,v),Z=i(Z,q,v),X=ie.length,ee=Z.length),Ue=X,fe=Z.slice(0,X),pe=fe.length;pe<X;fe[pe++]=0);$e=ie.slice(),$e=[0].concat($e),se=ie[0],ie[1]>=v/2&&se++;do{if(q=0,I=h(ie,fe,X,pe),I<0){if(ce=fe[0],X!=pe&&(ce=ce*v+(fe[1]||0)),q=lt(ce/se),q>1)for(q>=v&&(q=v-1),G=i(ie,q,v),K=G.length,pe=fe.length;h(G,fe,K,pe)==1;)q--,g(G,X<K?$e:ie,K,v),K=G.length,I=1;else q==0&&(I=q=1),G=ie.slice(),K=G.length;if(K<pe&&(G=[0].concat(G)),g(fe,G,pe,v),pe=fe.length,I==-1)for(;h(ie,fe,X,pe)<1;)q++,g(fe,X<pe?$e:ie,pe,v),pe=fe.length}else I===0&&(q++,fe=[0]);Y[C++]=q,fe[0]?fe[pe++]=Z[Ue]||0:(fe=[Z[Ue]],pe=1)}while((Ue++<ee||fe[0]!=null)&&Me--);L=fe[0]!=null,Y[0]||Y.splice(0,1)}if(v==it){for(C=1,Me=Y[0];Me>=10;Me/=10,C++);D(he,y+(he.e=C+b*we-1)+1,M,L)}else he.e=b,he.r=+L;return he}}();function R(i,h,g,w){var E,y,M,v,I;if(g==null?g=c:Te(g,0,8),!i.c)return i.toString();if(E=i.c[0],M=i.e,h==null)I=tt(i.c),I=w==1||w==2&&(M<=a||M>=f)?Qt(I,M):dt(I,M,"0");else if(i=D(new V(i),h,g),y=i.e,I=tt(i.c),v=I.length,w==1||w==2&&(h<=y||y<=a)){for(;v<h;I+="0",v++);I=Qt(I,y)}else if(h-=M,I=dt(I,y,"0"),y+1>v){if(--h>0)for(I+=".";h--;I+="0");}else if(h+=y-v,h>0)for(y+1==v&&(I+=".");h--;I+="0");return i.s<0&&E?"-"+I:I}function J(i,h){for(var g,w,E=1,y=new V(i[0]);E<i.length;E++)w=new V(i[E]),(!w.s||(g=Vt(y,w))===h||g===0&&y.s===h)&&(y=w);return y}function N(i,h,g){for(var w=1,E=h.length;!h[--E];h.pop());for(E=h[0];E>=10;E/=10,w++);return(g=w+g*we-1)>d?i.c=i.e=null:g<p?i.c=[i.e=0]:(i.e=g,i.c=h),i}t=function(){var i=/^(-?)0([xbo])(?=\w[\w.]*$)/i,h=/^([^.]+)\.$/,g=/^\.([^.]+)$/,w=/^-?(Infinity|NaN)$/,E=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,M,v,I){var b,C=v?M:M.replace(E,"");if(w.test(C))y.s=isNaN(C)?null:C<0?-1:1;else{if(!v&&(C=C.replace(i,function(L,q,G){return b=(G=G.toLowerCase())=="x"?16:G=="b"?2:8,!I||I==b?q:L}),I&&(b=I,C=C.replace(h,"$1").replace(g,"0.$1")),M!=C))return new V(C,b);if(V.DEBUG)throw Error(Ye+"Not a"+(I?" base "+I:"")+" number: "+M);y.s=null}y.c=y.e=null}}();function D(i,h,g,w){var E,y,M,v,I,b,C,L=i.c,q=al;if(L){e:{for(E=1,v=L[0];v>=10;v/=10,E++);if(y=h-E,y<0)y+=we,M=h,I=L[b=0],C=lt(I/q[E-M-1]%10);else if(b=ol((y+1)/we),b>=L.length)if(w){for(;L.length<=b;L.push(0));I=C=0,E=1,y%=we,M=y-we+1}else break e;else{for(I=v=L[b],E=1;v>=10;v/=10,E++);y%=we,M=y-we+E,C=M<0?0:lt(I/q[E-M-1]%10)}if(w=w||h<0||L[b+1]!=null||(M<0?I:I%q[E-M-1]),w=g<4?(C||w)&&(g==0||g==(i.s<0?3:2)):C>5||C==5&&(g==4||w||g==6&&(y>0?M>0?I/q[E-M]:0:L[b-1])%10&1||g==(i.s<0?8:7)),h<1||!L[0])return L.length=0,w?(h-=i.e+1,L[0]=q[(we-h%we)%we],i.e=-h||0):L[0]=i.e=0,i;if(y==0?(L.length=b,v=1,b--):(L.length=b+1,v=q[we-y],L[b]=M>0?lt(I/q[E-M]%q[M])*v:0),w)for(;;)if(b==0){for(y=1,M=L[0];M>=10;M/=10,y++);for(M=L[0]+=v,v=1;M>=10;M/=10,v++);y!=v&&(i.e++,L[0]==it&&(L[0]=1));break}else{if(L[b]+=v,L[b]!=it)break;L[b--]=0,v=1}for(y=L.length;L[--y]===0;L.pop());}i.e>d?i.c=i.e=null:i.e<p&&(i.c=[i.e=0])}return i}function A(i){var h,g=i.e;return g===null?i.toString():(h=tt(i.c),h=g<=a||g>=f?Qt(h,g):dt(h,g,"0"),i.s<0?"-"+h:h)}return r.absoluteValue=r.abs=function(){var i=new V(this);return i.s<0&&(i.s=1),i},r.comparedTo=function(i,h){return Vt(this,new V(i,h))},r.decimalPlaces=r.dp=function(i,h){var g,w,E,y=this;if(i!=null)return Te(i,0,Ge),h==null?h=c:Te(h,0,8),D(new V(y),i+y.e+1,h);if(!(g=y.c))return null;if(w=((E=g.length-1)-nt(this.e/we))*we,E=g[E])for(;E%10==0;E/=10,w--);return w<0&&(w=0),w},r.dividedBy=r.div=function(i,h){return e(this,new V(i,h),o,c)},r.dividedToIntegerBy=r.idiv=function(i,h){return e(this,new V(i,h),0,1)},r.exponentiatedBy=r.pow=function(i,h){var g,w,E,y,M,v,I,b,C,L=this;if(i=new V(i),i.c&&!i.isInteger())throw Error(Ye+"Exponent not an integer: "+A(i));if(h!=null&&(h=new V(h)),v=i.e>14,!L.c||!L.c[0]||L.c[0]==1&&!L.e&&L.c.length==1||!i.c||!i.c[0])return C=new V(Math.pow(+A(L),v?i.s*(2-Yt(i)):+A(i))),h?C.mod(h):C;if(I=i.s<0,h){if(h.c?!h.c[0]:!h.s)return new V(NaN);w=!I&&L.isInteger()&&h.isInteger(),w&&(L=L.mod(h))}else{if(i.e>9&&(L.e>0||L.e<-1||(L.e==0?L.c[0]>1||v&&L.c[1]>=24e7:L.c[0]<8e13||v&&L.c[0]<=9999975e7)))return y=L.s<0&&Yt(i)?-0:0,L.e>-1&&(y=1/y),new V(I?1/y:y);S&&(y=ol(S/we+2))}for(v?(g=new V(.5),I&&(i.s=1),b=Yt(i)):(E=Math.abs(+A(i)),b=E%2),C=new V(s);;){if(b){if(C=C.times(L),!C.c)break;y?C.c.length>y&&(C.c.length=y):w&&(C=C.mod(h))}if(E){if(E=lt(E/2),E===0)break;b=E%2}else if(i=i.times(g),D(i,i.e+1,1),i.e>14)b=Yt(i);else{if(E=+A(i),E===0)break;b=E%2}L=L.times(L),y?L.c&&L.c.length>y&&(L.c.length=y):w&&(L=L.mod(h))}return w?C:(I&&(C=s.div(C)),h?C.mod(h):y?D(C,S,c,M):C)},r.integerValue=function(i){var h=new V(this);return i==null?i=c:Te(i,0,8),D(h,h.e+1,i)},r.isEqualTo=r.eq=function(i,h){return Vt(this,new V(i,h))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(i,h){return Vt(this,new V(i,h))>0},r.isGreaterThanOrEqualTo=r.gte=function(i,h){return(h=Vt(this,new V(i,h)))===1||h===0},r.isInteger=function(){return!!this.c&&nt(this.e/we)>this.c.length-2},r.isLessThan=r.lt=function(i,h){return Vt(this,new V(i,h))<0},r.isLessThanOrEqualTo=r.lte=function(i,h){return(h=Vt(this,new V(i,h)))===-1||h===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(i,h){var g,w,E,y,M=this,v=M.s;if(i=new V(i,h),h=i.s,!v||!h)return new V(NaN);if(v!=h)return i.s=-h,M.plus(i);var I=M.e/we,b=i.e/we,C=M.c,L=i.c;if(!I||!b){if(!C||!L)return C?(i.s=-h,i):new V(L?M:NaN);if(!C[0]||!L[0])return L[0]?(i.s=-h,i):new V(C[0]?M:c==3?-0:0)}if(I=nt(I),b=nt(b),C=C.slice(),v=I-b){for((y=v<0)?(v=-v,E=C):(b=I,E=L),E.reverse(),h=v;h--;E.push(0));E.reverse()}else for(w=(y=(v=C.length)<(h=L.length))?v:h,v=h=0;h<w;h++)if(C[h]!=L[h]){y=C[h]<L[h];break}if(y&&(E=C,C=L,L=E,i.s=-i.s),h=(w=L.length)-(g=C.length),h>0)for(;h--;C[g++]=0);for(h=it-1;w>v;){if(C[--w]<L[w]){for(g=w;g&&!C[--g];C[g]=h);--C[g],C[w]+=it}C[w]-=L[w]}for(;C[0]==0;C.splice(0,1),--b);return C[0]?N(i,C,b):(i.s=c==3?-1:1,i.c=[i.e=0],i)},r.modulo=r.mod=function(i,h){var g,w,E=this;return i=new V(i,h),!E.c||!i.s||i.c&&!i.c[0]?new V(NaN):!i.c||E.c&&!E.c[0]?new V(E):(_==9?(w=i.s,i.s=1,g=e(E,i,0,3),i.s=w,g.s*=w):g=e(E,i,0,_),i=E.minus(g.times(i)),!i.c[0]&&_==1&&(i.s=E.s),i)},r.multipliedBy=r.times=function(i,h){var g,w,E,y,M,v,I,b,C,L,q,G,K,he,Y,fe=this,pe=fe.c,ce=(i=new V(i,h)).c;if(!pe||!ce||!pe[0]||!ce[0])return!fe.s||!i.s||pe&&!pe[0]&&!ce||ce&&!ce[0]&&!pe?i.c=i.e=i.s=null:(i.s*=fe.s,!pe||!ce?i.c=i.e=null:(i.c=[0],i.e=0)),i;for(w=nt(fe.e/we)+nt(i.e/we),i.s*=fe.s,I=pe.length,L=ce.length,I<L&&(K=pe,pe=ce,ce=K,E=I,I=L,L=E),E=I+L,K=[];E--;K.push(0));for(he=it,Y=_t,E=L;--E>=0;){for(g=0,q=ce[E]%Y,G=ce[E]/Y|0,M=I,y=E+M;y>E;)b=pe[--M]%Y,C=pe[M]/Y|0,v=G*b+C*q,b=q*b+v%Y*Y+K[y]+g,g=(b/he|0)+(v/Y|0)+G*C,K[y--]=b%he;K[y]=g}return g?++w:K.splice(0,1),N(i,K,w)},r.negated=function(){var i=new V(this);return i.s=-i.s||null,i},r.plus=function(i,h){var g,w=this,E=w.s;if(i=new V(i,h),h=i.s,!E||!h)return new V(NaN);if(E!=h)return i.s=-h,w.minus(i);var y=w.e/we,M=i.e/we,v=w.c,I=i.c;if(!y||!M){if(!v||!I)return new V(E/0);if(!v[0]||!I[0])return I[0]?i:new V(v[0]?w:E*0)}if(y=nt(y),M=nt(M),v=v.slice(),E=y-M){for(E>0?(M=y,g=I):(E=-E,g=v),g.reverse();E--;g.push(0));g.reverse()}for(E=v.length,h=I.length,E-h<0&&(g=I,I=v,v=g,h=E),E=0;h;)E=(v[--h]=v[h]+I[h]+E)/it|0,v[h]=it===v[h]?0:v[h]%it;return E&&(v=[E].concat(v),++M),N(i,v,M)},r.precision=r.sd=function(i,h){var g,w,E,y=this;if(i!=null&&i!==!!i)return Te(i,1,Ge),h==null?h=c:Te(h,0,8),D(new V(y),i,h);if(!(g=y.c))return null;if(E=g.length-1,w=E*we+1,E=g[E]){for(;E%10==0;E/=10,w--);for(E=g[0];E>=10;E/=10,w++);}return i&&y.e+1>w&&(w=y.e+1),w},r.shiftedBy=function(i){return Te(i,-il,il),this.times("1e"+i)},r.squareRoot=r.sqrt=function(){var i,h,g,w,E,y=this,M=y.c,v=y.s,I=y.e,b=o+4,C=new V("0.5");if(v!==1||!M||!M[0])return new V(!v||v<0&&(!M||M[0])?NaN:M?y:1/0);if(v=Math.sqrt(+A(y)),v==0||v==1/0?(h=tt(M),(h.length+I)%2==0&&(h+="0"),v=Math.sqrt(+h),I=nt((I+1)/2)-(I<0||I%2),v==1/0?h="5e"+I:(h=v.toExponential(),h=h.slice(0,h.indexOf("e")+1)+I),g=new V(h)):g=new V(v+""),g.c[0]){for(I=g.e,v=I+b,v<3&&(v=0);;)if(E=g,g=C.times(E.plus(e(y,E,b,1))),tt(E.c).slice(0,v)===(h=tt(g.c)).slice(0,v))if(g.e<I&&--v,h=h.slice(v-3,v+1),h=="9999"||!w&&h=="4999"){if(!w&&(D(E,E.e+o+2,0),E.times(E).eq(y))){g=E;break}b+=4,v+=4,w=1}else{(!+h||!+h.slice(1)&&h.charAt(0)=="5")&&(D(g,g.e+o+2,1),i=!g.times(g).eq(y));break}}return D(g,g.e+o+1,c,i)},r.toExponential=function(i,h){return i!=null&&(Te(i,0,Ge),i++),R(this,i,h,1)},r.toFixed=function(i,h){return i!=null&&(Te(i,0,Ge),i=i+this.e+1),R(this,i,h)},r.toFormat=function(i,h,g){var w,E=this;if(g==null)i!=null&&h&&typeof h=="object"?(g=h,h=null):i&&typeof i=="object"?(g=i,i=h=null):g=P;else if(typeof g!="object")throw Error(Ye+"Argument not an object: "+g);if(w=E.toFixed(i,h),E.c){var y,M=w.split("."),v=+g.groupSize,I=+g.secondaryGroupSize,b=g.groupSeparator||"",C=M[0],L=M[1],q=E.s<0,G=q?C.slice(1):C,K=G.length;if(I&&(y=v,v=I,I=y,K-=y),v>0&&K>0){for(y=K%v||v,C=G.substr(0,y);y<K;y+=v)C+=b+G.substr(y,v);I>0&&(C+=b+G.slice(y)),q&&(C="-"+C)}w=L?C+(g.decimalSeparator||"")+((I=+g.fractionGroupSize)?L.replace(new RegExp("\\d{"+I+"}\\B","g"),"$&"+(g.fractionGroupSeparator||"")):L):C}return(g.prefix||"")+w+(g.suffix||"")},r.toFraction=function(i){var h,g,w,E,y,M,v,I,b,C,L,q,G=this,K=G.c;if(i!=null&&(v=new V(i),!v.isInteger()&&(v.c||v.s!==1)||v.lt(s)))throw Error(Ye+"Argument "+(v.isInteger()?"out of range: ":"not an integer: ")+A(v));if(!K)return new V(G);for(h=new V(s),b=g=new V(s),w=I=new V(s),q=tt(K),y=h.e=q.length-G.e-1,h.c[0]=al[(M=y%we)<0?we+M:M],i=!i||v.comparedTo(h)>0?y>0?h:b:v,M=d,d=1/0,v=new V(q),I.c[0]=0;C=e(v,h,0,1),E=g.plus(C.times(w)),E.comparedTo(i)!=1;)g=w,w=E,b=I.plus(C.times(E=b)),I=E,h=v.minus(C.times(E=h)),v=E;return E=e(i.minus(g),w,0,1),I=I.plus(E.times(b)),g=g.plus(E.times(w)),I.s=b.s=G.s,y=y*2,L=e(b,w,y,c).minus(G).abs().comparedTo(e(I,g,y,c).minus(G).abs())<1?[b,w]:[I,g],d=M,L},r.toNumber=function(){return+A(this)},r.toPrecision=function(i,h){return i!=null&&Te(i,1,Ge),R(this,i,h,2)},r.toString=function(i){var h,g=this,w=g.s,E=g.e;return E===null?w?(h="Infinity",w<0&&(h="-"+h)):h="NaN":(i==null?h=E<=a||E>=f?Qt(tt(g.c),E):dt(tt(g.c),E,"0"):i===10&&F?(g=D(new V(g),o+E+1,c),h=dt(tt(g.c),g.e,"0")):(Te(i,2,j.length,"Base"),h=l(dt(tt(g.c),E,"0"),10,i,w,!0)),w<0&&g.c[0]&&(h="-"+h)),h},r.valueOf=r.toJSON=function(){return A(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,n!=null&&V.set(n),V}function nt(n){var e=n|0;return n>0||n===e?e:e-1}function tt(n){for(var e,l,t=1,r=n.length,s=n[0]+"";t<r;){for(e=n[t++]+"",l=we-e.length;l--;e="0"+e);s+=e}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function Vt(n,e){var l,t,r=n.c,s=e.c,o=n.s,c=e.s,a=n.e,f=e.e;if(!o||!c)return null;if(l=r&&!r[0],t=s&&!s[0],l||t)return l?t?0:-c:o;if(o!=c)return o;if(l=o<0,t=a==f,!r||!s)return t?0:!r^l?1:-1;if(!t)return a>f^l?1:-1;for(c=(a=r.length)<(f=s.length)?a:f,o=0;o<c;o++)if(r[o]!=s[o])return r[o]>s[o]^l?1:-1;return a==f?0:a>f^l?1:-1}function Te(n,e,l,t){if(n<e||n>l||n!==lt(n))throw Error(Ye+(t||"Argument")+(typeof n=="number"?n<e||n>l?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Yt(n){var e=n.c.length-1;return nt(n.e/we)==e&&n.c[e]%2!=0}function Qt(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function dt(n,e,l){var t,r;if(e<0){for(r=l+".";++e;r+=l);n=r+n}else if(t=n.length,++e>t){for(r=l,e-=t;--e;r+=l);n+=r}else e<t&&(n=n.slice(0,e)+"."+n.slice(e));return n}nr();const{theme:Lo}=wt(kt);Lo.colors.gray[100];const Bo=async()=>{};cr.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";const rr=20,zo=async(n,e)=>{El.set(!0);const{token_ids:l,input_tokens:t}=await Ho(n);gt.set(t);const{outputs:r,prediction:s}=await Oo(l),o=Yn(s,e),c=Qn(o,rr);Tt.set({outputs:r,prediction:o,sampled:c}),setTimeout(async()=>{Rt.set(c),El.set(!1)},0)},To=async(n,e)=>{const l=Yn(n,e),t=Qn(l,rr);Tt.update(r=>({...r,prediction:l})),await Bo(),Rt.set(t)},Po=n=>{const e=Math.max(...n),l=n.map(r=>Math.exp(r-e)),t=l.reduce((r,s)=>r+s,0);return l.map(r=>r/t)},Ho=async n=>{const e=await Kn.from_pretrained("Xenova/gpt2"),l=e.encode(n),t=l.map(r=>e.decode([r])).flat();return{token_ids:l,input_tokens:t}},jo=(n,e,l,t)=>{const r=Array.from(n).map((s,o)=>({tokenId:o,logit:s,probability:e[o]}));return r.sort((s,o)=>o.probability-s.probability),r.slice(0,t).map((s,o)=>({...s,rank:o,token:l.decode([s.tokenId])}))},Oo=async n=>{try{const e=new fr("int64",n,[1,n.length]),l=or(Xn);if(!l)throw new Error("Model session is not initialized.");const t={input:e},r=await l.run(t),s=r.linear_output.data,o=Po(s),c=await Kn.from_pretrained("Xenova/gpt2"),f=jo(s,o,c,100);return{outputs:Ro.reduce((d,u)=>{const _=r[u],S={..._,data:Kr([..._.cpuData],_.dims)};return d[u]=S,d},{}),prediction:f}}catch(e){throw console.error("Error during inference:",e.message),e}},Ro=["block_0_attn_head_0_attn","block_0_attn_head_0_attn_scaled","block_0_attn_head_0_attn_masked","block_0_attn_head_0_attn_softmax","block_0_attn_head_0_attn_dropout","linear_output"];async function Go(n){const e=await fetch(n);if(!e.ok)throw new Error(`Failed to fetch ${n}`);return e.arrayBuffer()}async function Fo(n){const e=await Promise.all(n.map(s=>Go(s))),l=e.reduce((s,o)=>s+o.byteLength,0),t=new Uint8Array(l);let r=0;for(const s of e)t.set(new Uint8Array(s),r),r+=s.byteLength;return t.buffer}function jn(n){let e,l,t,r,s,o,c;return l=new $r({}),{c(){e=B("div"),te(l.$$.fragment),this.h()},l(a){e=z(a,"DIV",{class:!0,style:!0,role:!0});var f=T(e);le(l.$$.fragment,f),f.forEach($),this.h()},h(){m(e,"class","qkv-weight-popover weight-popover svelte-1cfr5kc"),m(e,"style",t=`left:${n[0].left}px;top:${n[0].top}px;`),m(e,"role","group")},m(a,f){W(a,e,f),ne(l,e,null),s=!0,o||(c=[ke(e,"mouseenter",n[3]),ke(e,"mouseleave",n[4])],o=!0)},p(a,f){(!s||f&1&&t!==(t=`left:${a[0].left}px;top:${a[0].top}px;`))&&m(e,"style",t)},i(a){s||(H(l.$$.fragment,a),a&&(r||Lt(()=>{r=ir(e,at,{duration:300}),r.start()})),s=!0)},o(a){O(l.$$.fragment,a),s=!1},d(a){a&&$(e),re(l),o=!1,Fe(c)}}}function Uo(n){let e,l,t=(n[2]==="embedding"||n[1])&&jn(n);return{c(){t&&t.c(),e=ut()},l(r){t&&t.l(r),e=ut()},m(r,s){t&&t.m(r,s),W(r,e,s),l=!0},p(r,[s]){r[2]==="embedding"||r[1]?t?(t.p(r,s),s&6&&H(t,1)):(t=jn(r),t.c(),H(t,1),t.m(e.parentNode,e)):t&&(Ne(),O(t,1,1,()=>{t=null}),Se())},i(r){l||(H(t),l=!0)},o(r){O(t),l=!1},d(r){r&&$(e),t&&t.d(r)}}}function xo(n,e,l){let t;ye(n,fl,f=>l(2,t=f));let r,s={left:0,top:0},o=!1;return vt(()=>{const f=()=>{var F;const d=window.scrollX,u=(F=document.querySelector(".top-bar"))==null?void 0:F.offsetHeight,_=document.querySelector(".step.embedding .content"),S=document.querySelector(".step.mlp .content"),P=_.getBoundingClientRect(),j=S.getBoundingClientRect();l(0,s={left:P.right+d,top:P.top-u}),j.left+d,j.top-u};return f(),r=new ResizeObserver(d=>{f()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(d=>r.observe(d)),()=>{r.disconnect()}}),[s,o,t,()=>{l(1,o=!0)},()=>{l(1,o=!1)}]}class Wo extends Oe{constructor(e){super(),Re(this,e,xo,Uo,je,{})}}function On(n){let e,l,t,r,s,o,c,a,f,p,d;return{c(){e=B("div"),t=U(),r=B("div"),c=U(),a=B("div"),this.h()},l(u){e=z(u,"DIV",{class:!0}),T(e).forEach($),t=x(u),r=z(u,"DIV",{class:!0}),T(r).forEach($),c=x(u),a=z(u,"DIV",{class:!0}),T(a).forEach($),this.h()},h(){m(e,"class","dim svelte-p1rtu3"),m(r,"class",s=de(ue("dim-partial left",`${n[2].id||""}`))+" svelte-p1rtu3"),m(a,"class",f=de(ue("dim-partial right",`${n[2].id||""}`))+" svelte-p1rtu3")},m(u,_){W(u,e,_),W(u,t,_),W(u,r,_),W(u,c,_),W(u,a,_),d=!0},p(u,_){(!d||_&4&&s!==(s=de(ue("dim-partial left",`${u[2].id||""}`))+" svelte-p1rtu3"))&&m(r,"class",s),(!d||_&4&&f!==(f=de(ue("dim-partial right",`${u[2].id||""}`))+" svelte-p1rtu3"))&&m(a,"class",f)},i(u){d||(u&&Lt(()=>{d&&(l||(l=Mt(e,at,{duration:100},!0)),l.run(1))}),u&&Lt(()=>{d&&(o||(o=Mt(r,at,{duration:100},!0)),o.run(1))}),u&&Lt(()=>{d&&(p||(p=Mt(a,at,{duration:100},!0)),p.run(1))}),d=!0)},o(u){u&&(l||(l=Mt(e,at,{duration:100},!1)),l.run(0)),u&&(o||(o=Mt(r,at,{duration:100},!1)),o.run(0)),u&&(p||(p=Mt(a,at,{duration:100},!1)),p.run(0)),d=!1},d(u){u&&($(e),$(t),$(r),$(c),$(a)),u&&l&&l.end(),u&&o&&o.end(),u&&p&&p.end()}}}function Xo(n){let e,l,t,r,s,o,c,a,f,p,d,u,_,S,P,j,F,V,R,J,N,D=!!n[2].id&&On(n);return r=new Gr({}),a=new Eo({props:{className:"step"}}),p=new bs({props:{className:"step"}}),u=new Ao({props:{className:"step"}}),S=new Ms({props:{className:"step"}}),j=new Fs({props:{className:"step"}}),R=new Wo({}),{c(){e=B("div"),D&&D.c(),l=U(),t=B("div"),te(r.$$.fragment),s=U(),o=B("div"),c=B("div"),te(a.$$.fragment),f=U(),te(p.$$.fragment),d=U(),te(u.$$.fragment),_=U(),te(S.$$.fragment),P=U(),te(j.$$.fragment),V=U(),te(R.$$.fragment),this.h()},l(A){e=z(A,"DIV",{class:!0,style:!0});var i=T(e);D&&D.l(i),l=x(i),t=z(i,"DIV",{class:!0});var h=T(t);le(r.$$.fragment,h),h.forEach($),s=x(i),o=z(i,"DIV",{class:!0});var g=T(o);c=z(g,"DIV",{class:!0});var w=T(c);le(a.$$.fragment,w),f=x(w),le(p.$$.fragment,w),d=x(w),le(u.$$.fragment,w),_=x(w),le(S.$$.fragment,w),P=x(w),le(j.$$.fragment,w),w.forEach($),V=x(g),le(R.$$.fragment,g),g.forEach($),i.forEach($),this.h()},h(){m(t,"class","sankey opacity-1 svelte-p1rtu3"),oe(t,"attention",n[2].id==="attention"),m(c,"class","steps svelte-p1rtu3"),Lt(()=>n[7].call(c)),oe(c,"expanded",!!n[2].id),m(o,"class","nodes resize-watch svelte-p1rtu3"),m(e,"class","main-section h-full w-full"),m(e,"style",J=`--vector-height: ${n[1]}px;--title-height: ${n[3]}px;--content-height:${n[0]-n[3]}px;`)},m(A,i){W(A,e,i),D&&D.m(e,null),k(e,l),k(e,t),ne(r,t,null),k(e,s),k(e,o),k(o,c),ne(a,c,null),k(c,f),ne(p,c,null),k(c,d),ne(u,c,null),k(c,_),ne(S,c,null),k(c,P),ne(j,c,null),F=xn(c,n[7].bind(c)),k(o,V),ne(R,o,null),N=!0},p(A,[i]){A[2].id?D?(D.p(A,i),i&4&&H(D,1)):(D=On(A),D.c(),H(D,1),D.m(e,l)):D&&(Ne(),O(D,1,1,()=>{D=null}),Se()),(!N||i&4)&&oe(t,"attention",A[2].id==="attention"),(!N||i&4)&&oe(c,"expanded",!!A[2].id),(!N||i&3&&J!==(J=`--vector-height: ${A[1]}px;--title-height: ${A[3]}px;--content-height:${A[0]-A[3]}px;`))&&m(e,"style",J)},i(A){N||(H(D),H(r.$$.fragment,A),H(a.$$.fragment,A),H(p.$$.fragment,A),H(u.$$.fragment,A),H(S.$$.fragment,A),H(j.$$.fragment,A),H(R.$$.fragment,A),N=!0)},o(A){O(D),O(r.$$.fragment,A),O(a.$$.fragment,A),O(p.$$.fragment,A),O(u.$$.fragment,A),O(S.$$.fragment,A),O(j.$$.fragment,A),O(R.$$.fragment,A),N=!1},d(A){A&&$(e),D&&D.d(),re(r),re(a),re(p),re(u),re(S),re(j),F(),re(R)}}}function Ko(n,e,l){let t,r,s,o,c,a;ye(n,gt,_=>l(4,t=_)),ye(n,Tt,_=>l(5,r=_)),ye(n,ul,_=>l(8,s=_)),ye(n,Rt,_=>l(6,o=_)),ye(n,Jt,_=>l(1,c=_)),ye(n,xe,_=>l(2,a=_)),vt(async()=>{const S=Array(63).fill(0).map((D,A)=>`${Dr}/gpt2.onnx.part${A}`),P=await Fo(S),j=new Blob([P],{type:"application/octet-stream"}),F=URL.createObjectURL(j),V=await ur.create(F,{});Xn.set(V),hr.set(!1);const R=dr.subscribe(D=>{zo(D.trim(),s)});let J=!0;const N=ul.subscribe(D=>{if(J){J=!1;return}To(r==null?void 0:r.prediction,D)});return()=>{R(),N()}});let f=0,p=Bt*5;const d=()=>{const _=Bt*.5*(t.length-1),S=Math.min(Math.max((f-p-_)/t.length/pr,vr),gr);Jt.set(S),Wn.set(t.length*S*3+_)};function u(){f=this.offsetHeight,l(0,f)}return n.$$.update=()=>{n.$$.dirty&32&&console.log("data",r),n.$$.dirty&64&&console.log("p tkn",o),n.$$.dirty&17&&(f||t.length)&&d()},[f,c,a,p,t,r,o,u]}class oi extends Oe{constructor(e){super(),Re(this,e,Ko,Xo,je,{})}}export{oi as component,si as universal};
