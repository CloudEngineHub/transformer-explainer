import{s as Ge,G as rl,D as ul,H as hl,I as Fn,J as Dn,M as qn,N as Vn,O as An,a4 as Se,a5 as De,d as T,g as y,p as m,j as Z,n as Oe,m as Ce,z as Nt,C as Dt,A as ht,e as B,c as P,q as Me,w as pt,b as U,h as W,k,t as ie,o as qe,f as ae,ad as de,P as al,af as Nn,v as Ee,l as Ae,r as Ze,a9 as Zt,u as le,E as Yt,a7 as Un,ag as xn}from"../chunks/scheduler.QcZkUrsu.js";import{S as Re,i as Fe,c as ne,a as re,m as oe,t as F,b as Q,d as se,g as Be,e as Pe,h as Wn,j as Xn}from"../chunks/index.C7PoebJh.js";import{r as kt,a as Et,t as mt,m as Mt,n as ol,e as be,o as yt,b as ce,q as at,s as Lt,v as Xt,u as jt,w as Mn,p as Kt,d as At,j as Ft,x as Zn,f as sl,Z as Yn,g as dl,M as Kn,y as Ln,P as Qn,i as Jn,z as er,A as tr,B as lr}from"../chunks/index.CKQwWyIO.js";import{b as Qt,e as nr,d as rr}from"../chunks/transform.CY-uxLxB.js";import{s as Ut,a as lt,M as Vt,F as wt,f as zt,Q as or}from"../chunks/QKVWeightPopover.DyzXeSTt.js";import{a as sr,i as Bn,b as ir,c as ar,l as il}from"../chunks/linear.Cyih6OGm.js";import{g as cr,a as fr,t as ur,b as qt}from"../chunks/index.DCUscMZV.js";import{P as hr,a as Jt,H as pl,A as Pn}from"../chunks/image.Df3zN4J-.js";import{b as dr}from"../chunks/paths.BJEVnAti.js";function pr(n){let e;const l=n[4].default,t=Dn(l,n,n[6],null);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,o){t&&t.m(r,o),e=!0},p(r,o){t&&t.p&&(!e||o&64)&&qn(t,l,r,r[6],e?An(l,r[6],o,null):Vn(r[6]),null)},i(r){e||(F(t,r),e=!0)},o(r){Q(t,r),e=!1},d(r){t&&t.d(r)}}}function gr(n){let e,l;const t=[{rounded:!0},{shadow:!0},n[1],{class:n[0]}];let r={$$slots:{default:[pr]},$$scope:{ctx:n}};for(let o=0;o<t.length;o+=1)r=rl(r,t[o]);return e=new hr({props:r}),e.$on("show",n[5]),{c(){ne(e.$$.fragment)},l(o){re(e.$$.fragment,o)},m(o,s){oe(e,o,s),l=!0},p(o,[s]){const f=s&3?cr(t,[t[0],t[1],s&2&&fr(o[1]),s&1&&{class:o[0]}]):{};s&64&&(f.$$scope={dirty:s,ctx:o}),e.$set(f)},i(o){l||(F(e.$$.fragment,o),l=!0)},o(o){Q(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function vr(n,e,l){const t=["type","defaultClass"];let r=ul(e,t),{$$slots:o={},$$scope:s}=e,{type:f="dark"}=e,{defaultClass:a="py-2 px-3 text-sm font-medium"}=e;const i={dark:"bg-gray-900 text-white dark:bg-gray-700",light:"border-gray-200 bg-white text-gray-900",auto:" bg-white text-gray-900 dark:bg-gray-700 dark:text-white border-gray-200 dark:border-gray-700",custom:""};let h;function p(g){Fn.call(this,n,g)}return n.$$set=g=>{l(8,e=rl(rl({},e),hl(g))),l(1,r=ul(e,t)),"type"in g&&l(2,f=g.type),"defaultClass"in g&&l(3,a=g.defaultClass),"$$scope"in g&&l(6,s=g.$$scope)},n.$$.update=()=>{r.color?l(2,f="custom"):l(1,r.color="none",r),["light","auto"].includes(f)&&l(1,r.border=!0,r),l(0,h=ur("tooltip",a,i[f],e.class))},e=hl(e),[h,r,f,a,o,p,s]}class et extends Re{constructor(e){super(),Fe(this,e,vr,gr,Ge,{type:2,defaultClass:3})}}function Tn(n=[],e){const l=n.map(s=>s.logit/e),t=l.map(s=>Math.exp(s)),r=t.reduce((s,f)=>s+f,0);return n.map((s,f)=>({...s,adjustedLogit:l[f],adjustedProbability:t[f]/r,adjustedExp:t[f]}))}function Hn(n){const e=[];let l=0;for(const r of n)l+=r.probability,e.push(l);const t=Math.random();for(let r=0;r<e.length;r++)if(t<e[r])return n[r];return n[0]}const mr=!0,Ts=Object.freeze(Object.defineProperty({__proto__:null,prerender:mr},Symbol.toStringTag,{value:"Module"}));function _r(n,e){let l,t;for(const r of n)r!=null&&(l===void 0?r>=r&&(l=t=r):(l>r&&(l=r),t<r&&(t=r)));return[l,t]}function br(n,e){let l;if(e===void 0)for(const t of n)t!=null&&(l<t||l===void 0&&t>=t)&&(l=t);else{let t=-1;for(let r of n)(r=e(r,++t,n))!=null&&(l<r||l===void 0&&r>=r)&&(l=r)}return l}function $r(n,e){e===void 0&&(e=n,n=Qt);for(var l=0,t=e.length-1,r=e[0],o=new Array(t<0?0:t);l<t;)o[l]=n(r,r=e[++l]);return function(s){var f=Math.max(0,Math.min(t-1,Math.floor(s*=t)));return o[f](s-f)}}function yr(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function wr(){var n=0,e=.5,l=1,t=1,r,o,s,f,a,i=Bn,h,p=!1,g;function w(j){return isNaN(j=+j)?g:(j=.5+((j=+h(j))-o)*(t*j<t*o?f:a),i(p?Math.max(0,Math.min(1,j)):j))}w.domain=function(j){return arguments.length?([n,e,l]=j,r=h(n=+n),o=h(e=+e),s=h(l=+l),f=r===o?0:.5/(o-r),a=o===s?0:.5/(s-o),t=o<r?-1:1,w):[n,e,l]},w.clamp=function(j){return arguments.length?(p=!!j,w):p},w.interpolator=function(j){return arguments.length?(i=j,w):i};function V(j){return function(R){var G,M,q;return arguments.length?([G,M,q]=R,i=$r(j,[G,M,q]),w):[i(0),i(.5),i(1)]}}return w.range=V(Qt),w.rangeRound=V(ar),w.unknown=function(j){return arguments.length?(g=j,w):g},function(j){return h=j,r=j(n),o=j(e),s=j(l),f=r===o?0:.5/(o-r),a=o===s?0:.5/(s-o),t=o<r?-1:1,w}}function jn(){var n=sr(wr()(Bn));return n.copy=function(){return yr(n,jn())},ir.apply(n,arguments)}const{theme:ee}=kt(Et),ge=200,gl={"gray-blue":{0:ee.colors.gray[ge],100:ee.colors.blue[ge]},"gray-blue-last":{0:ee.colors.gray[ge],100:ee.colors.blue[ge]},"purple-indigo":{0:ee.colors.purple[ge],100:ee.colors.indigo[ge]},"purple-indigo-last":{0:ee.colors.purple[ge],100:ee.colors.indigo[ge]},"indigo-blue":{0:ee.colors.indigo[ge],100:ee.colors.blue[ge]},"indigo-blue-last":{0:ee.colors.indigo[ge],100:ee.colors.blue[ge]},"blue-white":{0:ee.colors.blue[ge],100:ee.colors.white},"red-white":{0:ee.colors.red[ge],100:ee.colors.white},"green-white":{0:ee.colors.green[ge],100:ee.colors.white},"red-purple":{0:ee.colors.red[ge],100:ee.colors.purple[ge]},"blue-purple":{90:ee.colors.blue[ge],100:ee.colors.purple[ge]},"green-purple":{0:ee.colors.green[ge],100:ee.colors.purple[ge]},"blue-gray":{0:ee.colors.blue[ge],100:ee.colors.gray[ge]},"blue-white-blue":{0:ee.colors.blue[ge],40:ee.colors.white,60:ee.colors.white,100:ee.colors.blue[ge]},"blue-white-blue-last":{0:ee.colors.blue[ge],40:ee.colors.white,60:ee.colors.white,100:ee.colors.blue[ge]},"transparent-purple":{0:{color:ee.colors.purple[100],opacity:0},100:{color:ee.colors.purple[100],opacity:1}},"transparent-purple2":{0:{color:ee.colors.purple[400],opacity:0},100:{color:ee.colors.purple[200],opacity:1}},"transparent-purple-last":{0:{color:ee.colors.purple[100],opacity:0},100:{color:ee.colors.purple[100],opacity:1}},"transparent-purple2-last":{0:{color:ee.colors.purple[400],opacity:0},100:{color:ee.colors.purple[200],opacity:1}},"blue-blue":{0:ee.colors.blue[ge],100:ee.colors.blue[ge]},"red-red":{0:ee.colors.red[ge],100:ee.colors.red[ge]},"green-green":{0:ee.colors.green[ge],100:ee.colors.green[ge]},"blue-blue2":{0:ee.colors.blue[ge],100:ee.colors.blue[ge]},"red-red2":{0:ee.colors.red[ge],100:ee.colors.red[ge]},"green-green2":{0:ee.colors.green[ge],100:ee.colors.green[ge]},"blue-blue-last":{0:ee.colors.blue[ge],100:ee.colors.blue[ge]},"red-red-last":{0:ee.colors.red[ge],100:ee.colors.red[ge]},"green-green-last":{0:ee.colors.green[ge],100:ee.colors.green[ge]},"blue-blue2-last":{0:ee.colors.blue[ge],100:ee.colors.blue[ge]},"red-red2-last":{0:ee.colors.red[ge],100:ee.colors.red[ge]},"green-green2-last":{0:ee.colors.green[ge],100:ee.colors.green[ge]},"gray-gray":{0:ee.colors.gray[ge],100:ee.colors.gray[ge]},"purple-purple":{0:ee.colors.purple[ge],100:ee.colors.purple[ge]},"purple-purple-last":{0:ee.colors.purple[ge],100:ee.colors.purple[ge]}};function kr(n){let e,l,t,r;return{c(){e=Se("svg"),t=Se("svg"),this.h()},l(o){e=De(o,"svg",{id:!0,class:!0,style:!0}),T(e).forEach(y),t=De(o,"svg",{class:!0,style:!0}),T(t).forEach(y),this.h()},h(){m(e,"id","back"),m(e,"class","sankey-back absolute left-0 top-0 h-full w-full"),m(e,"style",l=`z-index:${n[2].attention_head_num-1};`),m(t,"class","sankey-top absolute left-0 top-0 h-full w-full"),m(t,"style",r=`z-index:${n[2].attention_head_num};`)},m(o,s){Z(o,e,s),n[4](e),Z(o,t,s),n[5](t)},p(o,[s]){s&4&&l!==(l=`z-index:${o[2].attention_head_num-1};`)&&m(e,"style",l),s&4&&r!==(r=`z-index:${o[2].attention_head_num};`)&&m(t,"style",r)},i:Oe,o:Oe,d(o){o&&(y(e),y(t)),n[4](null),n[5](null)}}}const Er=80;function Ir(n,e,l){let t,r,o;Ce(n,mt,q=>l(3,r=q)),Ce(n,Mt,q=>l(2,o=q));const{theme:s}=kt(Et);let f,a,i;const h={attention:[{from:".attention .query .head-rest",to:".head-block .query .vector",gradientId:"blue-blue2",opacity:.4},{from:".attention .key .head-rest",to:".head-block .key .vector",gradientId:"red-red2",opacity:.4},{from:".attention .value .head-rest",to:".head-block .value .vector",gradientId:"green-green2",opacity:.4},{from:".attention .head-out .vector",to:".mlp .initial .vector .head-rest",gradientId:"transparent-purple",opacity:.4}]},p=()=>{const L=lt(a).append("defs");Object.keys(gl).forEach(z=>{const A=gl[z],H=L.append("linearGradient").attr("id",z).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");Object.keys(A).forEach(c=>{let d,$;typeof A[c]!="string"?(d=A[c].color,$=A[c].opacity):(d=A[c],$=1),H.append("stop").attr("offset",`${c}%`).attr("stop-color",d).attr("stop-opacity",$)})})};let g=1,w;const V=async()=>{await Dt();const q=lt(a),L=lt(f);[{dataMap:t,svg:q},{dataMap:h,svg:L}].forEach(({dataMap:z,svg:A})=>{A.selectAll("g.path-group").data(Object.keys(z)).join("g").attr("class",c=>`path-group ${c}`).on("mouseenter",(c,d)=>{clearTimeout(w),ol.set(d);const $=lt(`g.${d}`).selectAll("path");g=$.nodes()[0].getAttribute("opacity"),$.transition().duration(300).style("opacity",Number(g)+.2)}).on("mouseleave",(c,d)=>{w=setTimeout(()=>{ol.set(null)},300),lt(`g.${d}`).selectAll("path").transition().duration(300).style("opacity",g)}).selectAll("path.sankey-path").data(c=>z[c].map($=>{const E=Ut($.from).nodes(),I=Ut($.to).nodes();return E.map((S,C)=>{const u=S.getBoundingClientRect(),v=I[C].getBoundingClientRect(),b=$.curve||Er,N=($.pathGenerator||j)(u,v,b),D=I.length>1&&C===E.length-1;let O=$.gradientId;return D&&document.getElementById($.gradientId+"-last")&&(O=$.gradientId+"-last"),{id:$.id,isLast:C===E.length-1,path:N,fill:$.type==="stroke"?"none":$.gradientId?`url(#${O})`:$.fill,opacity:$.opacity,stroke:$.type==="stroke"?$.gradientId?`url(#${$.gradientId})`:$.fill:"none"}})}).flat()).join("path").attr("class",c=>`sankey-path ${c.id||""} ${c.isLast?"last":""}`).attr("fill",c=>c.fill).attr("stroke",c=>c.stroke).attr("stroke-width",2).attr("opacity",c=>c.opacity||1).attr("d",c=>c.path)})},j=(q,L,z)=>{const A=window.scrollY,H=window.scrollX;return`
        M ${q.right+H},${q.top+A}
        C ${q.right+H+z},${q.top+A} ${L.left+H-z},${L.top+A} ${L.left+H},${L.top+A}
        L ${L.left+H},${L.bottom+A}
        C ${L.left+H-z},${L.bottom+A} ${q.right+H+z},${q.bottom+A} ${q.right+H},${q.bottom+A}
        Z
    `};Nt(()=>(p(),i=new ResizeObserver(L=>{V(),R()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(L=>i.observe(L)),()=>{i.disconnect()}));const R=()=>{const q=lt(a),L=Ut(".residual-start path.head").nodes(),z=Ut(".residual-end path.head").nodes(),A=L.map((H,c)=>{const d=H.getBoundingClientRect(),$=z[c].getBoundingClientRect(),E=d.right,I=d.top,S=$.left,C=$.top;return{x1:E,y1:I,x2:S,y2:C,id:H.id}});q.selectAll("line.residual-connector").data(A).join("line").attr("class",H=>`residual-connector ${H.id}`).attr("x1",H=>H.x1).attr("y1",H=>H.y1).attr("x2",H=>H.x2).attr("y2",H=>H.y2).attr("stroke",s.colors.gray[400]).attr("stroke-width",1).style("opacity",0)};function G(q){ht[q?"unshift":"push"](()=>{f=q,l(0,f)})}function M(q){ht[q?"unshift":"push"](()=>{a=q,l(1,a)})}return n.$$.update=()=>{n.$$.dirty&8&&(t={embedding:[{from:".embedding .vector-column .column.vectors .vector",to:".attention .vector",gradientId:"gray-blue",opacity:.6,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX,c=30;return`
					M ${q.right+H},${q.top+A}
					L ${q.right+c+H},${q.top+A}
					C ${q.right+c+H+z},${q.top+A} ${L.left+H-z},${L.top+A} ${L.left+H},${L.top+A}
					L ${L.left+H},${L.bottom+A}
					C ${L.left+H-z},${L.bottom+A} ${q.right+c+H+z},${q.bottom+A} ${q.right+c+H},${q.bottom+A}
					L ${q.right+H},${q.bottom+A}
					Z
				`}}],attention:[{from:".attention .query .sub-vector.head1",to:".head-block .query .vector",gradientId:"blue-blue"},{from:".attention .key .sub-vector.head1",to:".head-block .key .vector",gradientId:"red-red"},{from:".attention .value .sub-vector.head1",to:".head-block .value .vector",gradientId:"green-green"},{from:".attention .head-out .vector",to:".mlp .initial .head1",gradientId:"purple-purple"},{from:".head-block .key .vector",to:".attention-initial .main g.g-row",id:"key-to-attention",type:"stroke",gradientId:"red-purple",curve:30,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX,c=q.top+A+q.height/2,d=L.top+A+L.height/2,$=q.right+H+z,E=L.left+H-z;return`
			    M ${q.right+H},${c}
			    C ${$},${c} ${E},${d} ${L.left+H},${d}
					L ${L.right+H},${d}
			`}},{from:".head-block .query .vector",to:`.attention-matrix.attention-initial .main g.g-row-${r.length-1} circle`,gradientId:"blue-purple",id:"query-to-attention",type:"stroke",curve:20,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX,c=q.top+A+q.height/2,d=L.left+H+L.width/2;return`
			    M ${q.right+H},${c}
			    L ${d-z},${c}
			    A ${z},${z} 0 0 1 ${d},${c+z}
			    L ${d},${L.bottom+A}
			`}},{from:".attention-matrix.attention-out .main svg",to:".attention .head-out",gradientId:"transparent-purple2",id:"to-attention-out",opacity:.4,curve:20,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX;return`
			    M ${q.right+H},${q.top+A}
			    C ${q.right+H+z},${q.top+A} ${L.left+H-z},${L.top+A} ${L.left+H},${L.top+A}
			    L ${L.left+H},${L.bottom+A}
			    C ${L.left+H-z},${L.bottom+A} ${q.right+H+z},${q.bottom+A} ${q.right+H},${q.bottom+A}
			    Z
			`}},{from:".head-block .value",to:".attention .head-out",gradientId:"green-purple",id:"to-attention-out",opacity:.4,curve:60,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX;return`
        M ${q.right+H},${q.top+A} 
        C ${L.left-z},${q.top+A} ${L.left+H-z},${q.top+A} ${L.left+H},${L.top+A}
        L ${L.left+H},${L.bottom+A}
        C ${L.left+H-z},${q.bottom+A} ${L.left-z},${q.bottom+A} ${q.right+H},${q.bottom+A}
        Z
    `}}],mlp:[{from:".mlp .column.initial .vector",to:".mlp .projections .vector",gradientId:"purple-indigo",curve:50,opacity:.4,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX,c=49;return`
					M ${q.right+H},${q.top+A}
					L ${q.right+c+H},${q.top+A}
					C ${q.right+c+H+z},${q.top+A} ${L.left+H-z},${L.top+A} ${L.left+H},${L.top+A}
					L ${L.left+H},${L.bottom+A}
					C ${L.left+H-z},${L.bottom+A} ${q.right+c+H+z},${q.bottom+A} ${q.right+c+H},${q.bottom+A}
					L ${q.right+H},${q.bottom+A}
					Z
				`}},{from:".mlp .projections .vector",to:".mlp .column.out .vector",gradientId:"indigo-blue",curve:50,opacity:.4,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX,c=20;return`
					M ${q.right+H},${q.top+A}
					C ${q.right+H+z},${q.top+A} ${L.left-c+H-z},${L.top+A} ${L.left-c+H},${L.top+A}
					L ${L.left+H},${L.top+A}
					L ${L.left+H},${L.bottom+A}
					L ${L.left-c+H},${L.bottom+A}
					C ${L.left-c+H-z},${L.bottom+A} ${q.right+H+z},${q.bottom+A} ${q.right+H},${q.bottom+A}
					L ${q.right+H},${q.bottom+A}
					Z
				`}}],"transformer-blocks":[{from:".mlp .out .vector",to:".transformer-blocks .column.final .vector",gradientId:"blue-white-blue",opacity:.6,pathGenerator:(q,L,z)=>{const A=window.scrollY,H=window.scrollX;return`
        M ${q.right+H},${q.top+A}
        C ${q.right+H+z},${q.top+A} ${L.left+H-z},${L.top+A} ${L.left+H},${L.top+A}
        L ${L.left+H},${L.bottom+A}
        C ${L.left+H-z},${L.bottom+A} ${q.right+H+z},${q.bottom+A} ${q.right+H},${q.bottom+A}
        Z
    `}}],"linear-softmax":[{from:".transformer-blocks .final .vector.last-token ",to:".softmax .content .vector",gradientId:"blue-gray",opacity:.4}]}),n.$$.dirty&8&&typeof window<"u"&&r&&(V(),R())},[f,a,o,r,G,M]}class Cr extends Re{constructor(e){super(),Fe(this,e,Ir,kr,Ge,{})}}function vl(n,e,l){const t=n.slice();return t[6]=e[l],t[8]=l,t}function Sr(n){let e,l,t,r,o;return{c(){e=B("div"),l=B("div"),r=U(),this.h()},l(s){e=P(s,"DIV",{class:!0,style:!0});var f=T(e);l=P(f,"DIV",{class:!0,style:!0}),T(l).forEach(y),r=W(f),f.forEach(y),this.h()},h(){m(l,"class","card svelte-z5n2f7"),m(l,"style",t=`width: ${n[1].width}px; height: ${n[1].height}px;`),m(e,"class","rest absolute"),m(e,"style",o=`transform:translate(${n[8]*yt.x}px,${n[8]*yt.y}px) scale(${1-yt.scale*n[8]}); 
      z-index: ${n[2].attention_head_num-n[8]};opacity:${Math.max(.1,1-n[8]*_l)};`)},m(s,f){Z(s,e,f),k(e,l),k(e,r)},p(s,f){f&2&&t!==(t=`width: ${s[1].width}px; height: ${s[1].height}px;`)&&m(l,"style",t),f&4&&o!==(o=`transform:translate(${s[8]*yt.x}px,${s[8]*yt.y}px) scale(${1-yt.scale*s[8]}); 
      z-index: ${s[2].attention_head_num-s[8]};opacity:${Math.max(.1,1-s[8]*_l)};`)&&m(e,"style",o)},i:Oe,o:Oe,d(s){s&&y(e)}}}function Dr(n){let e,l,t;const r=n[4].default,o=Dn(r,n,n[3],null);return{c(){e=B("div"),o&&o.c(),l=U(),this.h()},l(s){e=P(s,"DIV",{class:!0,style:!0});var f=T(e);o&&o.l(f),l=W(f),f.forEach(y),this.h()},h(){m(e,"class","w-full"),m(e,"style","z-index: 200;")},m(s,f){Z(s,e,f),o&&o.m(e,null),k(e,l),n[5](e),t=!0},p(s,f){o&&o.p&&(!t||f&8)&&qn(o,r,s,s[3],t?An(r,s[3],f,null):Vn(s[3]),null)},i(s){t||(F(o,s),t=!0)},o(s){Q(o,s),t=!1},d(s){s&&y(e),o&&o.d(s),n[5](null)}}}function ml(n){let e,l,t,r;const o=[Dr,Sr],s=[];function f(a,i){return a[8]===0?0:1}return e=f(n),l=s[e]=o[e](n),{c(){l.c(),t=pt()},l(a){l.l(a),t=pt()},m(a,i){s[e].m(a,i),Z(a,t,i),r=!0},p(a,i){l.p(a,i)},i(a){r||(F(l),r=!0)},o(a){Q(l),r=!1},d(a){a&&y(t),s[e].d(a)}}}function qr(n){let e,l,t=be(Array(n[2].attention_head_num+1).fill(0)),r=[];for(let s=0;s<t.length;s+=1)r[s]=ml(vl(n,t,s));const o=s=>Q(r[s],1,1,()=>{r[s]=null});return{c(){e=B("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=P(s,"DIV",{class:!0});var f=T(e);for(let a=0;a<r.length;a+=1)r[a].l(f);f.forEach(y),this.h()},h(){m(e,"class","multi-head flex w-full svelte-z5n2f7")},m(s,f){Z(s,e,f);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);l=!0},p(s,[f]){if(f&15){t=be(Array(s[2].attention_head_num+1).fill(0));let a;for(a=0;a<t.length;a+=1){const i=vl(s,t,a);r[a]?(r[a].p(i,f),F(r[a],1)):(r[a]=ml(i),r[a].c(),F(r[a],1),r[a].m(e,null))}for(Be(),a=t.length;a<r.length;a+=1)o(a);Pe()}},i(s){if(!l){for(let f=0;f<t.length;f+=1)F(r[f]);l=!0}},o(s){r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)Q(r[f]);l=!1},d(s){s&&y(e),Me(r,s)}}}let _l=.1;function Vr(n,e,l){let t;Ce(n,Mt,i=>l(2,t=i));let{$$slots:r={},$$scope:o}=e,s,f={width:0,height:0};Nt(()=>{const i=new ResizeObserver(h=>{for(let p of h){const{width:g,height:w}=p.contentRect;l(1,f={width:g,height:w})}});return i.observe(s),()=>{i.unobserve(s)}});function a(i){ht[i?"unshift":"push"](()=>{s=i,l(0,s)})}return n.$$set=i=>{"$$scope"in i&&l(3,o=i.$$scope)},[s,f,t,o,r,a]}class Ar extends Re{constructor(e){super(),Fe(this,e,Vr,qr,Ge,{})}}const Nr=(n,e)=>{console.log(n,e);const l=e.filter(r=>r!==1),t=(r,o)=>{if(o.length===1)return r.splice(0,o[0]);const s=o[0],f=o.slice(1);return Array.from({length:s},()=>t(r,f))};return t(n,l)},bt=n=>n.map((e,l)=>{let t=new Array(e.length).fill(-1/0);for(let r=0;r<=l&&r<e.length;r++)t[r]=e[r];return t});function Mr(n){var Pt,Tt;let e,l,t,r,o,s,f="QK<sup>T</sup>",a,i,h,p=((Pt=n[1][0])==null?void 0:Pt.toFixed(1))+"",g,w,V,j,R,G=((Tt=n[1][1])==null?void 0:Tt.toFixed(1))+"",M,q,L,z,A,H,c,d,$,E,I,S,C,u="Scaling · Mask",v,b,_='<span class="val svelte-7oct6y">-3.0</span> <div class="bar svelte-7oct6y"></div> <span class="val svelte-7oct6y">3.0</span>',N,D,O,Y,te,fe,X,ue,K,ve,je,Te="Softmax · Dropout",ye,He,Ve='<span class="val svelte-7oct6y">-1.0</span> <div class="bar svelte-7oct6y"></div> <span class="val svelte-7oct6y">1.0</span>',me,$e,J,pe,ke,Ne,st="Attention",he,ze,ct,Qe,We,Ue,Bt;return r=new Vt({props:{className:"main",data:n[2],showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[8]}}),$=new Vt({props:{className:"prev absolute top-0 left-0 pointer-events-none",data:n[2],showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[8]}}),I=new Vt({props:{className:"main opacity-0",data:bt(n[11]),showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[13]}}),X=new Vt({props:{className:"prev absolute top-0 left-0  pointer-events-none",data:bt(n[11]),showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[13]}}),K=new Vt({props:{className:"main opacity-0",data:bt(n[10]),showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),pe=new Vt({props:{className:"main",data:bt(n[10]),showSize:!1,cellHeight:n[9],cellWidth:n[9],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),{c(){e=B("div"),l=B("div"),t=B("div"),ne(r.$$.fragment),o=U(),s=B("div"),s.innerHTML=f,a=U(),i=B("div"),h=B("span"),g=ie(p),w=U(),V=B("div"),j=U(),R=B("span"),M=ie(G),L=U(),z=B("div"),A=Se("svg"),H=Se("path"),c=U(),d=B("div"),ne($.$$.fragment),E=U(),ne(I.$$.fragment),S=U(),C=B("div"),C.textContent=u,v=U(),b=B("div"),b.innerHTML=_,N=U(),D=B("div"),O=Se("svg"),Y=Se("path"),te=U(),fe=B("div"),ne(X.$$.fragment),ue=U(),ne(K.$$.fragment),ve=U(),je=B("div"),je.textContent=Te,ye=U(),He=B("div"),He.innerHTML=Ve,$e=U(),J=B("div"),ne(pe.$$.fragment),ke=U(),Ne=B("div"),Ne.textContent=st,this.h()},l(_e){e=P(_e,"DIV",{class:!0,style:!0});var Ie=T(e);l=P(Ie,"DIV",{role:!0,tabindex:!0,class:!0});var Xe=T(l);t=P(Xe,"DIV",{class:!0});var Ye=T(t);re(r.$$.fragment,Ye),o=W(Ye),s=P(Ye,"DIV",{class:!0,"data-svelte-h":!0}),qe(s)!=="svelte-1uhcjv4"&&(s.innerHTML=f),a=W(Ye),i=P(Ye,"DIV",{class:!0});var Ke=T(i);h=P(Ke,"SPAN",{class:!0});var ft=T(h);g=ae(ft,p),ft.forEach(y),w=W(Ke),V=P(Ke,"DIV",{class:!0}),T(V).forEach(y),j=W(Ke),R=P(Ke,"SPAN",{class:!0});var It=T(R);M=ae(It,G),It.forEach(y),Ke.forEach(y),Ye.forEach(y),L=W(Xe),z=P(Xe,"DIV",{class:!0});var tt=T(z);A=De(tt,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var Ht=T(A);H=De(Ht,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(H).forEach(y),Ht.forEach(y),c=W(tt),d=P(tt,"DIV",{});var Ct=T(d);re($.$$.fragment,Ct),E=W(Ct),re(I.$$.fragment,Ct),Ct.forEach(y),S=W(tt),C=P(tt,"DIV",{class:!0,"data-svelte-h":!0}),qe(C)!=="svelte-15vmxu9"&&(C.textContent=u),v=W(tt),b=P(tt,"DIV",{class:!0,"data-svelte-h":!0}),qe(b)!=="svelte-bz6asq"&&(b.innerHTML=_),tt.forEach(y),N=W(Xe),D=P(Xe,"DIV",{class:!0});var _t=T(D);O=De(_t,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var fl=T(O);Y=De(fl,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(Y).forEach(y),fl.forEach(y),te=W(_t),fe=P(_t,"DIV",{});var Gt=T(fe);re(X.$$.fragment,Gt),ue=W(Gt),re(K.$$.fragment,Gt),Gt.forEach(y),ve=W(_t),je=P(_t,"DIV",{class:!0,"data-svelte-h":!0}),qe(je)!=="svelte-1fyrzav"&&(je.textContent=Te),ye=W(_t),He=P(_t,"DIV",{class:!0,"data-svelte-h":!0}),qe(He)!=="svelte-1lh8vbm"&&(He.innerHTML=Ve),_t.forEach(y),$e=W(Xe),J=P(Xe,"DIV",{class:!0});var Rt=T(J);re(pe.$$.fragment,Rt),ke=W(Rt),Ne=P(Rt,"DIV",{class:!0,"data-svelte-h":!0}),qe(Ne)!=="svelte-10aghm9"&&(Ne.textContent=st),Rt.forEach(y),Xe.forEach(y),Ie.forEach(y),this.h()},h(){m(s,"class","matrix-label svelte-7oct6y"),m(h,"class","val svelte-7oct6y"),m(V,"class","bar svelte-7oct6y"),m(R,"class","val svelte-7oct6y"),m(i,"class","color-scale svelte-7oct6y"),m(t,"class",q=de(ce("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":n[0]}))+" svelte-7oct6y"),m(H,"stroke","currentColor"),m(H,"stroke-linecap","round"),m(H,"stroke-linejoin","round"),m(H,"stroke-width","2"),m(H,"d","M19 12H5m14 0-4 4m4-4-4-4"),m(A,"class","arrow svelte-7oct6y"),m(A,"aria-hidden","true"),m(A,"xmlns","http://www.w3.org/2000/svg"),m(A,"width","24"),m(A,"height","24"),m(A,"fill","none"),m(A,"viewBox","0 0 24 24"),m(C,"class","matrix-label svelte-7oct6y"),m(b,"class","color-scale svelte-7oct6y"),m(z,"class","attention-matrix attention-mask flex flex-col items-center svelte-7oct6y"),m(Y,"stroke","currentColor"),m(Y,"stroke-linecap","round"),m(Y,"stroke-linejoin","round"),m(Y,"stroke-width","2"),m(Y,"d","M19 12H5m14 0-4 4m4-4-4-4"),m(O,"class","arrow svelte-7oct6y"),m(O,"aria-hidden","true"),m(O,"xmlns","http://www.w3.org/2000/svg"),m(O,"width","24"),m(O,"height","24"),m(O,"fill","none"),m(O,"viewBox","0 0 24 24"),m(je,"class","matrix-label svelte-7oct6y"),m(He,"class","color-scale svelte-7oct6y"),m(D,"class",me=de(ce("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":n[0]}))+" svelte-7oct6y"),m(Ne,"class","matrix-label svelte-7oct6y"),m(J,"class",he=de(ce("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!n[0],"attention-out":!n[0]}))+" svelte-7oct6y"),al(()=>n[23].call(J)),m(l,"role","button"),m(l,"tabindex","0"),m(l,"class",ct=de(ce("attention-matrix-container relative flex gap-3 p-3 pb-1",{active:n[0]}))+" svelte-7oct6y"),m(e,"class","flex items-center gap-8 px-5"),m(e,"style",Qe=`--attention-matrix-width: ${n[7]}px;`)},m(_e,Ie){Z(_e,e,Ie),k(e,l),k(l,t),oe(r,t,null),k(t,o),k(t,s),k(t,a),k(t,i),k(i,h),k(h,g),k(i,w),k(i,V),k(i,j),k(i,R),k(R,M),n[19](t),k(l,L),k(l,z),k(z,A),k(A,H),k(z,c),k(z,d),oe($,d,null),k(d,E),oe(I,d,null),k(z,S),k(z,C),k(z,v),k(z,b),n[20](z),k(l,N),k(l,D),k(D,O),k(O,Y),k(D,te),k(D,fe),oe(X,fe,null),k(fe,ue),oe(K,fe,null),k(D,ve),k(D,je),k(D,ye),k(D,He),n[21](D),k(l,$e),k(l,J),oe(pe,J,null),k(J,ke),k(J,Ne),n[22](J),ze=Nn(J,n[23].bind(J)),We=!0,Ue||(Bt=[Ee(l,"click",n[12]),Ee(l,"keydown",n[12])],Ue=!0)},p(_e,[Ie]){var Ht,Ct;const Xe={};Ie&4&&(Xe.data=_e[2]),Ie&512&&(Xe.cellHeight=_e[9]),Ie&512&&(Xe.cellWidth=_e[9]),Ie&256&&(Xe.colorScale=_e[8]),r.$set(Xe),(!We||Ie&2)&&p!==(p=((Ht=_e[1][0])==null?void 0:Ht.toFixed(1))+"")&&Ae(g,p),(!We||Ie&2)&&G!==(G=((Ct=_e[1][1])==null?void 0:Ct.toFixed(1))+"")&&Ae(M,G),(!We||Ie&1&&q!==(q=de(ce("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":_e[0]}))+" svelte-7oct6y"))&&m(t,"class",q);const Ye={};Ie&4&&(Ye.data=_e[2]),Ie&512&&(Ye.cellHeight=_e[9]),Ie&512&&(Ye.cellWidth=_e[9]),Ie&256&&(Ye.colorScale=_e[8]),$.$set(Ye);const Ke={};Ie&2048&&(Ke.data=bt(_e[11])),Ie&512&&(Ke.cellHeight=_e[9]),Ie&512&&(Ke.cellWidth=_e[9]),I.$set(Ke);const ft={};Ie&2048&&(ft.data=bt(_e[11])),Ie&512&&(ft.cellHeight=_e[9]),Ie&512&&(ft.cellWidth=_e[9]),X.$set(ft);const It={};Ie&1024&&(It.data=bt(_e[10])),Ie&512&&(It.cellHeight=_e[9]),Ie&512&&(It.cellWidth=_e[9]),K.$set(It),(!We||Ie&1&&me!==(me=de(ce("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":_e[0]}))+" svelte-7oct6y"))&&m(D,"class",me);const tt={};Ie&1024&&(tt.data=bt(_e[10])),Ie&512&&(tt.cellHeight=_e[9]),Ie&512&&(tt.cellWidth=_e[9]),pe.$set(tt),(!We||Ie&1&&he!==(he=de(ce("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!_e[0],"attention-out":!_e[0]}))+" svelte-7oct6y"))&&m(J,"class",he),(!We||Ie&1&&ct!==(ct=de(ce("attention-matrix-container relative flex gap-3 p-3 pb-1",{active:_e[0]}))+" svelte-7oct6y"))&&m(l,"class",ct),(!We||Ie&128&&Qe!==(Qe=`--attention-matrix-width: ${_e[7]}px;`))&&m(e,"style",Qe)},i(_e){We||(F(r.$$.fragment,_e),F($.$$.fragment,_e),F(I.$$.fragment,_e),F(X.$$.fragment,_e),F(K.$$.fragment,_e),F(pe.$$.fragment,_e),We=!0)},o(_e){Q(r.$$.fragment,_e),Q($.$$.fragment,_e),Q(I.$$.fragment,_e),Q(X.$$.fragment,_e),Q(K.$$.fragment,_e),Q(pe.$$.fragment,_e),We=!1},d(_e){_e&&y(e),se(r),n[19](null),se($),se(I),n[20](null),se(X),se(K),n[21](null),se(pe),n[22](null),ze(),Ue=!1,Ze(Bt)}}}let Lr=16,Br=20,Pr=10;function Tr(n,e,l){let t,r,o,s,f,a,i,h,p,g;Ce(n,mt,b=>l(16,h=b)),Ce(n,at,b=>l(17,p=b)),Ce(n,Lt,b=>l(18,g=b));const{theme:w}=kt(Et);let V,j,R,G,M=0,q=!1;const L=Zt("block-id"),z=()=>{l(0,q=!q),q?(at.set({id:L}),c()):(at.set({id:null}),d())};let A=qt.timeline(),H=qt.timeline();const c=()=>{H.progress(1);const b=document.querySelectorAll("div.sankey g.attention path.key-to-attention"),_=document.querySelectorAll("div.sankey g.attention path.query-to-attention"),N=document.querySelectorAll("div.sankey g.attention path.to-attention-out");[...b,..._].forEach(Y=>{const te=Y.getTotalLength();Y.style.strokeDasharray=te,Y.style.strokeDashoffset=te});const D=1.2,O=Number((D/h.length).toFixed(2));A.set([j.querySelector(".prev"),R.querySelector(".prev")],{opacity:1}).set([j.querySelector(".main"),R.querySelector(".main")],{opacity:0}),A.set(N,{opacity:0}),A.to(G,{opacity:0,display:"none",duration:.2}),A.set(V,{width:"auto",display:"flex",opacity:0}).to(V,{opacity:1,duration:.5}).to(b,{strokeDashoffset:0,stagger:O,duration:D,ease:"power2.out"}).to(_,{strokeDashoffset:0,stagger:O,duration:D,ease:"power2.out"},"<").from(V.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:D/h.length,stagger:Number((D/Math.pow(h.length,2)).toFixed(2)),ease:"power2.out",duration:D},"<"),A.set(j,{width:0,x:M*-1,opacity:0}).to(j,{opacity:1,display:"flex",width:M,x:0,duration:.5}).to(j.querySelector(".prev"),{opacity:0,duration:1}).to(j.querySelector(".main"),{opacity:1,duration:1},"<"),A.set(R,{width:0,x:M*-1,opacity:0}).to(R,{opacity:1,display:"flex",width:M,x:0,duration:.4}).to(R.querySelector(".prev"),{opacity:0,duration:1}).to(R.querySelector(".main"),{opacity:1,duration:1},"<"),A.to(N,{opacity:.5})},d=()=>{A.progress(1),H.to([V,j,R],{opacity:0,display:"none",width:0,duration:.5}),H.to(G,{opacity:1,display:"flex",duration:.5},0)},$=(b,_)=>il().domain([-3,3]).range(["white",w.colors.purple[700]])(b),E=(b,_)=>Qt("white",w.colors.purple[700])(b);function I(b){ht[b?"unshift":"push"](()=>{V=b,l(3,V)})}function S(b){ht[b?"unshift":"push"](()=>{j=b,l(4,j)})}function C(b){ht[b?"unshift":"push"](()=>{R=b,l(5,R)})}function u(b){ht[b?"unshift":"push"](()=>{G=b,l(6,G)})}function v(){M=this.offsetWidth,l(7,M)}return n.$$.update=()=>{var b,_,N,D,O,Y;n.$$.dirty&65536&&l(15,t=Array(h.length).fill(0).map(te=>Array(h.length).fill(-1/0))),n.$$.dirty&294912&&l(2,r=((_=(b=g==null?void 0:g.outputs)==null?void 0:b.block_0_attn_head_0_attn)==null?void 0:_.data)||t),n.$$.dirty&294912&&l(11,o=((D=(N=g==null?void 0:g.outputs)==null?void 0:N.block_0_attn_head_0_attn_masked)==null?void 0:D.data)||t),n.$$.dirty&294912&&l(10,s=((Y=(O=g==null?void 0:g.outputs)==null?void 0:O.block_0_attn_head_0_attn_dropout)==null?void 0:Y.data)||t),n.$$.dirty&65536&&l(9,f=Math.min(Br,Math.max(1/h.length*Lr*6,Pr))),n.$$.dirty&131073&&p.id!==L&&q&&(l(0,q=!1),d()),n.$$.dirty&4&&l(1,a=_r(r.flat())),n.$$.dirty&2&&l(8,i=(te,fe)=>il().domain(a).range(["white",w.colors.purple[700]])(te))},[q,a,r,V,j,R,G,M,i,f,s,o,z,$,E,t,h,p,g,I,S,C,u,v]}class Hr extends Re{constructor(e){super(),Fe(this,e,Tr,Mr,Ge,{})}}function jr(n){let e;return{c(){e=B("canvas"),this.h()},l(l){e=P(l,"CANVAS",{class:!0}),T(e).forEach(y),this.h()},h(){m(e,"class","svelte-ex5m8"),le(e,"active",n[0])},m(l,t){Z(l,e,t),n[4](e)},p(l,[t]){t&1&&le(e,"active",l[0])},i:Oe,o:Oe,d(l){l&&y(e),n[4](null)}}}let zr=100;const el=1;function Or(n,e,l){const{theme:t}=kt(Et);let{active:r=!1}=e,{data:o=new Array(zr).fill(0).map(g=>Math.random())}=e,{colorScale:s=void 0}=e,f;const a=typeof s=="string"?s:"gray",i=typeof s=="function"?s:Qt(t.colors[a][100],t.colors[a][400]);function h(){const g=f.getContext("2d");if(!g)return;const w=f.parentElement.clientWidth,V=f.parentElement.clientHeight;g.clearRect(0,0,w,V);let j=4;l(1,f.width=w*j,f),l(1,f.height=V*j,f),l(1,f.style.width=`${w}px`,f),l(1,f.style.height=`${V}px`,f);for(let R=0;R<V/el;R++){const G=o[R];g.fillStyle=i(G),g.fillRect(0,R*el*j,w*j,el*j)}}Nt(()=>{const g=Xt.subscribe(h);return()=>{g()}});function p(g){ht[g?"unshift":"push"](()=>{f=g,l(1,f)})}return n.$$set=g=>{"active"in g&&l(0,r=g.active),"data"in g&&l(2,o=g.data),"colorScale"in g&&l(3,s=g.colorScale)},n.$$.update=()=>{n.$$.dirty&6&&o&&f&&h()},[r,f,o,s,p]}class dt extends Re{constructor(e){super(),Fe(this,e,Or,jr,Ge,{active:0,data:2,colorScale:3})}}function bl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function $l(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function yl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function wl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function kl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Gr(n){let e,l=n[4].dimension*3+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension*3+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Rr(n){let e,l=n[4].dimension/n[4].attention_head_num+"",t,r;return{c(){e=ie("Head1 Query, size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"Head1 Query, size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension/o[4].attention_head_num+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Fr(n){let e,l=n[4].dimension/n[4].attention_head_num+"",t,r;return{c(){e=ie("Head1 Key, size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"Head1 Key, size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension/o[4].attention_head_num+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Ur(n){let e,l=n[4].dimension/n[4].attention_head_num+"",t,r;return{c(){e=ie("Head1 Value size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"Head1 Value size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension/o[4].attention_head_num+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function xr(n){let e,l=n[4].dimension/n[4].attention_head_num+"",t,r;return{c(){e=ie("Head1 Attention Out, size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"Head1 Attention Out, size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension/o[4].attention_head_num+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function El(n){let e,l="Q";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),qe(e)!=="svelte-10ub4hf"&&(e.textContent=l)},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function Il(n){let e,l="K";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),qe(e)!=="svelte-1c09r6x"&&(e.textContent=l)},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function Cl(n){let e,l="V";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),qe(e)!=="svelte-j40kxg"&&(e.textContent=l)},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function Sl(n){let e,l,t,r,o,s,f,a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H,c,d;t=new dt({props:{colorScale:"blue",active:n[2]===n[16]}});let $=n[2]!==n[16]&&El();h=new dt({props:{colorScale:"red",active:n[2]===n[16]}});let E=n[2]!==n[16]&&Il();G=new dt({props:{colorScale:"green",active:n[2]===n[16]}});let I=n[2]!==n[16]&&Cl();function S(){return n[10](n[16])}return{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),r=U(),o=B("div"),s=U(),f=B("div"),$&&$.c(),a=U(),i=B("div"),ne(h.$$.fragment),p=U(),g=B("div"),w=U(),V=B("div"),E&&E.c(),j=U(),R=B("div"),ne(G.$$.fragment),M=U(),q=B("div"),L=U(),z=B("div"),I&&I.c(),A=U(),this.h()},l(C){e=P(C,"DIV",{class:!0,role:!0});var u=T(e);l=P(u,"DIV",{class:!0});var v=T(l);re(t.$$.fragment,v),r=W(v),o=P(v,"DIV",{class:!0}),T(o).forEach(y),s=W(v),f=P(v,"DIV",{class:!0});var b=T(f);$&&$.l(b),b.forEach(y),v.forEach(y),a=W(u),i=P(u,"DIV",{class:!0});var _=T(i);re(h.$$.fragment,_),p=W(_),g=P(_,"DIV",{class:!0}),T(g).forEach(y),w=W(_),V=P(_,"DIV",{class:!0});var N=T(V);E&&E.l(N),N.forEach(y),_.forEach(y),j=W(u),R=P(u,"DIV",{class:!0});var D=T(R);re(G.$$.fragment,D),M=W(D),q=P(D,"DIV",{class:!0}),T(q).forEach(y),L=W(D),z=P(D,"DIV",{class:!0});var O=T(z);I&&I.l(O),O.forEach(y),D.forEach(y),A=W(u),u.forEach(y),this.h()},h(){m(o,"class",de(`sub-vector x1-12 head1 ${zn}`)+" svelte-hribb5"),m(f,"class","sub-vector head-rest grow svelte-hribb5"),m(l,"class",de(`sub-vector query relative flex grow flex-col ${Zr}`)+" svelte-hribb5"),m(g,"class",de(`sub-vector x1-12 head1 ${On}`)+" svelte-hribb5"),m(V,"class","sub-vector head-rest grow svelte-hribb5"),m(i,"class",de(`sub-vector key relative flex grow flex-col ${Yr}`)+" svelte-hribb5"),m(q,"class",de(`sub-vector x1-12 head1 ${Gn}`)+" svelte-hribb5"),m(z,"class","sub-vector head-rest grow svelte-hribb5"),m(R,"class",de(`sub-vector value relative flex grow flex-col ${Kr}`)+" svelte-hribb5"),m(e,"class","qkv-weighted vector x3 flex flex-col"),m(e,"role","group"),le(e,"last",n[16]===n[5].length-1)},m(C,u){Z(C,e,u),k(e,l),oe(t,l,null),k(l,r),k(l,o),k(l,s),k(l,f),$&&$.m(f,null),k(e,a),k(e,i),oe(h,i,null),k(i,p),k(i,g),k(i,w),k(i,V),E&&E.m(V,null),k(e,j),k(e,R),oe(G,R,null),k(R,M),k(R,q),k(R,L),k(R,z),I&&I.m(z,null),k(e,A),H=!0,c||(d=[Ee(e,"mouseenter",S),Ee(e,"mouseleave",n[11])],c=!0)},p(C,u){n=C;const v={};u&4&&(v.active=n[2]===n[16]),t.$set(v),n[2]!==n[16]?$||($=El(),$.c(),$.m(f,null)):$&&($.d(1),$=null);const b={};u&4&&(b.active=n[2]===n[16]),h.$set(b),n[2]!==n[16]?E||(E=Il(),E.c(),E.m(V,null)):E&&(E.d(1),E=null);const _={};u&4&&(_.active=n[2]===n[16]),G.$set(_),n[2]!==n[16]?I||(I=Cl(),I.c(),I.m(z,null)):I&&(I.d(1),I=null),(!H||u&32)&&le(e,"last",n[16]===n[5].length-1)},i(C){H||(F(t.$$.fragment,C),F(h.$$.fragment,C),F(G.$$.fragment,C),H=!0)},o(C){Q(t.$$.fragment,C),Q(h.$$.fragment,C),Q(G.$$.fragment,C),H=!1},d(C){C&&y(e),se(t),$&&$.d(),se(h),E&&E.d(),se(G),I&&I.d(),c=!1,Ze(d)}}}function Dl(n){let e,l,t=n[14]+"",r,o,s,f;return{c(){e=B("div"),l=B("span"),r=ie(t),o=U(),s=B("div"),f=U(),this.h()},l(a){e=P(a,"DIV",{class:!0});var i=T(e);l=P(i,"SPAN",{class:!0});var h=T(l);r=ae(h,t),h.forEach(y),o=W(i),s=P(i,"DIV",{class:!0}),T(s).forEach(y),f=W(i),i.forEach(y),this.h()},h(){m(l,"class","label float svelte-hribb5"),m(s,"class",de(`vector x1-12  ${zn}`)+" svelte-hribb5"),m(e,"class","head1 cell x1-12 text-xs"),le(e,"last",n[16]===n[5].length-1)},m(a,i){Z(a,e,i),k(e,l),k(l,r),k(e,o),k(e,s),k(e,f)},p(a,i){i&32&&t!==(t=a[14]+"")&&Ae(r,t),i&32&&le(e,"last",a[16]===a[5].length-1)},d(a){a&&y(e)}}}function ql(n){let e,l,t=n[14]+"",r,o,s,f,a;return{c(){e=B("div"),l=B("span"),r=ie(t),o=U(),s=B("div"),f=U(),this.h()},l(i){e=P(i,"DIV",{class:!0});var h=T(e);l=P(h,"SPAN",{class:!0});var p=T(l);r=ae(p,t),p.forEach(y),o=W(h),s=P(h,"DIV",{class:!0}),T(s).forEach(y),f=W(h),h.forEach(y),this.h()},h(){m(l,"class","label float svelte-hribb5"),m(s,"class",de(`vector x1-12 ${On}`)+" svelte-hribb5"),m(e,"class",a="head1 cell x1-12 text-xs class:last="+(n[16]===n[5].length-1)+" svelte-hribb5")},m(i,h){Z(i,e,h),k(e,l),k(l,r),k(e,o),k(e,s),k(e,f)},p(i,h){h&32&&t!==(t=i[14]+"")&&Ae(r,t),h&32&&a!==(a="head1 cell x1-12 text-xs class:last="+(i[16]===i[5].length-1)+" svelte-hribb5")&&m(e,"class",a)},d(i){i&&y(e)}}}function Vl(n){let e,l,t=n[14]+"",r,o,s,f;return{c(){e=B("div"),l=B("span"),r=ie(t),o=U(),s=B("div"),f=U(),this.h()},l(a){e=P(a,"DIV",{class:!0});var i=T(e);l=P(i,"SPAN",{class:!0});var h=T(l);r=ae(h,t),h.forEach(y),o=W(i),s=P(i,"DIV",{class:!0}),T(s).forEach(y),f=W(i),i.forEach(y),this.h()},h(){m(l,"class","label float svelte-hribb5"),m(s,"class",de(`vector x1-12 ${Gn}`)+" svelte-hribb5"),m(e,"class","head1 cell x1-12 text-xs"),le(e,"last",n[16]===n[5].length-1)},m(a,i){Z(a,e,i),k(e,l),k(l,r),k(e,o),k(e,s),k(e,f)},p(a,i){i&32&&t!==(t=a[14]+"")&&Ae(r,t),i&32&&le(e,"last",a[16]===a[5].length-1)},d(a){a&&y(e)}}}function Al(n){let e,l,t;return{c(){e=B("div"),l=B("div"),t=U(),this.h()},l(r){e=P(r,"DIV",{class:!0});var o=T(e);l=P(o,"DIV",{class:!0}),T(l).forEach(y),t=W(o),o.forEach(y),this.h()},h(){m(l,"class",de(`vector x1-12 ${Qr}`)+" svelte-hribb5"),m(e,"class","head1 cell x1-12"),le(e,"last",n[16]===n[5].length-1)},m(r,o){Z(r,e,o),k(e,l),k(e,t)},p(r,o){o&32&&le(e,"last",r[16]===r[5].length-1)},d(r){r&&y(e)}}}function Wr(n){let e,l,t,r,o="Query",s,f,a,i,h="Key",p,g,w,V,j="Value",R,G,M,q,L,z,A,H,c="Out",d,$,E,I,S=n[4].attention_head_num+"",C,u,v,b=be(n[5]),_=[];for(let X=0;X<b.length;X+=1)_[X]=Dl(wl(n,b,X));let N=be(n[5]),D=[];for(let X=0;X<N.length;X+=1)D[X]=ql(yl(n,N,X));let O=be(n[5]),Y=[];for(let X=0;X<O.length;X+=1)Y[X]=Vl($l(n,O,X));q=new Hr({});let te=be(n[5]),fe=[];for(let X=0;X<te.length;X+=1)fe[X]=Al(bl(n,te,X));return{c(){e=B("div"),l=B("div"),t=B("div"),r=B("div"),r.textContent=o,s=U();for(let X=0;X<_.length;X+=1)_[X].c();f=U(),a=B("div"),i=B("div"),i.textContent=h,p=U();for(let X=0;X<D.length;X+=1)D[X].c();g=U(),w=B("div"),V=B("div"),V.textContent=j,R=U();for(let X=0;X<Y.length;X+=1)Y[X].c();G=U(),M=B("div"),ne(q.$$.fragment),L=U(),z=B("div"),A=B("div"),H=B("div"),H.textContent=c,d=U();for(let X=0;X<fe.length;X+=1)fe[X].c();$=U(),E=B("div"),I=ie("Head 1 of "),C=ie(S),this.h()},l(X){e=P(X,"DIV",{class:!0,style:!0});var ue=T(e);l=P(ue,"DIV",{class:!0});var K=T(l);t=P(K,"DIV",{class:!0});var ve=T(t);r=P(ve,"DIV",{class:!0,"data-svelte-h":!0}),qe(r)!=="svelte-1a2739d"&&(r.textContent=o),s=W(ve);for(let $e=0;$e<_.length;$e+=1)_[$e].l(ve);ve.forEach(y),f=W(K),a=P(K,"DIV",{class:!0});var je=T(a);i=P(je,"DIV",{class:!0,"data-svelte-h":!0}),qe(i)!=="svelte-bmmhtu"&&(i.textContent=h),p=W(je);for(let $e=0;$e<D.length;$e+=1)D[$e].l(je);je.forEach(y),g=W(K),w=P(K,"DIV",{class:!0});var Te=T(w);V=P(Te,"DIV",{class:!0,"data-svelte-h":!0}),qe(V)!=="svelte-17pe084"&&(V.textContent=j),R=W(Te);for(let $e=0;$e<Y.length;$e+=1)Y[$e].l(Te);Te.forEach(y),K.forEach(y),G=W(ue),M=P(ue,"DIV",{class:!0});var ye=T(M);re(q.$$.fragment,ye),ye.forEach(y),L=W(ue),z=P(ue,"DIV",{class:!0});var He=T(z);A=P(He,"DIV",{class:!0});var Ve=T(A);H=P(Ve,"DIV",{class:!0,"data-svelte-h":!0}),qe(H)!=="svelte-68unf9"&&(H.textContent=c),d=W(Ve);for(let $e=0;$e<fe.length;$e+=1)fe[$e].l(Ve);Ve.forEach(y),He.forEach(y),$=W(ue),E=P(ue,"DIV",{class:!0});var me=T(E);I=ae(me,"Head 1 of "),C=ae(me,S),me.forEach(y),ue.forEach(y),this.h()},h(){m(r,"class","title svelte-hribb5"),m(t,"class","column query"),m(i,"class","title svelte-hribb5"),m(a,"class","column key"),m(V,"class","title svelte-hribb5"),m(w,"class","column value"),m(l,"class","qkv flex h-full flex-col justify-center gap-[5rem] pl-[6rem]"),m(M,"class","resize-watch attention-matrix flex"),m(H,"class","title svelte-hribb5"),m(A,"class","column out"),m(z,"class","head-out mx-[2rem]"),m(E,"class","head-title absolute bottom-2 right-3 text-right text-gray-400"),m(e,"class","head-block flex w-full items-center justify-between px-2"),m(e,"style",u=`height:${n[6]}px;`)},m(X,ue){Z(X,e,ue),k(e,l),k(l,t),k(t,r),k(t,s);for(let K=0;K<_.length;K+=1)_[K]&&_[K].m(t,null);k(l,f),k(l,a),k(a,i),k(a,p);for(let K=0;K<D.length;K+=1)D[K]&&D[K].m(a,null);k(l,g),k(l,w),k(w,V),k(w,R);for(let K=0;K<Y.length;K+=1)Y[K]&&Y[K].m(w,null);k(e,G),k(e,M),oe(q,M,null),k(e,L),k(e,z),k(z,A),k(A,H),k(A,d);for(let K=0;K<fe.length;K+=1)fe[K]&&fe[K].m(A,null);k(e,$),k(e,E),k(E,I),k(E,C),v=!0},p(X,ue){if(ue&32){b=be(X[5]);let K;for(K=0;K<b.length;K+=1){const ve=wl(X,b,K);_[K]?_[K].p(ve,ue):(_[K]=Dl(ve),_[K].c(),_[K].m(t,null))}for(;K<_.length;K+=1)_[K].d(1);_.length=b.length}if(ue&32){N=be(X[5]);let K;for(K=0;K<N.length;K+=1){const ve=yl(X,N,K);D[K]?D[K].p(ve,ue):(D[K]=ql(ve),D[K].c(),D[K].m(a,null))}for(;K<D.length;K+=1)D[K].d(1);D.length=N.length}if(ue&32){O=be(X[5]);let K;for(K=0;K<O.length;K+=1){const ve=$l(X,O,K);Y[K]?Y[K].p(ve,ue):(Y[K]=Vl(ve),Y[K].c(),Y[K].m(w,null))}for(;K<Y.length;K+=1)Y[K].d(1);Y.length=O.length}if(ue&32){te=be(X[5]);let K;for(K=0;K<te.length;K+=1){const ve=bl(X,te,K);fe[K]?fe[K].p(ve,ue):(fe[K]=Al(ve),fe[K].c(),fe[K].m(A,null))}for(;K<fe.length;K+=1)fe[K].d(1);fe.length=te.length}(!v||ue&16)&&S!==(S=X[4].attention_head_num+"")&&Ae(C,S),(!v||ue&64&&u!==(u=`height:${X[6]}px;`))&&m(e,"style",u)},i(X){v||(F(q.$$.fragment,X),v=!0)},o(X){Q(q.$$.fragment,X),v=!1},d(X){X&&y(e),Me(_,X),Me(D,X),Me(Y,X),se(q),Me(fe,X)}}}function Xr(n){let e,l,t="<div>Multi-head Self Attention</div>",r,o,s,f='<div class="bounding-title">Transformer Block 1</div>',a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H,c,d,$,E,I,S;w=new et({props:{triggeredBy:".attention .qkv-weighted",placement:"right",class:"popover text-sm font-light",$$slots:{default:[Gr]},$$scope:{ctx:n}}}),j=new et({props:{triggeredBy:".attention .query .head1",placement:"right",class:"popover text-sm font-light",$$slots:{default:[Rr]},$$scope:{ctx:n}}}),G=new et({props:{triggeredBy:".attention .key .head1",placement:"right",class:"popover text-sm font-light",$$slots:{default:[Fr]},$$scope:{ctx:n}}}),q=new et({props:{triggeredBy:".attention .value .head1",placement:"right",class:"popover text-sm font-light",$$slots:{default:[Ur]},$$scope:{ctx:n}}}),z=new et({props:{triggeredBy:".attention .out .head1",placement:"right",class:"popover text-sm font-light",$$slots:{default:[xr]},$$scope:{ctx:n}}});let C=be(n[5]),u=[];for(let b=0;b<C.length;b+=1)u[b]=Sl(kl(n,C,b));const v=b=>Q(u[b],1,1,()=>{u[b]=null});return d=new Ar({props:{$$slots:{default:[Wr]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),o=B("div"),s=B("div"),s.innerHTML=f,a=U(),i=B("div"),p=U(),g=B("div"),ne(w.$$.fragment),V=U(),ne(j.$$.fragment),R=U(),ne(G.$$.fragment),M=U(),ne(q.$$.fragment),L=U(),ne(z.$$.fragment),A=U();for(let b=0;b<u.length;b+=1)u[b].c();H=U(),c=B("div"),ne(d.$$.fragment),this.h()},l(b){e=P(b,"DIV",{class:!0});var _=T(e);l=P(_,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),qe(l)!=="svelte-n6swon"&&(l.innerHTML=t),r=W(_),o=P(_,"DIV",{class:!0});var N=T(o);s=P(N,"DIV",{class:!0,"data-svelte-h":!0}),qe(s)!=="svelte-vte4ua"&&(s.innerHTML=f),a=W(N),i=P(N,"DIV",{class:!0,style:!0}),T(i).forEach(y),p=W(N),g=P(N,"DIV",{class:!0});var D=T(g);re(w.$$.fragment,D),V=W(D),re(j.$$.fragment,D),R=W(D),re(G.$$.fragment,D),M=W(D),re(q.$$.fragment,D),L=W(D),re(z.$$.fragment,D),A=W(D);for(let Y=0;Y<u.length;Y+=1)u[Y].l(D);D.forEach(y),H=W(N),c=P(N,"DIV",{class:!0});var O=T(c);re(d.$$.fragment,O),O.forEach(y),N.forEach(y),_.forEach(y),this.h()},h(){m(l,"class","title svelte-hribb5"),m(l,"role","group"),m(s,"class","bounding transformer-bounding svelte-hribb5"),le(s,"active",n[3]),m(i,"class","bounding attention-bounding svelte-hribb5"),m(i,"style",h=`padding-bottom:${n[4].attention_head_num*yt.y}px`),le(i,"active",n[1]&&!n[7]),m(g,"class","column"),m(c,"class","heads svelte-hribb5"),m(o,"class","content relative svelte-hribb5"),m(e,"class",$=de(ce("attention",n[0]))+" svelte-hribb5")},m(b,_){Z(b,e,_),k(e,l),k(e,r),k(e,o),k(o,s),k(o,a),k(o,i),k(o,p),k(o,g),oe(w,g,null),k(g,V),oe(j,g,null),k(g,R),oe(G,g,null),k(g,M),oe(q,g,null),k(g,L),oe(z,g,null),k(g,A);for(let N=0;N<u.length;N+=1)u[N]&&u[N].m(g,null);k(o,H),k(o,c),oe(d,c,null),E=!0,I||(S=[Ee(l,"mouseenter",n[8]),Ee(l,"mouseleave",n[9])],I=!0)},p(b,[_]){(!E||_&8)&&le(s,"active",b[3]),(!E||_&16&&h!==(h=`padding-bottom:${b[4].attention_head_num*yt.y}px`))&&m(i,"style",h),(!E||_&130)&&le(i,"active",b[1]&&!b[7]);const N={};_&2097168&&(N.$$scope={dirty:_,ctx:b}),w.$set(N);const D={};_&2097168&&(D.$$scope={dirty:_,ctx:b}),j.$set(D);const O={};_&2097168&&(O.$$scope={dirty:_,ctx:b}),G.$set(O);const Y={};_&2097168&&(Y.$$scope={dirty:_,ctx:b}),q.$set(Y);const te={};if(_&2097168&&(te.$$scope={dirty:_,ctx:b}),z.$set(te),_&36){C=be(b[5]);let X;for(X=0;X<C.length;X+=1){const ue=kl(b,C,X);u[X]?(u[X].p(ue,_),F(u[X],1)):(u[X]=Sl(ue),u[X].c(),F(u[X],1),u[X].m(g,null))}for(Be(),X=C.length;X<u.length;X+=1)v(X);Pe()}const fe={};_&2097264&&(fe.$$scope={dirty:_,ctx:b}),d.$set(fe),(!E||_&1&&$!==($=de(ce("attention",b[0]))+" svelte-hribb5"))&&m(e,"class",$)},i(b){if(!E){F(w.$$.fragment,b),F(j.$$.fragment,b),F(G.$$.fragment,b),F(q.$$.fragment,b),F(z.$$.fragment,b);for(let _=0;_<C.length;_+=1)F(u[_]);F(d.$$.fragment,b),E=!0}},o(b){Q(w.$$.fragment,b),Q(j.$$.fragment,b),Q(G.$$.fragment,b),Q(q.$$.fragment,b),Q(z.$$.fragment,b),u=u.filter(Boolean);for(let _=0;_<u.length;_+=1)Q(u[_]);Q(d.$$.fragment,b),E=!1},d(b){b&&y(e),se(w),se(j),se(G),se(q),se(z),Me(u,b),se(d),I=!1,Ze(S)}}}const Zr="bg-blue-200",Yr="bg-red-200",Kr="bg-green-200",zn="bg-blue-300",On="bg-red-300",Gn="bg-green-300",Qr="bg-purple-300";function Jr(n,e,l){let t,r,o,s,f;Ce(n,at,G=>l(12,t=G)),Ce(n,jt,G=>l(3,r=G)),Ce(n,Mt,G=>l(4,o=G)),Ce(n,mt,G=>l(5,s=G)),Ce(n,Mn,G=>l(6,f=G));let{className:a=void 0}=e;Yt("block-id","attention");const i=Zt("block-id");let h=t.id===i,p=!1;function g(){l(1,p=!0)}function w(){l(1,p=!1)}let V=null;const j=G=>{l(2,V=G)},R=()=>{l(2,V=null)};return n.$$set=G=>{"className"in G&&l(0,a=G.className)},[a,p,V,r,o,s,f,h,g,w,j,R]}class eo extends Re{constructor(e){super(),Fe(this,e,Jr,Xr,Ge,{className:0})}}function to(n){let e,l,t,r,o,s,f,a=n[3]&&Nl(n);return{c(){e=B("div"),l=B("div"),t=U(),r=Se("svg"),a&&a.c(),o=Se("path"),this.h()},l(i){e=P(i,"DIV",{class:!0});var h=T(e);l=P(h,"DIV",{class:!0}),T(l).forEach(y),t=W(h),r=De(h,"svg",{class:!0});var p=T(r);a&&a.l(p),o=De(p,"path",{d:!0,class:!0}),T(o).forEach(y),p.forEach(y),h.forEach(y),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(o,"d",s=`M0,0 L0,${n[6]}`),m(o,"class","svelte-1jqlo12"),m(r,"class","main svelte-1jqlo12"),m(e,"class",f=de(ce("residual residual-end cell",n[1]))+" svelte-1jqlo12"),le(e,"active",n[5])},m(i,h){Z(i,e,h),k(e,l),k(e,t),k(e,r),a&&a.m(r,null),k(r,o)},p(i,h){i[3]?a?a.p(i,h):(a=Nl(i),a.c(),a.m(r,o)):a&&(a.d(1),a=null),h&64&&s!==(s=`M0,0 L0,${i[6]}`)&&m(o,"d",s),h&2&&f!==(f=de(ce("residual residual-end cell",i[1]))+" svelte-1jqlo12")&&m(e,"class",f),h&34&&le(e,"active",i[5])},d(i){i&&y(e),a&&a.d()}}}function lo(n){let e,l,t,r,o,s,f,a=n[3]&&Ml(n);return{c(){e=B("div"),l=B("div"),t=U(),r=Se("svg"),a&&a.c(),o=Se("path"),this.h()},l(i){e=P(i,"DIV",{class:!0});var h=T(e);l=P(h,"DIV",{class:!0}),T(l).forEach(y),t=W(h),r=De(h,"svg",{class:!0});var p=T(r);a&&a.l(p),o=De(p,"path",{d:!0,class:!0}),T(o).forEach(y),p.forEach(y),h.forEach(y),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(o,"d",s=`M0,0 L0,${n[6]}`),m(o,"class","svelte-1jqlo12"),m(r,"class","main svelte-1jqlo12"),m(e,"class",f=de(ce("residual residual-start cell",n[1]))+" svelte-1jqlo12"),le(e,"active",n[5])},m(i,h){Z(i,e,h),k(e,l),k(e,t),k(e,r),a&&a.m(r,null),k(r,o)},p(i,h){i[3]?a?a.p(i,h):(a=Ml(i),a.c(),a.m(r,o)):a&&(a.d(1),a=null),h&64&&s!==(s=`M0,0 L0,${i[6]}`)&&m(o,"d",s),h&2&&f!==(f=de(ce("residual residual-start cell",i[1]))+" svelte-1jqlo12")&&m(e,"class",f),h&34&&le(e,"active",i[5])},d(i){i&&y(e),a&&a.d()}}}function no(n){let e,l,t,r,o,s,f,a,i,h=n[4]&&Ll();return{c(){e=B("div"),l=B("div"),t=U(),r=Se("svg"),o=Se("circle"),s=Se("path"),a=U(),h&&h.c(),this.h()},l(p){e=P(p,"DIV",{class:!0});var g=T(e);l=P(g,"DIV",{class:!0}),T(l).forEach(y),t=W(g),r=De(g,"svg",{class:!0});var w=T(r);o=De(w,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(o).forEach(y),s=De(w,"path",{class:!0,d:!0}),T(s).forEach(y),w.forEach(y),a=W(g),h&&h.l(g),g.forEach(y),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(o,"class","icon svelte-1jqlo12"),m(o,"cx","50%"),m(o,"cy","50%"),m(o,"r","3"),m(s,"class","line svelte-1jqlo12"),m(s,"d",f=`
     M 0 0
    C 0 ${n[6]*.25}, ${n[6]*.2} ${n[6]*.25}, ${n[6]*.2} ${n[6]*.5}
    C ${n[6]*.2} ${n[6]*.75}, 0 ${n[6]*.75}, 0 ${n[6]}
  `),m(r,"class","main svelte-1jqlo12"),m(e,"class",i=de(ce("cell ln",n[1]))+" svelte-1jqlo12"),le(e,"active",n[5])},m(p,g){Z(p,e,g),k(e,l),k(e,t),k(e,r),k(r,o),k(r,s),k(e,a),h&&h.m(e,null)},p(p,g){g&64&&f!==(f=`
     M 0 0
    C 0 ${p[6]*.25}, ${p[6]*.2} ${p[6]*.25}, ${p[6]*.2} ${p[6]*.5}
    C ${p[6]*.2} ${p[6]*.75}, 0 ${p[6]*.75}, 0 ${p[6]}
  `)&&m(s,"d",f),p[4]?h||(h=Ll(),h.c(),h.m(e,null)):h&&(h.d(1),h=null),g&2&&i!==(i=de(ce("cell ln",p[1]))+" svelte-1jqlo12")&&m(e,"class",i),g&34&&le(e,"active",p[5])},d(p){p&&y(e),h&&h.d()}}}function ro(n){let e,l,t,r,o,s,f,a,i,h=n[4]&&Bl();return{c(){e=B("div"),l=B("div"),t=U(),r=Se("svg"),o=Se("path"),f=Se("circle"),a=U(),h&&h.c(),this.h()},l(p){e=P(p,"DIV",{class:!0});var g=T(e);l=P(g,"DIV",{class:!0}),T(l).forEach(y),t=W(g),r=De(g,"svg",{class:!0});var w=T(r);o=De(w,"path",{class:!0,d:!0}),T(o).forEach(y),f=De(w,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(f).forEach(y),w.forEach(y),a=W(g),h&&h.l(g),g.forEach(y),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(o,"class","line svelte-1jqlo12"),m(o,"d",s=`M0,0 L0,${n[6]}`),m(f,"class","icon svelte-1jqlo12"),m(f,"cx","50%"),m(f,"cy","50%"),m(f,"r","3"),m(r,"class","main svelte-1jqlo12"),m(e,"class",i=de(ce("cell dropout",n[1]))+" svelte-1jqlo12"),le(e,"active",n[5])},m(p,g){Z(p,e,g),k(e,l),k(e,t),k(e,r),k(r,o),k(r,f),k(e,a),h&&h.m(e,null)},p(p,g){g&64&&s!==(s=`M0,0 L0,${p[6]}`)&&m(o,"d",s),p[4]?h||(h=Bl(),h.c(),h.m(e,null)):h&&(h.d(1),h=null),g&2&&i!==(i=de(ce("cell dropout",p[1]))+" svelte-1jqlo12")&&m(e,"class",i),g&34&&le(e,"active",p[5])},d(p){p&&y(e),h&&h.d()}}}function oo(n){let e,l,t,r,o,s,f;return{c(){e=B("div"),l=B("div"),t=U(),r=Se("svg"),o=Se("path"),s=Se("circle"),this.h()},l(a){e=P(a,"DIV",{class:!0});var i=T(e);l=P(i,"DIV",{class:!0}),T(l).forEach(y),t=W(i),r=De(i,"svg",{class:!0});var h=T(r);o=De(h,"path",{class:!0,d:!0}),T(o).forEach(y),s=De(h,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(s).forEach(y),h.forEach(y),i.forEach(y),this.h()},h(){m(l,"class","cursor svelte-1jqlo12"),m(o,"class","line line1 svelte-1jqlo12"),m(o,"d","M0,0 L0,90%"),m(s,"class","icon svelte-1jqlo12"),m(s,"cx","50%"),m(s,"cy","50%"),m(s,"r","3"),m(r,"class","main svelte-1jqlo12"),m(e,"class",f=de(ce("cell activation",n[1]))+" svelte-1jqlo12"),le(e,"active",n[5])},m(a,i){Z(a,e,i),k(e,l),k(e,t),k(e,r),k(r,o),k(r,s)},p(a,i){i&2&&f!==(f=de(ce("cell activation",a[1]))+" svelte-1jqlo12")&&m(e,"class",f),i&34&&le(e,"active",a[5])},d(a){a&&y(e)}}}function Nl(n){let e;return{c(){e=Se("path"),this.h()},l(l){e=De(l,"path",{id:!0,class:!0,d:!0}),T(e).forEach(y),this.h()},h(){m(e,"id",n[0]),m(e,"class","head svelte-1jqlo12"),m(e,"d","M0,0 Q0,-16 -30,-16")},m(l,t){Z(l,e,t)},p(l,t){t&1&&m(e,"id",l[0])},d(l){l&&y(e)}}}function Ml(n){let e,l,t;return{c(){e=Se("path"),l=Se("text"),t=ie("Residual"),this.h()},l(r){e=De(r,"path",{id:!0,class:!0,d:!0}),T(e).forEach(y),l=De(r,"text",{x:!0,y:!0,dy:!0,dx:!0,class:!0});var o=T(l);t=ae(o,"Residual"),o.forEach(y),this.h()},h(){m(e,"id",n[0]),m(e,"class","head svelte-1jqlo12"),m(e,"d","M0,0 Q0,-16 30,-16"),m(l,"x","30"),m(l,"y","-26"),m(l,"dy","4"),m(l,"dx","4"),m(l,"class","svelte-1jqlo12")},m(r,o){Z(r,e,o),Z(r,l,o),k(l,t)},p(r,o){o&1&&m(e,"id",r[0])},d(r){r&&(y(e),y(l))}}}function Ll(n){let e,l,t,r;return{c(){e=Se("svg"),l=Se("path"),t=Se("text"),r=ie("Layer Normalization"),this.h()},l(o){e=De(o,"svg",{class:!0,width:!0});var s=T(e);l=De(s,"path",{d:!0,class:!0}),T(l).forEach(y),t=De(s,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var f=T(t);r=ae(f,"Layer Normalization"),f.forEach(y),s.forEach(y),this.h()},h(){m(l,"d","M27.3536 4.35355C27.5488 4.15829 27.5488 3.84171 27.3536 3.64645L24.1716 0.46447C23.9763 0.269208 23.6597 0.269208 23.4645 0.464471C23.2692 0.659733 23.2692 0.976316 23.4645 1.17158L26.2929 4L23.4645 6.82843C23.2692 7.02369 23.2692 7.34028 23.4645 7.53554C23.6597 7.7308 23.9763 7.7308 24.1716 7.53554L27.3536 4.35355ZM27 3.5C20.3125 3.50001 15.2969 6.63952 11.5638 11.7944C7.84616 16.9278 5.39057 24.0677 3.75991 32.1346C0.498061 48.2711 0.5 68.3247 0.5 84H1.5C1.5 68.2984 1.50194 48.352 4.74009 32.3328C6.35943 24.3218 8.77884 17.3448 12.3737 12.3809C15.9531 7.4384 20.6875 4.50001 27 4.5V3.5Z"),m(l,"class","svelte-1jqlo12"),m(t,"x","4"),m(t,"y","95"),m(t,"text-anchor","middle"),m(t,"class","svelte-1jqlo12"),m(e,"class","guide svelte-1jqlo12"),m(e,"width","27px"),le(e,"active",!1)},m(o,s){Z(o,e,s),k(e,l),k(e,t),k(t,r)},d(o){o&&y(e)}}}function Bl(n){let e,l,t,r;return{c(){e=Se("svg"),l=Se("path"),t=Se("text"),r=ie("Dropout"),this.h()},l(o){e=De(o,"svg",{class:!0,width:!0});var s=T(e);l=De(s,"path",{d:!0,class:!0}),T(l).forEach(y),t=De(s,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var f=T(t);r=ae(f,"Dropout"),f.forEach(y),s.forEach(y),this.h()},h(){m(l,"d","M44.3186 4.46399C44.5314 4.28801 44.5613 3.97284 44.3853 3.76004L41.5175 0.292199C41.3416 0.0793953 41.0264 0.0495441 40.8136 0.225525C40.6008 0.401505 40.5709 0.716677 40.7469 0.929481L43.296 4.012L40.2135 6.56113C40.0007 6.73711 39.9709 7.05228 40.1468 7.26509C40.3228 7.47789 40.638 7.50774 40.8508 7.33176L44.3186 4.46399ZM44.0471 3.58091C38.7621 3.08034 27.8926 4.80481 18.3357 11.5838C8.74613 18.386 0.5 30.2626 0.5 50H1.5C1.5 30.5889 9.58721 19.0154 18.9143 12.3994C28.2741 5.76023 38.9045 4.0983 43.9529 4.57645L44.0471 3.58091Z"),m(l,"class","svelte-1jqlo12"),m(t,"x","4"),m(t,"y","60"),m(t,"text-anchor","middle"),m(t,"class","svelte-1jqlo12"),m(e,"class","guide svelte-1jqlo12"),m(e,"width","44px"),le(e,"active",!1)},m(o,s){Z(o,e,s),k(e,l),k(e,t),k(t,r)},d(o){o&&y(e)}}}function so(n){let e;function l(o,s){if(o[2]==="activation")return oo;if(o[2]==="dropout")return ro;if(o[2]==="ln")return no;if(o[2]==="residual-start")return lo;if(o[2]==="residual-end")return to}let t=l(n),r=t&&t(n);return{c(){r&&r.c(),e=pt()},l(o){r&&r.l(o),e=pt()},m(o,s){r&&r.m(o,s),Z(o,e,s)},p(o,[s]){t===(t=l(o))&&r?r.p(o,s):(r&&r.d(1),r=t&&t(o),r&&(r.c(),r.m(e.parentNode,e)))},i:Oe,o:Oe,d(o){o&&y(e),r&&r.d(o)}}}function io(n,e,l){let t;Ce(n,Xt,h=>l(6,t=h));let{id:r=void 0}=e,{className:o=void 0}=e,{type:s=void 0}=e,{head:f=!1}=e,{tail:a=!1}=e,{active:i=!1}=e;return n.$$set=h=>{"id"in h&&l(0,r=h.id),"className"in h&&l(1,o=h.className),"type"in h&&l(2,s=h.type),"head"in h&&l(3,f=h.head),"tail"in h&&l(4,a=h.tail),"active"in h&&l(5,i=h.active)},[r,o,s,f,a,i,t]}class Ot extends Re{constructor(e){super(),Fe(this,e,io,so,Ge,{id:0,className:1,type:2,head:3,tail:4,active:5})}}function Pl(n,e,l){const t=n.slice();return t[6]=e[l],t[8]=l,t}function ao(n){let e,l=n[1].dimension+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&2&&l!==(l=o[1].dimension+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Tl(n){let e,l=n[6]+"",t;return{c(){e=B("span"),t=ie(l),this.h()},l(r){e=P(r,"SPAN",{class:!0});var o=T(e);t=ae(o,l),o.forEach(y),this.h()},h(){m(e,"class","label float svelte-1wjygpv")},m(r,o){Z(r,e,o),k(e,t)},p(r,o){o&8&&l!==(l=r[6]+"")&&Ae(t,l)},d(r){r&&y(e)}}}function Hl(n){let e,l,t,r,o,s,f;t=new dt({props:{colorScale:"blue"}});let a=n[8]===n[3].length-1&&Tl(n);return{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),o=U(),a&&a.c(),s=U(),this.h()},l(i){e=P(i,"DIV",{class:!0});var h=T(e);l=P(h,"DIV",{class:!0});var p=T(l);re(t.$$.fragment,p),p.forEach(y),o=W(h),a&&a.l(h),s=W(h),h.forEach(y),this.h()},h(){m(l,"class",r=de(ce("vector shrink-0 bg-blue-200",{"last-token":n[8]===n[3].length-1}))+" svelte-1wjygpv"),m(e,"class","cell svelte-1wjygpv"),le(e,"last",n[8]===n[3].length-1)},m(i,h){Z(i,e,h),k(e,l),oe(t,l,null),k(e,o),a&&a.m(e,null),k(e,s),f=!0},p(i,h){(!f||h&8&&r!==(r=de(ce("vector shrink-0 bg-blue-200",{"last-token":i[8]===i[3].length-1}))+" svelte-1wjygpv"))&&m(l,"class",r),i[8]===i[3].length-1?a?a.p(i,h):(a=Tl(i),a.c(),a.m(e,s)):a&&(a.d(1),a=null),(!f||h&8)&&le(e,"last",i[8]===i[3].length-1)},i(i){f||(F(t.$$.fragment,i),f=!0)},o(i){Q(t.$$.fragment,i),f=!1},d(i){i&&y(e),se(t),a&&a.d()}}}function co(n){let e,l,t,r,o,s,f,a,i,h=n[1].layer_num-1+"",p,g,w,V,j="Transformer<br/>Blocks",R,G,M,q,L,z,A,H,c="",d,$,E,I;o=new et({props:{triggeredBy:".transformer-blocks .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[ao]},$$scope:{ctx:n}}});let S=be(n[3]),C=[];for(let v=0;v<S.length;v+=1)C[v]=Hl(Pl(n,S,v));const u=v=>Q(C[v],1,1,()=>{C[v]=null});return{c(){e=B("div"),l=B("div"),t=U(),r=B("div"),ne(o.$$.fragment),s=U(),f=B("div"),a=B("div"),i=B("div"),p=ie(h),g=ie(" more"),w=B("br"),V=B("span"),V.innerHTML=j,R=B("br"),G=ie("go here."),M=U(),q=Se("svg"),L=Se("path"),z=U();for(let v=0;v<C.length;v+=1)C[v].c();A=U(),H=B("div"),H.innerHTML=c,this.h()},l(v){e=P(v,"DIV",{class:!0,role:!0});var b=T(e);l=P(b,"DIV",{class:!0}),T(l).forEach(y),t=W(b),r=P(b,"DIV",{class:!0});var _=T(r);re(o.$$.fragment,_),s=W(_),f=P(_,"DIV",{class:!0});var N=T(f);a=P(N,"DIV",{class:!0});var D=T(a);i=P(D,"DIV",{class:!0});var O=T(i);p=ae(O,h),g=ae(O," more"),w=P(O,"BR",{}),V=P(O,"SPAN",{class:!0,"data-svelte-h":!0}),qe(V)!=="svelte-jj13a6"&&(V.innerHTML=j),R=P(O,"BR",{}),G=ae(O,"go here."),O.forEach(y),M=W(D),q=De(D,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var Y=T(q);L=De(Y,"path",{d:!0,fill:!0}),T(L).forEach(y),Y.forEach(y),D.forEach(y),z=W(N);for(let te=0;te<C.length;te+=1)C[te].l(N);N.forEach(y),A=W(_),H=P(_,"DIV",{class:!0,"data-svelte-h":!0}),qe(H)!=="svelte-shkdve"&&(H.innerHTML=c),_.forEach(y),b.forEach(y),this.h()},h(){m(l,"class","title"),m(V,"class","highlight svelte-1wjygpv"),m(i,"class","text svelte-1wjygpv"),le(i,"active",n[2]),m(L,"d","M1.18221 4.58047C1.23103 4.62928 1.31017 4.62928 1.35899 4.58047L2.15448 3.78497C2.2033 3.73616 2.2033 3.65701 2.15448 3.6082C2.10567 3.55938 2.02652 3.55938 1.97771 3.6082L1.2706 4.3153L0.563493 3.6082C0.514677 3.55938 0.435531 3.55938 0.386716 3.6082C0.3379 3.65701 0.3379 3.73616 0.386716 3.78497L1.18221 4.58047ZM1.1456 0.285461V4.49208H1.3956V0.285461H1.1456Z"),m(L,"fill","currentColor"),m(q,"xmlns","http://www.w3.org/2000/svg"),m(q,"class","h-6 w-6 text-gray-300"),m(q,"viewBox","0 0 3 5"),m(q,"fill","none"),m(a,"class","guide flex flex-col items-start gap-1 svelte-1wjygpv"),m(f,"class","column final relative svelte-1wjygpv"),m(H,"class","second-column svelte-1wjygpv"),m(r,"class","content svelte-1wjygpv"),m(e,"class",d=de(ce("transformer-blocks",n[0]))+" svelte-1wjygpv"),m(e,"role","group")},m(v,b){Z(v,e,b),k(e,l),k(e,t),k(e,r),oe(o,r,null),k(r,s),k(r,f),k(f,a),k(a,i),k(i,p),k(i,g),k(i,w),k(i,V),k(i,R),k(i,G),k(a,M),k(a,q),k(q,L),k(f,z);for(let _=0;_<C.length;_+=1)C[_]&&C[_].m(f,null);k(r,A),k(r,H),$=!0,E||(I=[Ee(e,"mouseenter",n[4]),Ee(e,"mouseleave",n[5])],E=!0)},p(v,[b]){const _={};if(b&514&&(_.$$scope={dirty:b,ctx:v}),o.$set(_),(!$||b&2)&&h!==(h=v[1].layer_num-1+"")&&Ae(p,h),(!$||b&4)&&le(i,"active",v[2]),b&8){S=be(v[3]);let N;for(N=0;N<S.length;N+=1){const D=Pl(v,S,N);C[N]?(C[N].p(D,b),F(C[N],1)):(C[N]=Hl(D),C[N].c(),F(C[N],1),C[N].m(f,null))}for(Be(),N=S.length;N<C.length;N+=1)u(N);Pe()}(!$||b&1&&d!==(d=de(ce("transformer-blocks",v[0]))+" svelte-1wjygpv"))&&m(e,"class",d)},i(v){if(!$){F(o.$$.fragment,v);for(let b=0;b<S.length;b+=1)F(C[b]);$=!0}},o(v){Q(o.$$.fragment,v),C=C.filter(Boolean);for(let b=0;b<C.length;b+=1)Q(C[b]);$=!1},d(v){v&&y(e),se(o),Me(C,v),E=!1,Ze(I)}}}function fo(n,e,l){let t,r,o;Ce(n,Mt,i=>l(1,t=i)),Ce(n,jt,i=>l(2,r=i)),Ce(n,mt,i=>l(3,o=i));let{className:s=void 0}=e;const f=()=>{jt.set(!0)},a=()=>{jt.set(!1)};return n.$$set=i=>{"className"in i&&l(0,s=i.className)},[s,t,r,o,f,a]}class uo extends Re{constructor(e){super(),Fe(this,e,fo,co,Ge,{className:0})}}function ho(n){let e,l,t,r;return{c(){e=B("div"),l=Se("svg"),t=Se("g"),r=Se("g"),this.h()},l(o){e=P(o,"DIV",{class:!0});var s=T(e);l=De(s,"svg",{class:!0});var f=T(l);t=De(f,"g",{class:!0}),T(t).forEach(y),r=De(f,"g",{class:!0}),T(r).forEach(y),f.forEach(y),s.forEach(y),this.h()},h(){m(t,"class","bars"),m(r,"class","bar-labels"),m(l,"class","h-full w-full"),m(e,"class","content-box probability grow svelte-8s3yoj")},m(o,s){Z(o,e,s),k(e,l),k(l,t),k(l,r),n[5](l)},p:Oe,i:Oe,o:Oe,d(o){o&&y(e),n[5](null)}}}const jl=4;let po=1;function go(n,e,l){let t,r;Ce(n,Kt,j=>l(6,t=j)),Ce(n,Lt,j=>l(4,r=j));const{theme:o}=kt(Et);let{rowHeight:s}=e,{rowGap:f}=e,{hoveredIndex:a=null}=e,i,h=o.colors.gray[300],p=o.colors.blue[500],g=()=>{const j=r==null?void 0:r.prediction,R=r==null?void 0:r.sampled,G=lt(i);let M=il().domain([0,br(j,q=>q.adjustedProbability)]).range([0,(i==null?void 0:i.clientWidth)-At*3]);G.select("g.bars").selectAll("rect").data(j).join("rect").attr("x",0).attr("y",(q,L)=>L*s+L*f+s/2-jl/2).attr("height",jl).attr("width",q=>M(q.adjustedProbability)).attr("rx",1).attr("ry",1).attr("fill",(q,L)=>L===a?p:(R==null?void 0:R.rank)===L?Ft:h).on("mouseenter",function(q,L){l(1,a=L.rank),lt(this).style("cursor","pointer")}).on("mouseleave",()=>l(1,a=null)).transition().ease(nr).duration(500).attr("width",q=>M(q.adjustedProbability)),G.select("g.bar-labels").selectAll("text").data(j).join("text").attr("fill",(q,L)=>L===a?p:(R==null?void 0:R.rank)===L?Ft:h).on("mouseenter",function(q,L){l(1,a=L.rank),lt(this).style("cursor","pointer")}).on("mouseleave",()=>{l(1,a=null)}).attr("x",q=>.4*At+M(q.adjustedProbability)).attr("y",(q,L)=>L*s+L*f).attr("dy",s/2+3).attr("text-anchor","start").style("font-size","0.75rem").transition().duration(500).tween("text",function(q){const L=lt(this),z=rr(L.text().replace("%",""),q.adjustedProbability*100);return function(A){L.text(z(A).toFixed(po)+"%")}})};Nt(()=>{g()});const w=()=>{if(!i)return;const j=lt(i);j.selectAll("g.bars rect").attr("fill",(R,G)=>G===a?p:(t==null?void 0:t.rank)===G?Ft:h),j.selectAll("g.bar-labels text").attr("fill",(R,G)=>G===a?p:(t==null?void 0:t.rank)===G?Ft:h)};function V(j){ht[j?"unshift":"push"](()=>{i=j,l(0,i)})}return n.$$set=j=>{"rowHeight"in j&&l(2,s=j.rowHeight),"rowGap"in j&&l(3,f=j.rowGap),"hoveredIndex"in j&&l(1,a=j.hoveredIndex)},n.$$.update=()=>{n.$$.dirty&17&&r&&i&&g(),n.$$.dirty&2&&a!==void 0&&w()},[i,a,s,f,r,V]}class vo extends Re{constructor(e){super(),Fe(this,e,go,ho,Ge,{rowHeight:2,rowGap:3,hoveredIndex:1})}}function zl(n,e,l){const t=n.slice();return t[30]=e[l],t[32]=l,t}function Ol(n,e,l){const t=n.slice();return t[33]=e[l],t[32]=l,t}function Gl(n,e,l){const t=n.slice();return t[35]=e[l],t[32]=l,t}function mo(n){let e,l=n[7][n[32]]+"",t,r;return{c(){e=ie("Token ID: "),t=ie(l),r=U()},l(o){e=ae(o,"Token ID: "),t=ae(o,l),r=W(o)},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s[0]&128&&l!==(l=o[7][o[32]]+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Rl(n){let e,l=n[35].token+"",t,r,o,s,f,a;function i(){return n[18](n[32])}return o=new et({props:{class:"text-xs",placement:"left",type:"light",$$slots:{default:[mo]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ie(l),r=U(),ne(o.$$.fragment),this.h()},l(h){e=P(h,"DIV",{role:!0,class:!0});var p=T(e);t=ae(p,l),p.forEach(y),r=W(h),re(o.$$.fragment,h),this.h()},h(){var h;m(e,"role","group"),m(e,"class","text-box svelte-1q04ryr"),le(e,"highlight",n[32]===n[3]),le(e,"sample_highlight",n[8]===n[32]),le(e,"final_token_highlight",((h=n[9])==null?void 0:h.rank)===n[32])},m(h,p){Z(h,e,p),k(e,t),Z(h,r,p),oe(o,h,p),s=!0,f||(a=[Ee(e,"mouseenter",i),Ee(e,"mouseleave",n[19])],f=!0)},p(h,p){var w;n=h,(!s||p[0]&4)&&l!==(l=n[35].token+"")&&Ae(t,l),(!s||p[0]&8)&&le(e,"highlight",n[32]===n[3]),(!s||p[0]&256)&&le(e,"sample_highlight",n[8]===n[32]),(!s||p[0]&512)&&le(e,"final_token_highlight",((w=n[9])==null?void 0:w.rank)===n[32]);const g={};p[0]&128|p[1]&64&&(g.$$scope={dirty:p,ctx:n}),o.$set(g)},i(h){s||(F(o.$$.fragment,h),s=!0)},o(h){Q(o.$$.fragment,h),s=!1},d(h){h&&(y(e),y(r)),se(o,h),f=!1,Ze(a)}}}function Fl(n){let e,l='<div class="title-box token-string !justify-end svelte-1q04ryr"><div class="title-text svelte-1q04ryr">Tokens</div></div> <div class="title-box logits svelte-1q04ryr"><div class="title-text svelte-1q04ryr">Logits</div></div> <div class="title-box exponents svelte-1q04ryr"><div class="title-text svelte-1q04ryr">Exponents</div></div> <div class="title-box probability svelte-1q04ryr"><div class="title-text svelte-1q04ryr">Probability</div></div>';return{c(){e=B("div"),e.innerHTML=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-16l107t"&&(e.innerHTML=l),this.h()},h(){m(e,"class","softmax-subtitle softmax-detail flex text-center text-xs opacity-0 svelte-1q04ryr")},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function Ul(n){let e,l,t,r,o=be(n[6]),s=[];for(let p=0;p<o.length;p+=1)s[p]=Wl(Ol(n,o,p));const f=p=>Q(s[p],1,1,()=>{s[p]=null});let a=be(n[5]),i=[];for(let p=0;p<a.length;p+=1)i[p]=Xl(zl(n,a,p));const h=p=>Q(i[p],1,1,()=>{i[p]=null});return{c(){e=B("div");for(let p=0;p<s.length;p+=1)s[p].c();l=U(),t=B("div");for(let p=0;p<i.length;p+=1)i[p].c();this.h()},l(p){e=P(p,"DIV",{class:!0});var g=T(e);for(let V=0;V<s.length;V+=1)s[V].l(g);g.forEach(y),l=W(p),t=P(p,"DIV",{class:!0});var w=T(t);for(let V=0;V<i.length;V+=1)i[V].l(w);w.forEach(y),this.h()},h(){m(e,"class","content-box vector-box logits ml-2 svelte-1q04ryr"),m(t,"class","content-box vector-box exponents svelte-1q04ryr")},m(p,g){Z(p,e,g);for(let w=0;w<s.length;w+=1)s[w]&&s[w].m(e,null);Z(p,l,g),Z(p,t,g);for(let w=0;w<i.length;w+=1)i[w]&&i[w].m(t,null);r=!0},p(p,g){if(g[0]&1864){o=be(p[6]);let w;for(w=0;w<o.length;w+=1){const V=Ol(p,o,w);s[w]?(s[w].p(V,g),F(s[w],1)):(s[w]=Wl(V),s[w].c(),F(s[w],1),s[w].m(e,null))}for(Be(),w=o.length;w<s.length;w+=1)f(w);Pe()}if(g[0]&872){a=be(p[5]);let w;for(w=0;w<a.length;w+=1){const V=zl(p,a,w);i[w]?(i[w].p(V,g),F(i[w],1)):(i[w]=Xl(V),i[w].c(),F(i[w],1),i[w].m(t,null))}for(Be(),w=a.length;w<i.length;w+=1)h(w);Pe()}},i(p){if(!r){for(let g=0;g<o.length;g+=1)F(s[g]);for(let g=0;g<a.length;g+=1)F(i[g]);r=!0}},o(p){s=s.filter(Boolean);for(let g=0;g<s.length;g+=1)Q(s[g]);i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)Q(i[g]);r=!1},d(p){p&&(y(e),y(l),y(t)),Me(s,p),Me(i,p)}}}function xl(n){let e,l=n[33].toFixed(2)+"",t,r,o,s,f,a;function i(){return n[20](n[32])}return o=new et({props:{class:"text-xs",placement:"left",type:"light",$$slots:{default:[_o]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ie(l),r=U(),ne(o.$$.fragment),this.h()},l(h){e=P(h,"DIV",{role:!0,class:!0});var p=T(e);t=ae(p,l),p.forEach(y),r=W(h),re(o.$$.fragment,h),this.h()},h(){var h;m(e,"role","group"),m(e,"class","text-box text-center svelte-1q04ryr"),le(e,"highlight",n[32]===n[3]),le(e,"sample_highlight",n[8]===n[32]),le(e,"final_token_highlight",((h=n[9])==null?void 0:h.rank)===n[32])},m(h,p){Z(h,e,p),k(e,t),Z(h,r,p),oe(o,h,p),s=!0,f||(a=[Ee(e,"mouseenter",i),Ee(e,"mouseleave",n[21])],f=!0)},p(h,p){var w;n=h,(!s||p[0]&64)&&l!==(l=n[33].toFixed(2)+"")&&Ae(t,l),(!s||p[0]&8)&&le(e,"highlight",n[32]===n[3]),(!s||p[0]&256)&&le(e,"sample_highlight",n[8]===n[32]),(!s||p[0]&512)&&le(e,"final_token_highlight",((w=n[9])==null?void 0:w.rank)===n[32]);const g={};p[0]&1088|p[1]&64&&(g.$$scope={dirty:p,ctx:n}),o.$set(g)},i(h){s||(F(o.$$.fragment,h),s=!0)},o(h){Q(o.$$.fragment,h),s=!1},d(h){h&&(y(e),y(r)),se(o,h),f=!1,Ze(a)}}}function _o(n){let e=(n[33]*n[10]).toFixed(2)+"",l,t,r,o,s=n[33].toFixed(2)+"",f,a;return{c(){l=ie(e),t=ie(" ÷ "),r=ie(n[10]),o=ie(" = "),f=ie(s),a=U()},l(i){l=ae(i,e),t=ae(i," ÷ "),r=ae(i,n[10]),o=ae(i," = "),f=ae(i,s),a=W(i)},m(i,h){Z(i,l,h),Z(i,t,h),Z(i,r,h),Z(i,o,h),Z(i,f,h),Z(i,a,h)},p(i,h){h[0]&1088&&e!==(e=(i[33]*i[10]).toFixed(2)+"")&&Ae(l,e),h[0]&1024&&Ae(r,i[10]),h[0]&64&&s!==(s=i[33].toFixed(2)+"")&&Ae(f,s)},d(i){i&&(y(l),y(t),y(r),y(o),y(f),y(a))}}}function Wl(n){let e,l,t=n[33]!==void 0&&xl(n);return{c(){t&&t.c(),e=pt()},l(r){t&&t.l(r),e=pt()},m(r,o){t&&t.m(r,o),Z(r,e,o),l=!0},p(r,o){r[33]!==void 0?t?(t.p(r,o),o[0]&64&&F(t,1)):(t=xl(r),t.c(),F(t,1),t.m(e.parentNode,e)):t&&(Be(),Q(t,1,1,()=>{t=null}),Pe())},i(r){l||(F(t),l=!0)},o(r){Q(t),l=!1},d(r){r&&y(e),t&&t.d(r)}}}function bo(n){let e,l=n[6][n[32]].toFixed(2)+"",t,r,o=n[30].toFixed(2)+"",s,f;return{c(){e=ie("exp("),t=ie(l),r=ie(") = "),s=ie(o),f=U()},l(a){e=ae(a,"exp("),t=ae(a,l),r=ae(a,") = "),s=ae(a,o),f=W(a)},m(a,i){Z(a,e,i),Z(a,t,i),Z(a,r,i),Z(a,s,i),Z(a,f,i)},p(a,i){i[0]&64&&l!==(l=a[6][a[32]].toFixed(2)+"")&&Ae(t,l),i[0]&32&&o!==(o=a[30].toFixed(2)+"")&&Ae(s,o)},d(a){a&&(y(e),y(t),y(r),y(s),y(f))}}}function Xl(n){let e,l=n[30].toExponential(2)+"",t,r,o,s,f,a;function i(){return n[22](n[32])}return o=new et({props:{class:"text-xs",placement:"left",type:"light",$$slots:{default:[bo]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ie(l),r=U(),ne(o.$$.fragment),this.h()},l(h){e=P(h,"DIV",{role:!0,class:!0});var p=T(e);t=ae(p,l),p.forEach(y),r=W(h),re(o.$$.fragment,h),this.h()},h(){var h;m(e,"role","group"),m(e,"class","text-box text-center svelte-1q04ryr"),le(e,"highlight",n[32]===n[3]),le(e,"sample_highlight",n[8]===n[32]),le(e,"final_token_highlight",((h=n[9])==null?void 0:h.rank)===n[32])},m(h,p){Z(h,e,p),k(e,t),Z(h,r,p),oe(o,h,p),s=!0,f||(a=[Ee(e,"mouseenter",i),Ee(e,"mouseleave",n[23])],f=!0)},p(h,p){var w;n=h,(!s||p[0]&32)&&l!==(l=n[30].toExponential(2)+"")&&Ae(t,l),(!s||p[0]&8)&&le(e,"highlight",n[32]===n[3]),(!s||p[0]&256)&&le(e,"sample_highlight",n[8]===n[32]),(!s||p[0]&512)&&le(e,"final_token_highlight",((w=n[9])==null?void 0:w.rank)===n[32]);const g={};p[0]&96|p[1]&64&&(g.$$scope={dirty:p,ctx:n}),o.$set(g)},i(h){s||(F(o.$$.fragment,h),s=!0)},o(h){Q(o.$$.fragment,h),s=!1},d(h){h&&(y(e),y(r)),se(o,h),f=!1,Ze(a)}}}function $o(n){let e,l,t="<div>Probabilities</div>",r,o,s,f,a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H,c=be(n[2]),d=[];for(let u=0;u<c.length;u+=1)d[u]=Rl(Gl(n,c,u));const $=u=>Q(d[u],1,1,()=>{d[u]=null});let E=n[1]&&Fl(),I=n[1]&&Ul(n);function S(u){n[24](u)}let C={rowGap:n[13],rowHeight:n[12]};return n[3]!==void 0&&(C.hoveredIndex=n[3]),M=new vo({props:C}),ht.push(()=>Wn(M,"hoveredIndex",S)),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),o=B("div"),s=B("div"),f=U(),a=B("div"),i=B("div");for(let u=0;u<d.length;u+=1)d[u].c();h=U(),p=B("div"),g=U(),w=B("div"),E&&E.c(),V=U(),j=B("div"),R=B("div"),I&&I.c(),G=U(),ne(M.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0,role:!0,tabindex:!0});var v=T(e);l=P(v,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),qe(l)!=="svelte-11ugyn5"&&(l.innerHTML=t),r=W(v),o=P(v,"DIV",{class:!0,style:!0});var b=T(o);s=P(b,"DIV",{class:!0}),T(s).forEach(y),f=W(b),a=P(b,"DIV",{class:!0});var _=T(a);i=P(_,"DIV",{class:!0});var N=T(i);for(let te=0;te<d.length;te+=1)d[te].l(N);N.forEach(y),h=W(_),p=P(_,"DIV",{class:!0}),T(p).forEach(y),_.forEach(y),g=W(b),w=P(b,"DIV",{class:!0});var D=T(w);E&&E.l(D),V=W(D),j=P(D,"DIV",{class:!0});var O=T(j);R=P(O,"DIV",{class:!0});var Y=T(R);I&&I.l(Y),Y.forEach(y),G=W(O),re(M.$$.fragment,O),O.forEach(y),D.forEach(y),b.forEach(y),v.forEach(y),this.h()},h(){m(l,"class","title expandable"),m(l,"role","group"),m(s,"class","bounding softmax-bounding svelte-1q04ryr"),le(s,"active",n[4]&&!n[1]),m(i,"class","content-box token-string svelte-1q04ryr"),m(p,"class","vector vocab opacity-1 w-0"),m(a,"class","first-column relative flex justify-end"),m(R,"class","softmax-detail expandable flex gap-2 opacity-0"),m(j,"class","content-row flex gap-2"),m(w,"class","resize-watch second-column flex flex-col svelte-1q04ryr"),m(o,"class","content relative svelte-1q04ryr"),m(o,"style",`--softmax-row-height: ${n[12]}px;--softmax-row-gap: ${n[13]}px`),m(e,"class",L=de(ce("softmax",n[0]))+" svelte-1q04ryr"),m(e,"role","button"),m(e,"tabindex","0")},m(u,v){Z(u,e,v),k(e,l),k(e,r),k(e,o),k(o,s),k(o,f),k(o,a),k(a,i);for(let b=0;b<d.length;b+=1)d[b]&&d[b].m(i,null);k(a,h),k(a,p),k(o,g),k(o,w),E&&E.m(w,null),k(w,V),k(w,j),k(j,R),I&&I.m(R,null),k(j,G),oe(M,j,null),z=!0,A||(H=[Ee(l,"mouseenter",n[14]),Ee(l,"mouseleave",n[15]),Ee(e,"click",n[11]),Ee(e,"keydown",n[11])],A=!0)},p(u,v){if((!z||v[0]&18)&&le(s,"active",u[4]&&!u[1]),v[0]&908){c=be(u[2]);let _;for(_=0;_<c.length;_+=1){const N=Gl(u,c,_);d[_]?(d[_].p(N,v),F(d[_],1)):(d[_]=Rl(N),d[_].c(),F(d[_],1),d[_].m(i,null))}for(Be(),_=c.length;_<d.length;_+=1)$(_);Pe()}u[1]?E||(E=Fl(),E.c(),E.m(w,V)):E&&(E.d(1),E=null),u[1]?I?(I.p(u,v),v[0]&2&&F(I,1)):(I=Ul(u),I.c(),F(I,1),I.m(R,null)):I&&(Be(),Q(I,1,1,()=>{I=null}),Pe());const b={};!q&&v[0]&8&&(q=!0,b.hoveredIndex=u[3],Un(()=>q=!1)),M.$set(b),(!z||v[0]&1&&L!==(L=de(ce("softmax",u[0]))+" svelte-1q04ryr"))&&m(e,"class",L)},i(u){if(!z){for(let v=0;v<c.length;v+=1)F(d[v]);F(I),F(M.$$.fragment,u),z=!0}},o(u){d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)Q(d[v]);Q(I),Q(M.$$.fragment,u),z=!1},d(u){u&&y(e),Me(d,u),E&&E.d(),I&&I.d(),se(M),A=!1,Ze(H)}}}function yo(n,e,l){let t,r,o,s,f,a,i,h,p;Ce(n,Lt,v=>l(16,f=v)),Ce(n,at,v=>l(17,a=v)),Ce(n,Zn,v=>l(8,i=v)),Ce(n,Kt,v=>l(9,h=v)),Ce(n,sl,v=>l(10,p=v));let{className:g=void 0}=e;kt(Et),Yt("block-id","softmax");const w=Zt("block-id");let V=!1;const j=()=>{V?(at.set({id:null}),M()):(at.set({id:w}),G())};let R;const G=async()=>{R=wt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,V=!0),await Dt();const v=document.getElementById("main");v.style.justifyContent="end",await Dt(),wt.Flip.from(R,{duration:1,ease:"power2.inOut"}),qt.to(".softmax-detail",{opacity:1,duration:.5,delay:.5})},M=async()=>{R=wt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,V=!1),await Dt(),await wt.Flip.from(R,{duration:.5,ease:"power2.inOut"}),qt.to(".softmax-detail",{opacity:0,duration:.5}),await Dt();const v=document.getElementById("main");v.style.justifyContent="start"};let q=At*1.2,L=.4*At,z=null,A=!1;function H(){l(4,A=!0)}function c(){l(4,A=!1)}const d=v=>l(3,z=v),$=()=>l(3,z=null),E=v=>l(3,z=v),I=()=>l(3,z=null),S=v=>l(3,z=v),C=()=>l(3,z=null);function u(v){z=v,l(3,z)}return n.$$set=v=>{"className"in v&&l(0,g=v.className)},n.$$.update=()=>{n.$$.dirty[0]&131074&&a.id!==w&&V&&(l(1,V=!1),M()),n.$$.dirty[0]&65536&&l(2,t=(f==null?void 0:f.prediction)||[]),n.$$.dirty[0]&4&&l(7,r=t==null?void 0:t.map(v=>v.tokenId)),n.$$.dirty[0]&4&&l(6,o=(t==null?void 0:t.map(v=>v.adjustedLogit))||[]),n.$$.dirty[0]&4&&l(5,s=(t==null?void 0:t.map(v=>v.adjustedExp))||[])},[g,V,t,z,A,s,o,r,i,h,p,j,q,L,H,c,f,a,d,$,E,I,S,C,u]}class wo extends Re{constructor(e){super(),Fe(this,e,yo,$o,Ge,{className:0},null,[-1,-1])}}function ko(n){let e,l="Drop out is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-ohkp45"&&(e.textContent=l),this.h()},h(){m(e,"class","dropout-content")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function Eo(n){let e,l;return e=new Jt({props:{class:ce("popover dropout-popover text-sm",n[1]),title:"Drop out",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:zt,params:{duration:100},$$slots:{default:[ko]},$$scope:{ctx:n}}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,[r]){const o={};r&2&&(o.class=ce("popover dropout-popover text-sm",t[1])),r&1&&(o.offset=t[0]),r&4&&(o.triggeredBy=t[2]),r&8&&(o.trigger=t[3]),r&16&&(o.placement=t[4]),r&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function Io(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:s="hover"}=e,{placement:f="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,s=a.trigger),"placement"in a&&l(4,f=a.placement)},[t,r,o,s,f]}class Co extends Re{constructor(e){super(),Fe(this,e,Io,Eo,Ge,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function So(n){let e,l="Layer normalization is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-qw3l61"&&(e.textContent=l),this.h()},h(){m(e,"class","ln-content")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function Do(n){let e,l;return e=new Jt({props:{class:ce("popover ln-popover text-sm",n[1]),title:"Layer Normalization",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:zt,params:{duration:100},$$slots:{default:[So]},$$scope:{ctx:n}}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,[r]){const o={};r&2&&(o.class=ce("popover ln-popover text-sm",t[1])),r&1&&(o.offset=t[0]),r&4&&(o.triggeredBy=t[2]),r&8&&(o.trigger=t[3]),r&16&&(o.placement=t[4]),r&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function qo(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:s="hover"}=e,{placement:f="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,s=a.trigger),"placement"in a&&l(4,f=a.placement)},[t,r,o,s,f]}class Vo extends Re{constructor(e){super(),Fe(this,e,qo,Do,Ge,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Ao(n){let e,l=`The GELU (Gaussian Error Linear Unit) activation function combines linear and non-linear
		behavior by scaling inputs using the Gaussian cumulative distribution function. It retains small
		negative values for smoother gradients and is effective in models like BERT.`;return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-1ri460b"&&(e.textContent=l),this.h()},h(){m(e,"class","activation-content svelte-60plg2")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function No(n){let e,l;return e=new Jt({props:{class:ce("popover activation-popover text-sm",n[1]),title:"GeLu Activation",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:zt,params:{duration:100},$$slots:{default:[Ao]},$$scope:{ctx:n}}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,[r]){const o={};r&2&&(o.class=ce("popover activation-popover text-sm",t[1])),r&1&&(o.offset=t[0]),r&4&&(o.triggeredBy=t[2]),r&8&&(o.trigger=t[3]),r&16&&(o.placement=t[4]),r&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function Mo(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:s="hover"}=e,{placement:f="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,r=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,s=a.trigger),"placement"in a&&l(4,f=a.placement)},[t,r,o,s,f]}class Lo extends Re{constructor(e){super(),Fe(this,e,Mo,No,Ge,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Bo(n){let e,l="Residual out is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-124ixs1"&&(e.textContent=l),this.h()},h(){m(e,"class","residual-content")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function Po(n){let e,l;return e=new Jt({props:{class:ce("popover residual-popover text-sm",n[1]),title:"Residual",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:zt,params:{duration:100},reference:n[5],$$slots:{default:[Bo]},$$scope:{ctx:n}}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,[r]){const o={};r&2&&(o.class=ce("popover residual-popover text-sm",t[1])),r&1&&(o.offset=t[0]),r&4&&(o.triggeredBy=t[2]),r&8&&(o.trigger=t[3]),r&16&&(o.placement=t[4]),r&32&&(o.reference=t[5]),r&64&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function To(n,e,l){let{offset:t=void 0}=e,{className:r=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:s="hover"}=e,{placement:f="right"}=e,{reference:a}=e;return n.$$set=i=>{"offset"in i&&l(0,t=i.offset),"className"in i&&l(1,r=i.className),"triggeredBy"in i&&l(2,o=i.triggeredBy),"trigger"in i&&l(3,s=i.trigger),"placement"in i&&l(4,f=i.placement),"reference"in i&&l(5,a=i.reference)},[t,r,o,s,f,a]}class Ho extends Re{constructor(e){super(),Fe(this,e,To,Po,Ge,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4,reference:5})}}function Zl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Yl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Kl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Ql(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Jl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function jo(n){let e,l,t,r,o,s,f=be(n[4]),a=[];for(let h=0;h<f.length;h+=1)a[h]=en(Zl(n,f,h));const i=h=>Q(a[h],1,1,()=>{a[h]=null});return{c(){e=B("div");for(let h=0;h<a.length;h+=1)a[h].c();this.h()},l(h){e=P(h,"DIV",{id:!0,class:!0,role:!0});var p=T(e);for(let g=0;g<a.length;g+=1)a[g].l(p);p.forEach(y),this.h()},h(){m(e,"id",l=`${n[0]}-end`),m(e,"class",t=de(ce("operation-col column residual",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(h,p){Z(h,e,p);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(e,null);r=!0,o||(s=[Ee(e,"mouseenter",n[5]),Ee(e,"mouseleave",n[6])],o=!0)},p(h,p){if(p&27){f=be(h[4]);let g;for(g=0;g<f.length;g+=1){const w=Zl(h,f,g);a[g]?(a[g].p(w,p),F(a[g],1)):(a[g]=en(w),a[g].c(),F(a[g],1),a[g].m(e,null))}for(Be(),g=f.length;g<a.length;g+=1)i(g);Pe()}(!r||p&1&&l!==(l=`${h[0]}-end`))&&m(e,"id",l),(!r||p&2&&t!==(t=de(ce("operation-col column residual",h[1]))+" svelte-cfq6hx"))&&m(e,"class",t)},i(h){if(!r){for(let p=0;p<f.length;p+=1)F(a[p]);r=!0}},o(h){a=a.filter(Boolean);for(let p=0;p<a.length;p+=1)Q(a[p]);r=!1},d(h){h&&y(e),Me(a,h),o=!1,Ze(s)}}}function zo(n){let e,l,t,r,o,s,f,a,i=be(n[4]),h=[];for(let g=0;g<i.length;g+=1)h[g]=tn(Yl(n,i,g));const p=g=>Q(h[g],1,1,()=>{h[g]=null});return t=new Ho({props:{reference:`#${n[0]}-start`,triggeredBy:`[id^='${n[0]}-']`,offset:1}}),{c(){e=B("div");for(let g=0;g<h.length;g+=1)h[g].c();l=U(),ne(t.$$.fragment),this.h()},l(g){e=P(g,"DIV",{id:!0,class:!0,role:!0});var w=T(e);for(let V=0;V<h.length;V+=1)h[V].l(w);l=W(w),re(t.$$.fragment,w),w.forEach(y),this.h()},h(){m(e,"id",r=`${n[0]}-start`),m(e,"class",o=de(ce("operation-col column residual",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(g,w){Z(g,e,w);for(let V=0;V<h.length;V+=1)h[V]&&h[V].m(e,null);k(e,l),oe(t,e,null),s=!0,f||(a=[Ee(e,"mouseenter",n[5]),Ee(e,"mouseleave",n[6])],f=!0)},p(g,w){if(w&27){i=be(g[4]);let j;for(j=0;j<i.length;j+=1){const R=Yl(g,i,j);h[j]?(h[j].p(R,w),F(h[j],1)):(h[j]=tn(R),h[j].c(),F(h[j],1),h[j].m(e,l))}for(Be(),j=i.length;j<h.length;j+=1)p(j);Pe()}const V={};w&1&&(V.reference=`#${g[0]}-start`),w&1&&(V.triggeredBy=`[id^='${g[0]}-']`),t.$set(V),(!s||w&1&&r!==(r=`${g[0]}-start`))&&m(e,"id",r),(!s||w&2&&o!==(o=de(ce("operation-col column residual",g[1]))+" svelte-cfq6hx"))&&m(e,"class",o)},i(g){if(!s){for(let w=0;w<i.length;w+=1)F(h[w]);F(t.$$.fragment,g),s=!0}},o(g){h=h.filter(Boolean);for(let w=0;w<h.length;w+=1)Q(h[w]);Q(t.$$.fragment,g),s=!1},d(g){g&&y(e),Me(h,g),se(t),f=!1,Ze(a)}}}function Oo(n){let e,l,t,r,o,s,f,a=be(n[4]),i=[];for(let p=0;p<a.length;p+=1)i[p]=ln(Kl(n,a,p));const h=p=>Q(i[p],1,1,()=>{i[p]=null});return t=new Vo({props:{triggeredBy:`#${n[0]}`}}),{c(){e=B("div");for(let p=0;p<i.length;p+=1)i[p].c();l=U(),ne(t.$$.fragment),this.h()},l(p){e=P(p,"DIV",{id:!0,class:!0,role:!0});var g=T(e);for(let w=0;w<i.length;w+=1)i[w].l(g);l=W(g),re(t.$$.fragment,g),g.forEach(y),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ce("operation-col column ln",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(p,g){Z(p,e,g);for(let w=0;w<i.length;w+=1)i[w]&&i[w].m(e,null);k(e,l),oe(t,e,null),o=!0,s||(f=[Ee(e,"mouseenter",n[11]),Ee(e,"mouseleave",n[12])],s=!0)},p(p,g){if(g&26){a=be(p[4]);let V;for(V=0;V<a.length;V+=1){const j=Kl(p,a,V);i[V]?(i[V].p(j,g),F(i[V],1)):(i[V]=ln(j),i[V].c(),F(i[V],1),i[V].m(e,l))}for(Be(),V=a.length;V<i.length;V+=1)h(V);Pe()}const w={};g&1&&(w.triggeredBy=`#${p[0]}`),t.$set(w),(!o||g&1)&&m(e,"id",p[0]),(!o||g&2&&r!==(r=de(ce("operation-col column ln",p[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(p){if(!o){for(let g=0;g<a.length;g+=1)F(i[g]);F(t.$$.fragment,p),o=!0}},o(p){i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)Q(i[g]);Q(t.$$.fragment,p),o=!1},d(p){p&&y(e),Me(i,p),se(t),s=!1,Ze(f)}}}function Go(n){let e,l,t,r,o,s,f,a=be(n[4]),i=[];for(let p=0;p<a.length;p+=1)i[p]=nn(Ql(n,a,p));const h=p=>Q(i[p],1,1,()=>{i[p]=null});return t=new Co({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let p=0;p<i.length;p+=1)i[p].c();l=U(),ne(t.$$.fragment),this.h()},l(p){e=P(p,"DIV",{id:!0,class:!0,role:!0});var g=T(e);for(let w=0;w<i.length;w+=1)i[w].l(g);l=W(g),re(t.$$.fragment,g),g.forEach(y),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ce("operation-col column dropout",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(p,g){Z(p,e,g);for(let w=0;w<i.length;w+=1)i[w]&&i[w].m(e,null);k(e,l),oe(t,e,null),o=!0,s||(f=[Ee(e,"mouseenter",n[9]),Ee(e,"mouseleave",n[10])],s=!0)},p(p,g){if(g&26){a=be(p[4]);let V;for(V=0;V<a.length;V+=1){const j=Ql(p,a,V);i[V]?(i[V].p(j,g),F(i[V],1)):(i[V]=nn(j),i[V].c(),F(i[V],1),i[V].m(e,l))}for(Be(),V=a.length;V<i.length;V+=1)h(V);Pe()}const w={};g&1&&(w.triggeredBy=`#${p[0]}`),t.$set(w),(!o||g&1)&&m(e,"id",p[0]),(!o||g&2&&r!==(r=de(ce("operation-col column dropout",p[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(p){if(!o){for(let g=0;g<a.length;g+=1)F(i[g]);F(t.$$.fragment,p),o=!0}},o(p){i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)Q(i[g]);Q(t.$$.fragment,p),o=!1},d(p){p&&y(e),Me(i,p),se(t),s=!1,Ze(f)}}}function Ro(n){let e,l,t,r,o,s,f,a=be(n[4]),i=[];for(let p=0;p<a.length;p+=1)i[p]=rn(Jl(n,a,p));const h=p=>Q(i[p],1,1,()=>{i[p]=null});return t=new Lo({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let p=0;p<i.length;p+=1)i[p].c();l=U(),ne(t.$$.fragment),this.h()},l(p){e=P(p,"DIV",{id:!0,class:!0,role:!0});var g=T(e);for(let w=0;w<i.length;w+=1)i[w].l(g);l=W(g),re(t.$$.fragment,g),g.forEach(y),this.h()},h(){m(e,"id",n[0]),m(e,"class",r=de(ce("operation-col column activation",n[1]))+" svelte-cfq6hx"),m(e,"role","group")},m(p,g){Z(p,e,g);for(let w=0;w<i.length;w+=1)i[w]&&i[w].m(e,null);k(e,l),oe(t,e,null),o=!0,s||(f=[Ee(e,"mouseenter",n[7]),Ee(e,"mouseleave",n[8])],s=!0)},p(p,g){if(g&26){a=be(p[4]);let V;for(V=0;V<a.length;V+=1){const j=Jl(p,a,V);i[V]?(i[V].p(j,g),F(i[V],1)):(i[V]=rn(j),i[V].c(),F(i[V],1),i[V].m(e,l))}for(Be(),V=a.length;V<i.length;V+=1)h(V);Pe()}const w={};g&1&&(w.triggeredBy=`#${p[0]}`),t.$set(w),(!o||g&1)&&m(e,"id",p[0]),(!o||g&2&&r!==(r=de(ce("operation-col column activation",p[1]))+" svelte-cfq6hx"))&&m(e,"class",r)},i(p){if(!o){for(let g=0;g<a.length;g+=1)F(i[g]);F(t.$$.fragment,p),o=!0}},o(p){i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)Q(i[g]);Q(t.$$.fragment,p),o=!1},d(p){p&&y(e),Me(i,p),se(t),s=!1,Ze(f)}}}function en(n){let e,l;return e=new Ot({props:{id:n[0],className:ce(n[1],{last:n[16]===n[4].length-1}),type:"residual-end",head:n[16]===0,active:n[3]}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.id=t[0]),r&18&&(o.className=ce(t[1],{last:t[16]===t[4].length-1})),r&8&&(o.active=t[3]),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function tn(n){let e,l;return e=new Ot({props:{id:n[0],className:ce(n[1],{last:n[16]===n[4].length-1}),type:"residual-start",head:n[16]===0,active:n[3]}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.id=t[0]),r&18&&(o.className=ce(t[1],{last:t[16]===t[4].length-1})),r&8&&(o.active=t[3]),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function ln(n){let e,l;return e=new Ot({props:{className:ce(n[1],{last:n[16]===n[4].length-1}),type:"ln",tail:n[16]===n[4].length-1,active:n[3]}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,r){const o={};r&18&&(o.className=ce(t[1],{last:t[16]===t[4].length-1})),r&16&&(o.tail=t[16]===t[4].length-1),r&8&&(o.active=t[3]),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function nn(n){let e,l;return e=new Ot({props:{className:ce(n[1],{last:n[16]===n[4].length-1}),type:"dropout",tail:n[16]===n[4].length-1,active:n[3]}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,r){const o={};r&18&&(o.className=ce(t[1],{last:t[16]===t[4].length-1})),r&16&&(o.tail=t[16]===t[4].length-1),r&8&&(o.active=t[3]),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function rn(n){let e,l;return e=new Ot({props:{className:ce(n[1],{last:n[16]===n[4].length-1}),type:"activation",tail:n[16]===n[4].length-1,active:n[3]}}),{c(){ne(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,r){oe(e,t,r),l=!0},p(t,r){const o={};r&18&&(o.className=ce(t[1],{last:t[16]===t[4].length-1})),r&16&&(o.tail=t[16]===t[4].length-1),r&8&&(o.active=t[3]),e.$set(o)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function Fo(n){let e,l,t,r;const o=[Ro,Go,Oo,zo,jo],s=[];function f(a,i){return a[2]==="activation"?0:a[2]==="dropout"?1:a[2]==="ln"?2:a[2]==="residual-start"?3:a[2]==="residual-end"?4:-1}return~(e=f(n))&&(l=s[e]=o[e](n)),{c(){l&&l.c(),t=pt()},l(a){l&&l.l(a),t=pt()},m(a,i){~e&&s[e].m(a,i),Z(a,t,i),r=!0},p(a,[i]){let h=e;e=f(a),e===h?~e&&s[e].p(a,i):(l&&(Be(),Q(s[h],1,1,()=>{s[h]=null}),Pe()),~e?(l=s[e],l?l.p(a,i):(l=s[e]=o[e](a),l.c()),F(l,1),l.m(t.parentNode,t)):l=null)},i(a){r||(F(l),r=!0)},o(a){Q(l),r=!1},d(a){a&&y(t),~e&&s[e].d(a)}}}function Uo(n,e,l){let t;Ce(n,mt,G=>l(4,t=G));let{id:r}=e,{className:o=void 0}=e,{type:s=void 0}=e,f=!1;const a=()=>{l(3,f=!0);const G=document.querySelector(`#${r}-start`),M=document.querySelector(`#${r}-end`),q=lt(`.residual-connector.${r}`);q.style("opacity",1),h(q),G==null||G.classList.add("active"),M==null||M.classList.add("active")},i=()=>{l(3,f=!1);const G=document.querySelector(`#${r}-start`),M=document.querySelector(`#${r}-end`);lt(`.residual-connector.${r}`).style("opacity",0),G==null||G.classList.remove("active"),M==null||M.classList.remove("active")},h=G=>{const M=G.node().getTotalLength();G.attr("stroke-dasharray",M+" "+M).attr("stroke-dashoffset",M).transition().duration(300).attr("stroke-dashoffset",0)},p=()=>{l(3,f=!0)},g=()=>{l(3,f=!1)},w=()=>{l(3,f=!0)},V=()=>{l(3,f=!1)},j=()=>{l(3,f=!0)},R=()=>{l(3,f=!1)};return n.$$set=G=>{"id"in G&&l(0,r=G.id),"className"in G&&l(1,o=G.className),"type"in G&&l(2,s=G.type)},[r,o,s,f,t,a,i,p,g,w,V,j,R]}class ut extends Re{constructor(e){super(),Fe(this,e,Uo,Fo,Ge,{id:0,className:1,type:2})}}function on(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function sn(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function an(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function cn(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function fn(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function un(n,e,l){const t=n.slice();return t[21]=e[l],t[23]=l,t}function hn(n){let e,l="Token";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-6k2z6t"&&(e.textContent=l),this.h()},h(){m(e,"class","subtitle embedding-detail svelte-61uen")},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function dn(n){let e,l,t=n[21]+"",r;return{c(){e=B("div"),l=B("span"),r=ie(t),this.h()},l(o){e=P(o,"DIV",{class:!0});var s=T(e);l=P(s,"SPAN",{class:!0});var f=T(l);r=ae(f,t),f.forEach(y),s.forEach(y),this.h()},h(){m(l,"class","label svelte-61uen"),m(e,"class","cell svelte-61uen"),le(e,"last",n[23]===n[3].length-1)},m(o,s){Z(o,e,s),k(e,l),k(l,r)},p(o,s){s&8&&t!==(t=o[21]+"")&&Ae(r,t),s&8&&le(e,"last",o[23]===o[3].length-1)},d(o){o&&y(e)}}}function pn(n){let e,l,t,r,o,s="Token Embedding",f,a,i,h,p,g,w,V,j="Positional Embedding",R,G,M,q,L;e=new et({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[xo]},$$scope:{ctx:n}}}),f=new pl({props:{id:"token-embedding",$$slots:{default:[Wo]},$$scope:{ctx:n}}});let z=be(n[3]),A=[];for(let u=0;u<z.length;u+=1)A[u]=gn(fn(n,z,u));const H=u=>Q(A[u],1,1,()=>{A[u]=null});let c=be(n[3]),d=[];for(let u=0;u<c.length;u+=1)d[u]=vn(cn(n,c,u));R=new pl({props:{id:"position-embedding",$$slots:{default:[Yo]},$$scope:{ctx:n}}});let $=be(n[3]),E=[];for(let u=0;u<$.length;u+=1)E[u]=mn(an(n,$,u));const I=u=>Q(E[u],1,1,()=>{E[u]=null});let S=be(n[3]),C=[];for(let u=0;u<S.length;u+=1)C[u]=_n(sn(n,S,u));return{c(){ne(e.$$.fragment),l=U(),t=B("div"),r=B("div"),o=B("span"),o.textContent=s,ne(f.$$.fragment),a=U();for(let u=0;u<A.length;u+=1)A[u].c();i=U(),h=B("div");for(let u=0;u<d.length;u+=1)d[u].c();p=U(),g=B("div"),w=B("div"),V=B("span"),V.textContent=j,ne(R.$$.fragment),G=U();for(let u=0;u<E.length;u+=1)E[u].c();M=U(),q=B("div");for(let u=0;u<C.length;u+=1)C[u].c();this.h()},l(u){re(e.$$.fragment,u),l=W(u),t=P(u,"DIV",{class:!0});var v=T(t);r=P(v,"DIV",{class:!0});var b=T(r);o=P(b,"SPAN",{"data-svelte-h":!0}),qe(o)!=="svelte-mkgxme"&&(o.textContent=s),re(f.$$.fragment,b),b.forEach(y),a=W(v);for(let Y=0;Y<A.length;Y+=1)A[Y].l(v);v.forEach(y),i=W(u),h=P(u,"DIV",{class:!0});var _=T(h);for(let Y=0;Y<d.length;Y+=1)d[Y].l(_);_.forEach(y),p=W(u),g=P(u,"DIV",{class:!0});var N=T(g);w=P(N,"DIV",{class:!0});var D=T(w);V=P(D,"SPAN",{"data-svelte-h":!0}),qe(V)!=="svelte-w2vnbx"&&(V.textContent=j),re(R.$$.fragment,D),D.forEach(y),G=W(N);for(let Y=0;Y<E.length;Y+=1)E[Y].l(N);N.forEach(y),M=W(u),q=P(u,"DIV",{class:!0});var O=T(q);for(let Y=0;Y<C.length;Y+=1)C[Y].l(O);O.forEach(y),this.h()},h(){m(r,"class","subtitle flex items-center gap-1 svelte-61uen"),m(t,"class","column token-embedding embedding-detail svelte-61uen"),m(h,"class","column symbol embedding-detail svelte-61uen"),m(w,"class","subtitle flex gap-1 svelte-61uen"),m(g,"class","column embedding-detail position-embedding svelte-61uen"),m(q,"class","column symbol embedding-d etail svelte-61uen")},m(u,v){oe(e,u,v),Z(u,l,v),Z(u,t,v),k(t,r),k(r,o),oe(f,r,null),k(t,a);for(let b=0;b<A.length;b+=1)A[b]&&A[b].m(t,null);Z(u,i,v),Z(u,h,v);for(let b=0;b<d.length;b+=1)d[b]&&d[b].m(h,null);Z(u,p,v),Z(u,g,v),k(g,w),k(w,V),oe(R,w,null),k(g,G);for(let b=0;b<E.length;b+=1)E[b]&&E[b].m(g,null);Z(u,M,v),Z(u,q,v);for(let b=0;b<C.length;b+=1)C[b]&&C[b].m(q,null);L=!0},p(u,v){const b={};v&536870928&&(b.$$scope={dirty:v,ctx:u}),e.$set(b);const _={};if(v&536870912&&(_.$$scope={dirty:v,ctx:u}),f.$set(_),v&8){z=be(u[3]);let D;for(D=0;D<z.length;D+=1){const O=fn(u,z,D);A[D]?(A[D].p(O,v),F(A[D],1)):(A[D]=gn(O),A[D].c(),F(A[D],1),A[D].m(t,null))}for(Be(),D=z.length;D<A.length;D+=1)H(D);Pe()}if(v&8){c=be(u[3]);let D;for(D=0;D<c.length;D+=1){const O=cn(u,c,D);d[D]?d[D].p(O,v):(d[D]=vn(),d[D].c(),d[D].m(h,null))}for(;D<d.length;D+=1)d[D].d(1);d.length=c.length}const N={};if(v&536870912&&(N.$$scope={dirty:v,ctx:u}),R.$set(N),v&40){$=be(u[3]);let D;for(D=0;D<$.length;D+=1){const O=an(u,$,D);E[D]?(E[D].p(O,v),F(E[D],1)):(E[D]=mn(O),E[D].c(),F(E[D],1),E[D].m(g,null))}for(Be(),D=$.length;D<E.length;D+=1)I(D);Pe()}if(v&8){S=be(u[3]);let D;for(D=0;D<S.length;D+=1){const O=sn(u,S,D);C[D]?C[D].p(O,v):(C[D]=_n(),C[D].c(),C[D].m(q,null))}for(;D<C.length;D+=1)C[D].d(1);C.length=S.length}},i(u){if(!L){F(e.$$.fragment,u),F(f.$$.fragment,u);for(let v=0;v<z.length;v+=1)F(A[v]);F(R.$$.fragment,u);for(let v=0;v<$.length;v+=1)F(E[v]);L=!0}},o(u){Q(e.$$.fragment,u),Q(f.$$.fragment,u),A=A.filter(Boolean);for(let v=0;v<A.length;v+=1)Q(A[v]);Q(R.$$.fragment,u),E=E.filter(Boolean);for(let v=0;v<E.length;v+=1)Q(E[v]);L=!1},d(u){u&&(y(l),y(t),y(i),y(h),y(p),y(g),y(M),y(q)),se(e,u),se(f),Me(A,u),Me(d,u),se(R),Me(E,u),Me(C,u)}}}function xo(n){let e,l=n[4].dimension+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function Wo(n){let e;return{c(){e=ie("Token Embedding is")},l(l){e=ae(l,"Token Embedding is")},m(l,t){Z(l,e,t)},d(l){l&&y(e)}}}function Xo(n){let e,l='<span>look up</span><svg class="h-3 w-3 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"></path></svg>';return{c(){e=B("div"),e.innerHTML=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-bcqwtg"&&(e.innerHTML=l),this.h()},h(){m(e,"class","look-up flex items-center gap-1")},m(t,r){Z(t,e,r)},d(t){t&&y(e)}}}function Zo(n){let e,l="id",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(r){e=P(r,"SPAN",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-1e13gni"&&(e.textContent=l),t=P(r,"BR",{}),this.h()},h(){m(e,"class","label svelte-61uen")},m(r,o){Z(r,e,o),Z(r,t,o)},d(r){r&&(y(e),y(t))}}}function gn(n){let e,l,t,r,o,s,f,a,i,h,p,g,w,V,j=(Math.random()*1e4).toFixed()+"",R,G,M,q=n[23]===0&&Xo();h=new dt({props:{active:!0}});let L=n[23]===0&&Zo();return{c(){e=B("div"),l=B("div"),t=B("div"),q&&q.c(),r=U(),o=Se("svg"),s=Se("path"),f=U(),a=B("div"),i=B("div"),ne(h.$$.fragment),p=U(),g=B("span"),L&&L.c(),w=U(),V=B("span"),R=ie(j),G=U(),this.h()},l(z){e=P(z,"DIV",{class:!0});var A=T(e);l=P(A,"DIV",{class:!0});var H=T(l);t=P(H,"DIV",{class:!0});var c=T(t);q&&q.l(c),r=W(c),o=De(c,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var d=T(o);s=De(d,"path",{fill:!0,d:!0}),T(s).forEach(y),d.forEach(y),c.forEach(y),H.forEach(y),f=W(A),a=P(A,"DIV",{class:!0});var $=T(a);i=P($,"DIV",{class:!0});var E=T(i);re(h.$$.fragment,E),E.forEach(y),p=W($),g=P($,"SPAN",{class:!0});var I=T(g);L&&L.l(I),w=W(I),V=P(I,"SPAN",{class:!0});var S=T(V);R=ae(S,j),S.forEach(y),I.forEach(y),$.forEach(y),G=W(A),A.forEach(y),this.h()},h(){m(s,"fill","currentColor"),m(s,"d","M30.3886 4.74352C30.5839 4.54826 30.5839 4.23168 30.3886 4.03642L27.2067 0.854435C27.0114 0.659173 26.6948 0.659173 26.4996 0.854435C26.3043 1.0497 26.3043 1.36628 26.4996 1.56154L29.328 4.38997L26.4996 7.2184C26.3043 7.41366 26.3043 7.73024 26.4996 7.9255C26.6948 8.12076 27.0114 8.12076 27.2067 7.9255L30.3886 4.74352ZM0.31958 4.88997H30.0351V3.88997H0.31958V4.88997Z"),m(o,"xmlns","http://www.w3.org/2000/svg"),m(o,"viewBox","0 0 31 9"),m(o,"fill","none"),m(o,"class","w-10 text-gray-300"),m(t,"class","flex flex-col items-center"),m(l,"class","vocab-index ellipsis flex items-center text-right text-xs text-gray-400 svelte-61uen"),m(i,"class",de(`vector ${cl}`)+" svelte-61uen"),m(V,"class","val svelte-61uen"),m(g,"class","index-val text-xs svelte-61uen"),m(a,"class","cell flex items-center svelte-61uen"),m(e,"class","token-id flex items-center")},m(z,A){Z(z,e,A),k(e,l),k(l,t),q&&q.m(t,null),k(t,r),k(t,o),k(o,s),k(e,f),k(e,a),k(a,i),oe(h,i,null),k(a,p),k(a,g),L&&L.m(g,null),k(g,w),k(g,V),k(V,R),k(e,G),M=!0},p:Oe,i(z){M||(F(h.$$.fragment,z),M=!0)},o(z){Q(h.$$.fragment,z),M=!1},d(z){z&&y(e),q&&q.d(),se(h),L&&L.d()}}}function vn(n){let e,l="+";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-124y0va"&&(e.textContent=l),this.h()},h(){m(e,"class","cell svelte-61uen")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function Yo(n){let e;return{c(){e=ie("Positional Embedding is")},l(l){e=ae(l,"Positional Embedding is")},m(l,t){Z(l,e,t)},d(l){l&&y(e)}}}function Ko(n){let e,l="poition",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(r){e=P(r,"SPAN",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-1fb2ksh"&&(e.textContent=l),t=P(r,"BR",{}),this.h()},h(){m(e,"class","label svelte-61uen")},m(r,o){Z(r,e,o),Z(r,t,o)},d(r){r&&(y(e),y(t))}}}function mn(n){let e,l,t,r,o,s,f,a,i,h;t=new dt({props:{active:!0,colorScale:n[10]}});let p=n[23]===0&&Ko();return{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),r=U(),o=B("span"),p&&p.c(),s=U(),f=B("span"),a=ie(n[23]),i=U(),this.h()},l(g){e=P(g,"DIV",{class:!0});var w=T(e);l=P(w,"DIV",{class:!0});var V=T(l);re(t.$$.fragment,V),V.forEach(y),r=W(w),o=P(w,"SPAN",{class:!0});var j=T(o);p&&p.l(j),s=W(j),f=P(j,"SPAN",{class:!0});var R=T(f);a=ae(R,n[23]),R.forEach(y),j.forEach(y),i=W(w),w.forEach(y),this.h()},h(){m(l,"class",de(`vector ${cl}`)+" svelte-61uen"),m(f,"class","val svelte-61uen"),m(o,"class","index-val text-xs svelte-61uen"),m(e,"class","cell flex items-center svelte-61uen")},m(g,w){Z(g,e,w),k(e,l),oe(t,l,null),k(e,r),k(e,o),p&&p.m(o,null),k(o,s),k(o,f),k(f,a),k(e,i),h=!0},p:Oe,i(g){h||(F(t.$$.fragment,g),h=!0)},o(g){Q(t.$$.fragment,g),h=!1},d(g){g&&y(e),se(t),p&&p.d()}}}function _n(n){let e,l="=";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),qe(e)!=="svelte-1btrmmo"&&(e.textContent=l),this.h()},h(){m(e,"class","cell svelte-61uen")},m(t,r){Z(t,e,r)},p:Oe,d(t){t&&y(e)}}}function Qo(n){let e,l=n[4].dimension+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&16&&l!==(l=o[4].dimension+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function bn(n){let e,l,t,r;return l=new dt({props:{active:n[2]||n[1]}}),{c(){e=B("div"),ne(l.$$.fragment),t=U(),this.h()},l(o){e=P(o,"DIV",{class:!0});var s=T(e);re(l.$$.fragment,s),t=W(s),s.forEach(y),this.h()},h(){m(e,"class",de(`vector ${cl}`)+" svelte-61uen"),le(e,"last",n[23]===n[3].length-1)},m(o,s){Z(o,e,s),oe(l,e,null),k(e,t),r=!0},p(o,s){const f={};s&6&&(f.active=o[2]||o[1]),l.$set(f),(!r||s&8)&&le(e,"last",o[23]===o[3].length-1)},i(o){r||(F(l.$$.fragment,o),r=!0)},o(o){Q(l.$$.fragment,o),r=!1},d(o){o&&y(e),se(l)}}}function Jo(n){let e,l,t="<div>Embedding</div>",r,o,s,f,a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H,c,d,$,E=n[1]&&hn(),I=be(n[3]),S=[];for(let _=0;_<I.length;_+=1)S[_]=dn(un(n,I,_));let C=n[1]&&pn(n);V=new et({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[Qo]},$$scope:{ctx:n}}});let u=be(n[3]),v=[];for(let _=0;_<u.length;_+=1)v[_]=bn(on(n,u,_));const b=_=>Q(v[_],1,1,()=>{v[_]=null});return M=new ut({props:{type:"dropout",id:"embedding-dropout"}}),L=new ut({props:{type:"residual-start",id:"residual-first"}}),A=new ut({props:{type:"ln",id:"embedding-ln"}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,r=U(),o=B("div"),s=B("div"),f=B("div"),E&&E.c(),a=U();for(let _=0;_<S.length;_+=1)S[_].c();i=U(),h=B("div"),p=U(),C&&C.c(),g=U(),w=B("div"),ne(V.$$.fragment),j=U(),R=B("div");for(let _=0;_<v.length;_+=1)v[_].c();G=U(),ne(M.$$.fragment),q=U(),ne(L.$$.fragment),z=U(),ne(A.$$.fragment),this.h()},l(_){e=P(_,"DIV",{class:!0});var N=T(e);l=P(N,"DIV",{class:!0,role:!0,tabindex:!0,"data-svelte-h":!0}),qe(l)!=="svelte-ht2s65"&&(l.innerHTML=t),r=W(N),o=P(N,"DIV",{class:!0});var D=T(o);s=P(D,"DIV",{class:!0});var O=T(s);f=P(O,"DIV",{class:!0});var Y=T(f);E&&E.l(Y),a=W(Y);for(let X=0;X<S.length;X+=1)S[X].l(Y);i=W(Y),h=P(Y,"DIV",{class:!0}),T(h).forEach(y),Y.forEach(y),p=W(O),C&&C.l(O),O.forEach(y),g=W(D),w=P(D,"DIV",{class:!0});var te=T(w);re(V.$$.fragment,te),j=W(te),R=P(te,"DIV",{class:!0});var fe=T(R);for(let X=0;X<v.length;X+=1)v[X].l(fe);fe.forEach(y),G=W(te),re(M.$$.fragment,te),q=W(te),re(L.$$.fragment,te),z=W(te),re(A.$$.fragment,te),te.forEach(y),D.forEach(y),N.forEach(y),this.h()},h(){m(l,"class","title expandable svelte-61uen"),m(l,"role","button"),m(l,"tabindex","0"),m(h,"class","bounding embedding-bounding svelte-61uen"),le(h,"active",n[2]&&!n[1]),m(f,"class","column token-string relative svelte-61uen"),m(s,"class","token-column resizable resize-watch flex"),m(R,"class","column vectors svelte-61uen"),m(w,"class","vector-column relative flex"),m(o,"class","content relative svelte-61uen"),m(e,"class",H=de(ce("embedding",n[0]))+" svelte-61uen")},m(_,N){Z(_,e,N),k(e,l),k(e,r),k(e,o),k(o,s),k(s,f),E&&E.m(f,null),k(f,a);for(let D=0;D<S.length;D+=1)S[D]&&S[D].m(f,null);k(f,i),k(f,h),k(s,p),C&&C.m(s,null),k(o,g),k(o,w),oe(V,w,null),k(w,j),k(w,R);for(let D=0;D<v.length;D+=1)v[D]&&v[D].m(R,null);k(w,G),oe(M,w,null),k(w,q),oe(L,w,null),k(w,z),oe(A,w,null),c=!0,d||($=[Ee(l,"click",n[6]),Ee(l,"keydown",n[6]),Ee(l,"mouseenter",n[7]),Ee(l,"mouseleave",n[8])],d=!0)},p(_,[N]){if(_[1]?E||(E=hn(),E.c(),E.m(f,a)):E&&(E.d(1),E=null),N&8){I=be(_[3]);let O;for(O=0;O<I.length;O+=1){const Y=un(_,I,O);S[O]?S[O].p(Y,N):(S[O]=dn(Y),S[O].c(),S[O].m(f,i))}for(;O<S.length;O+=1)S[O].d(1);S.length=I.length}(!c||N&6)&&le(h,"active",_[2]&&!_[1]),_[1]?C?(C.p(_,N),N&2&&F(C,1)):(C=pn(_),C.c(),F(C,1),C.m(s,null)):C&&(Be(),Q(C,1,1,()=>{C=null}),Pe());const D={};if(N&536870928&&(D.$$scope={dirty:N,ctx:_}),V.$set(D),N&14){u=be(_[3]);let O;for(O=0;O<u.length;O+=1){const Y=on(_,u,O);v[O]?(v[O].p(Y,N),F(v[O],1)):(v[O]=bn(Y),v[O].c(),F(v[O],1),v[O].m(R,null))}for(Be(),O=u.length;O<v.length;O+=1)b(O);Pe()}(!c||N&1&&H!==(H=de(ce("embedding",_[0]))+" svelte-61uen"))&&m(e,"class",H)},i(_){if(!c){F(C),F(V.$$.fragment,_);for(let N=0;N<u.length;N+=1)F(v[N]);F(M.$$.fragment,_),F(L.$$.fragment,_),F(A.$$.fragment,_),c=!0}},o(_){Q(C),Q(V.$$.fragment,_),v=v.filter(Boolean);for(let N=0;N<v.length;N+=1)Q(v[N]);Q(M.$$.fragment,_),Q(L.$$.fragment,_),Q(A.$$.fragment,_),c=!1},d(_){_&&y(e),E&&E.d(),Me(S,_),C&&C.d(),se(V),Me(v,_),se(M),se(L),se(A),d=!1,Ze($)}}}const cl="bg-gray-300";function es(n,e,l){let t,r,o;Ce(n,at,M=>l(9,t=M)),Ce(n,mt,M=>l(3,r=M)),Ce(n,Mt,M=>l(4,o=M));const{theme:s}=kt(Et);let{className:f=void 0}=e;Yt("block-id","embedding");const a=Zt("block-id");let i=!1;const h=()=>{i?(at.set({id:null}),w()):(at.set({id:a}),g())};let p;const g=async()=>{p=wt.Flip.getState(".embedding .token-column"),l(1,i=!0),await Dt(),wt.Flip.from(p,{duration:1,ease:"power2.inOut"}),qt.to(".embedding-detail",{opacity:1,duration:.5,delay:.5})},w=async()=>{p=wt.Flip.getState(".embedding .token-column"),l(1,i=!1),await Dt(),wt.Flip.from(p,{duration:.5,ease:"power2.inOut"})};let V=!1;function j(){l(2,V=!0)}function R(){l(2,V=!1)}const G=(M,q)=>jn().domain([0,.5,1]).range([s.colors.red[400],"white",s.colors.blue[400]])(M);return n.$$set=M=>{"className"in M&&l(0,f=M.className)},n.$$.update=()=>{n.$$.dirty&514&&t.id!==a&&i&&(l(1,i=!1),w())},[f,i,V,r,o,s,h,j,R,t,G]}class ts extends Re{constructor(e){super(),Fe(this,e,es,Jo,Ge,{className:0})}}function $n(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function yn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function wn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function ls(n){let e,l=n[3].dimension+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&8&&l!==(l=o[3].dimension+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function ns(n){let e,l=n[3].dimension+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&8&&l!==(l=o[3].dimension+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function rs(n){let e,l=n[3].dimension*4+"",t,r;return{c(){e=ie("size(1, "),t=ie(l),r=ie(")")},l(o){e=ae(o,"size(1, "),t=ae(o,l),r=ae(o,")")},m(o,s){Z(o,e,s),Z(o,t,s),Z(o,r,s)},p(o,s){s&8&&l!==(l=o[3].dimension*4+"")&&Ae(t,l)},d(o){o&&(y(e),y(t),y(r))}}}function kn(n){let e,l,t=n[10]+"",r,o,s,f,a,i,h,p,g,w,V,j;f=new dt({props:{colorScale:"purple",active:n[2]===n[12]}});function R(){return n[8](n[12])}return{c(){e=B("div"),l=B("span"),r=ie(t),o=U(),s=B("div"),ne(f.$$.fragment),a=U(),i=B("div"),h=U(),p=B("div"),g=U(),this.h()},l(G){e=P(G,"DIV",{class:!0,role:!0});var M=T(e);l=P(M,"SPAN",{class:!0});var q=T(l);r=ae(q,t),q.forEach(y),o=W(M),s=P(M,"DIV",{class:!0});var L=T(s);re(f.$$.fragment,L),a=W(L),i=P(L,"DIV",{class:!0}),T(i).forEach(y),h=W(L),p=P(L,"DIV",{class:!0}),T(p).forEach(y),L.forEach(y),g=W(M),M.forEach(y),this.h()},h(){m(l,"class","label float"),m(i,"class","sub-vector x1-12 head1"),m(p,"class","sub-vector head-rest grow"),m(s,"class",de(`vector flex flex-col  ${ss}`)+" svelte-r5b4c7"),m(e,"class","cell"),m(e,"role","group"),le(e,"last",n[12]===n[5].length-1)},m(G,M){Z(G,e,M),k(e,l),k(l,r),k(e,o),k(e,s),oe(f,s,null),k(s,a),k(s,i),k(s,h),k(s,p),k(e,g),w=!0,V||(j=[Ee(e,"mouseenter",R),Ee(e,"mouseleave",n[9])],V=!0)},p(G,M){n=G,(!w||M&32)&&t!==(t=n[10]+"")&&Ae(r,t);const q={};M&4&&(q.active=n[2]===n[12]),f.$set(q),(!w||M&32)&&le(e,"last",n[12]===n[5].length-1)},i(G){w||(F(f.$$.fragment,G),w=!0)},o(G){Q(f.$$.fragment,G),w=!1},d(G){G&&y(e),se(f),V=!1,Ze(j)}}}function En(n){let e,l,t,r,o,s;return t=new dt({props:{colorScale:"indigo"}}),{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),r=U(),this.h()},l(f){e=P(f,"DIV",{class:!0});var a=T(e);l=P(a,"DIV",{class:!0});var i=T(l);re(t.$$.fragment,i),i.forEach(y),r=W(a),a.forEach(y),this.h()},h(){m(l,"class",de(ce(`vector x4 ${is} opacity-80`))+" svelte-r5b4c7"),m(e,"class",o=de(ce("cell x4",{small:n[12]!==0&&n[12]!==n[5].length-1}))+" svelte-r5b4c7"),le(e,"last",n[12]===n[5].length-1)},m(f,a){Z(f,e,a),k(e,l),oe(t,l,null),k(e,r),s=!0},p(f,a){(!s||a&32&&o!==(o=de(ce("cell x4",{small:f[12]!==0&&f[12]!==f[5].length-1}))+" svelte-r5b4c7"))&&m(e,"class",o),(!s||a&32)&&le(e,"last",f[12]===f[5].length-1)},i(f){s||(F(t.$$.fragment,f),s=!0)},o(f){Q(t.$$.fragment,f),s=!1},d(f){f&&y(e),se(t)}}}function In(n){let e,l,t,r,o;return t=new dt({props:{colorScale:"blue"}}),{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),r=U(),this.h()},l(s){e=P(s,"DIV",{class:!0});var f=T(e);l=P(f,"DIV",{class:!0});var a=T(l);re(t.$$.fragment,a),a.forEach(y),r=W(f),f.forEach(y),this.h()},h(){m(l,"class",de(`vector ${as}`)+" svelte-r5b4c7"),m(e,"class","cell"),le(e,"last",n[12]===n[5].length-1)},m(s,f){Z(s,e,f),k(e,l),oe(t,l,null),k(e,r),o=!0},p(s,f){(!o||f&32)&&le(e,"last",s[12]===s[5].length-1)},i(s){o||(F(t.$$.fragment,s),o=!0)},o(s){Q(t.$$.fragment,s),o=!1},d(s){s&&y(e),se(t)}}}function os(n){let e,l,t="MLP",r,o,s,f,a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H,c,d,$,E,I,S,C,u,v,b,_,N,D,O,Y,te,fe,X,ue;s=new et({props:{triggeredBy:".mlp .first-layer .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[ls]},$$scope:{ctx:n}}}),a=new et({props:{triggeredBy:".mlp .out .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[ns]},$$scope:{ctx:n}}}),h=new et({props:{triggeredBy:".mlp .projections .vector",placement:"right",class:"popover text-sm font-light",$$slots:{default:[rs]},$$scope:{ctx:n}}});let K=be(n[5]),ve=[];for(let J=0;J<K.length;J+=1)ve[J]=kn(wn(n,K,J));const je=J=>Q(ve[J],1,1,()=>{ve[J]=null});q=new ut({props:{type:"dropout",id:"mlp-first-dropout"}}),z=new ut({props:{type:"residual-end",id:"residual-first"}}),H=new ut({props:{type:"ln",id:"mlp-first-ln"}}),d=new ut({props:{type:"residual-start",id:"residual-second"}});let Te=be(n[5]),ye=[];for(let J=0;J<Te.length;J+=1)ye[J]=En(yn(n,Te,J));const He=J=>Q(ye[J],1,1,()=>{ye[J]=null});u=new ut({props:{type:"activation",id:"mlp-activation",className:"x4"}}),_=new ut({props:{type:"residual-end",id:"residual-second"}}),D=new ut({props:{type:"ln",id:"mlp-second-ln"}});let Ve=be(n[5]),me=[];for(let J=0;J<Ve.length;J+=1)me[J]=In($n(n,Ve,J));const $e=J=>Q(me[J],1,1,()=>{me[J]=null});return{c(){e=B("div"),l=B("div"),l.textContent=t,r=U(),o=B("div"),ne(s.$$.fragment),f=U(),ne(a.$$.fragment),i=U(),ne(h.$$.fragment),p=U(),g=B("div"),w=U(),V=B("div"),j=U(),R=B("div"),G=B("div");for(let J=0;J<ve.length;J+=1)ve[J].c();M=U(),ne(q.$$.fragment),L=U(),ne(z.$$.fragment),A=U(),ne(H.$$.fragment),c=U(),ne(d.$$.fragment),$=U(),E=B("div"),I=B("div"),S=B("div");for(let J=0;J<ye.length;J+=1)ye[J].c();C=U(),ne(u.$$.fragment),v=U(),b=B("div"),ne(_.$$.fragment),N=U(),ne(D.$$.fragment),O=U(),Y=B("div");for(let J=0;J<me.length;J+=1)me[J].c();this.h()},l(J){e=P(J,"DIV",{class:!0});var pe=T(e);l=P(pe,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),qe(l)!=="svelte-50ab67"&&(l.textContent=t),r=W(pe),o=P(pe,"DIV",{class:!0});var ke=T(o);re(s.$$.fragment,ke),f=W(ke),re(a.$$.fragment,ke),i=W(ke),re(h.$$.fragment,ke),p=W(ke),g=P(ke,"DIV",{class:!0}),T(g).forEach(y),w=W(ke),V=P(ke,"DIV",{class:!0}),T(V).forEach(y),j=W(ke),R=P(ke,"DIV",{class:!0});var Ne=T(R);G=P(Ne,"DIV",{class:!0});var st=T(G);for(let Ue=0;Ue<ve.length;Ue+=1)ve[Ue].l(st);st.forEach(y),M=W(Ne),re(q.$$.fragment,Ne),L=W(Ne),re(z.$$.fragment,Ne),A=W(Ne),re(H.$$.fragment,Ne),c=W(Ne),re(d.$$.fragment,Ne),Ne.forEach(y),$=W(ke),E=P(ke,"DIV",{class:!0});var he=T(E);I=P(he,"DIV",{class:!0});var ze=T(I);S=P(ze,"DIV",{class:!0});var ct=T(S);for(let Ue=0;Ue<ye.length;Ue+=1)ye[Ue].l(ct);ct.forEach(y),C=W(ze),re(u.$$.fragment,ze),ze.forEach(y),v=W(he),b=P(he,"DIV",{class:!0});var Qe=T(b);re(_.$$.fragment,Qe),N=W(Qe),re(D.$$.fragment,Qe),O=W(Qe),Y=P(Qe,"DIV",{class:!0});var We=T(Y);for(let Ue=0;Ue<me.length;Ue+=1)me[Ue].l(We);We.forEach(y),Qe.forEach(y),he.forEach(y),ke.forEach(y),pe.forEach(y),this.h()},h(){m(l,"class","title"),m(l,"role","group"),m(g,"class","bounding transformer-bounding svelte-r5b4c7"),le(g,"active",n[4]),m(V,"class","bounding mlp-bounding svelte-r5b4c7"),le(V,"active",n[1]),m(G,"class","column initial"),m(R,"class","layer first-layer flex svelte-r5b4c7"),m(S,"class","column"),m(I,"class","projections flex"),m(Y,"class","column out"),m(b,"class","ouputs flex"),m(E,"class","layer second-layer flex justify-between svelte-r5b4c7"),m(o,"class","content relative svelte-r5b4c7"),m(e,"class",te=de(ce("mlp",n[0]))+" svelte-r5b4c7")},m(J,pe){Z(J,e,pe),k(e,l),k(e,r),k(e,o),oe(s,o,null),k(o,f),oe(a,o,null),k(o,i),oe(h,o,null),k(o,p),k(o,g),k(o,w),k(o,V),k(o,j),k(o,R),k(R,G);for(let ke=0;ke<ve.length;ke+=1)ve[ke]&&ve[ke].m(G,null);k(R,M),oe(q,R,null),k(R,L),oe(z,R,null),k(R,A),oe(H,R,null),k(R,c),oe(d,R,null),k(o,$),k(o,E),k(E,I),k(I,S);for(let ke=0;ke<ye.length;ke+=1)ye[ke]&&ye[ke].m(S,null);k(I,C),oe(u,I,null),k(E,v),k(E,b),oe(_,b,null),k(b,N),oe(D,b,null),k(b,O),k(b,Y);for(let ke=0;ke<me.length;ke+=1)me[ke]&&me[ke].m(Y,null);fe=!0,X||(ue=[Ee(l,"mouseenter",n[6]),Ee(l,"mouseleave",n[7])],X=!0)},p(J,[pe]){const ke={};pe&32776&&(ke.$$scope={dirty:pe,ctx:J}),s.$set(ke);const Ne={};pe&32776&&(Ne.$$scope={dirty:pe,ctx:J}),a.$set(Ne);const st={};if(pe&32776&&(st.$$scope={dirty:pe,ctx:J}),h.$set(st),(!fe||pe&16)&&le(g,"active",J[4]),(!fe||pe&2)&&le(V,"active",J[1]),pe&36){K=be(J[5]);let he;for(he=0;he<K.length;he+=1){const ze=wn(J,K,he);ve[he]?(ve[he].p(ze,pe),F(ve[he],1)):(ve[he]=kn(ze),ve[he].c(),F(ve[he],1),ve[he].m(G,null))}for(Be(),he=K.length;he<ve.length;he+=1)je(he);Pe()}if(pe&32){Te=be(J[5]);let he;for(he=0;he<Te.length;he+=1){const ze=yn(J,Te,he);ye[he]?(ye[he].p(ze,pe),F(ye[he],1)):(ye[he]=En(ze),ye[he].c(),F(ye[he],1),ye[he].m(S,null))}for(Be(),he=Te.length;he<ye.length;he+=1)He(he);Pe()}if(pe&32){Ve=be(J[5]);let he;for(he=0;he<Ve.length;he+=1){const ze=$n(J,Ve,he);me[he]?(me[he].p(ze,pe),F(me[he],1)):(me[he]=In(ze),me[he].c(),F(me[he],1),me[he].m(Y,null))}for(Be(),he=Ve.length;he<me.length;he+=1)$e(he);Pe()}(!fe||pe&1&&te!==(te=de(ce("mlp",J[0]))+" svelte-r5b4c7"))&&m(e,"class",te)},i(J){if(!fe){F(s.$$.fragment,J),F(a.$$.fragment,J),F(h.$$.fragment,J);for(let pe=0;pe<K.length;pe+=1)F(ve[pe]);F(q.$$.fragment,J),F(z.$$.fragment,J),F(H.$$.fragment,J),F(d.$$.fragment,J);for(let pe=0;pe<Te.length;pe+=1)F(ye[pe]);F(u.$$.fragment,J),F(_.$$.fragment,J),F(D.$$.fragment,J);for(let pe=0;pe<Ve.length;pe+=1)F(me[pe]);fe=!0}},o(J){Q(s.$$.fragment,J),Q(a.$$.fragment,J),Q(h.$$.fragment,J),ve=ve.filter(Boolean);for(let pe=0;pe<ve.length;pe+=1)Q(ve[pe]);Q(q.$$.fragment,J),Q(z.$$.fragment,J),Q(H.$$.fragment,J),Q(d.$$.fragment,J),ye=ye.filter(Boolean);for(let pe=0;pe<ye.length;pe+=1)Q(ye[pe]);Q(u.$$.fragment,J),Q(_.$$.fragment,J),Q(D.$$.fragment,J),me=me.filter(Boolean);for(let pe=0;pe<me.length;pe+=1)Q(me[pe]);fe=!1},d(J){J&&y(e),se(s),se(a),se(h),Me(ve,J),se(q),se(z),se(H),se(d),Me(ye,J),se(u),se(_),se(D),Me(me,J),X=!1,Ze(ue)}}}const ss="bg-purple-200",is="bg-indigo-200",as="bg-blue-200";function cs(n,e,l){let t,r,o;Ce(n,Mt,w=>l(3,t=w)),Ce(n,jt,w=>l(4,r=w)),Ce(n,mt,w=>l(5,o=w));let{className:s=void 0}=e;Yt("block-id","mlp");let f=!1;function a(){l(1,f=!0)}function i(){l(1,f=!1)}let h=null;const p=w=>{l(2,h=w)},g=()=>{l(2,h=null)};return n.$$set=w=>{"className"in w&&l(0,s=w.className)},[s,f,h,t,r,o,a,i,p,g]}class fs extends Re{constructor(e){super(),Fe(this,e,cs,os,Ge,{className:0})}}var us=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,tl=Math.ceil,rt=Math.floor,Je="[BigNumber Error] ",Cn=Je+"Number primitive has more than 15 significant digits: ",it=1e14,we=14,ll=9007199254740991,nl=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],$t=1e7,xe=1e9;function Rn(n){var e,l,t,r=M.prototype={constructor:M,toString:null,valueOf:null},o=new M(1),s=20,f=4,a=-7,i=21,h=-1e7,p=1e7,g=!1,w=1,V=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},R="0123456789abcdefghijklmnopqrstuvwxyz",G=!0;function M(c,d){var $,E,I,S,C,u,v,b,_=this;if(!(_ instanceof M))return new M(c,d);if(d==null){if(c&&c._isBigNumber===!0){_.s=c.s,!c.c||c.e>p?_.c=_.e=null:c.e<h?_.c=[_.e=0]:(_.e=c.e,_.c=c.c.slice());return}if((u=typeof c=="number")&&c*0==0){if(_.s=1/c<0?(c=-c,-1):1,c===~~c){for(S=0,C=c;C>=10;C/=10,S++);S>p?_.c=_.e=null:(_.e=S,_.c=[c]);return}b=String(c)}else{if(!us.test(b=String(c)))return t(_,b,u);_.s=b.charCodeAt(0)==45?(b=b.slice(1),-1):1}(S=b.indexOf("."))>-1&&(b=b.replace(".","")),(C=b.search(/e/i))>0?(S<0&&(S=C),S+=+b.slice(C+1),b=b.substring(0,C)):S<0&&(S=b.length)}else{if(Le(d,2,R.length,"Base"),d==10&&G)return _=new M(c),A(_,s+_.e+1,f);if(b=String(c),u=typeof c=="number"){if(c*0!=0)return t(_,b,u,d);if(_.s=1/c<0?(b=b.slice(1),-1):1,M.DEBUG&&b.replace(/^0\.0*|\./,"").length>15)throw Error(Cn+c)}else _.s=b.charCodeAt(0)===45?(b=b.slice(1),-1):1;for($=R.slice(0,d),S=C=0,v=b.length;C<v;C++)if($.indexOf(E=b.charAt(C))<0){if(E=="."){if(C>S){S=v;continue}}else if(!I&&(b==b.toUpperCase()&&(b=b.toLowerCase())||b==b.toLowerCase()&&(b=b.toUpperCase()))){I=!0,C=-1,S=0;continue}return t(_,String(c),u,d)}u=!1,b=l(b,d,10,_.s),(S=b.indexOf("."))>-1?b=b.replace(".",""):S=b.length}for(C=0;b.charCodeAt(C)===48;C++);for(v=b.length;b.charCodeAt(--v)===48;);if(b=b.slice(C,++v)){if(v-=C,u&&M.DEBUG&&v>15&&(c>ll||c!==rt(c)))throw Error(Cn+_.s*c);if((S=S-C-1)>p)_.c=_.e=null;else if(S<h)_.c=[_.e=0];else{if(_.e=S,_.c=[],C=(S+1)%we,S<0&&(C+=we),C<v){for(C&&_.c.push(+b.slice(0,C)),v-=we;C<v;)_.c.push(+b.slice(C,C+=we));C=we-(b=b.slice(C)).length}else C-=v;for(;C--;b+="0");_.c.push(+b)}}else _.c=[_.e=0]}M.clone=Rn,M.ROUND_UP=0,M.ROUND_DOWN=1,M.ROUND_CEIL=2,M.ROUND_FLOOR=3,M.ROUND_HALF_UP=4,M.ROUND_HALF_DOWN=5,M.ROUND_HALF_EVEN=6,M.ROUND_HALF_CEIL=7,M.ROUND_HALF_FLOOR=8,M.EUCLID=9,M.config=M.set=function(c){var d,$;if(c!=null)if(typeof c=="object"){if(c.hasOwnProperty(d="DECIMAL_PLACES")&&($=c[d],Le($,0,xe,d),s=$),c.hasOwnProperty(d="ROUNDING_MODE")&&($=c[d],Le($,0,8,d),f=$),c.hasOwnProperty(d="EXPONENTIAL_AT")&&($=c[d],$&&$.pop?(Le($[0],-xe,0,d),Le($[1],0,xe,d),a=$[0],i=$[1]):(Le($,-xe,xe,d),a=-(i=$<0?-$:$))),c.hasOwnProperty(d="RANGE"))if($=c[d],$&&$.pop)Le($[0],-xe,-1,d),Le($[1],1,xe,d),h=$[0],p=$[1];else if(Le($,-xe,xe,d),$)h=-(p=$<0?-$:$);else throw Error(Je+d+" cannot be zero: "+$);if(c.hasOwnProperty(d="CRYPTO"))if($=c[d],$===!!$)if($)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))g=$;else throw g=!$,Error(Je+"crypto unavailable");else g=$;else throw Error(Je+d+" not true or false: "+$);if(c.hasOwnProperty(d="MODULO_MODE")&&($=c[d],Le($,0,9,d),w=$),c.hasOwnProperty(d="POW_PRECISION")&&($=c[d],Le($,0,xe,d),V=$),c.hasOwnProperty(d="FORMAT"))if($=c[d],typeof $=="object")j=$;else throw Error(Je+d+" not an object: "+$);if(c.hasOwnProperty(d="ALPHABET"))if($=c[d],typeof $=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test($))G=$.slice(0,10)=="0123456789",R=$;else throw Error(Je+d+" invalid: "+$)}else throw Error(Je+"Object expected: "+c);return{DECIMAL_PLACES:s,ROUNDING_MODE:f,EXPONENTIAL_AT:[a,i],RANGE:[h,p],CRYPTO:g,MODULO_MODE:w,POW_PRECISION:V,FORMAT:j,ALPHABET:R}},M.isBigNumber=function(c){if(!c||c._isBigNumber!==!0)return!1;if(!M.DEBUG)return!0;var d,$,E=c.c,I=c.e,S=c.s;e:if({}.toString.call(E)=="[object Array]"){if((S===1||S===-1)&&I>=-xe&&I<=xe&&I===rt(I)){if(E[0]===0){if(I===0&&E.length===1)return!0;break e}if(d=(I+1)%we,d<1&&(d+=we),String(E[0]).length==d){for(d=0;d<E.length;d++)if($=E[d],$<0||$>=it||$!==rt($))break e;if($!==0)return!0}}}else if(E===null&&I===null&&(S===null||S===1||S===-1))return!0;throw Error(Je+"Invalid BigNumber: "+c)},M.maximum=M.max=function(){return L(arguments,-1)},M.minimum=M.min=function(){return L(arguments,1)},M.random=function(){var c=9007199254740992,d=Math.random()*c&2097151?function(){return rt(Math.random()*c)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function($){var E,I,S,C,u,v=0,b=[],_=new M(o);if($==null?$=s:Le($,0,xe),C=tl($/we),g)if(crypto.getRandomValues){for(E=crypto.getRandomValues(new Uint32Array(C*=2));v<C;)u=E[v]*131072+(E[v+1]>>>11),u>=9e15?(I=crypto.getRandomValues(new Uint32Array(2)),E[v]=I[0],E[v+1]=I[1]):(b.push(u%1e14),v+=2);v=C/2}else if(crypto.randomBytes){for(E=crypto.randomBytes(C*=7);v<C;)u=(E[v]&31)*281474976710656+E[v+1]*1099511627776+E[v+2]*4294967296+E[v+3]*16777216+(E[v+4]<<16)+(E[v+5]<<8)+E[v+6],u>=9e15?crypto.randomBytes(7).copy(E,v):(b.push(u%1e14),v+=7);v=C/7}else throw g=!1,Error(Je+"crypto unavailable");if(!g)for(;v<C;)u=d(),u<9e15&&(b[v++]=u%1e14);for(C=b[--v],$%=we,C&&$&&(u=nl[we-$],b[v]=rt(C/u)*u);b[v]===0;b.pop(),v--);if(v<0)b=[S=0];else{for(S=-1;b[0]===0;b.splice(0,1),S-=we);for(v=1,u=b[0];u>=10;u/=10,v++);v<we&&(S-=we-v)}return _.e=S,_.c=b,_}}(),M.sum=function(){for(var c=1,d=arguments,$=new M(d[0]);c<d.length;)$=$.plus(d[c++]);return $},l=function(){var c="0123456789";function d($,E,I,S){for(var C,u=[0],v,b=0,_=$.length;b<_;){for(v=u.length;v--;u[v]*=E);for(u[0]+=S.indexOf($.charAt(b++)),C=0;C<u.length;C++)u[C]>I-1&&(u[C+1]==null&&(u[C+1]=0),u[C+1]+=u[C]/I|0,u[C]%=I)}return u.reverse()}return function($,E,I,S,C){var u,v,b,_,N,D,O,Y,te=$.indexOf("."),fe=s,X=f;for(te>=0&&(_=V,V=0,$=$.replace(".",""),Y=new M(E),D=Y.pow($.length-te),V=_,Y.c=d(gt(nt(D.c),D.e,"0"),10,I,c),Y.e=Y.c.length),O=d($,E,I,C?(u=R,c):(u=c,R)),b=_=O.length;O[--_]==0;O.pop());if(!O[0])return u.charAt(0);if(te<0?--b:(D.c=O,D.e=b,D.s=S,D=e(D,Y,fe,X,I),O=D.c,N=D.r,b=D.e),v=b+fe+1,te=O[v],_=I/2,N=N||v<0||O[v+1]!=null,N=X<4?(te!=null||N)&&(X==0||X==(D.s<0?3:2)):te>_||te==_&&(X==4||N||X==6&&O[v-1]&1||X==(D.s<0?8:7)),v<1||!O[0])$=N?gt(u.charAt(1),-fe,u.charAt(0)):u.charAt(0);else{if(O.length=v,N)for(--I;++O[--v]>I;)O[v]=0,v||(++b,O=[1].concat(O));for(_=O.length;!O[--_];);for(te=0,$="";te<=_;$+=u.charAt(O[te++]));$=gt($,b,u.charAt(0))}return $}}(),e=function(){function c(E,I,S){var C,u,v,b,_=0,N=E.length,D=I%$t,O=I/$t|0;for(E=E.slice();N--;)v=E[N]%$t,b=E[N]/$t|0,C=O*v+b*D,u=D*v+C%$t*$t+_,_=(u/S|0)+(C/$t|0)+O*b,E[N]=u%S;return _&&(E=[_].concat(E)),E}function d(E,I,S,C){var u,v;if(S!=C)v=S>C?1:-1;else for(u=v=0;u<S;u++)if(E[u]!=I[u]){v=E[u]>I[u]?1:-1;break}return v}function $(E,I,S,C){for(var u=0;S--;)E[S]-=u,u=E[S]<I[S]?1:0,E[S]=u*C+E[S]-I[S];for(;!E[0]&&E.length>1;E.splice(0,1));}return function(E,I,S,C,u){var v,b,_,N,D,O,Y,te,fe,X,ue,K,ve,je,Te,ye,He,Ve=E.s==I.s?1:-1,me=E.c,$e=I.c;if(!me||!me[0]||!$e||!$e[0])return new M(!E.s||!I.s||(me?$e&&me[0]==$e[0]:!$e)?NaN:me&&me[0]==0||!$e?Ve*0:Ve/0);for(te=new M(Ve),fe=te.c=[],b=E.e-I.e,Ve=S+b+1,u||(u=it,b=ot(E.e/we)-ot(I.e/we),Ve=Ve/we|0),_=0;$e[_]==(me[_]||0);_++);if($e[_]>(me[_]||0)&&b--,Ve<0)fe.push(1),N=!0;else{for(je=me.length,ye=$e.length,_=0,Ve+=2,D=rt(u/($e[0]+1)),D>1&&($e=c($e,D,u),me=c(me,D,u),ye=$e.length,je=me.length),ve=ye,X=me.slice(0,ye),ue=X.length;ue<ye;X[ue++]=0);He=$e.slice(),He=[0].concat(He),Te=$e[0],$e[1]>=u/2&&Te++;do{if(D=0,v=d($e,X,ye,ue),v<0){if(K=X[0],ye!=ue&&(K=K*u+(X[1]||0)),D=rt(K/Te),D>1)for(D>=u&&(D=u-1),O=c($e,D,u),Y=O.length,ue=X.length;d(O,X,Y,ue)==1;)D--,$(O,ye<Y?He:$e,Y,u),Y=O.length,v=1;else D==0&&(v=D=1),O=$e.slice(),Y=O.length;if(Y<ue&&(O=[0].concat(O)),$(X,O,ue,u),ue=X.length,v==-1)for(;d($e,X,ye,ue)<1;)D++,$(X,ye<ue?He:$e,ue,u),ue=X.length}else v===0&&(D++,X=[0]);fe[_++]=D,X[0]?X[ue++]=me[ve]||0:(X=[me[ve]],ue=1)}while((ve++<je||X[0]!=null)&&Ve--);N=X[0]!=null,fe[0]||fe.splice(0,1)}if(u==it){for(_=1,Ve=fe[0];Ve>=10;Ve/=10,_++);A(te,S+(te.e=_+b*we-1)+1,C,N)}else te.e=b,te.r=+N;return te}}();function q(c,d,$,E){var I,S,C,u,v;if($==null?$=f:Le($,0,8),!c.c)return c.toString();if(I=c.c[0],C=c.e,d==null)v=nt(c.c),v=E==1||E==2&&(C<=a||C>=i)?Wt(v,C):gt(v,C,"0");else if(c=A(new M(c),d,$),S=c.e,v=nt(c.c),u=v.length,E==1||E==2&&(d<=S||S<=a)){for(;u<d;v+="0",u++);v=Wt(v,S)}else if(d-=C,v=gt(v,S,"0"),S+1>u){if(--d>0)for(v+=".";d--;v+="0");}else if(d+=S-u,d>0)for(S+1==u&&(v+=".");d--;v+="0");return c.s<0&&I?"-"+v:v}function L(c,d){for(var $,E,I=1,S=new M(c[0]);I<c.length;I++)E=new M(c[I]),(!E.s||($=St(S,E))===d||$===0&&S.s===d)&&(S=E);return S}function z(c,d,$){for(var E=1,I=d.length;!d[--I];d.pop());for(I=d[0];I>=10;I/=10,E++);return($=E+$*we-1)>p?c.c=c.e=null:$<h?c.c=[c.e=0]:(c.e=$,c.c=d),c}t=function(){var c=/^(-?)0([xbo])(?=\w[\w.]*$)/i,d=/^([^.]+)\.$/,$=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(S,C,u,v){var b,_=u?C:C.replace(I,"");if(E.test(_))S.s=isNaN(_)?null:_<0?-1:1;else{if(!u&&(_=_.replace(c,function(N,D,O){return b=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!v||v==b?D:N}),v&&(b=v,_=_.replace(d,"$1").replace($,"0.$1")),C!=_))return new M(_,b);if(M.DEBUG)throw Error(Je+"Not a"+(v?" base "+v:"")+" number: "+C);S.s=null}S.c=S.e=null}}();function A(c,d,$,E){var I,S,C,u,v,b,_,N=c.c,D=nl;if(N){e:{for(I=1,u=N[0];u>=10;u/=10,I++);if(S=d-I,S<0)S+=we,C=d,v=N[b=0],_=rt(v/D[I-C-1]%10);else if(b=tl((S+1)/we),b>=N.length)if(E){for(;N.length<=b;N.push(0));v=_=0,I=1,S%=we,C=S-we+1}else break e;else{for(v=u=N[b],I=1;u>=10;u/=10,I++);S%=we,C=S-we+I,_=C<0?0:rt(v/D[I-C-1]%10)}if(E=E||d<0||N[b+1]!=null||(C<0?v:v%D[I-C-1]),E=$<4?(_||E)&&($==0||$==(c.s<0?3:2)):_>5||_==5&&($==4||E||$==6&&(S>0?C>0?v/D[I-C]:0:N[b-1])%10&1||$==(c.s<0?8:7)),d<1||!N[0])return N.length=0,E?(d-=c.e+1,N[0]=D[(we-d%we)%we],c.e=-d||0):N[0]=c.e=0,c;if(S==0?(N.length=b,u=1,b--):(N.length=b+1,u=D[we-S],N[b]=C>0?rt(v/D[I-C]%D[C])*u:0),E)for(;;)if(b==0){for(S=1,C=N[0];C>=10;C/=10,S++);for(C=N[0]+=u,u=1;C>=10;C/=10,u++);S!=u&&(c.e++,N[0]==it&&(N[0]=1));break}else{if(N[b]+=u,N[b]!=it)break;N[b--]=0,u=1}for(S=N.length;N[--S]===0;N.pop());}c.e>p?c.c=c.e=null:c.e<h&&(c.c=[c.e=0])}return c}function H(c){var d,$=c.e;return $===null?c.toString():(d=nt(c.c),d=$<=a||$>=i?Wt(d,$):gt(d,$,"0"),c.s<0?"-"+d:d)}return r.absoluteValue=r.abs=function(){var c=new M(this);return c.s<0&&(c.s=1),c},r.comparedTo=function(c,d){return St(this,new M(c,d))},r.decimalPlaces=r.dp=function(c,d){var $,E,I,S=this;if(c!=null)return Le(c,0,xe),d==null?d=f:Le(d,0,8),A(new M(S),c+S.e+1,d);if(!($=S.c))return null;if(E=((I=$.length-1)-ot(this.e/we))*we,I=$[I])for(;I%10==0;I/=10,E--);return E<0&&(E=0),E},r.dividedBy=r.div=function(c,d){return e(this,new M(c,d),s,f)},r.dividedToIntegerBy=r.idiv=function(c,d){return e(this,new M(c,d),0,1)},r.exponentiatedBy=r.pow=function(c,d){var $,E,I,S,C,u,v,b,_,N=this;if(c=new M(c),c.c&&!c.isInteger())throw Error(Je+"Exponent not an integer: "+H(c));if(d!=null&&(d=new M(d)),u=c.e>14,!N.c||!N.c[0]||N.c[0]==1&&!N.e&&N.c.length==1||!c.c||!c.c[0])return _=new M(Math.pow(+H(N),u?c.s*(2-xt(c)):+H(c))),d?_.mod(d):_;if(v=c.s<0,d){if(d.c?!d.c[0]:!d.s)return new M(NaN);E=!v&&N.isInteger()&&d.isInteger(),E&&(N=N.mod(d))}else{if(c.e>9&&(N.e>0||N.e<-1||(N.e==0?N.c[0]>1||u&&N.c[1]>=24e7:N.c[0]<8e13||u&&N.c[0]<=9999975e7)))return S=N.s<0&&xt(c)?-0:0,N.e>-1&&(S=1/S),new M(v?1/S:S);V&&(S=tl(V/we+2))}for(u?($=new M(.5),v&&(c.s=1),b=xt(c)):(I=Math.abs(+H(c)),b=I%2),_=new M(o);;){if(b){if(_=_.times(N),!_.c)break;S?_.c.length>S&&(_.c.length=S):E&&(_=_.mod(d))}if(I){if(I=rt(I/2),I===0)break;b=I%2}else if(c=c.times($),A(c,c.e+1,1),c.e>14)b=xt(c);else{if(I=+H(c),I===0)break;b=I%2}N=N.times(N),S?N.c&&N.c.length>S&&(N.c.length=S):E&&(N=N.mod(d))}return E?_:(v&&(_=o.div(_)),d?_.mod(d):S?A(_,V,f,C):_)},r.integerValue=function(c){var d=new M(this);return c==null?c=f:Le(c,0,8),A(d,d.e+1,c)},r.isEqualTo=r.eq=function(c,d){return St(this,new M(c,d))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(c,d){return St(this,new M(c,d))>0},r.isGreaterThanOrEqualTo=r.gte=function(c,d){return(d=St(this,new M(c,d)))===1||d===0},r.isInteger=function(){return!!this.c&&ot(this.e/we)>this.c.length-2},r.isLessThan=r.lt=function(c,d){return St(this,new M(c,d))<0},r.isLessThanOrEqualTo=r.lte=function(c,d){return(d=St(this,new M(c,d)))===-1||d===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(c,d){var $,E,I,S,C=this,u=C.s;if(c=new M(c,d),d=c.s,!u||!d)return new M(NaN);if(u!=d)return c.s=-d,C.plus(c);var v=C.e/we,b=c.e/we,_=C.c,N=c.c;if(!v||!b){if(!_||!N)return _?(c.s=-d,c):new M(N?C:NaN);if(!_[0]||!N[0])return N[0]?(c.s=-d,c):new M(_[0]?C:f==3?-0:0)}if(v=ot(v),b=ot(b),_=_.slice(),u=v-b){for((S=u<0)?(u=-u,I=_):(b=v,I=N),I.reverse(),d=u;d--;I.push(0));I.reverse()}else for(E=(S=(u=_.length)<(d=N.length))?u:d,u=d=0;d<E;d++)if(_[d]!=N[d]){S=_[d]<N[d];break}if(S&&(I=_,_=N,N=I,c.s=-c.s),d=(E=N.length)-($=_.length),d>0)for(;d--;_[$++]=0);for(d=it-1;E>u;){if(_[--E]<N[E]){for($=E;$&&!_[--$];_[$]=d);--_[$],_[E]+=it}_[E]-=N[E]}for(;_[0]==0;_.splice(0,1),--b);return _[0]?z(c,_,b):(c.s=f==3?-1:1,c.c=[c.e=0],c)},r.modulo=r.mod=function(c,d){var $,E,I=this;return c=new M(c,d),!I.c||!c.s||c.c&&!c.c[0]?new M(NaN):!c.c||I.c&&!I.c[0]?new M(I):(w==9?(E=c.s,c.s=1,$=e(I,c,0,3),c.s=E,$.s*=E):$=e(I,c,0,w),c=I.minus($.times(c)),!c.c[0]&&w==1&&(c.s=I.s),c)},r.multipliedBy=r.times=function(c,d){var $,E,I,S,C,u,v,b,_,N,D,O,Y,te,fe,X=this,ue=X.c,K=(c=new M(c,d)).c;if(!ue||!K||!ue[0]||!K[0])return!X.s||!c.s||ue&&!ue[0]&&!K||K&&!K[0]&&!ue?c.c=c.e=c.s=null:(c.s*=X.s,!ue||!K?c.c=c.e=null:(c.c=[0],c.e=0)),c;for(E=ot(X.e/we)+ot(c.e/we),c.s*=X.s,v=ue.length,N=K.length,v<N&&(Y=ue,ue=K,K=Y,I=v,v=N,N=I),I=v+N,Y=[];I--;Y.push(0));for(te=it,fe=$t,I=N;--I>=0;){for($=0,D=K[I]%fe,O=K[I]/fe|0,C=v,S=I+C;S>I;)b=ue[--C]%fe,_=ue[C]/fe|0,u=O*b+_*D,b=D*b+u%fe*fe+Y[S]+$,$=(b/te|0)+(u/fe|0)+O*_,Y[S--]=b%te;Y[S]=$}return $?++E:Y.splice(0,1),z(c,Y,E)},r.negated=function(){var c=new M(this);return c.s=-c.s||null,c},r.plus=function(c,d){var $,E=this,I=E.s;if(c=new M(c,d),d=c.s,!I||!d)return new M(NaN);if(I!=d)return c.s=-d,E.minus(c);var S=E.e/we,C=c.e/we,u=E.c,v=c.c;if(!S||!C){if(!u||!v)return new M(I/0);if(!u[0]||!v[0])return v[0]?c:new M(u[0]?E:I*0)}if(S=ot(S),C=ot(C),u=u.slice(),I=S-C){for(I>0?(C=S,$=v):(I=-I,$=u),$.reverse();I--;$.push(0));$.reverse()}for(I=u.length,d=v.length,I-d<0&&($=v,v=u,u=$,d=I),I=0;d;)I=(u[--d]=u[d]+v[d]+I)/it|0,u[d]=it===u[d]?0:u[d]%it;return I&&(u=[I].concat(u),++C),z(c,u,C)},r.precision=r.sd=function(c,d){var $,E,I,S=this;if(c!=null&&c!==!!c)return Le(c,1,xe),d==null?d=f:Le(d,0,8),A(new M(S),c,d);if(!($=S.c))return null;if(I=$.length-1,E=I*we+1,I=$[I]){for(;I%10==0;I/=10,E--);for(I=$[0];I>=10;I/=10,E++);}return c&&S.e+1>E&&(E=S.e+1),E},r.shiftedBy=function(c){return Le(c,-ll,ll),this.times("1e"+c)},r.squareRoot=r.sqrt=function(){var c,d,$,E,I,S=this,C=S.c,u=S.s,v=S.e,b=s+4,_=new M("0.5");if(u!==1||!C||!C[0])return new M(!u||u<0&&(!C||C[0])?NaN:C?S:1/0);if(u=Math.sqrt(+H(S)),u==0||u==1/0?(d=nt(C),(d.length+v)%2==0&&(d+="0"),u=Math.sqrt(+d),v=ot((v+1)/2)-(v<0||v%2),u==1/0?d="5e"+v:(d=u.toExponential(),d=d.slice(0,d.indexOf("e")+1)+v),$=new M(d)):$=new M(u+""),$.c[0]){for(v=$.e,u=v+b,u<3&&(u=0);;)if(I=$,$=_.times(I.plus(e(S,I,b,1))),nt(I.c).slice(0,u)===(d=nt($.c)).slice(0,u))if($.e<v&&--u,d=d.slice(u-3,u+1),d=="9999"||!E&&d=="4999"){if(!E&&(A(I,I.e+s+2,0),I.times(I).eq(S))){$=I;break}b+=4,u+=4,E=1}else{(!+d||!+d.slice(1)&&d.charAt(0)=="5")&&(A($,$.e+s+2,1),c=!$.times($).eq(S));break}}return A($,$.e+s+1,f,c)},r.toExponential=function(c,d){return c!=null&&(Le(c,0,xe),c++),q(this,c,d,1)},r.toFixed=function(c,d){return c!=null&&(Le(c,0,xe),c=c+this.e+1),q(this,c,d)},r.toFormat=function(c,d,$){var E,I=this;if($==null)c!=null&&d&&typeof d=="object"?($=d,d=null):c&&typeof c=="object"?($=c,c=d=null):$=j;else if(typeof $!="object")throw Error(Je+"Argument not an object: "+$);if(E=I.toFixed(c,d),I.c){var S,C=E.split("."),u=+$.groupSize,v=+$.secondaryGroupSize,b=$.groupSeparator||"",_=C[0],N=C[1],D=I.s<0,O=D?_.slice(1):_,Y=O.length;if(v&&(S=u,u=v,v=S,Y-=S),u>0&&Y>0){for(S=Y%u||u,_=O.substr(0,S);S<Y;S+=u)_+=b+O.substr(S,u);v>0&&(_+=b+O.slice(S)),D&&(_="-"+_)}E=N?_+($.decimalSeparator||"")+((v=+$.fractionGroupSize)?N.replace(new RegExp("\\d{"+v+"}\\B","g"),"$&"+($.fractionGroupSeparator||"")):N):_}return($.prefix||"")+E+($.suffix||"")},r.toFraction=function(c){var d,$,E,I,S,C,u,v,b,_,N,D,O=this,Y=O.c;if(c!=null&&(u=new M(c),!u.isInteger()&&(u.c||u.s!==1)||u.lt(o)))throw Error(Je+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+H(u));if(!Y)return new M(O);for(d=new M(o),b=$=new M(o),E=v=new M(o),D=nt(Y),S=d.e=D.length-O.e-1,d.c[0]=nl[(C=S%we)<0?we+C:C],c=!c||u.comparedTo(d)>0?S>0?d:b:u,C=p,p=1/0,u=new M(D),v.c[0]=0;_=e(u,d,0,1),I=$.plus(_.times(E)),I.comparedTo(c)!=1;)$=E,E=I,b=v.plus(_.times(I=b)),v=I,d=u.minus(_.times(I=d)),u=I;return I=e(c.minus($),E,0,1),v=v.plus(I.times(b)),$=$.plus(I.times(E)),v.s=b.s=O.s,S=S*2,N=e(b,E,S,f).minus(O).abs().comparedTo(e(v,$,S,f).minus(O).abs())<1?[b,E]:[v,$],p=C,N},r.toNumber=function(){return+H(this)},r.toPrecision=function(c,d){return c!=null&&Le(c,1,xe),q(this,c,d,2)},r.toString=function(c){var d,$=this,E=$.s,I=$.e;return I===null?E?(d="Infinity",E<0&&(d="-"+d)):d="NaN":(c==null?d=I<=a||I>=i?Wt(nt($.c),I):gt(nt($.c),I,"0"):c===10&&G?($=A(new M($),s+I+1,f),d=gt(nt($.c),$.e,"0")):(Le(c,2,R.length,"Base"),d=l(gt(nt($.c),I,"0"),10,c,E,!0)),E<0&&$.c[0]&&(d="-"+d)),d},r.valueOf=r.toJSON=function(){return H(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,n!=null&&M.set(n),M}function ot(n){var e=n|0;return n>0||n===e?e:e-1}function nt(n){for(var e,l,t=1,r=n.length,o=n[0]+"";t<r;){for(e=n[t++]+"",l=we-e.length;l--;e="0"+e);o+=e}for(r=o.length;o.charCodeAt(--r)===48;);return o.slice(0,r+1||1)}function St(n,e){var l,t,r=n.c,o=e.c,s=n.s,f=e.s,a=n.e,i=e.e;if(!s||!f)return null;if(l=r&&!r[0],t=o&&!o[0],l||t)return l?t?0:-f:s;if(s!=f)return s;if(l=s<0,t=a==i,!r||!o)return t?0:!r^l?1:-1;if(!t)return a>i^l?1:-1;for(f=(a=r.length)<(i=o.length)?a:i,s=0;s<f;s++)if(r[s]!=o[s])return r[s]>o[s]^l?1:-1;return a==i?0:a>i^l?1:-1}function Le(n,e,l,t){if(n<e||n>l||n!==rt(n))throw Error(Je+(t||"Argument")+(typeof n=="number"?n<e||n>l?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function xt(n){var e=n.c.length-1;return ot(n.e/we)==e&&n.c[e]%2!=0}function Wt(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function gt(n,e,l){var t,r;if(e<0){for(r=l+".";++e;r+=l);n=r+n}else if(t=n.length,++e>t){for(r=l,e-=t;--e;r+=l);n+=r}else e<t&&(n=n.slice(0,e)+"."+n.slice(e));return n}Rn();kt(Et);const vt=(n,e,l={})=>{const{color:t="rgba(255,255,255,0)",duration:r=.2,ease:o="power1.in",offset:s={from:"0%",to:"100%"},position:f="+=0",...a}=l,{from:i="0%",to:h="100%"}=s,p=Array.isArray(e)?e.map(g=>g.getAttribute("stop-color")):e.getAttribute("stop-color");n.fromTo(e,{attr:{offset:i,"stop-color":t}},{attr:{offset:h,"stop-color":t},duration:r,ease:o,...a},f).to(e,{attr:{offset:h,"stop-color":g=>Array.isArray(e)?p[g]:p},duration:r,ease:o,...a},"-=50%")},hs=async n=>new Promise(e=>{var He,Ve,me,$e,J,pe,ke,Ne,st,he,ze,ct,Qe,We,Ue,Bt,Pt,Tt,_e,Ie,Xe,Ye;const l=qt.timeline({onComplete:e}),t=.01,r=document.querySelectorAll(".embedding .content .last");l.fromTo(r,{opacity:0},{opacity:1,duration:t});const o=document.querySelectorAll(".sankey .embedding .last");l.set(o,{opacity:.6});const s=(He=document.querySelector("#gray-blue-last"))==null?void 0:He.querySelectorAll("stop")[1];vt(l,s,{duration:t*1.5});const f=document.querySelectorAll(".attention .column .vector.last");l.fromTo(f,{opacity:0},{opacity:1,duration:t});const a=document.querySelectorAll(".sankey-top .attention .last"),i=document.querySelectorAll(".sankey-back .attention .last"),h=document.querySelectorAll(".sankey-top .attention .to-attention-out");l.set(a,{opacity:1}),l.set([i,h],{opacity:.4});const p=(Ve=document.querySelector("#blue-blue-last"))==null?void 0:Ve.querySelectorAll("stop")[1],g=(me=document.querySelector("#red-red-last"))==null?void 0:me.querySelectorAll("stop")[1],w=($e=document.querySelector("#green-green-last"))==null?void 0:$e.querySelectorAll("stop")[1],V=(J=document.querySelector("#blue-blue2-last"))==null?void 0:J.querySelectorAll("stop")[1],j=(pe=document.querySelector("#red-red2-last"))==null?void 0:pe.querySelectorAll("stop")[1],R=(ke=document.querySelector("#green-green2-last"))==null?void 0:ke.querySelectorAll("stop")[1];vt(l,[p,g,w,V,j,R],{});const G=document.querySelectorAll(".attention .head-block .qkv .column .last");l.fromTo(G,{opacity:0},{opacity:1,duration:t});const M=document.querySelectorAll(".sankey g.attention path.key-to-attention"),q=document.querySelectorAll(".sankey g.attention path.query-to-attention");document.querySelectorAll(".sankey g.attention path.to-attention-out");const L=document.querySelector(".attention .attention-result");[...M,...q].forEach(Ke=>{const ft=Ke.getTotalLength();Ke.style.strokeDasharray=ft,Ke.style.strokeDashoffset=ft});const z=.4,A=Number((z/n).toFixed(2));l.to(M,{strokeDashoffset:0,stagger:A,duration:z,ease:"power2.out"},"<+=50%").to(q,{strokeDashoffset:0,stagger:A,duration:z,ease:"power2.out"},"<").from(L.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:z/n,stagger:Number((z/Math.pow(n,2)).toFixed(2)),ease:"power2.out",duration:z},"<");const H=(Ne=document.querySelector("#green-purple"))==null?void 0:Ne.querySelectorAll("stop")[1],c=(st=document.querySelector("#transparent-purple2"))==null?void 0:st.querySelectorAll("stop")[1];vt(l,[c,H],{});const d=document.querySelectorAll(".attention .head-block .head-out .column .cell");l.fromTo(d,{opacity:0},{opacity:1,duration:t});const $=(he=document.querySelector("#purple-purple"))==null?void 0:he.querySelectorAll("stop")[1],E=(ze=document.querySelector("#transparent-purple"))==null?void 0:ze.querySelectorAll("stop")[1],I=(ct=document.querySelector("#purple-purple-last"))==null?void 0:ct.querySelectorAll("stop")[1],S=(Qe=document.querySelector("#transparent-purple-last"))==null?void 0:Qe.querySelectorAll("stop")[1];vt(l,[$,E,I,S],{});const C=document.querySelectorAll(".mlp .first-layer .cell");l.fromTo(C,{opacity:0},{opacity:1,duration:t});const u=document.querySelectorAll(".sankey .mlp .last");l.set(u,{opacity:.4});const v=(We=document.querySelector("#purple-indigo"))==null?void 0:We.querySelectorAll("stop")[1],b=(Ue=document.querySelector("#purple-indigo-last"))==null?void 0:Ue.querySelectorAll("stop")[1];vt(l,[v,b],{});const _=document.querySelectorAll(".mlp .second-layer .projections .cell");l.fromTo(_,{opacity:0},{opacity:1,duration:t});const N=(Bt=document.querySelector("#indigo-blue"))==null?void 0:Bt.querySelectorAll("stop")[1],D=(Pt=document.querySelector("#indigo-blue-last"))==null?void 0:Pt.querySelectorAll("stop")[1];vt(l,[N,D],{});const O=document.querySelectorAll(".mlp .second-layer .ouputs .cell");l.fromTo(O,{opacity:0},{opacity:1,duration:t});const Y=document.querySelectorAll(".sankey .transformer-blocks .last");l.set(Y,{opacity:.6});const te=(Tt=document.querySelector("#blue-white-blue"))==null?void 0:Tt.querySelectorAll("stop")[1],fe=(_e=document.querySelector("#blue-white-blue"))==null?void 0:_e.querySelectorAll("stop")[3],X=(Ie=document.querySelector("#blue-white-blue-last"))==null?void 0:Ie.querySelectorAll("stop")[1],ue=(Xe=document.querySelector("#blue-white-blue-last"))==null?void 0:Xe.querySelectorAll("stop")[3],K=qt.timeline({});vt(K,[te,X],{duration:.3,offset:{to:"50%"},ease:"sine.inOut"}),vt(K,[fe,ue],{duration:.3,offset:{from:"50%"},ease:"sine.inOut"}),l.add(K);const ve=document.querySelectorAll(".transformer-blocks .cell");l.fromTo(ve,{opacity:0},{opacity:1,duration:t});const je=document.querySelectorAll(".sankey .linear-softmax .last");l.set(je,{opacity:.6});const Te=(Ye=document.querySelector("#blue-gray"))==null?void 0:Ye.querySelectorAll("stop")[1];vt(l,Te,{});const ye=document.querySelectorAll(".softmax .content");l.fromTo(ye,{opacity:0},{opacity:1,duration:t})}),ds=async()=>{};Yn.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";const ps=async(n,e)=>{dl.set(!0);const{token_ids:l,input_tokens:t}=await ms(n);mt.set(t),console.log(l);const{outputs:r,prediction:o}=await bs(l),s=Tn(o,e),f=Hn(s);Lt.set({outputs:r,prediction:s,sampled:f}),await hs(t.length),Kt.set(f),dl.set(!1)},gs=async(n,e)=>{const l=Tn(n,e),t=Hn(l);Lt.update(r=>({...r,prediction:l})),await ds(),Kt.set(t)},vs=n=>{const e=Math.max(...n),l=n.map(r=>Math.exp(r-e)),t=l.reduce((r,o)=>r+o,0);return l.map(r=>r/t)},ms=async n=>{const e=await Pn.from_pretrained("Xenova/gpt2"),l=e.encode(n),t=l.map(r=>e.decode([r])).flat();return{token_ids:l,input_tokens:t}},_s=(n,e,l,t)=>{const r=Array.from(n).map((o,s)=>({tokenId:s,logit:o,probability:e[s]}));return r.sort((o,s)=>s.probability-o.probability),r.slice(0,t).map((o,s)=>({...o,rank:s,token:l.decode([o.tokenId])}))},bs=async n=>{try{const e=new Kn("int64",n,[1,n.length]),l=xn(Ln);if(!l)throw new Error("Model session is not initialized.");const t={input:e},r=await l.run(t),o=r.linear_output.data,s=vs(o),f=await Pn.from_pretrained("Xenova/gpt2"),i=_s(o,s,f,100),h=$s.reduce((p,g)=>{const w=r[g];console.log(w);const V={...w,data:Nr([...w.cpuData],w.dims)};return p[g]=V,p},{});return console.log("out",h),{outputs:h,prediction:i}}catch(e){throw console.error("Error during inference:",e.message),e}},$s=["block_0_attn_head_0_attn","block_0_attn_head_0_attn_scaled","block_0_attn_head_0_attn_masked","block_0_attn_head_0_attn_softmax","block_0_attn_head_0_attn_dropout","linear_output"];async function ys(n){const e=await fetch(n);if(!e.ok)throw new Error(`Failed to fetch ${n}`);return e.arrayBuffer()}async function ws(n){const e=await Promise.all(n.map(o=>ys(o))),l=e.reduce((o,s)=>o+s.byteLength,0),t=new Uint8Array(l);let r=0;for(const o of e)t.set(new Uint8Array(o),r),r+=o.byteLength;return t.buffer}function Sn(n){let e,l,t,r,o,s,f;return l=new or({}),{c(){e=B("div"),ne(l.$$.fragment),this.h()},l(a){e=P(a,"DIV",{class:!0,style:!0,role:!0});var i=T(e);re(l.$$.fragment,i),i.forEach(y),this.h()},h(){m(e,"class","qkv-weight-popover svelte-6mb5yb"),m(e,"style",t=`left:${n[0].left}px;top:${n[0].top}px;`),m(e,"role","group")},m(a,i){Z(a,e,i),oe(l,e,null),o=!0,s||(f=[Ee(e,"mouseenter",n[3]),Ee(e,"mouseleave",n[4])],s=!0)},p(a,i){(!o||i&1&&t!==(t=`left:${a[0].left}px;top:${a[0].top}px;`))&&m(e,"style",t)},i(a){o||(F(l.$$.fragment,a),a&&(r||al(()=>{r=Xn(e,zt,{duration:300}),r.start()})),o=!0)},o(a){Q(l.$$.fragment,a),o=!1},d(a){a&&y(e),se(l),s=!1,Ze(f)}}}function ks(n){let e,l,t=(n[2]==="embedding"||n[1])&&Sn(n);return{c(){t&&t.c(),e=pt()},l(r){t&&t.l(r),e=pt()},m(r,o){t&&t.m(r,o),Z(r,e,o),l=!0},p(r,[o]){r[2]==="embedding"||r[1]?t?(t.p(r,o),o&6&&F(t,1)):(t=Sn(r),t.c(),F(t,1),t.m(e.parentNode,e)):t&&(Be(),Q(t,1,1,()=>{t=null}),Pe())},i(r){l||(F(t),l=!0)},o(r){Q(t),l=!1},d(r){r&&y(e),t&&t.d(r)}}}function Es(n,e,l){let t;Ce(n,ol,i=>l(2,t=i));let r,o={left:0,top:0},s=!1;return Nt(()=>{const i=()=>{var j;const p=window.scrollX,g=(j=document.querySelector(".top-bar"))==null?void 0:j.offsetHeight,V=document.querySelector(".step.embedding .content").getBoundingClientRect();l(0,o={left:V.right+p,top:V.top-g})};return i(),r=new ResizeObserver(p=>{i()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(p=>r.observe(p)),()=>{r.disconnect()}}),[o,s,t,()=>{l(1,s=!0)},()=>{l(1,s=!1)}]}class Is extends Re{constructor(e){super(),Fe(this,e,Es,ks,Ge,{})}}function Cs(n){let e,l,t,r,o,s,f,a,i,h,p,g,w,V,j,R,G,M,q,L,z,A,H;return t=new Cr({}),f=new ts({props:{className:"step"}}),i=new eo({props:{className:"step"}}),p=new fs({props:{className:"step"}}),w=new uo({props:{className:"step"}}),j=new wo({props:{className:"step"}}),M=new Is({}),{c(){e=B("div"),l=B("div"),ne(t.$$.fragment),r=U(),o=B("div"),s=B("div"),ne(f.$$.fragment),a=U(),ne(i.$$.fragment),h=U(),ne(p.$$.fragment),g=U(),ne(w.$$.fragment),V=U(),ne(j.$$.fragment),G=U(),ne(M.$$.fragment),q=U(),L=B("div"),this.h()},l(c){e=P(c,"DIV",{class:!0,style:!0});var d=T(e);l=P(d,"DIV",{class:!0});var $=T(l);re(t.$$.fragment,$),$.forEach(y),r=W(d),o=P(d,"DIV",{class:!0});var E=T(o);s=P(E,"DIV",{class:!0});var I=T(s);re(f.$$.fragment,I),a=W(I),re(i.$$.fragment,I),h=W(I),re(p.$$.fragment,I),g=W(I),re(w.$$.fragment,I),V=W(I),re(j.$$.fragment,I),I.forEach(y),G=W(E),re(M.$$.fragment,E),E.forEach(y),q=W(d),L=P(d,"DIV",{class:!0}),T(L).forEach(y),d.forEach(y),this.h()},h(){m(l,"class","sankey opacity-1 svelte-1r5dkt8"),m(s,"class","steps svelte-1r5dkt8"),al(()=>n[6].call(s)),le(s,"expanded",n[2]),m(o,"class","nodes resize-watch svelte-1r5dkt8"),m(L,"class",z=de(ce("dim pointer-events-none",`${n[1].id||""}`,{active:!!n[1].id}))+" svelte-1r5dkt8"),m(e,"class","main-section h-full"),m(e,"style",A=`--vector-height: ${n[3]}px;--title-height: ${n[4]}px;--content-height:${n[0]-n[4]}px;`)},m(c,d){Z(c,e,d),k(e,l),oe(t,l,null),k(e,r),k(e,o),k(o,s),oe(f,s,null),k(s,a),oe(i,s,null),k(s,h),oe(p,s,null),k(s,g),oe(w,s,null),k(s,V),oe(j,s,null),R=Nn(s,n[6].bind(s)),k(o,G),oe(M,o,null),k(e,q),k(e,L),H=!0},p(c,[d]){(!H||d&4)&&le(s,"expanded",c[2]),(!H||d&2&&z!==(z=de(ce("dim pointer-events-none",`${c[1].id||""}`,{active:!!c[1].id}))+" svelte-1r5dkt8"))&&m(L,"class",z),(!H||d&9&&A!==(A=`--vector-height: ${c[3]}px;--title-height: ${c[4]}px;--content-height:${c[0]-c[4]}px;`))&&m(e,"style",A)},i(c){H||(F(t.$$.fragment,c),F(f.$$.fragment,c),F(i.$$.fragment,c),F(p.$$.fragment,c),F(w.$$.fragment,c),F(j.$$.fragment,c),F(M.$$.fragment,c),H=!0)},o(c){Q(t.$$.fragment,c),Q(f.$$.fragment,c),Q(i.$$.fragment,c),Q(p.$$.fragment,c),Q(w.$$.fragment,c),Q(j.$$.fragment,c),Q(M.$$.fragment,c),H=!1},d(c){c&&y(e),se(t),se(f),se(i),se(p),se(w),se(j),R(),se(M)}}}function Ss(n,e,l){let t,r,o,s,f;Ce(n,mt,w=>l(5,t=w)),Ce(n,Lt,w=>l(7,r=w)),Ce(n,sl,w=>l(8,o=w)),Ce(n,at,w=>l(1,s=w)),Ce(n,Xt,w=>l(3,f=w));let a=!1;Nt(async()=>{const V=Array(10).fill(0).map((A,H)=>`${dr}/gpt2-quant.onnx.part${H}`),j=await ws(V),R=new Blob([j],{type:"application/octet-stream"}),G=URL.createObjectURL(R),M=await Qn.create(G,{});Ln.set(M);const q=Jn.subscribe(A=>{ps(A,o)});let L=!0;const z=sl.subscribe(A=>{if(L){L=!1;return}gs(r==null?void 0:r.prediction,A)});return()=>{x,q(),z()}});let i=0,h=At*5;const p=()=>{const w=At*.5*(t.length-1),V=Math.min(Math.max((i-h-w)/t.length/er,tr),lr);Xt.set(V),Mn.set(t.length*V*3+w)};function g(){i=this.offsetHeight,l(0,i)}return n.$$.update=()=>{n.$$.dirty&2&&(s.id!==null?l(2,a=!0):l(2,a=!1)),n.$$.dirty&33&&(i||t.length)&&p()},[i,s,a,f,h,t,g]}class Hs extends Re{constructor(e){super(),Fe(this,e,Ss,Cs,Ge,{})}}export{Hs as component,Ts as universal};
