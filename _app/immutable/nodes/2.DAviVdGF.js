import{s as Ne,G as Ot,D as Yt,H as Ut,I as An,J as mn,M as pn,N as gn,O as _n,a4 as Ee,a5 as Ie,d as C,g as v,p as h,j as N,n as Be,m as ye,z as ct,C as Vt,A as Ue,e as E,c as I,q as Se,w as at,b as M,h as B,k as m,ad as ie,t as se,o as Ce,f as re,P as St,af as bn,v as _e,l as qe,r as Re,a9 as Pt,u as ee,E as Tt,a7 as Jt,ag as Ln}from"../chunks/scheduler.QcZkUrsu.js";import{S as He,i as je,c as te,a as le,m as ne,t as L,b as F,d as oe,g as Ae,e as Le,h as xt,j as Mn,f as Bt}from"../chunks/index.Bylzl8VN.js";import{r as mt,a as pt,t as ut,m as yt,s as Wt,e as me,u as ht,b as ae,g as We,v as kt,w as jt,x as Dt,y as $n,p as zt,d as $t,n as Nt,z as Bn,f as Zt,Z as Nn,i as el,M as Hn,A as yn,P as jn,j as Pn,k as Tn,B as zn,C as Gn,D as Fn}from"../chunks/index.CHTeGXUK.js";import{b as Gt,d as Rn,c as On}from"../chunks/transform.yYZBLT4W.js";import{s as Ht,a as et,M as bt,F as vt,f as it,Q as Wn}from"../chunks/QKVWeightPopover.BbWM2nPV.js";import{a as Zn,i as kn,b as Xn,c as Kn,l as Xt}from"../chunks/linear.D3KXbiNi.js";import{g as Qn,a as Yn,t as Un,b as lt}from"../chunks/index.LjCCkuxf.js";import{P as Jn,a as Ft,H as tl,A as wn}from"../chunks/bignumber.BV3wFKVA.js";import{b as xn}from"../chunks/paths.CZF73G_y.js";function eo(n){let e;const l=n[4].default,t=mn(l,n,n[6],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&64)&&pn(t,l,s,s[6],e?_n(l,s[6],o,null):gn(s[6]),null)},i(s){e||(L(t,s),e=!0)},o(s){F(t,s),e=!1},d(s){t&&t.d(s)}}}function to(n){let e,l;const t=[{rounded:!0},{shadow:!0},n[1],{class:n[0]}];let s={$$slots:{default:[eo]},$$scope:{ctx:n}};for(let o=0;o<t.length;o+=1)s=Ot(s,t[o]);return e=new Jn({props:s}),e.$on("show",n[5]),{c(){te(e.$$.fragment)},l(o){le(e.$$.fragment,o)},m(o,r){ne(e,o,r),l=!0},p(o,[r]){const c=r&3?Qn(t,[t[0],t[1],r&2&&Yn(o[1]),r&1&&{class:o[0]}]):{};r&64&&(c.$$scope={dirty:r,ctx:o}),e.$set(c)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){F(e.$$.fragment,o),l=!1},d(o){oe(e,o)}}}function lo(n,e,l){const t=["type","defaultClass"];let s=Yt(e,t),{$$slots:o={},$$scope:r}=e,{type:c="dark"}=e,{defaultClass:a="py-2 px-3 text-sm font-medium"}=e;const i={dark:"bg-gray-900 text-white dark:bg-gray-700",light:"border-gray-200 bg-white text-gray-900",auto:" bg-white text-gray-900 dark:bg-gray-700 dark:text-white border-gray-200 dark:border-gray-700",custom:""};let u;function f(d){An.call(this,n,d)}return n.$$set=d=>{l(8,e=Ot(Ot({},e),Ut(d))),l(1,s=Yt(e,t)),"type"in d&&l(2,c=d.type),"defaultClass"in d&&l(3,a=d.defaultClass),"$$scope"in d&&l(6,r=d.$$scope)},n.$$.update=()=>{s.color?l(2,c="custom"):l(1,s.color="none",s),["light","auto"].includes(c)&&l(1,s.border=!0,s),l(0,u=Un("tooltip",a,i[c],e.class))},e=Ut(e),[u,s,c,a,o,f,r]}class Je extends He{constructor(e){super(),je(this,e,lo,to,Ne,{type:2,defaultClass:3})}}function En(n=[],e){const l=n.map(r=>r.logit/e),t=l.map(r=>Math.exp(r)),s=t.reduce((r,c)=>r+c,0);return console.log(l,t),n.map((r,c)=>({...r,adjustedLogit:l[c],adjustedProbability:t[c]/s,adjustedExp:t[c]}))}function In(n,e){const l=n.slice(0,e),t=[];let s=0;for(const r of l)s+=r.probability,t.push(s);const o=Math.random();for(let r=0;r<t.length;r++)if(o<t[r])return l[r];return l[0]}const no=!0,kr=Object.freeze(Object.defineProperty({__proto__:null,prerender:no},Symbol.toStringTag,{value:"Module"}));function oo(n,e){let l,t;for(const s of n)s!=null&&(l===void 0?s>=s&&(l=t=s):(l>s&&(l=s),t<s&&(t=s)));return[l,t]}function so(n,e){let l;if(e===void 0)for(const t of n)t!=null&&(l<t||l===void 0&&t>=t)&&(l=t);else{let t=-1;for(let s of n)(s=e(s,++t,n))!=null&&(l<s||l===void 0&&s>=s)&&(l=s)}return l}function ro(n,e){e===void 0&&(e=n,n=Gt);for(var l=0,t=e.length-1,s=e[0],o=new Array(t<0?0:t);l<t;)o[l]=n(s,s=e[++l]);return function(r){var c=Math.max(0,Math.min(t-1,Math.floor(r*=t)));return o[c](r-c)}}function ao(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function io(){var n=0,e=.5,l=1,t=1,s,o,r,c,a,i=kn,u,f=!1,d;function p(q){return isNaN(q=+q)?d:(q=.5+((q=+u(q))-o)*(t*q<t*o?c:a),i(f?Math.max(0,Math.min(1,q)):q))}p.domain=function(q){return arguments.length?([n,e,l]=q,s=u(n=+n),o=u(e=+e),r=u(l=+l),c=s===o?0:.5/(o-s),a=o===r?0:.5/(r-o),t=o<s?-1:1,p):[n,e,l]},p.clamp=function(q){return arguments.length?(f=!!q,p):f},p.interpolator=function(q){return arguments.length?(i=q,p):i};function $(q){return function(H){var P,A,g;return arguments.length?([P,A,g]=H,i=ro(q,[P,A,g]),p):[i(0),i(.5),i(1)]}}return p.range=$(Gt),p.rangeRound=$(Kn),p.unknown=function(q){return arguments.length?(d=q,p):d},function(q){return u=q,s=q(n),o=q(e),r=q(l),c=s===o?0:.5/(o-s),a=o===r?0:.5/(r-o),t=o<s?-1:1,p}}function Cn(){var n=Zn(io()(kn));return n.copy=function(){return ao(n,Cn())},Xn.apply(n,arguments)}const{theme:x}=mt(pt),fe=200,ll={"gray-blue":{0:x.colors.gray[fe],100:x.colors.blue[fe]},"gray-blue-last":{0:x.colors.gray[fe],100:x.colors.blue[fe]},"purple-indigo":{0:x.colors.purple[fe],100:x.colors.indigo[fe]},"purple-indigo-last":{0:x.colors.purple[fe],100:x.colors.indigo[fe]},"indigo-blue":{0:x.colors.indigo[fe],100:x.colors.blue[fe]},"indigo-blue-last":{0:x.colors.indigo[fe],100:x.colors.blue[fe]},"blue-white":{0:x.colors.blue[fe],100:x.colors.white},"red-white":{0:x.colors.red[fe],100:x.colors.white},"green-white":{0:x.colors.green[fe],100:x.colors.white},"red-purple":{0:x.colors.red[fe],100:x.colors.purple[fe]},"blue-purple":{90:x.colors.blue[fe],100:x.colors.purple[fe]},"green-purple":{0:x.colors.green[fe],100:x.colors.purple[fe]},"blue-gray":{0:x.colors.blue[fe],50:x.colors.gray[fe]},"blue-white-blue":{0:x.colors.blue[fe],40:x.colors.white,60:x.colors.white,100:x.colors.blue[fe]},"blue-white-blue-last":{0:x.colors.blue[fe],40:x.colors.white,60:x.colors.white,100:x.colors.blue[fe]},"transparent-purple":{0:{color:x.colors.purple[100],opacity:0},100:{color:x.colors.purple[100],opacity:1}},"transparent-purple2":{0:{color:x.colors.purple[400],opacity:0},100:{color:x.colors.purple[200],opacity:1}},"transparent-purple-last":{0:{color:x.colors.purple[100],opacity:0},100:{color:x.colors.purple[100],opacity:1}},"transparent-purple2-last":{0:{color:x.colors.purple[400],opacity:0},100:{color:x.colors.purple[200],opacity:1}},"blue-blue":{0:x.colors.blue[fe],100:x.colors.blue[fe]},"red-red":{0:x.colors.red[fe],100:x.colors.red[fe]},"green-green":{0:x.colors.green[fe],100:x.colors.green[fe]},"blue-blue2":{0:x.colors.blue[fe],100:x.colors.blue[fe]},"red-red2":{0:x.colors.red[fe],100:x.colors.red[fe]},"green-green2":{0:x.colors.green[fe],100:x.colors.green[fe]},"blue-blue-last":{0:x.colors.blue[fe],100:x.colors.blue[fe]},"red-red-last":{0:x.colors.red[fe],100:x.colors.red[fe]},"green-green-last":{0:x.colors.green[fe],100:x.colors.green[fe]},"blue-blue2-last":{0:x.colors.blue[fe],100:x.colors.blue[fe]},"red-red2-last":{0:x.colors.red[fe],100:x.colors.red[fe]},"green-green2-last":{0:x.colors.green[fe],100:x.colors.green[fe]},"gray-gray":{0:x.colors.gray[fe],100:x.colors.gray[fe]},"purple-purple":{0:x.colors.purple[fe],100:x.colors.purple[fe]},"purple-purple-last":{0:x.colors.purple[fe],100:x.colors.purple[fe]}};function co(n){let e,l,t,s;return{c(){e=Ee("svg"),t=Ee("svg"),this.h()},l(o){e=Ie(o,"svg",{id:!0,class:!0,style:!0}),C(e).forEach(v),t=Ie(o,"svg",{class:!0,style:!0}),C(t).forEach(v),this.h()},h(){h(e,"id","back"),h(e,"class","sankey-back absolute left-0 top-0 h-full w-full"),h(e,"style",l=`z-index:${n[2].attention_head_num-1};`),h(t,"class","sankey-top absolute left-0 top-0 h-full w-full"),h(t,"style",s=`z-index:${n[2].attention_head_num};`)},m(o,r){N(o,e,r),n[4](e),N(o,t,r),n[5](t)},p(o,[r]){r&4&&l!==(l=`z-index:${o[2].attention_head_num-1};`)&&h(e,"style",l),r&4&&s!==(s=`z-index:${o[2].attention_head_num};`)&&h(t,"style",s)},i:Be,o:Be,d(o){o&&(v(e),v(t)),n[4](null),n[5](null)}}}const uo=80;function fo(n,e,l){let t,s,o;ye(n,ut,g=>l(3,s=g)),ye(n,yt,g=>l(2,o=g));const{theme:r}=mt(pt);let c,a,i;const u={attention:[{from:".attention .query .head-rest",to:".head-block .query .vector",gradientId:"blue-blue2",opacity:.4},{from:".attention .key .head-rest",to:".head-block .key .vector",gradientId:"red-red2",opacity:.4},{from:".attention .value .head-rest",to:".head-block .value .vector",gradientId:"green-green2",opacity:.4},{from:".attention .head-out .vector",to:".mlp .initial .vector .head-rest",gradientId:"transparent-purple",opacity:.4}]},f=()=>{const D=et(a).append("defs");Object.keys(ll).forEach(V=>{const _=ll[V],w=D.append("linearGradient").attr("id",V).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");Object.keys(_).forEach(R=>{let O,z;typeof _[R]!="string"?(O=_[R].color,z=_[R].opacity):(O=_[R],z=1),w.append("stop").attr("offset",`${R}%`).attr("stop-color",O).attr("stop-opacity",z)})})};let d=1,p;const $=async()=>{await Vt();const g=et(a),D=et(c);[{dataMap:t,svg:g},{dataMap:u,svg:D}].forEach(({dataMap:V,svg:_})=>{_.selectAll("g.path-group").data(Object.keys(V)).join("g").attr("class",R=>`path-group ${R}`).on("mouseenter",(R,O)=>{clearTimeout(p),Wt.set(O);const z=et(`g.${O}`).selectAll("path");d=z.nodes()[0].getAttribute("opacity"),z.transition().duration(300).style("opacity",Number(d)+.2)}).on("mouseleave",(R,O)=>{p=setTimeout(()=>{Wt.set(null)},300),et(`g.${O}`).selectAll("path").transition().duration(300).style("opacity",d)}).selectAll("path.sankey-path").data(R=>V[R].map(z=>{const X=Ht(z.from).nodes(),Q=Ht(z.to).nodes();return X.map((Y,U)=>{const y=Y.getBoundingClientRect(),G=Q[U].getBoundingClientRect(),k=z.curve||uo,T=(z.pathGenerator||q)(y,G,k),b=Q.length>1&&U===X.length-1;let J=z.gradientId;return b&&!z.unique&&document.getElementById(z.gradientId+"-last")&&(J=z.gradientId+"-last"),{id:z.id,isLast:U===X.length-1,path:T,fill:z.type==="stroke"?"none":z.gradientId?`url(#${J})`:z.fill,opacity:z.opacity,stroke:z.type==="stroke"?z.gradientId?`url(#${z.gradientId})`:z.fill:"none"}})}).flat()).join("path").attr("class",R=>`sankey-path ${R.id||""} ${R.isLast?"last":""}`).attr("fill",R=>R.fill).attr("stroke",R=>R.stroke).attr("stroke-width",2).attr("opacity",R=>R.opacity||1).attr("d",R=>R.path)})},q=(g,D,V)=>{const _=window.scrollY,w=window.scrollX;return`
        M ${g.right+w},${g.top+_}
        C ${g.right+w+V},${g.top+_} ${D.left+w-V},${D.top+_} ${D.left+w},${D.top+_}
        L ${D.left+w},${D.bottom+_}
        C ${D.left+w-V},${D.bottom+_} ${g.right+w+V},${g.bottom+_} ${g.right+w},${g.bottom+_}
        Z
    `};ct(()=>(f(),i=new ResizeObserver(D=>{$(),H()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(D=>i.observe(D)),()=>{i.disconnect()}));const H=()=>{const g=et(a),D=Ht(".residual-start path.head").nodes(),V=Ht(".residual-end path.head").nodes(),_=D.map((w,R)=>{const O=w.getBoundingClientRect(),z=V[R].getBoundingClientRect(),X=O.right,Q=O.top,Y=z.left,U=z.top;return{x1:X,y1:Q,x2:Y,y2:U,id:w.id}});g.selectAll("line.residual-connector").data(_).join("line").attr("class",w=>`residual-connector ${w.id}`).attr("x1",w=>w.x1).attr("y1",w=>w.y1).attr("x2",w=>w.x2).attr("y2",w=>w.y2).attr("stroke",r.colors.gray[400]).attr("stroke-width",1).attr("stroke-dasharray","8,4").style("opacity",0)};function P(g){Ue[g?"unshift":"push"](()=>{c=g,l(0,c)})}function A(g){Ue[g?"unshift":"push"](()=>{a=g,l(1,a)})}return n.$$.update=()=>{n.$$.dirty&8&&(t={embedding:[{from:".embedding .vector-column .column.vectors .vector",to:".attention .vector",gradientId:"gray-blue",opacity:.6,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX,R=30;return`
					M ${g.right+w},${g.top+_}
					L ${g.right+R+w},${g.top+_}
					C ${g.right+R+w+V},${g.top+_} ${D.left+w-V},${D.top+_} ${D.left+w},${D.top+_}
					L ${D.left+w},${D.bottom+_}
					C ${D.left+w-V},${D.bottom+_} ${g.right+R+w+V},${g.bottom+_} ${g.right+R+w},${g.bottom+_}
					L ${g.right+w},${g.bottom+_}
					Z
				`}}],attention:[{from:".attention .query .sub-vector.head1",to:".head-block .query .vector",gradientId:"blue-blue"},{from:".attention .key .sub-vector.head1",to:".head-block .key .vector",gradientId:"red-red"},{from:".attention .value .sub-vector.head1",to:".head-block .value .vector",gradientId:"green-green"},{from:".attention .head-out .vector",to:".mlp .initial .head1",gradientId:"purple-purple"},{from:".head-block .key .vector",to:".attention-initial .main g.g-row",id:"key-to-attention",type:"stroke",gradientId:"red-purple",unique:!0,curve:30,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX,R=g.top+_+g.height/2,O=D.top+_+D.height/2,z=g.right+w+V,X=D.left+w-V;return`
			    M ${g.right+w},${R}
			    C ${z},${R} ${X},${O} ${D.left+w},${O}
					L ${D.right+w},${O}
			`}},{from:".head-block .query .vector",to:`.attention-matrix.attention-initial .main g.g-row-${s.length-1} circle`,gradientId:"blue-purple",id:"query-to-attention",unique:!0,type:"stroke",curve:20,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX,R=g.top+_+g.height/2,O=D.left+w+D.width/2;return`
			    M ${g.right+w},${R}
			    L ${O-V},${R}
			    A ${V},${V} 0 0 1 ${O},${R+V}
			    L ${O},${D.bottom+_}
			`}},{from:".attention-matrix.attention-out .main svg",to:".attention .head-out",gradientId:"transparent-purple2",id:"to-attention-out",unique:!0,opacity:.4,curve:20,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX;return`
			    M ${g.right+w},${g.top+_}
			    C ${g.right+w+V},${g.top+_} ${D.left+w-V},${D.top+_} ${D.left+w},${D.top+_}
			    L ${D.left+w},${D.bottom+_}
			    C ${D.left+w-V},${D.bottom+_} ${g.right+w+V},${g.bottom+_} ${g.right+w},${g.bottom+_}
			    Z
			`}},{from:".head-block .value",to:".attention .head-out",gradientId:"green-purple",id:"to-attention-out",unique:!0,opacity:.4,curve:60,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX;return`
        M ${g.right+w},${g.top+_} 
        C ${D.left-V},${g.top+_} ${D.left+w-V},${g.top+_} ${D.left+w},${D.top+_}
        L ${D.left+w},${D.bottom+_}
        C ${D.left+w-V},${g.bottom+_} ${D.left-V},${g.bottom+_} ${g.right+w},${g.bottom+_}
        Z
    `}}],mlp:[{from:".mlp .column.initial .vector",to:".mlp .projections .vector",gradientId:"purple-indigo",curve:50,opacity:.4,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX,R=49;return`
					M ${g.right+w},${g.top+_}
					L ${g.right+R+w},${g.top+_}
					C ${g.right+R+w+V},${g.top+_} ${D.left+w-V},${D.top+_} ${D.left+w},${D.top+_}
					L ${D.left+w},${D.bottom+_}
					C ${D.left+w-V},${D.bottom+_} ${g.right+R+w+V},${g.bottom+_} ${g.right+R+w},${g.bottom+_}
					L ${g.right+w},${g.bottom+_}
					Z
				`}},{from:".mlp .projections .vector",to:".mlp .column.out .vector",gradientId:"indigo-blue",curve:50,opacity:.4,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX,R=20;return`
					M ${g.right+w},${g.top+_}
					C ${g.right+w+V},${g.top+_} ${D.left-R+w-V},${D.top+_} ${D.left-R+w},${D.top+_}
					L ${D.left+w},${D.top+_}
					L ${D.left+w},${D.bottom+_}
					L ${D.left-R+w},${D.bottom+_}
					C ${D.left-R+w-V},${D.bottom+_} ${g.right+w+V},${g.bottom+_} ${g.right+w},${g.bottom+_}
					L ${g.right+w},${g.bottom+_}
					Z
				`}}],"transformer-blocks":[{from:".mlp .out .vector",to:".transformer-blocks .column.final .vector",gradientId:"blue-white-blue",opacity:.6,pathGenerator:(g,D,V)=>{const _=window.scrollY,w=window.scrollX;return`
        M ${g.right+w},${g.top+_}
        C ${g.right+w+V},${g.top+_} ${D.left+w-V},${D.top+_} ${D.left+w},${D.top+_}
        L ${D.left+w},${D.bottom+_}
        C ${D.left+w-V},${D.bottom+_} ${g.right+w+V},${g.bottom+_} ${g.right+w},${g.bottom+_}
        Z
    `}}],"linear-softmax":[{from:".transformer-blocks .final .vector.last-token ",to:".softmax .content .vector",gradientId:"blue-gray",opacity:.4,unique:!0}]}),n.$$.dirty&8&&typeof window<"u"&&s&&($(),H())},[c,a,o,s,P,A]}class ho extends He{constructor(e){super(),je(this,e,fo,co,Ne,{})}}function nl(n,e,l){const t=n.slice();return t[6]=e[l],t[8]=l,t}function vo(n){let e,l,t,s,o;return{c(){e=E("div"),l=E("div"),s=M(),this.h()},l(r){e=I(r,"DIV",{class:!0,style:!0});var c=C(e);l=I(c,"DIV",{class:!0,style:!0}),C(l).forEach(v),s=B(c),c.forEach(v),this.h()},h(){h(l,"class","card svelte-1k8s99h"),h(l,"style",t=`width: ${n[1].width}px; height: ${n[1].height}px;`),h(e,"class","rest absolute"),h(e,"style",o=`transform:translate(${n[8]*ht.x}px,${n[8]*ht.y}px) scale(${1-ht.scale*n[8]}); 
      z-index: ${n[2].attention_head_num-n[8]};opacity:${Math.max(.1,1-n[8]*sl)};`)},m(r,c){N(r,e,c),m(e,l),m(e,s)},p(r,c){c&2&&t!==(t=`width: ${r[1].width}px; height: ${r[1].height}px;`)&&h(l,"style",t),c&4&&o!==(o=`transform:translate(${r[8]*ht.x}px,${r[8]*ht.y}px) scale(${1-ht.scale*r[8]}); 
      z-index: ${r[2].attention_head_num-r[8]};opacity:${Math.max(.1,1-r[8]*sl)};`)&&h(e,"style",o)},i:Be,o:Be,d(r){r&&v(e)}}}function mo(n){let e,l,t;const s=n[4].default,o=mn(s,n,n[3],null);return{c(){e=E("div"),o&&o.c(),l=M(),this.h()},l(r){e=I(r,"DIV",{class:!0});var c=C(e);o&&o.l(c),l=B(c),c.forEach(v),this.h()},h(){h(e,"class",ie("first-head-content")+" svelte-1k8s99h")},m(r,c){N(r,e,c),o&&o.m(e,null),m(e,l),n[5](e),t=!0},p(r,c){o&&o.p&&(!t||c&8)&&pn(o,s,r,r[3],t?_n(s,r[3],c,null):gn(r[3]),null)},i(r){t||(L(o,r),t=!0)},o(r){F(o,r),t=!1},d(r){r&&v(e),o&&o.d(r),n[5](null)}}}function ol(n){let e,l,t,s;const o=[mo,vo],r=[];function c(a,i){return a[8]===0?0:1}return e=c(n),l=r[e]=o[e](n),{c(){l.c(),t=at()},l(a){l.l(a),t=at()},m(a,i){r[e].m(a,i),N(a,t,i),s=!0},p(a,i){l.p(a,i)},i(a){s||(L(l),s=!0)},o(a){F(l),s=!1},d(a){a&&v(t),r[e].d(a)}}}function po(n){let e,l,t=me(Array(n[2].attention_head_num+1).fill(0)),s=[];for(let r=0;r<t.length;r+=1)s[r]=ol(nl(n,t,r));const o=r=>F(s[r],1,1,()=>{s[r]=null});return{c(){e=E("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var c=C(e);for(let a=0;a<s.length;a+=1)s[a].l(c);c.forEach(v),this.h()},h(){h(e,"class","multi-head flex w-full svelte-1k8s99h")},m(r,c){N(r,e,c);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);l=!0},p(r,[c]){if(c&15){t=me(Array(r[2].attention_head_num+1).fill(0));let a;for(a=0;a<t.length;a+=1){const i=nl(r,t,a);s[a]?(s[a].p(i,c),L(s[a],1)):(s[a]=ol(i),s[a].c(),L(s[a],1),s[a].m(e,null))}for(Ae(),a=t.length;a<s.length;a+=1)o(a);Le()}},i(r){if(!l){for(let c=0;c<t.length;c+=1)L(s[c]);l=!0}},o(r){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)F(s[c]);l=!1},d(r){r&&v(e),Se(s,r)}}}let sl=.1;function go(n,e,l){let t;ye(n,yt,i=>l(2,t=i));let{$$slots:s={},$$scope:o}=e,r,c={width:0,height:0};ct(()=>{const i=new ResizeObserver(u=>{for(let f of u){const{width:d,height:p}=f.contentRect;l(1,c={width:d,height:p})}});return i.observe(r),()=>{i.unobserve(r)}});function a(i){Ue[i?"unshift":"push"](()=>{r=i,l(0,r)})}return n.$$set=i=>{"$$scope"in i&&l(3,o=i.$$scope)},[r,c,t,o,s,a]}class _o extends He{constructor(e){super(),je(this,e,go,po,Ne,{})}}const bo=(n,e)=>{console.log(n,e);const l=e.filter(s=>s!==1),t=(s,o)=>{if(o.length===1)return s.splice(0,o[0]);const r=o[0],c=o.slice(1);return Array.from({length:r},()=>t(s,c))};return t(n,l)},dt=n=>n.map((e,l)=>{let t=new Array(e.length).fill(-1/0);for(let s=0;s<=l&&s<e.length;s++)t[s]=e[s];return t});function $o(n){var Et,It;let e,l,t,s,o,r,c="QK<sup>T</sup>",a,i,u,f=((Et=n[1][0])==null?void 0:Et.toFixed(1))+"",d,p,$,q,H,P=((It=n[1][1])==null?void 0:It.toFixed(1))+"",A,g,D,V,_,w,R,O,z,X,Q,Y,U,y="Scaling · Mask",G,k,j='<span class="val svelte-1y1cy1i">-3.0</span> <div class="bar svelte-1y1cy1i"></div> <span class="val svelte-1y1cy1i">3.0</span>',T,b,J,S,he,de,Z,ge,W,pe,Oe,ze="Softmax · Dropout",we,Ze,Pe='<span class="val svelte-1y1cy1i">-1.0</span> <div class="bar svelte-1y1cy1i"></div> <span class="val svelte-1y1cy1i">1.0</span>',$e,De,K,ue,be,Ve,tt="Attention",ce,Me,nt,Qe,Ge,Te,wt;return s=new bt({props:{className:"main",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),z=new bt({props:{className:"prev absolute top-0 left-0 pointer-events-none",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),Q=new bt({props:{className:"main opacity-0",data:dt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),Z=new bt({props:{className:"prev absolute top-0 left-0  pointer-events-none",data:dt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),W=new bt({props:{className:"main opacity-0",data:dt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),ue=new bt({props:{className:"main",data:dt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),{c(){e=E("div"),l=E("div"),t=E("div"),te(s.$$.fragment),o=M(),r=E("div"),r.innerHTML=c,a=M(),i=E("div"),u=E("span"),d=se(f),p=M(),$=E("div"),q=M(),H=E("span"),A=se(P),D=M(),V=E("div"),_=Ee("svg"),w=Ee("path"),R=M(),O=E("div"),te(z.$$.fragment),X=M(),te(Q.$$.fragment),Y=M(),U=E("div"),U.textContent=y,G=M(),k=E("div"),k.innerHTML=j,T=M(),b=E("div"),J=Ee("svg"),S=Ee("path"),he=M(),de=E("div"),te(Z.$$.fragment),ge=M(),te(W.$$.fragment),pe=M(),Oe=E("div"),Oe.textContent=ze,we=M(),Ze=E("div"),Ze.innerHTML=Pe,De=M(),K=E("div"),te(ue.$$.fragment),be=M(),Ve=E("div"),Ve.textContent=tt,this.h()},l(ve){e=I(ve,"DIV",{class:!0,style:!0});var ke=C(e);l=I(ke,"DIV",{role:!0,class:!0});var Fe=C(l);t=I(Fe,"DIV",{class:!0});var Xe=C(t);le(s.$$.fragment,Xe),o=B(Xe),r=I(Xe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(r)!=="svelte-1uhcjv4"&&(r.innerHTML=c),a=B(Xe),i=I(Xe,"DIV",{class:!0});var Ke=C(i);u=I(Ke,"SPAN",{class:!0});var ot=C(u);d=re(ot,f),ot.forEach(v),p=B(Ke),$=I(Ke,"DIV",{class:!0}),C($).forEach(v),q=B(Ke),H=I(Ke,"SPAN",{class:!0});var gt=C(H);A=re(gt,P),gt.forEach(v),Ke.forEach(v),Xe.forEach(v),D=B(Fe),V=I(Fe,"DIV",{class:!0});var xe=C(V);_=Ie(xe,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var Ct=C(_);w=Ie(Ct,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(w).forEach(v),Ct.forEach(v),R=B(xe),O=I(xe,"DIV",{});var _t=C(O);le(z.$$.fragment,_t),X=B(_t),le(Q.$$.fragment,_t),_t.forEach(v),Y=B(xe),U=I(xe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(U)!=="svelte-15vmxu9"&&(U.textContent=y),G=B(xe),k=I(xe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(k)!=="svelte-bz6asq"&&(k.innerHTML=j),xe.forEach(v),T=B(Fe),b=I(Fe,"DIV",{class:!0});var ft=C(b);J=Ie(ft,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var Qt=C(J);S=Ie(Qt,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(S).forEach(v),Qt.forEach(v),he=B(ft),de=I(ft,"DIV",{});var Lt=C(de);le(Z.$$.fragment,Lt),ge=B(Lt),le(W.$$.fragment,Lt),Lt.forEach(v),pe=B(ft),Oe=I(ft,"DIV",{class:!0,"data-svelte-h":!0}),Ce(Oe)!=="svelte-1fyrzav"&&(Oe.textContent=ze),we=B(ft),Ze=I(ft,"DIV",{class:!0,"data-svelte-h":!0}),Ce(Ze)!=="svelte-1lh8vbm"&&(Ze.innerHTML=Pe),ft.forEach(v),De=B(Fe),K=I(Fe,"DIV",{class:!0});var Mt=C(K);le(ue.$$.fragment,Mt),be=B(Mt),Ve=I(Mt,"DIV",{class:!0,"data-svelte-h":!0}),Ce(Ve)!=="svelte-10aghm9"&&(Ve.textContent=tt),Mt.forEach(v),Fe.forEach(v),ke.forEach(v),this.h()},h(){h(r,"class","matrix-label svelte-1y1cy1i"),h(u,"class","val svelte-1y1cy1i"),h($,"class","bar svelte-1y1cy1i"),h(H,"class","val svelte-1y1cy1i"),h(i,"class","color-scale svelte-1y1cy1i"),h(t,"class",g=ie(ae("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":n[0]}))+" svelte-1y1cy1i"),h(w,"stroke","currentColor"),h(w,"stroke-linecap","round"),h(w,"stroke-linejoin","round"),h(w,"stroke-width","2"),h(w,"d","M19 12H5m14 0-4 4m4-4-4-4"),h(_,"class","arrow svelte-1y1cy1i"),h(_,"aria-hidden","true"),h(_,"xmlns","http://www.w3.org/2000/svg"),h(_,"width","24"),h(_,"height","24"),h(_,"fill","none"),h(_,"viewBox","0 0 24 24"),h(U,"class","matrix-label svelte-1y1cy1i"),h(k,"class","color-scale svelte-1y1cy1i"),h(V,"class","attention-matrix attention-mask flex flex-col items-center svelte-1y1cy1i"),h(S,"stroke","currentColor"),h(S,"stroke-linecap","round"),h(S,"stroke-linejoin","round"),h(S,"stroke-width","2"),h(S,"d","M19 12H5m14 0-4 4m4-4-4-4"),h(J,"class","arrow svelte-1y1cy1i"),h(J,"aria-hidden","true"),h(J,"xmlns","http://www.w3.org/2000/svg"),h(J,"width","24"),h(J,"height","24"),h(J,"fill","none"),h(J,"viewBox","0 0 24 24"),h(Oe,"class","matrix-label svelte-1y1cy1i"),h(Ze,"class","color-scale svelte-1y1cy1i"),h(b,"class",$e=ie(ae("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":n[0]}))+" svelte-1y1cy1i"),h(Ve,"class","matrix-label svelte-1y1cy1i"),h(K,"class",ce=ie(ae("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!n[0],"attention-out":!n[0]}))+" svelte-1y1cy1i"),St(()=>n[24].call(K)),h(l,"role","none"),h(l,"class",nt=ie(ae("attention-matrix-container relative flex gap-3 p-3 pb-1",{active:n[0]}))+" svelte-1y1cy1i"),h(e,"class","flex items-center gap-8 px-5"),h(e,"style",Qe=`--attention-matrix-width: ${n[7]}px;`)},m(ve,ke){N(ve,e,ke),m(e,l),m(l,t),ne(s,t,null),m(t,o),m(t,r),m(t,a),m(t,i),m(i,u),m(u,d),m(i,p),m(i,$),m(i,q),m(i,H),m(H,A),n[20](t),m(l,D),m(l,V),m(V,_),m(_,w),m(V,R),m(V,O),ne(z,O,null),m(O,X),ne(Q,O,null),m(V,Y),m(V,U),m(V,G),m(V,k),n[21](V),m(l,T),m(l,b),m(b,J),m(J,S),m(b,he),m(b,de),ne(Z,de,null),m(de,ge),ne(W,de,null),m(b,pe),m(b,Oe),m(b,we),m(b,Ze),n[22](b),m(l,De),m(l,K),ne(ue,K,null),m(K,be),m(K,Ve),n[23](K),Me=bn(K,n[24].bind(K)),n[25](l),Ge=!0,Te||(wt=[_e(l,"click",n[13]),_e(l,"keydown",n[13])],Te=!0)},p(ve,ke){var Ct,_t;const Fe={};ke[0]&4&&(Fe.data=ve[2]),ke[0]&1024&&(Fe.cellHeight=ve[10]),ke[0]&1024&&(Fe.cellWidth=ve[10]),ke[0]&512&&(Fe.colorScale=ve[9]),s.$set(Fe),(!Ge||ke[0]&2)&&f!==(f=((Ct=ve[1][0])==null?void 0:Ct.toFixed(1))+"")&&qe(d,f),(!Ge||ke[0]&2)&&P!==(P=((_t=ve[1][1])==null?void 0:_t.toFixed(1))+"")&&qe(A,P),(!Ge||ke[0]&1&&g!==(g=ie(ae("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":ve[0]}))+" svelte-1y1cy1i"))&&h(t,"class",g);const Xe={};ke[0]&4&&(Xe.data=ve[2]),ke[0]&1024&&(Xe.cellHeight=ve[10]),ke[0]&1024&&(Xe.cellWidth=ve[10]),ke[0]&512&&(Xe.colorScale=ve[9]),z.$set(Xe);const Ke={};ke[0]&4096&&(Ke.data=dt(ve[12])),ke[0]&1024&&(Ke.cellHeight=ve[10]),ke[0]&1024&&(Ke.cellWidth=ve[10]),Q.$set(Ke);const ot={};ke[0]&4096&&(ot.data=dt(ve[12])),ke[0]&1024&&(ot.cellHeight=ve[10]),ke[0]&1024&&(ot.cellWidth=ve[10]),Z.$set(ot);const gt={};ke[0]&2048&&(gt.data=dt(ve[11])),ke[0]&1024&&(gt.cellHeight=ve[10]),ke[0]&1024&&(gt.cellWidth=ve[10]),W.$set(gt),(!Ge||ke[0]&1&&$e!==($e=ie(ae("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":ve[0]}))+" svelte-1y1cy1i"))&&h(b,"class",$e);const xe={};ke[0]&2048&&(xe.data=dt(ve[11])),ke[0]&1024&&(xe.cellHeight=ve[10]),ke[0]&1024&&(xe.cellWidth=ve[10]),ue.$set(xe),(!Ge||ke[0]&1&&ce!==(ce=ie(ae("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!ve[0],"attention-out":!ve[0]}))+" svelte-1y1cy1i"))&&h(K,"class",ce),(!Ge||ke[0]&1&&nt!==(nt=ie(ae("attention-matrix-container relative flex gap-3 p-3 pb-1",{active:ve[0]}))+" svelte-1y1cy1i"))&&h(l,"class",nt),(!Ge||ke[0]&128&&Qe!==(Qe=`--attention-matrix-width: ${ve[7]}px;`))&&h(e,"style",Qe)},i(ve){Ge||(L(s.$$.fragment,ve),L(z.$$.fragment,ve),L(Q.$$.fragment,ve),L(Z.$$.fragment,ve),L(W.$$.fragment,ve),L(ue.$$.fragment,ve),Ge=!0)},o(ve){F(s.$$.fragment,ve),F(z.$$.fragment,ve),F(Q.$$.fragment,ve),F(Z.$$.fragment,ve),F(W.$$.fragment,ve),F(ue.$$.fragment,ve),Ge=!1},d(ve){ve&&v(e),oe(s),n[20](null),oe(z),oe(Q),n[21](null),oe(Z),oe(W),n[22](null),oe(ue),n[23](null),Me(),n[25](null),Te=!1,Re(wt)}}}let yo=16,ko=20,wo=10;function Eo(n,e,l){let t,s,o,r,c,a,i,u,f,d;ye(n,ut,b=>l(17,u=b)),ye(n,We,b=>l(18,f=b)),ye(n,kt,b=>l(19,d=b));const{theme:p}=mt(pt);let $,q,H,P,A=0,g=!1;const D=Pt("block-id"),V=()=>{g||(We.set({id:D}),z())};let _;function w(b){g&&!_.contains(b.target)&&We.set({id:null})}ct(()=>(document.body.addEventListener("click",w),()=>{document.body.removeEventListener("click",w)}));let R=lt.timeline(),O=lt.timeline();const z=()=>{l(0,g=!0),O.progress(1);const b=document.querySelectorAll("div.sankey g.attention path.key-to-attention"),J=document.querySelectorAll("div.sankey g.attention path.query-to-attention"),S=document.querySelectorAll("div.sankey g.attention path.to-attention-out");[...b,...J].forEach(Z=>{const ge=Z.getTotalLength();Z.style.strokeDasharray=ge,Z.style.strokeDashoffset=ge});const he=1.2,de=Number((he/u.length).toFixed(2));R.set([q.querySelector(".prev"),H.querySelector(".prev")],{opacity:1}).set([q.querySelector(".main"),H.querySelector(".main")],{opacity:0}),R.set(S,{opacity:0}),R.to(P,{opacity:0,display:"none",duration:.2}),R.set($,{width:"auto",display:"flex",opacity:0}).to($,{opacity:1,duration:.5}).to(b,{strokeDashoffset:0,stagger:de,duration:he,ease:"power2.out"}).to(J,{strokeDashoffset:0,stagger:de,duration:he,ease:"power2.out"},"<").from($.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:he/u.length,stagger:Number((he/Math.pow(u.length,2)).toFixed(2)),ease:"power2.out",duration:he},"<"),R.set(q,{width:0,x:A*-1,opacity:0}).to(q,{opacity:1,display:"flex",width:A,x:0,duration:.5}).to(q.querySelector(".prev"),{opacity:0,duration:1}).to(q.querySelector(".main"),{opacity:1,duration:1},"<"),R.set(H,{width:0,x:A*-1,opacity:0}).to(H,{opacity:1,display:"flex",width:A,x:0,duration:.4}).to(H.querySelector(".prev"),{opacity:0,duration:1}).to(H.querySelector(".main"),{opacity:1,duration:1},"<"),R.to(S,{opacity:.5})},X=()=>{l(0,g=!1),R.progress(1),O.to([$,q,H],{opacity:0,display:"none",width:0,duration:.5}),O.to(P,{opacity:1,display:"flex",duration:.5},0)},Q=(b,J)=>Xt().domain([-3,3]).range(["white",p.colors.purple[700]])(b),Y=(b,J)=>Gt("white",p.colors.purple[700])(b);function U(b){Ue[b?"unshift":"push"](()=>{$=b,l(3,$)})}function y(b){Ue[b?"unshift":"push"](()=>{q=b,l(4,q)})}function G(b){Ue[b?"unshift":"push"](()=>{H=b,l(5,H)})}function k(b){Ue[b?"unshift":"push"](()=>{P=b,l(6,P)})}function j(){A=this.offsetWidth,l(7,A)}function T(b){Ue[b?"unshift":"push"](()=>{_=b,l(8,_)})}return n.$$.update=()=>{var b,J,S,he,de,Z;n.$$.dirty[0]&131072&&l(16,t=Array(u.length).fill(0).map(ge=>Array(u.length).fill(-1/0))),n.$$.dirty[0]&589824&&l(2,s=((J=(b=d==null?void 0:d.outputs)==null?void 0:b.block_0_attn_head_0_attn)==null?void 0:J.data)||t),n.$$.dirty[0]&589824&&l(12,o=((he=(S=d==null?void 0:d.outputs)==null?void 0:S.block_0_attn_head_0_attn_masked)==null?void 0:he.data)||t),n.$$.dirty[0]&589824&&l(11,r=((Z=(de=d==null?void 0:d.outputs)==null?void 0:de.block_0_attn_head_0_attn_dropout)==null?void 0:Z.data)||t),n.$$.dirty[0]&131072&&l(10,c=Math.min(ko,Math.max(1/u.length*yo*6,wo))),n.$$.dirty[0]&262145&&f.id!==D&&g&&(l(0,g=!1),X()),n.$$.dirty[0]&4&&l(1,a=oo(s.flat())),n.$$.dirty[0]&2&&l(9,i=(ge,W)=>Xt().domain(a).range(["white",p.colors.purple[700]])(ge))},[g,a,s,$,q,H,P,A,_,i,c,r,o,V,Q,Y,t,u,f,d,U,y,G,k,j,T]}class Io extends He{constructor(e){super(),je(this,e,Eo,$o,Ne,{},null,[-1,-1])}}function Co(n){let e;return{c(){e=E("canvas"),this.h()},l(l){e=I(l,"CANVAS",{class:!0}),C(e).forEach(v),this.h()},h(){h(e,"class","svelte-ex5m8"),ee(e,"active",n[0])},m(l,t){N(l,e,t),n[4](e)},p(l,[t]){t&1&&ee(e,"active",l[0])},i:Be,o:Be,d(l){l&&v(e),n[4](null)}}}let qo=100;const Rt=1;function Do(n,e,l){const{theme:t}=mt(pt);let{active:s=!1}=e,{data:o=new Array(qo).fill(0).map(d=>Math.random())}=e,{colorScale:r=void 0}=e,c;const a=typeof r=="string"?r:"gray",i=typeof r=="function"?r:Gt(t.colors[a][100],t.colors[a][400]);function u(){const d=c.getContext("2d");if(!d)return;const p=c.parentElement.clientWidth,$=c.parentElement.clientHeight;d.clearRect(0,0,p,$);let q=4;l(1,c.width=p*q,c),l(1,c.height=$*q,c),l(1,c.style.width=`${p}px`,c),l(1,c.style.height=`${$}px`,c);for(let H=0;H<$/Rt;H++){const P=o[H];d.fillStyle=i(P),d.fillRect(0,H*Rt*q,p*q,Rt*q)}}ct(()=>{const d=jt.subscribe(u);return()=>{d()}});function f(d){Ue[d?"unshift":"push"](()=>{c=d,l(1,c)})}return n.$$set=d=>{"active"in d&&l(0,s=d.active),"data"in d&&l(2,o=d.data),"colorScale"in d&&l(3,r=d.colorScale)},n.$$.update=()=>{n.$$.dirty&6&&o&&c&&u()},[s,c,o,r,f]}class rt extends He{constructor(e){super(),je(this,e,Do,Co,Ne,{active:0,data:2,colorScale:3})}}function rl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function al(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function il(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function cl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function ul(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Vo(n){let e,l=n[5].dimension*3+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension*3+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function So(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,s;return{c(){e=se("Query, Head 1, vector("),t=se(l),s=se(")")},l(o){e=re(o,"Query, Head 1, vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension/o[5].attention_head_num+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Ao(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,s;return{c(){e=se("Key, Head 1, vector("),t=se(l),s=se(")")},l(o){e=re(o,"Key, Head 1, vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension/o[5].attention_head_num+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Lo(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,s;return{c(){e=se("Value, Head 1, vector("),t=se(l),s=se(")")},l(o){e=re(o,"Value, Head 1, vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension/o[5].attention_head_num+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Mo(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,s;return{c(){e=se("Attention Out, Head 1, vector("),t=se(l),s=se(")")},l(o){e=re(o,"Attention Out, Head 1, vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension/o[5].attention_head_num+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function fl(n){let e,l="Q";return{c(){e=E("span"),e.textContent=l},l(t){e=I(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-10ub4hf"&&(e.textContent=l)},m(t,s){N(t,e,s)},d(t){t&&v(e)}}}function dl(n){let e,l="K";return{c(){e=E("span"),e.textContent=l},l(t){e=I(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-1c09r6x"&&(e.textContent=l)},m(t,s){N(t,e,s)},d(t){t&&v(e)}}}function hl(n){let e,l="V";return{c(){e=E("span"),e.textContent=l},l(t){e=I(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-j40kxg"&&(e.textContent=l)},m(t,s){N(t,e,s)},d(t){t&&v(e)}}}function vl(n){let e,l,t,s,o,r,c,a,i,u,f,d,p,$,q,H,P,A,g,D,V,_,w,R,O;t=new rt({props:{colorScale:"blue",active:n[2]===n[16]}});let z=n[2]!==n[16]&&fl();u=new rt({props:{colorScale:"red",active:n[2]===n[16]}});let X=n[2]!==n[16]&&dl();P=new rt({props:{colorScale:"green",active:n[2]===n[16]}});let Q=n[2]!==n[16]&&hl();function Y(){return n[11](n[16])}return{c(){e=E("div"),l=E("div"),te(t.$$.fragment),s=M(),o=E("div"),r=M(),c=E("div"),z&&z.c(),a=M(),i=E("div"),te(u.$$.fragment),f=M(),d=E("div"),p=M(),$=E("div"),X&&X.c(),q=M(),H=E("div"),te(P.$$.fragment),A=M(),g=E("div"),D=M(),V=E("div"),Q&&Q.c(),_=M(),this.h()},l(U){e=I(U,"DIV",{class:!0,role:!0});var y=C(e);l=I(y,"DIV",{class:!0});var G=C(l);le(t.$$.fragment,G),s=B(G),o=I(G,"DIV",{class:!0}),C(o).forEach(v),r=B(G),c=I(G,"DIV",{class:!0});var k=C(c);z&&z.l(k),k.forEach(v),G.forEach(v),a=B(y),i=I(y,"DIV",{class:!0});var j=C(i);le(u.$$.fragment,j),f=B(j),d=I(j,"DIV",{class:!0}),C(d).forEach(v),p=B(j),$=I(j,"DIV",{class:!0});var T=C($);X&&X.l(T),T.forEach(v),j.forEach(v),q=B(y),H=I(y,"DIV",{class:!0});var b=C(H);le(P.$$.fragment,b),A=B(b),g=I(b,"DIV",{class:!0}),C(g).forEach(v),D=B(b),V=I(b,"DIV",{class:!0});var J=C(V);Q&&Q.l(J),J.forEach(v),b.forEach(v),_=B(y),y.forEach(v),this.h()},h(){h(o,"class",ie(`sub-vector x1-12 head1 ${qn}`)+" svelte-1hhniwm"),h(c,"class","sub-vector head-rest grow svelte-1hhniwm"),h(l,"class",ie(`sub-vector query relative flex grow flex-col ${Ho}`)+" svelte-1hhniwm"),h(d,"class",ie(`sub-vector x1-12 head1 ${Dn}`)+" svelte-1hhniwm"),h($,"class","sub-vector head-rest grow svelte-1hhniwm"),h(i,"class",ie(`sub-vector key relative flex grow flex-col ${jo}`)+" svelte-1hhniwm"),h(g,"class",ie(`sub-vector x1-12 head1 ${Vn}`)+" svelte-1hhniwm"),h(V,"class","sub-vector head-rest grow svelte-1hhniwm"),h(H,"class",ie(`sub-vector value relative flex grow flex-col ${Po}`)+" svelte-1hhniwm"),h(e,"class","qkv-weighted vector x3 flex flex-col"),h(e,"role","group"),ee(e,"last",n[16]===n[6].length-1)},m(U,y){N(U,e,y),m(e,l),ne(t,l,null),m(l,s),m(l,o),m(l,r),m(l,c),z&&z.m(c,null),m(e,a),m(e,i),ne(u,i,null),m(i,f),m(i,d),m(i,p),m(i,$),X&&X.m($,null),m(e,q),m(e,H),ne(P,H,null),m(H,A),m(H,g),m(H,D),m(H,V),Q&&Q.m(V,null),m(e,_),w=!0,R||(O=[_e(e,"mouseenter",Y),_e(e,"mouseleave",n[12])],R=!0)},p(U,y){n=U;const G={};y&4&&(G.active=n[2]===n[16]),t.$set(G),n[2]!==n[16]?z||(z=fl(),z.c(),z.m(c,null)):z&&(z.d(1),z=null);const k={};y&4&&(k.active=n[2]===n[16]),u.$set(k),n[2]!==n[16]?X||(X=dl(),X.c(),X.m($,null)):X&&(X.d(1),X=null);const j={};y&4&&(j.active=n[2]===n[16]),P.$set(j),n[2]!==n[16]?Q||(Q=hl(),Q.c(),Q.m(V,null)):Q&&(Q.d(1),Q=null),(!w||y&64)&&ee(e,"last",n[16]===n[6].length-1)},i(U){w||(L(t.$$.fragment,U),L(u.$$.fragment,U),L(P.$$.fragment,U),w=!0)},o(U){F(t.$$.fragment,U),F(u.$$.fragment,U),F(P.$$.fragment,U),w=!1},d(U){U&&v(e),oe(t),z&&z.d(),oe(u),X&&X.d(),oe(P),Q&&Q.d(),R=!1,Re(O)}}}function ml(n){let e,l,t=n[14]+"",s,o,r,c;return{c(){e=E("div"),l=E("span"),s=se(t),o=M(),r=E("div"),c=M(),this.h()},l(a){e=I(a,"DIV",{class:!0});var i=C(e);l=I(i,"SPAN",{class:!0});var u=C(l);s=re(u,t),u.forEach(v),o=B(i),r=I(i,"DIV",{class:!0}),C(r).forEach(v),c=B(i),i.forEach(v),this.h()},h(){h(l,"class","label float svelte-1hhniwm"),h(r,"class",ie(`vector x1-12  ${qn}`)+" svelte-1hhniwm"),h(e,"class","head1 cell x1-12 text-xs"),ee(e,"last",n[16]===n[6].length-1)},m(a,i){N(a,e,i),m(e,l),m(l,s),m(e,o),m(e,r),m(e,c)},p(a,i){i&64&&t!==(t=a[14]+"")&&qe(s,t),i&64&&ee(e,"last",a[16]===a[6].length-1)},d(a){a&&v(e)}}}function pl(n){let e,l,t=n[14]+"",s,o,r,c,a;return{c(){e=E("div"),l=E("span"),s=se(t),o=M(),r=E("div"),c=M(),this.h()},l(i){e=I(i,"DIV",{class:!0});var u=C(e);l=I(u,"SPAN",{class:!0});var f=C(l);s=re(f,t),f.forEach(v),o=B(u),r=I(u,"DIV",{class:!0}),C(r).forEach(v),c=B(u),u.forEach(v),this.h()},h(){h(l,"class","label float svelte-1hhniwm"),h(r,"class",ie(`vector x1-12 ${Dn}`)+" svelte-1hhniwm"),h(e,"class",a="head1 cell x1-12 text-xs class:last="+(n[16]===n[6].length-1)+" svelte-1hhniwm")},m(i,u){N(i,e,u),m(e,l),m(l,s),m(e,o),m(e,r),m(e,c)},p(i,u){u&64&&t!==(t=i[14]+"")&&qe(s,t),u&64&&a!==(a="head1 cell x1-12 text-xs class:last="+(i[16]===i[6].length-1)+" svelte-1hhniwm")&&h(e,"class",a)},d(i){i&&v(e)}}}function gl(n){let e,l,t=n[14]+"",s,o,r,c;return{c(){e=E("div"),l=E("span"),s=se(t),o=M(),r=E("div"),c=M(),this.h()},l(a){e=I(a,"DIV",{class:!0});var i=C(e);l=I(i,"SPAN",{class:!0});var u=C(l);s=re(u,t),u.forEach(v),o=B(i),r=I(i,"DIV",{class:!0}),C(r).forEach(v),c=B(i),i.forEach(v),this.h()},h(){h(l,"class","label float svelte-1hhniwm"),h(r,"class",ie(`vector x1-12 ${Vn}`)+" svelte-1hhniwm"),h(e,"class","head1 cell x1-12 text-xs"),ee(e,"last",n[16]===n[6].length-1)},m(a,i){N(a,e,i),m(e,l),m(l,s),m(e,o),m(e,r),m(e,c)},p(a,i){i&64&&t!==(t=a[14]+"")&&qe(s,t),i&64&&ee(e,"last",a[16]===a[6].length-1)},d(a){a&&v(e)}}}function _l(n){let e,l,t;return{c(){e=E("div"),l=E("div"),t=M(),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=C(e);l=I(o,"DIV",{class:!0}),C(l).forEach(v),t=B(o),o.forEach(v),this.h()},h(){h(l,"class",ie(`vector x1-12 ${To}`)+" svelte-1hhniwm"),h(e,"class","head1 cell x1-12"),ee(e,"last",n[16]===n[6].length-1)},m(s,o){N(s,e,o),m(e,l),m(e,t)},p(s,o){o&64&&ee(e,"last",s[16]===s[6].length-1)},d(s){s&&v(e)}}}function Bo(n){let e,l,t,s,o="Query",r,c,a,i,u="Key",f,d,p,$,q="Value",H,P,A,g,D,V,_,w,R="Out",O,z,X,Q,Y=n[5].attention_head_num+"",U,y,G,k=me(n[6]),j=[];for(let Z=0;Z<k.length;Z+=1)j[Z]=ml(cl(n,k,Z));let T=me(n[6]),b=[];for(let Z=0;Z<T.length;Z+=1)b[Z]=pl(il(n,T,Z));let J=me(n[6]),S=[];for(let Z=0;Z<J.length;Z+=1)S[Z]=gl(al(n,J,Z));g=new Io({});let he=me(n[6]),de=[];for(let Z=0;Z<he.length;Z+=1)de[Z]=_l(rl(n,he,Z));return{c(){e=E("div"),l=E("div"),t=E("div"),s=E("div"),s.textContent=o,r=M();for(let Z=0;Z<j.length;Z+=1)j[Z].c();c=M(),a=E("div"),i=E("div"),i.textContent=u,f=M();for(let Z=0;Z<b.length;Z+=1)b[Z].c();d=M(),p=E("div"),$=E("div"),$.textContent=q,H=M();for(let Z=0;Z<S.length;Z+=1)S[Z].c();P=M(),A=E("div"),te(g.$$.fragment),D=M(),V=E("div"),_=E("div"),w=E("div"),w.textContent=R,O=M();for(let Z=0;Z<de.length;Z+=1)de[Z].c();z=M(),X=E("div"),Q=se("Head 1 of "),U=se(Y),this.h()},l(Z){e=I(Z,"DIV",{class:!0,style:!0});var ge=C(e);l=I(ge,"DIV",{class:!0});var W=C(l);t=I(W,"DIV",{class:!0});var pe=C(t);s=I(pe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(s)!=="svelte-1a2739d"&&(s.textContent=o),r=B(pe);for(let De=0;De<j.length;De+=1)j[De].l(pe);pe.forEach(v),c=B(W),a=I(W,"DIV",{class:!0});var Oe=C(a);i=I(Oe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(i)!=="svelte-bmmhtu"&&(i.textContent=u),f=B(Oe);for(let De=0;De<b.length;De+=1)b[De].l(Oe);Oe.forEach(v),d=B(W),p=I(W,"DIV",{class:!0});var ze=C(p);$=I(ze,"DIV",{class:!0,"data-svelte-h":!0}),Ce($)!=="svelte-17pe084"&&($.textContent=q),H=B(ze);for(let De=0;De<S.length;De+=1)S[De].l(ze);ze.forEach(v),W.forEach(v),P=B(ge),A=I(ge,"DIV",{class:!0});var we=C(A);le(g.$$.fragment,we),we.forEach(v),D=B(ge),V=I(ge,"DIV",{class:!0});var Ze=C(V);_=I(Ze,"DIV",{class:!0});var Pe=C(_);w=I(Pe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(w)!=="svelte-68unf9"&&(w.textContent=R),O=B(Pe);for(let De=0;De<de.length;De+=1)de[De].l(Pe);Pe.forEach(v),Ze.forEach(v),z=B(ge),X=I(ge,"DIV",{class:!0});var $e=C(X);Q=re($e,"Head 1 of "),U=re($e,Y),$e.forEach(v),ge.forEach(v),this.h()},h(){h(s,"class","title svelte-1hhniwm"),h(t,"class","column query"),h(i,"class","title svelte-1hhniwm"),h(a,"class","column key"),h($,"class","title svelte-1hhniwm"),h(p,"class","column value"),h(l,"class","qkv flex h-full flex-col justify-center gap-[5rem] pl-[6rem]"),h(A,"class","resize-watch attention-matrix flex"),h(w,"class","title svelte-1hhniwm"),h(_,"class","column out"),h(V,"class","head-out mx-[2rem]"),h(X,"class","head-title absolute bottom-2 right-3 text-right text-gray-400"),h(e,"class","head-block flex w-full items-center justify-between px-2"),h(e,"style",y=`height:${n[7]}px;`)},m(Z,ge){N(Z,e,ge),m(e,l),m(l,t),m(t,s),m(t,r);for(let W=0;W<j.length;W+=1)j[W]&&j[W].m(t,null);m(l,c),m(l,a),m(a,i),m(a,f);for(let W=0;W<b.length;W+=1)b[W]&&b[W].m(a,null);m(l,d),m(l,p),m(p,$),m(p,H);for(let W=0;W<S.length;W+=1)S[W]&&S[W].m(p,null);m(e,P),m(e,A),ne(g,A,null),m(e,D),m(e,V),m(V,_),m(_,w),m(_,O);for(let W=0;W<de.length;W+=1)de[W]&&de[W].m(_,null);m(e,z),m(e,X),m(X,Q),m(X,U),G=!0},p(Z,ge){if(ge&64){k=me(Z[6]);let W;for(W=0;W<k.length;W+=1){const pe=cl(Z,k,W);j[W]?j[W].p(pe,ge):(j[W]=ml(pe),j[W].c(),j[W].m(t,null))}for(;W<j.length;W+=1)j[W].d(1);j.length=k.length}if(ge&64){T=me(Z[6]);let W;for(W=0;W<T.length;W+=1){const pe=il(Z,T,W);b[W]?b[W].p(pe,ge):(b[W]=pl(pe),b[W].c(),b[W].m(a,null))}for(;W<b.length;W+=1)b[W].d(1);b.length=T.length}if(ge&64){J=me(Z[6]);let W;for(W=0;W<J.length;W+=1){const pe=al(Z,J,W);S[W]?S[W].p(pe,ge):(S[W]=gl(pe),S[W].c(),S[W].m(p,null))}for(;W<S.length;W+=1)S[W].d(1);S.length=J.length}if(ge&64){he=me(Z[6]);let W;for(W=0;W<he.length;W+=1){const pe=rl(Z,he,W);de[W]?de[W].p(pe,ge):(de[W]=_l(pe),de[W].c(),de[W].m(_,null))}for(;W<de.length;W+=1)de[W].d(1);de.length=he.length}(!G||ge&32)&&Y!==(Y=Z[5].attention_head_num+"")&&qe(U,Y),(!G||ge&128&&y!==(y=`height:${Z[7]}px;`))&&h(e,"style",y)},i(Z){G||(L(g.$$.fragment,Z),G=!0)},o(Z){F(g.$$.fragment,Z),G=!1},d(Z){Z&&v(e),Se(j,Z),Se(b,Z),Se(S,Z),oe(g),Se(de,Z)}}}function No(n){let e,l,t="<div>Multi-head Self Attention</div>",s,o,r,c='<div class="bounding-title svelte-1hhniwm">Transformer Block 1</div>',a,i,u,f,d,p,$,q,H,P,A,g,D,V,_,w,R,O,z,X,Q,Y;p=new Je({props:{triggeredBy:".attention .qkv-weighted",placement:"right",class:"popover",$$slots:{default:[Vo]},$$scope:{ctx:n}}}),q=new Je({props:{triggeredBy:".attention .query .cell.head1",placement:"right",class:"popover",$$slots:{default:[So]},$$scope:{ctx:n}}}),P=new Je({props:{triggeredBy:".attention .key .cell.head1",placement:"right",class:"popover",$$slots:{default:[Ao]},$$scope:{ctx:n}}}),g=new Je({props:{triggeredBy:".attention .value .cell.head1",placement:"right",class:"popover",$$slots:{default:[Lo]},$$scope:{ctx:n}}}),V=new Je({props:{triggeredBy:".attention .out .cell.head1",placement:"right",class:"popover",$$slots:{default:[Mo]},$$scope:{ctx:n}}});let U=me(n[6]),y=[];for(let k=0;k<U.length;k+=1)y[k]=vl(ul(n,U,k));const G=k=>F(y[k],1,1,()=>{y[k]=null});return O=new _o({props:{$$slots:{default:[Bo]},$$scope:{ctx:n}}}),{c(){e=E("div"),l=E("div"),l.innerHTML=t,s=M(),o=E("div"),r=E("div"),r.innerHTML=c,a=M(),i=E("div"),f=M(),d=E("div"),te(p.$$.fragment),$=M(),te(q.$$.fragment),H=M(),te(P.$$.fragment),A=M(),te(g.$$.fragment),D=M(),te(V.$$.fragment),_=M();for(let k=0;k<y.length;k+=1)y[k].c();w=M(),R=E("div"),te(O.$$.fragment),this.h()},l(k){e=I(k,"DIV",{class:!0});var j=C(e);l=I(j,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-n6swon"&&(l.innerHTML=t),s=B(j),o=I(j,"DIV",{class:!0});var T=C(o);r=I(T,"DIV",{class:!0,"data-svelte-h":!0}),Ce(r)!=="svelte-vte4ua"&&(r.innerHTML=c),a=B(T),i=I(T,"DIV",{class:!0,style:!0}),C(i).forEach(v),f=B(T),d=I(T,"DIV",{class:!0});var b=C(d);le(p.$$.fragment,b),$=B(b),le(q.$$.fragment,b),H=B(b),le(P.$$.fragment,b),A=B(b),le(g.$$.fragment,b),D=B(b),le(V.$$.fragment,b),_=B(b);for(let S=0;S<y.length;S+=1)y[S].l(b);b.forEach(v),w=B(T),R=I(T,"DIV",{class:!0});var J=C(R);le(O.$$.fragment,J),J.forEach(v),T.forEach(v),j.forEach(v),this.h()},h(){h(l,"class","title svelte-1hhniwm"),h(l,"role","group"),h(r,"class","bounding transformer-bounding svelte-1hhniwm"),ee(r,"active",n[4]),h(i,"class","bounding attention-bounding svelte-1hhniwm"),h(i,"style",u=`padding-bottom:${n[5].attention_head_num*ht.y}px`),ee(i,"active",n[1]&&!n[3]),h(d,"class","column"),h(R,"class","heads svelte-1hhniwm"),h(o,"class","content relative svelte-1hhniwm"),h(e,"class",z=ie(ae("attention",n[0],{expanded:n[3]}))+" svelte-1hhniwm")},m(k,j){N(k,e,j),m(e,l),m(e,s),m(e,o),m(o,r),m(o,a),m(o,i),m(o,f),m(o,d),ne(p,d,null),m(d,$),ne(q,d,null),m(d,H),ne(P,d,null),m(d,A),ne(g,d,null),m(d,D),ne(V,d,null),m(d,_);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(d,null);m(o,w),m(o,R),ne(O,R,null),X=!0,Q||(Y=[_e(l,"mouseenter",n[8]),_e(l,"mouseleave",n[9])],Q=!0)},p(k,[j]){(!X||j&16)&&ee(r,"active",k[4]),(!X||j&32&&u!==(u=`padding-bottom:${k[5].attention_head_num*ht.y}px`))&&h(i,"style",u),(!X||j&10)&&ee(i,"active",k[1]&&!k[3]);const T={};j&2097184&&(T.$$scope={dirty:j,ctx:k}),p.$set(T);const b={};j&2097184&&(b.$$scope={dirty:j,ctx:k}),q.$set(b);const J={};j&2097184&&(J.$$scope={dirty:j,ctx:k}),P.$set(J);const S={};j&2097184&&(S.$$scope={dirty:j,ctx:k}),g.$set(S);const he={};if(j&2097184&&(he.$$scope={dirty:j,ctx:k}),V.$set(he),j&68){U=me(k[6]);let Z;for(Z=0;Z<U.length;Z+=1){const ge=ul(k,U,Z);y[Z]?(y[Z].p(ge,j),L(y[Z],1)):(y[Z]=vl(ge),y[Z].c(),L(y[Z],1),y[Z].m(d,null))}for(Ae(),Z=U.length;Z<y.length;Z+=1)G(Z);Le()}const de={};j&2097376&&(de.$$scope={dirty:j,ctx:k}),O.$set(de),(!X||j&9&&z!==(z=ie(ae("attention",k[0],{expanded:k[3]}))+" svelte-1hhniwm"))&&h(e,"class",z)},i(k){if(!X){L(p.$$.fragment,k),L(q.$$.fragment,k),L(P.$$.fragment,k),L(g.$$.fragment,k),L(V.$$.fragment,k);for(let j=0;j<U.length;j+=1)L(y[j]);L(O.$$.fragment,k),X=!0}},o(k){F(p.$$.fragment,k),F(q.$$.fragment,k),F(P.$$.fragment,k),F(g.$$.fragment,k),F(V.$$.fragment,k),y=y.filter(Boolean);for(let j=0;j<y.length;j+=1)F(y[j]);F(O.$$.fragment,k),X=!1},d(k){k&&v(e),oe(p),oe(q),oe(P),oe(g),oe(V),Se(y,k),oe(O),Q=!1,Re(Y)}}}const Ho="bg-blue-200",jo="bg-red-200",Po="bg-green-200",qn="bg-blue-300",Dn="bg-red-300",Vn="bg-green-300",To="bg-purple-300";function zo(n,e,l){let t,s,o,r,c,a;ye(n,We,P=>l(10,s=P)),ye(n,Dt,P=>l(4,o=P)),ye(n,yt,P=>l(5,r=P)),ye(n,ut,P=>l(6,c=P)),ye(n,$n,P=>l(7,a=P));let{className:i=void 0}=e;Tt("block-id","attention");const u=Pt("block-id");let f=!1;function d(){l(1,f=!0)}function p(){l(1,f=!1)}let $=null;const q=P=>{l(2,$=P)},H=()=>{l(2,$=null)};return n.$$set=P=>{"className"in P&&l(0,i=P.className)},n.$$.update=()=>{n.$$.dirty&1024&&l(3,t=s.id===u)},[i,f,$,t,o,r,c,a,d,p,s,q,H]}class Go extends He{constructor(e){super(),je(this,e,zo,No,Ne,{className:0})}}function Fo(n){let e,l,t,s,o,r,c,a=n[3]&&bl(n);return{c(){e=E("div"),l=E("div"),t=M(),s=Ee("svg"),a&&a.c(),o=Ee("path"),this.h()},l(i){e=I(i,"DIV",{class:!0});var u=C(e);l=I(u,"DIV",{class:!0}),C(l).forEach(v),t=B(u),s=Ie(u,"svg",{class:!0});var f=C(s);a&&a.l(f),o=Ie(f,"path",{d:!0,class:!0}),C(o).forEach(v),f.forEach(v),u.forEach(v),this.h()},h(){h(l,"class","cursor svelte-1jqlo12"),h(o,"d",r=`M0,0 L0,${n[6]}`),h(o,"class","svelte-1jqlo12"),h(s,"class","main svelte-1jqlo12"),h(e,"class",c=ie(ae("residual residual-end cell",n[1]))+" svelte-1jqlo12"),ee(e,"active",n[5])},m(i,u){N(i,e,u),m(e,l),m(e,t),m(e,s),a&&a.m(s,null),m(s,o)},p(i,u){i[3]?a?a.p(i,u):(a=bl(i),a.c(),a.m(s,o)):a&&(a.d(1),a=null),u&64&&r!==(r=`M0,0 L0,${i[6]}`)&&h(o,"d",r),u&2&&c!==(c=ie(ae("residual residual-end cell",i[1]))+" svelte-1jqlo12")&&h(e,"class",c),u&34&&ee(e,"active",i[5])},d(i){i&&v(e),a&&a.d()}}}function Ro(n){let e,l,t,s,o,r,c,a=n[3]&&$l(n);return{c(){e=E("div"),l=E("div"),t=M(),s=Ee("svg"),a&&a.c(),o=Ee("path"),this.h()},l(i){e=I(i,"DIV",{class:!0});var u=C(e);l=I(u,"DIV",{class:!0}),C(l).forEach(v),t=B(u),s=Ie(u,"svg",{class:!0});var f=C(s);a&&a.l(f),o=Ie(f,"path",{d:!0,class:!0}),C(o).forEach(v),f.forEach(v),u.forEach(v),this.h()},h(){h(l,"class","cursor svelte-1jqlo12"),h(o,"d",r=`M0,0 L0,${n[6]}`),h(o,"class","svelte-1jqlo12"),h(s,"class","main svelte-1jqlo12"),h(e,"class",c=ie(ae("residual residual-start cell",n[1]))+" svelte-1jqlo12"),ee(e,"active",n[5])},m(i,u){N(i,e,u),m(e,l),m(e,t),m(e,s),a&&a.m(s,null),m(s,o)},p(i,u){i[3]?a?a.p(i,u):(a=$l(i),a.c(),a.m(s,o)):a&&(a.d(1),a=null),u&64&&r!==(r=`M0,0 L0,${i[6]}`)&&h(o,"d",r),u&2&&c!==(c=ie(ae("residual residual-start cell",i[1]))+" svelte-1jqlo12")&&h(e,"class",c),u&34&&ee(e,"active",i[5])},d(i){i&&v(e),a&&a.d()}}}function Oo(n){let e,l,t,s,o,r,c,a,i,u=n[4]&&yl();return{c(){e=E("div"),l=E("div"),t=M(),s=Ee("svg"),o=Ee("circle"),r=Ee("path"),a=M(),u&&u.c(),this.h()},l(f){e=I(f,"DIV",{class:!0});var d=C(e);l=I(d,"DIV",{class:!0}),C(l).forEach(v),t=B(d),s=Ie(d,"svg",{class:!0});var p=C(s);o=Ie(p,"circle",{class:!0,cx:!0,cy:!0,r:!0}),C(o).forEach(v),r=Ie(p,"path",{class:!0,d:!0}),C(r).forEach(v),p.forEach(v),a=B(d),u&&u.l(d),d.forEach(v),this.h()},h(){h(l,"class","cursor svelte-1jqlo12"),h(o,"class","icon svelte-1jqlo12"),h(o,"cx","50%"),h(o,"cy","50%"),h(o,"r","3"),h(r,"class","line svelte-1jqlo12"),h(r,"d",c=`
     M 0 0
    C 0 ${n[6]*.25}, ${n[6]*.2} ${n[6]*.25}, ${n[6]*.2} ${n[6]*.5}
    C ${n[6]*.2} ${n[6]*.75}, 0 ${n[6]*.75}, 0 ${n[6]}
  `),h(s,"class","main svelte-1jqlo12"),h(e,"class",i=ie(ae("cell ln",n[1]))+" svelte-1jqlo12"),ee(e,"active",n[5])},m(f,d){N(f,e,d),m(e,l),m(e,t),m(e,s),m(s,o),m(s,r),m(e,a),u&&u.m(e,null)},p(f,d){d&64&&c!==(c=`
     M 0 0
    C 0 ${f[6]*.25}, ${f[6]*.2} ${f[6]*.25}, ${f[6]*.2} ${f[6]*.5}
    C ${f[6]*.2} ${f[6]*.75}, 0 ${f[6]*.75}, 0 ${f[6]}
  `)&&h(r,"d",c),f[4]?u||(u=yl(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&i!==(i=ie(ae("cell ln",f[1]))+" svelte-1jqlo12")&&h(e,"class",i),d&34&&ee(e,"active",f[5])},d(f){f&&v(e),u&&u.d()}}}function Wo(n){let e,l,t,s,o,r,c,a,i,u=n[4]&&kl();return{c(){e=E("div"),l=E("div"),t=M(),s=Ee("svg"),o=Ee("path"),c=Ee("circle"),a=M(),u&&u.c(),this.h()},l(f){e=I(f,"DIV",{class:!0});var d=C(e);l=I(d,"DIV",{class:!0}),C(l).forEach(v),t=B(d),s=Ie(d,"svg",{class:!0});var p=C(s);o=Ie(p,"path",{class:!0,d:!0}),C(o).forEach(v),c=Ie(p,"circle",{class:!0,cx:!0,cy:!0,r:!0}),C(c).forEach(v),p.forEach(v),a=B(d),u&&u.l(d),d.forEach(v),this.h()},h(){h(l,"class","cursor svelte-1jqlo12"),h(o,"class","line svelte-1jqlo12"),h(o,"d",r=`M0,0 L0,${n[6]}`),h(c,"class","icon svelte-1jqlo12"),h(c,"cx","50%"),h(c,"cy","50%"),h(c,"r","3"),h(s,"class","main svelte-1jqlo12"),h(e,"class",i=ie(ae("cell dropout",n[1]))+" svelte-1jqlo12"),ee(e,"active",n[5])},m(f,d){N(f,e,d),m(e,l),m(e,t),m(e,s),m(s,o),m(s,c),m(e,a),u&&u.m(e,null)},p(f,d){d&64&&r!==(r=`M0,0 L0,${f[6]}`)&&h(o,"d",r),f[4]?u||(u=kl(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&i!==(i=ie(ae("cell dropout",f[1]))+" svelte-1jqlo12")&&h(e,"class",i),d&34&&ee(e,"active",f[5])},d(f){f&&v(e),u&&u.d()}}}function Zo(n){let e,l,t,s,o,r,c;return{c(){e=E("div"),l=E("div"),t=M(),s=Ee("svg"),o=Ee("path"),r=Ee("circle"),this.h()},l(a){e=I(a,"DIV",{class:!0});var i=C(e);l=I(i,"DIV",{class:!0}),C(l).forEach(v),t=B(i),s=Ie(i,"svg",{class:!0});var u=C(s);o=Ie(u,"path",{class:!0,d:!0}),C(o).forEach(v),r=Ie(u,"circle",{class:!0,cx:!0,cy:!0,r:!0}),C(r).forEach(v),u.forEach(v),i.forEach(v),this.h()},h(){h(l,"class","cursor svelte-1jqlo12"),h(o,"class","line line1 svelte-1jqlo12"),h(o,"d","M0,0 L0,90%"),h(r,"class","icon svelte-1jqlo12"),h(r,"cx","50%"),h(r,"cy","50%"),h(r,"r","3"),h(s,"class","main svelte-1jqlo12"),h(e,"class",c=ie(ae("cell activation",n[1]))+" svelte-1jqlo12"),ee(e,"active",n[5])},m(a,i){N(a,e,i),m(e,l),m(e,t),m(e,s),m(s,o),m(s,r)},p(a,i){i&2&&c!==(c=ie(ae("cell activation",a[1]))+" svelte-1jqlo12")&&h(e,"class",c),i&34&&ee(e,"active",a[5])},d(a){a&&v(e)}}}function bl(n){let e;return{c(){e=Ee("path"),this.h()},l(l){e=Ie(l,"path",{id:!0,class:!0,d:!0}),C(e).forEach(v),this.h()},h(){h(e,"id",n[0]),h(e,"class","head svelte-1jqlo12"),h(e,"d","M0,0 Q0,-16 -30,-16")},m(l,t){N(l,e,t)},p(l,t){t&1&&h(e,"id",l[0])},d(l){l&&v(e)}}}function $l(n){let e,l,t;return{c(){e=Ee("path"),l=Ee("text"),t=se("Residual"),this.h()},l(s){e=Ie(s,"path",{id:!0,class:!0,d:!0}),C(e).forEach(v),l=Ie(s,"text",{x:!0,y:!0,dy:!0,dx:!0,class:!0});var o=C(l);t=re(o,"Residual"),o.forEach(v),this.h()},h(){h(e,"id",n[0]),h(e,"class","head svelte-1jqlo12"),h(e,"d","M0,0 Q0,-16 30,-16"),h(l,"x","30"),h(l,"y","-26"),h(l,"dy","4"),h(l,"dx","4"),h(l,"class","svelte-1jqlo12")},m(s,o){N(s,e,o),N(s,l,o),m(l,t)},p(s,o){o&1&&h(e,"id",s[0])},d(s){s&&(v(e),v(l))}}}function yl(n){let e,l,t,s;return{c(){e=Ee("svg"),l=Ee("path"),t=Ee("text"),s=se("Layer Normalization"),this.h()},l(o){e=Ie(o,"svg",{class:!0,width:!0});var r=C(e);l=Ie(r,"path",{d:!0,class:!0}),C(l).forEach(v),t=Ie(r,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=C(t);s=re(c,"Layer Normalization"),c.forEach(v),r.forEach(v),this.h()},h(){h(l,"d","M27.3536 4.35355C27.5488 4.15829 27.5488 3.84171 27.3536 3.64645L24.1716 0.46447C23.9763 0.269208 23.6597 0.269208 23.4645 0.464471C23.2692 0.659733 23.2692 0.976316 23.4645 1.17158L26.2929 4L23.4645 6.82843C23.2692 7.02369 23.2692 7.34028 23.4645 7.53554C23.6597 7.7308 23.9763 7.7308 24.1716 7.53554L27.3536 4.35355ZM27 3.5C20.3125 3.50001 15.2969 6.63952 11.5638 11.7944C7.84616 16.9278 5.39057 24.0677 3.75991 32.1346C0.498061 48.2711 0.5 68.3247 0.5 84H1.5C1.5 68.2984 1.50194 48.352 4.74009 32.3328C6.35943 24.3218 8.77884 17.3448 12.3737 12.3809C15.9531 7.4384 20.6875 4.50001 27 4.5V3.5Z"),h(l,"class","svelte-1jqlo12"),h(t,"x","4"),h(t,"y","95"),h(t,"text-anchor","middle"),h(t,"class","svelte-1jqlo12"),h(e,"class","guide svelte-1jqlo12"),h(e,"width","27px"),ee(e,"active",!1)},m(o,r){N(o,e,r),m(e,l),m(e,t),m(t,s)},d(o){o&&v(e)}}}function kl(n){let e,l,t,s;return{c(){e=Ee("svg"),l=Ee("path"),t=Ee("text"),s=se("Dropout"),this.h()},l(o){e=Ie(o,"svg",{class:!0,width:!0});var r=C(e);l=Ie(r,"path",{d:!0,class:!0}),C(l).forEach(v),t=Ie(r,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=C(t);s=re(c,"Dropout"),c.forEach(v),r.forEach(v),this.h()},h(){h(l,"d","M44.3186 4.46399C44.5314 4.28801 44.5613 3.97284 44.3853 3.76004L41.5175 0.292199C41.3416 0.0793953 41.0264 0.0495441 40.8136 0.225525C40.6008 0.401505 40.5709 0.716677 40.7469 0.929481L43.296 4.012L40.2135 6.56113C40.0007 6.73711 39.9709 7.05228 40.1468 7.26509C40.3228 7.47789 40.638 7.50774 40.8508 7.33176L44.3186 4.46399ZM44.0471 3.58091C38.7621 3.08034 27.8926 4.80481 18.3357 11.5838C8.74613 18.386 0.5 30.2626 0.5 50H1.5C1.5 30.5889 9.58721 19.0154 18.9143 12.3994C28.2741 5.76023 38.9045 4.0983 43.9529 4.57645L44.0471 3.58091Z"),h(l,"class","svelte-1jqlo12"),h(t,"x","4"),h(t,"y","60"),h(t,"text-anchor","middle"),h(t,"class","svelte-1jqlo12"),h(e,"class","guide svelte-1jqlo12"),h(e,"width","44px"),ee(e,"active",!1)},m(o,r){N(o,e,r),m(e,l),m(e,t),m(t,s)},d(o){o&&v(e)}}}function Xo(n){let e;function l(o,r){if(o[2]==="activation")return Zo;if(o[2]==="dropout")return Wo;if(o[2]==="ln")return Oo;if(o[2]==="residual-start")return Ro;if(o[2]==="residual-end")return Fo}let t=l(n),s=t&&t(n);return{c(){s&&s.c(),e=at()},l(o){s&&s.l(o),e=at()},m(o,r){s&&s.m(o,r),N(o,e,r)},p(o,[r]){t===(t=l(o))&&s?s.p(o,r):(s&&s.d(1),s=t&&t(o),s&&(s.c(),s.m(e.parentNode,e)))},i:Be,o:Be,d(o){o&&v(e),s&&s.d(o)}}}function Ko(n,e,l){let t;ye(n,jt,u=>l(6,t=u));let{id:s=void 0}=e,{className:o=void 0}=e,{type:r=void 0}=e,{head:c=!1}=e,{tail:a=!1}=e,{active:i=!1}=e;return n.$$set=u=>{"id"in u&&l(0,s=u.id),"className"in u&&l(1,o=u.className),"type"in u&&l(2,r=u.type),"head"in u&&l(3,c=u.head),"tail"in u&&l(4,a=u.tail),"active"in u&&l(5,i=u.active)},[s,o,r,c,a,i,t]}class At extends He{constructor(e){super(),je(this,e,Ko,Xo,Ne,{id:0,className:1,type:2,head:3,tail:4,active:5})}}function wl(n,e,l){const t=n.slice();return t[7]=e[l],t[9]=l,t}function Qo(n){let e,l=n[1].dimension+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&2&&l!==(l=o[1].dimension+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function El(n){let e,l=n[7]+"",t;return{c(){e=E("span"),t=se(l),this.h()},l(s){e=I(s,"SPAN",{class:!0});var o=C(e);t=re(o,l),o.forEach(v),this.h()},h(){h(e,"class","label float svelte-knr4c7")},m(s,o){N(s,e,o),m(e,t)},p(s,o){o&8&&l!==(l=s[7]+"")&&qe(t,l)},d(s){s&&v(e)}}}function Il(n){let e,l,t,s,o,r,c;t=new rt({props:{colorScale:"blue"}});let a=n[9]===n[3].length-1&&El(n);return{c(){e=E("div"),l=E("div"),te(t.$$.fragment),o=M(),a&&a.c(),r=M(),this.h()},l(i){e=I(i,"DIV",{class:!0});var u=C(e);l=I(u,"DIV",{class:!0});var f=C(l);le(t.$$.fragment,f),f.forEach(v),o=B(u),a&&a.l(u),r=B(u),u.forEach(v),this.h()},h(){h(l,"class",s=ie(ae("vector shrink-0 bg-blue-200",{"last-token":n[9]===n[3].length-1}))+" svelte-knr4c7"),h(e,"class","cell svelte-knr4c7"),ee(e,"last",n[9]===n[3].length-1)},m(i,u){N(i,e,u),m(e,l),ne(t,l,null),m(e,o),a&&a.m(e,null),m(e,r),c=!0},p(i,u){(!c||u&8&&s!==(s=ie(ae("vector shrink-0 bg-blue-200",{"last-token":i[9]===i[3].length-1}))+" svelte-knr4c7"))&&h(l,"class",s),i[9]===i[3].length-1?a?a.p(i,u):(a=El(i),a.c(),a.m(e,r)):a&&(a.d(1),a=null),(!c||u&8)&&ee(e,"last",i[9]===i[3].length-1)},i(i){c||(L(t.$$.fragment,i),c=!0)},o(i){F(t.$$.fragment,i),c=!1},d(i){i&&v(e),oe(t),a&&a.d()}}}function Yo(n){let e,l,t,s,o,r,c,a,i,u=n[1].layer_num-1+"",f,d,p,$,q="Transformer<br/>Blocks",H,P,A,g,D,V,_,w,R,O,z,X;o=new Je({props:{triggeredBy:".transformer-blocks .vector",placement:"right",class:"popover",$$slots:{default:[Qo]},$$scope:{ctx:n}}});let Q=me(n[3]),Y=[];for(let y=0;y<Q.length;y+=1)Y[y]=Il(wl(n,Q,y));const U=y=>F(Y[y],1,1,()=>{Y[y]=null});return{c(){e=E("div"),l=E("div"),t=M(),s=E("div"),te(o.$$.fragment),r=M(),c=E("div"),a=E("div"),i=E("div"),f=se(u),d=se(" more identical"),p=E("br"),$=E("span"),$.innerHTML=q,H=se("."),P=M(),A=Ee("svg"),g=Ee("path"),D=M();for(let y=0;y<Y.length;y+=1)Y[y].c();V=M(),_=E("div"),w=E("div"),this.h()},l(y){e=I(y,"DIV",{class:!0,role:!0});var G=C(e);l=I(G,"DIV",{class:!0}),C(l).forEach(v),t=B(G),s=I(G,"DIV",{class:!0});var k=C(s);le(o.$$.fragment,k),r=B(k),c=I(k,"DIV",{class:!0});var j=C(c);a=I(j,"DIV",{class:!0});var T=C(a);i=I(T,"DIV",{class:!0});var b=C(i);f=re(b,u),d=re(b," more identical"),p=I(b,"BR",{}),$=I(b,"SPAN",{class:!0,"data-svelte-h":!0}),Ce($)!=="svelte-m89yhc"&&($.innerHTML=q),H=re(b,"."),b.forEach(v),P=B(T),A=Ie(T,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var J=C(A);g=Ie(J,"path",{d:!0,fill:!0}),C(g).forEach(v),J.forEach(v),T.forEach(v),D=B(j);for(let he=0;he<Y.length;he+=1)Y[he].l(j);j.forEach(v),V=B(k),_=I(k,"DIV",{class:!0});var S=C(_);w=I(S,"DIV",{class:!0}),C(w).forEach(v),S.forEach(v),k.forEach(v),G.forEach(v),this.h()},h(){h(l,"class","title"),h($,"class","highlight svelte-knr4c7"),h(i,"class","text svelte-knr4c7"),ee(i,"active",n[2]),h(g,"d","M1.18221 4.58047C1.23103 4.62928 1.31017 4.62928 1.35899 4.58047L2.15448 3.78497C2.2033 3.73616 2.2033 3.65701 2.15448 3.6082C2.10567 3.55938 2.02652 3.55938 1.97771 3.6082L1.2706 4.3153L0.563493 3.6082C0.514677 3.55938 0.435531 3.55938 0.386716 3.6082C0.3379 3.65701 0.3379 3.73616 0.386716 3.78497L1.18221 4.58047ZM1.1456 0.285461V4.49208H1.3956V0.285461H1.1456Z"),h(g,"fill","currentColor"),h(A,"xmlns","http://www.w3.org/2000/svg"),h(A,"class","h-6 w-6 text-gray-300"),h(A,"viewBox","0 0 3 5"),h(A,"fill","none"),h(a,"class","guide flex flex-col items-start gap-1 svelte-knr4c7"),h(c,"class","column final relative svelte-knr4c7"),h(w,"class","prob-dim svelte-knr4c7"),ee(w,"expanded",n[4].id==="softmax"),h(_,"class","second-column svelte-knr4c7"),h(s,"class","content svelte-knr4c7"),h(e,"class",R=ie(ae("transformer-blocks",n[0]))+" svelte-knr4c7"),h(e,"role","group")},m(y,G){N(y,e,G),m(e,l),m(e,t),m(e,s),ne(o,s,null),m(s,r),m(s,c),m(c,a),m(a,i),m(i,f),m(i,d),m(i,p),m(i,$),m(i,H),m(a,P),m(a,A),m(A,g),m(c,D);for(let k=0;k<Y.length;k+=1)Y[k]&&Y[k].m(c,null);m(s,V),m(s,_),m(_,w),O=!0,z||(X=[_e(e,"mouseenter",n[5]),_e(e,"mouseleave",n[6])],z=!0)},p(y,[G]){const k={};if(G&1026&&(k.$$scope={dirty:G,ctx:y}),o.$set(k),(!O||G&2)&&u!==(u=y[1].layer_num-1+"")&&qe(f,u),(!O||G&4)&&ee(i,"active",y[2]),G&8){Q=me(y[3]);let j;for(j=0;j<Q.length;j+=1){const T=wl(y,Q,j);Y[j]?(Y[j].p(T,G),L(Y[j],1)):(Y[j]=Il(T),Y[j].c(),L(Y[j],1),Y[j].m(c,null))}for(Ae(),j=Q.length;j<Y.length;j+=1)U(j);Le()}(!O||G&16)&&ee(w,"expanded",y[4].id==="softmax"),(!O||G&1&&R!==(R=ie(ae("transformer-blocks",y[0]))+" svelte-knr4c7"))&&h(e,"class",R)},i(y){if(!O){L(o.$$.fragment,y);for(let G=0;G<Q.length;G+=1)L(Y[G]);O=!0}},o(y){F(o.$$.fragment,y),Y=Y.filter(Boolean);for(let G=0;G<Y.length;G+=1)F(Y[G]);O=!1},d(y){y&&v(e),oe(o),Se(Y,y),z=!1,Re(X)}}}function Uo(n,e,l){let t,s,o,r;ye(n,yt,u=>l(1,t=u)),ye(n,Dt,u=>l(2,s=u)),ye(n,ut,u=>l(3,o=u)),ye(n,We,u=>l(4,r=u));let{className:c=void 0}=e;const a=()=>{Dt.set(!0)},i=()=>{Dt.set(!1)};return n.$$set=u=>{"className"in u&&l(0,c=u.className)},[c,t,s,o,r,a,i]}class Jo extends He{constructor(e){super(),je(this,e,Uo,Yo,Ne,{className:0})}}function xo(n){let e,l,t,s;return{c(){e=E("div"),l=Ee("svg"),t=Ee("g"),s=Ee("g"),this.h()},l(o){e=I(o,"DIV",{class:!0});var r=C(e);l=Ie(r,"svg",{class:!0});var c=C(l);t=Ie(c,"g",{class:!0}),C(t).forEach(v),s=Ie(c,"g",{class:!0}),C(s).forEach(v),c.forEach(v),r.forEach(v),this.h()},h(){h(t,"class","bars"),h(s,"class","bar-labels"),h(l,"class","h-full w-full"),h(e,"class","content-box probability grow svelte-8s3yoj")},m(o,r){N(o,e,r),m(e,l),m(l,t),m(l,s),n[7](l)},p:Be,i:Be,o:Be,d(o){o&&v(e),n[7](null)}}}const Cl=4;let es=1;function ts(n,e,l){let t,s;ye(n,zt,q=>l(5,t=q)),ye(n,kt,q=>l(6,s=q));const{theme:o}=mt(pt);let{rowHeight:r}=e,{rowGap:c}=e,{hoveredIndex:a=null}=e,i,u=o.colors.gray[300],f=o.colors.purple[400],{drawBars:d=()=>{const q=s==null?void 0:s.prediction;console.log("ddd");const H=et(i);let P=Xt().domain([0,so(q,A=>A.adjustedProbability)]).range([0,(i==null?void 0:i.clientWidth)-$t*3]);H.select("g.bars").selectAll("rect").data(q).join("rect").attr("x",0).attr("y",(A,g)=>g*r+g*c+r/2-Cl/2).attr("height",Cl).attr("width",A=>P(A.adjustedProbability)).attr("rx",1).attr("ry",1).attr("fill",(A,g)=>(console.log(),g===a?f:(t==null?void 0:t.rank)===g?Nt:u)).on("mouseenter",function(A,g){l(1,a=g.rank),et(this).style("cursor","pointer")}).on("mouseleave",()=>l(1,a=null)).transition().ease(Rn).duration(500).attr("width",A=>P(A.adjustedProbability)),H.select("g.bar-labels").selectAll("text").data(q).join("text").attr("fill",(A,g)=>g===a?f:(t==null?void 0:t.rank)===g?Nt:u).on("mouseenter",function(A,g){l(1,a=g.rank),et(this).style("cursor","pointer")}).on("mouseleave",()=>{l(1,a=null)}).attr("x",A=>.4*$t+P(A.adjustedProbability)).attr("y",(A,g)=>g*r+g*c).attr("dy",r/2+3).attr("text-anchor","start").style("font-size","0.75rem").transition().duration(500).tween("text",function(A){const g=et(this),D=On(g.text().replace("%",""),A.adjustedProbability*100);return function(V){g.text(D(V).toFixed(es)+"%")}})}}=e;ct(()=>{d()});const p=()=>{if(!i)return;const q=et(i);q.selectAll("g.bars rect").attr("fill",(H,P)=>P===a?f:(t==null?void 0:t.rank)===P?Nt:u),q.selectAll("g.bar-labels text").attr("fill",(H,P)=>P===a?f:(t==null?void 0:t.rank)===P?Nt:u)};function $(q){Ue[q?"unshift":"push"](()=>{i=q,l(0,i)})}return n.$$set=q=>{"rowHeight"in q&&l(2,r=q.rowHeight),"rowGap"in q&&l(3,c=q.rowGap),"hoveredIndex"in q&&l(1,a=q.hoveredIndex),"drawBars"in q&&l(4,d=q.drawBars)},n.$$.update=()=>{n.$$.dirty&81&&s&&i&&d(),n.$$.dirty&2&&a!==void 0&&p(),n.$$.dirty&32&&t&&p()},[i,a,r,c,d,t,s,$]}class ls extends He{constructor(e){super(),je(this,e,ts,xo,Ne,{rowHeight:2,rowGap:3,hoveredIndex:1,drawBars:4})}}function ql(n,e,l){const t=n.slice();return t[36]=e[l],t[38]=l,t}function Dl(n,e,l){const t=n.slice();return t[39]=e[l],t[38]=l,t}function Vl(n,e,l){const t=n.slice();return t[41]=e[l],t[38]=l,t}function ns(n){let e,l=n[9][n[38]]+"",t,s;return{c(){e=se("Token ID: "),t=se(l),s=M()},l(o){e=re(o,"Token ID: "),t=re(o,l),s=B(o)},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r[0]&512&&l!==(l=o[9][o[38]]+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Sl(n){let e,l=(n[41].token.trim()===""?" ":n[41].token)+"",t,s,o,r,c,a;function i(){return n[21](n[38])}return o=new Je({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[ns]},$$scope:{ctx:n}}}),{c(){e=E("div"),t=se(l),s=M(),te(o.$$.fragment),this.h()},l(u){e=I(u,"DIV",{role:!0,class:!0});var f=C(e);t=re(f,l),f.forEach(v),s=B(u),le(o.$$.fragment,u),this.h()},h(){var u;h(e,"role","group"),h(e,"class","text-box svelte-1uvdybw"),ee(e,"highlight",n[38]===n[5]),ee(e,"sample_highlight",n[10]===n[38]),ee(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,f){N(u,e,f),m(e,t),N(u,s,f),ne(o,u,f),r=!0,c||(a=[_e(e,"mouseenter",i),_e(e,"mouseleave",n[22])],c=!0)},p(u,f){var p;n=u,(!r||f[0]&4)&&l!==(l=(n[41].token.trim()===""?" ":n[41].token)+"")&&qe(t,l),(!r||f[0]&32)&&ee(e,"highlight",n[38]===n[5]),(!r||f[0]&1024)&&ee(e,"sample_highlight",n[10]===n[38]),(!r||f[0]&2048)&&ee(e,"final_token_highlight",((p=n[11])==null?void 0:p.rank)===n[38]);const d={};f[0]&512|f[1]&4096&&(d.$$scope={dirty:f,ctx:n}),o.$set(d)},i(u){r||(L(o.$$.fragment,u),r=!0)},o(u){F(o.$$.fragment,u),r=!1},d(u){u&&(v(e),v(s)),oe(o,u),c=!1,Re(a)}}}function Al(n){let e,l='<div class="title-box token-string !justify-end svelte-1uvdybw"><div class="title-text svelte-1uvdybw">Tokens</div></div> <div class="title-box logits svelte-1uvdybw"><div class="title-text svelte-1uvdybw">Logits</div></div> <div class="title-box exponents svelte-1uvdybw"><div class="title-text svelte-1uvdybw">Exponents</div></div> <div class="title-box probability svelte-1uvdybw"><div class="title-text svelte-1uvdybw">Probability</div></div>';return{c(){e=E("div"),e.innerHTML=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-16l107t"&&(e.innerHTML=l),this.h()},h(){h(e,"class","softmax-subtitle softmax-detail flex text-center text-xs opacity-0 svelte-1uvdybw")},m(t,s){N(t,e,s)},d(t){t&&v(e)}}}function Ll(n){let e,l,t,s,o=me(n[8]),r=[];for(let f=0;f<o.length;f+=1)r[f]=Bl(Dl(n,o,f));const c=f=>F(r[f],1,1,()=>{r[f]=null});let a=me(n[7]),i=[];for(let f=0;f<a.length;f+=1)i[f]=Nl(ql(n,a,f));const u=f=>F(i[f],1,1,()=>{i[f]=null});return{c(){e=E("div");for(let f=0;f<r.length;f+=1)r[f].c();l=M(),t=E("div");for(let f=0;f<i.length;f+=1)i[f].c();this.h()},l(f){e=I(f,"DIV",{class:!0});var d=C(e);for(let $=0;$<r.length;$+=1)r[$].l(d);d.forEach(v),l=B(f),t=I(f,"DIV",{class:!0});var p=C(t);for(let $=0;$<i.length;$+=1)i[$].l(p);p.forEach(v),this.h()},h(){h(e,"class","content-box vector-box logits ml-2 svelte-1uvdybw"),h(t,"class","content-box vector-box exponents svelte-1uvdybw")},m(f,d){N(f,e,d);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(e,null);N(f,l,d),N(f,t,d);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(t,null);s=!0},p(f,d){if(d[0]&7456){o=me(f[8]);let p;for(p=0;p<o.length;p+=1){const $=Dl(f,o,p);r[p]?(r[p].p($,d),L(r[p],1)):(r[p]=Bl($),r[p].c(),L(r[p],1),r[p].m(e,null))}for(Ae(),p=o.length;p<r.length;p+=1)c(p);Le()}if(d[0]&3488){a=me(f[7]);let p;for(p=0;p<a.length;p+=1){const $=ql(f,a,p);i[p]?(i[p].p($,d),L(i[p],1)):(i[p]=Nl($),i[p].c(),L(i[p],1),i[p].m(t,null))}for(Ae(),p=a.length;p<i.length;p+=1)u(p);Le()}},i(f){if(!s){for(let d=0;d<o.length;d+=1)L(r[d]);for(let d=0;d<a.length;d+=1)L(i[d]);s=!0}},o(f){r=r.filter(Boolean);for(let d=0;d<r.length;d+=1)F(r[d]);i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);s=!1},d(f){f&&(v(e),v(l),v(t)),Se(r,f),Se(i,f)}}}function Ml(n){let e,l=n[39].toFixed(2)+"",t,s,o,r,c,a;function i(){return n[23](n[38])}return o=new Je({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[os]},$$scope:{ctx:n}}}),{c(){e=E("div"),t=se(l),s=M(),te(o.$$.fragment),this.h()},l(u){e=I(u,"DIV",{role:!0,class:!0});var f=C(e);t=re(f,l),f.forEach(v),s=B(u),le(o.$$.fragment,u),this.h()},h(){var u;h(e,"role","group"),h(e,"class","text-box text-center svelte-1uvdybw"),ee(e,"highlight",n[38]===n[5]),ee(e,"sample_highlight",n[10]===n[38]),ee(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,f){N(u,e,f),m(e,t),N(u,s,f),ne(o,u,f),r=!0,c||(a=[_e(e,"mouseenter",i),_e(e,"mouseleave",n[24])],c=!0)},p(u,f){var p;n=u,(!r||f[0]&256)&&l!==(l=n[39].toFixed(2)+"")&&qe(t,l),(!r||f[0]&32)&&ee(e,"highlight",n[38]===n[5]),(!r||f[0]&1024)&&ee(e,"sample_highlight",n[10]===n[38]),(!r||f[0]&2048)&&ee(e,"final_token_highlight",((p=n[11])==null?void 0:p.rank)===n[38]);const d={};f[0]&4352|f[1]&4096&&(d.$$scope={dirty:f,ctx:n}),o.$set(d)},i(u){r||(L(o.$$.fragment,u),r=!0)},o(u){F(o.$$.fragment,u),r=!1},d(u){u&&(v(e),v(s)),oe(o,u),c=!1,Re(a)}}}function os(n){let e=(n[39]*n[12]).toFixed(2)+"",l,t,s,o,r=n[39].toFixed(2)+"",c,a;return{c(){l=se(e),t=se(" ÷ "),s=se(n[12]),o=se(" = "),c=se(r),a=M()},l(i){l=re(i,e),t=re(i," ÷ "),s=re(i,n[12]),o=re(i," = "),c=re(i,r),a=B(i)},m(i,u){N(i,l,u),N(i,t,u),N(i,s,u),N(i,o,u),N(i,c,u),N(i,a,u)},p(i,u){u[0]&4352&&e!==(e=(i[39]*i[12]).toFixed(2)+"")&&qe(l,e),u[0]&4096&&qe(s,i[12]),u[0]&256&&r!==(r=i[39].toFixed(2)+"")&&qe(c,r)},d(i){i&&(v(l),v(t),v(s),v(o),v(c),v(a))}}}function Bl(n){let e,l,t=n[39]!==void 0&&Ml(n);return{c(){t&&t.c(),e=at()},l(s){t&&t.l(s),e=at()},m(s,o){t&&t.m(s,o),N(s,e,o),l=!0},p(s,o){s[39]!==void 0?t?(t.p(s,o),o[0]&256&&L(t,1)):(t=Ml(s),t.c(),L(t,1),t.m(e.parentNode,e)):t&&(Ae(),F(t,1,1,()=>{t=null}),Le())},i(s){l||(L(t),l=!0)},o(s){F(t),l=!1},d(s){s&&v(e),t&&t.d(s)}}}function ss(n){let e,l=n[8][n[38]].toFixed(2)+"",t,s,o=n[36].toFixed(2)+"",r,c;return{c(){e=se("exp("),t=se(l),s=se(") = "),r=se(o),c=M()},l(a){e=re(a,"exp("),t=re(a,l),s=re(a,") = "),r=re(a,o),c=B(a)},m(a,i){N(a,e,i),N(a,t,i),N(a,s,i),N(a,r,i),N(a,c,i)},p(a,i){i[0]&256&&l!==(l=a[8][a[38]].toFixed(2)+"")&&qe(t,l),i[0]&128&&o!==(o=a[36].toFixed(2)+"")&&qe(r,o)},d(a){a&&(v(e),v(t),v(s),v(r),v(c))}}}function Nl(n){let e,l=n[36].toExponential(2)+"",t,s,o,r,c,a;function i(){return n[25](n[38])}return o=new Je({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[ss]},$$scope:{ctx:n}}}),{c(){e=E("div"),t=se(l),s=M(),te(o.$$.fragment),this.h()},l(u){e=I(u,"DIV",{role:!0,class:!0});var f=C(e);t=re(f,l),f.forEach(v),s=B(u),le(o.$$.fragment,u),this.h()},h(){var u;h(e,"role","group"),h(e,"class","text-box text-center svelte-1uvdybw"),ee(e,"highlight",n[38]===n[5]),ee(e,"sample_highlight",n[10]===n[38]),ee(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,f){N(u,e,f),m(e,t),N(u,s,f),ne(o,u,f),r=!0,c||(a=[_e(e,"mouseenter",i),_e(e,"mouseleave",n[26])],c=!0)},p(u,f){var p;n=u,(!r||f[0]&128)&&l!==(l=n[36].toExponential(2)+"")&&qe(t,l),(!r||f[0]&32)&&ee(e,"highlight",n[38]===n[5]),(!r||f[0]&1024)&&ee(e,"sample_highlight",n[10]===n[38]),(!r||f[0]&2048)&&ee(e,"final_token_highlight",((p=n[11])==null?void 0:p.rank)===n[38]);const d={};f[0]&384|f[1]&4096&&(d.$$scope={dirty:f,ctx:n}),o.$set(d)},i(u){r||(L(o.$$.fragment,u),r=!0)},o(u){F(o.$$.fragment,u),r=!1},d(u){u&&(v(e),v(s)),oe(o,u),c=!1,Re(a)}}}function rs(n){let e,l,t="<div>Probabilities</div>",s,o,r,c,a,i,u,f,d,p,$,q,H,P,A,g,D,V,_,w,R,O=me(n[2]),z=[];for(let k=0;k<O.length;k+=1)z[k]=Sl(Vl(n,O,k));const X=k=>F(z[k],1,1,()=>{z[k]=null});let Q=n[1]&&Al(),Y=n[1]&&Ll(n);function U(k){n[27](k)}function y(k){n[28](k)}let G={rowGap:n[16],rowHeight:n[15]};return n[5]!==void 0&&(G.hoveredIndex=n[5]),n[4]!==void 0&&(G.drawBars=n[4]),A=new ls({props:G}),Ue.push(()=>xt(A,"hoveredIndex",U)),Ue.push(()=>xt(A,"drawBars",y)),{c(){e=E("div"),l=E("div"),l.innerHTML=t,s=M(),o=E("div"),r=E("div"),c=M(),a=E("div"),i=E("div");for(let k=0;k<z.length;k+=1)z[k].c();u=M(),f=E("div"),d=M(),p=E("div"),Q&&Q.c(),$=M(),q=E("div"),H=E("div"),Y&&Y.c(),P=M(),te(A.$$.fragment),this.h()},l(k){e=I(k,"DIV",{class:!0,role:!0});var j=C(e);l=I(j,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-1d64i2n"&&(l.innerHTML=t),s=B(j),o=I(j,"DIV",{class:!0,style:!0});var T=C(o);r=I(T,"DIV",{class:!0}),C(r).forEach(v),c=B(T),a=I(T,"DIV",{class:!0});var b=C(a);i=I(b,"DIV",{class:!0});var J=C(i);for(let Z=0;Z<z.length;Z+=1)z[Z].l(J);J.forEach(v),u=B(b),f=I(b,"DIV",{class:!0}),C(f).forEach(v),b.forEach(v),d=B(T),p=I(T,"DIV",{class:!0});var S=C(p);Q&&Q.l(S),$=B(S),q=I(S,"DIV",{class:!0});var he=C(q);H=I(he,"DIV",{class:!0});var de=C(H);Y&&Y.l(de),de.forEach(v),P=B(he),le(A.$$.fragment,he),he.forEach(v),S.forEach(v),T.forEach(v),j.forEach(v),this.h()},h(){h(l,"class","title expandable svelte-1uvdybw"),h(l,"role","none"),h(r,"class","bounding softmax-bounding svelte-1uvdybw"),ee(r,"active",n[6]&&!n[1]),h(i,"class","content-box token-string svelte-1uvdybw"),h(f,"class","vector vocab opacity-1 w-0"),h(a,"class","first-column relative flex justify-end"),h(H,"class","softmax-detail expandable flex gap-2 opacity-0"),h(q,"class","content-row flex gap-2"),h(p,"class","second-column flex flex-col svelte-1uvdybw"),h(o,"class","content resize-watch relative svelte-1uvdybw"),h(o,"style",`--softmax-row-height: ${n[15]}px;--softmax-row-gap: ${n[16]}px`),h(e,"class",V=ie(ae("softmax",n[0],{expanded:n[1]}))+" svelte-1uvdybw"),h(e,"role","none")},m(k,j){N(k,e,j),m(e,l),m(e,s),m(e,o),m(o,r),m(o,c),m(o,a),m(a,i);for(let T=0;T<z.length;T+=1)z[T]&&z[T].m(i,null);m(a,u),m(a,f),m(o,d),m(o,p),Q&&Q.m(p,null),m(p,$),m(p,q),m(q,H),Y&&Y.m(H,null),m(q,P),ne(A,q,null),n[29](e),_=!0,w||(R=[_e(l,"click",n[14]),_e(l,"keydown",n[14]),_e(l,"mouseenter",n[17]),_e(l,"mouseleave",n[18]),_e(e,"click",n[13]),_e(e,"keydown",n[13])],w=!0)},p(k,j){if((!_||j[0]&66)&&ee(r,"active",k[6]&&!k[1]),j[0]&3620){O=me(k[2]);let b;for(b=0;b<O.length;b+=1){const J=Vl(k,O,b);z[b]?(z[b].p(J,j),L(z[b],1)):(z[b]=Sl(J),z[b].c(),L(z[b],1),z[b].m(i,null))}for(Ae(),b=O.length;b<z.length;b+=1)X(b);Le()}k[1]?Q||(Q=Al(),Q.c(),Q.m(p,$)):Q&&(Q.d(1),Q=null),k[1]?Y?(Y.p(k,j),j[0]&2&&L(Y,1)):(Y=Ll(k),Y.c(),L(Y,1),Y.m(H,null)):Y&&(Ae(),F(Y,1,1,()=>{Y=null}),Le());const T={};!g&&j[0]&32&&(g=!0,T.hoveredIndex=k[5],Jt(()=>g=!1)),!D&&j[0]&16&&(D=!0,T.drawBars=k[4],Jt(()=>D=!1)),A.$set(T),(!_||j[0]&3&&V!==(V=ie(ae("softmax",k[0],{expanded:k[1]}))+" svelte-1uvdybw"))&&h(e,"class",V)},i(k){if(!_){for(let j=0;j<O.length;j+=1)L(z[j]);L(Y),L(A.$$.fragment,k),_=!0}},o(k){z=z.filter(Boolean);for(let j=0;j<z.length;j+=1)F(z[j]);F(Y),F(A.$$.fragment,k),_=!1},d(k){k&&v(e),Se(z,k),Q&&Q.d(),Y&&Y.d(),oe(A),n[29](null),w=!1,Re(R)}}}function as(n,e,l){let t,s,o,r,c,a,i,u,f;ye(n,kt,S=>l(19,c=S)),ye(n,We,S=>l(20,a=S)),ye(n,Bn,S=>l(10,i=S)),ye(n,zt,S=>l(11,u=S)),ye(n,Zt,S=>l(12,f=S));let{className:d=void 0}=e;mt(pt),Tt("block-id","softmax");const p=Pt("block-id");let $=!1;const q=()=>{$||(We.set({id:p}),V())},H=S=>{S.stopPropagation(),S.preventDefault(),$?(We.set({id:null}),_()):(We.set({id:p}),V())};let P;function A(S){$&&!P.contains(S.target)&&We.set({id:null})}ct(()=>(document.body.addEventListener("click",A),()=>{document.body.removeEventListener("click",A)}));let g,D;const V=async()=>{g=vt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,$=!0),await Vt(),lt.set(".steps",{justifyContent:"end"}),lt.set(".softmax-detail",{opacity:0}),vt.Flip.from(g,{duration:.5,ease:"power2.inOut",onComplete:()=>{D==null||D()}}),lt.to(".softmax-detail",{opacity:1,duration:.2,delay:.5})},_=async()=>{g=vt.Flip.getState(".softmax .softmax-detail.expandable"),l(1,$=!1),await Vt(),await vt.Flip.from(g,{duration:.5,ease:"power2.inOut",onComplete:()=>{D==null||D()}}),lt.to(".softmax-detail",{opacity:0,duration:.2}),lt.set(".steps",{justifyContent:"start"})};let w=$t*1.2,R=.4*$t,O=null,z=!1;function X(){l(6,z=!0)}function Q(){l(6,z=!1)}const Y=S=>l(5,O=S),U=()=>l(5,O=null),y=S=>l(5,O=S),G=()=>l(5,O=null),k=S=>l(5,O=S),j=()=>l(5,O=null);function T(S){O=S,l(5,O)}function b(S){D=S,l(4,D)}function J(S){Ue[S?"unshift":"push"](()=>{P=S,l(3,P)})}return n.$$set=S=>{"className"in S&&l(0,d=S.className)},n.$$.update=()=>{n.$$.dirty[0]&1048578&&a.id!==p&&$&&(l(1,$=!1),_()),n.$$.dirty[0]&524288&&l(2,t=(c==null?void 0:c.prediction)||[]),n.$$.dirty[0]&4&&l(9,s=t==null?void 0:t.map(S=>S.tokenId)),n.$$.dirty[0]&4&&l(8,o=(t==null?void 0:t.map(S=>S.adjustedLogit))||[]),n.$$.dirty[0]&4&&l(7,r=(t==null?void 0:t.map(S=>S.adjustedExp))||[])},[d,$,t,P,D,O,z,r,o,s,i,u,f,q,H,w,R,X,Q,c,a,Y,U,y,G,k,j,T,b,J]}class is extends He{constructor(e){super(),je(this,e,as,rs,Ne,{className:0},null,[-1,-1])}}function cs(n){let e,l="Drop out is";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-ohkp45"&&(e.textContent=l),this.h()},h(){h(e,"class","dropout-content")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function us(n){let e,l;return e=new Ft({props:{class:ae("popover dropout-popover text-sm",n[1]),title:"Drop out",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[cs]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,[s]){const o={};s&2&&(o.class=ae("popover dropout-popover text-sm",t[1])),s&1&&(o.offset=t[0]),s&4&&(o.triggeredBy=t[2]),s&8&&(o.trigger=t[3]),s&16&&(o.placement=t[4]),s&32&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function fs(n,e,l){let{offset:t=void 0}=e,{className:s=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:r="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,s=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,r=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,s,o,r,c]}class ds extends He{constructor(e){super(),je(this,e,fs,us,Ne,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function hs(n){let e,l="Layer normalization is";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-qw3l61"&&(e.textContent=l),this.h()},h(){h(e,"class","ln-content")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function vs(n){let e,l;return e=new Ft({props:{class:ae("popover ln-popover text-sm",n[1]),title:"Layer Normalization",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[hs]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,[s]){const o={};s&2&&(o.class=ae("popover ln-popover text-sm",t[1])),s&1&&(o.offset=t[0]),s&4&&(o.triggeredBy=t[2]),s&8&&(o.trigger=t[3]),s&16&&(o.placement=t[4]),s&32&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function ms(n,e,l){let{offset:t=void 0}=e,{className:s=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:r="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,s=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,r=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,s,o,r,c]}class ps extends He{constructor(e){super(),je(this,e,ms,vs,Ne,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function gs(n){let e,l=`The GELU (Gaussian Error Linear Unit) activation function combines linear and non-linear
		behavior by scaling inputs using the Gaussian cumulative distribution function. It retains small
		negative values for smoother gradients and is effective in models like BERT.`;return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1ri460b"&&(e.textContent=l),this.h()},h(){h(e,"class","activation-content svelte-60plg2")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function _s(n){let e,l;return e=new Ft({props:{class:ae("popover activation-popover text-sm",n[1]),title:"GeLu Activation",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[gs]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,[s]){const o={};s&2&&(o.class=ae("popover activation-popover text-sm",t[1])),s&1&&(o.offset=t[0]),s&4&&(o.triggeredBy=t[2]),s&8&&(o.trigger=t[3]),s&16&&(o.placement=t[4]),s&32&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function bs(n,e,l){let{offset:t=void 0}=e,{className:s=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:r="hover"}=e,{placement:c="right"}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,s=a.className),"triggeredBy"in a&&l(2,o=a.triggeredBy),"trigger"in a&&l(3,r=a.trigger),"placement"in a&&l(4,c=a.placement)},[t,s,o,r,c]}class $s extends He{constructor(e){super(),je(this,e,bs,_s,Ne,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function ys(n){let e,l="Residual out is";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-124ixs1"&&(e.textContent=l),this.h()},h(){h(e,"class","residual-content")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function ks(n){let e,l;return e=new Ft({props:{class:ae("popover residual-popover text-sm",n[1]),title:"Residual",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},reference:n[5],$$slots:{default:[ys]},$$scope:{ctx:n}}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,[s]){const o={};s&2&&(o.class=ae("popover residual-popover text-sm",t[1])),s&1&&(o.offset=t[0]),s&4&&(o.triggeredBy=t[2]),s&8&&(o.trigger=t[3]),s&16&&(o.placement=t[4]),s&32&&(o.reference=t[5]),s&64&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function ws(n,e,l){let{offset:t=void 0}=e,{className:s=void 0}=e,{triggeredBy:o=void 0}=e,{trigger:r="hover"}=e,{placement:c="right"}=e,{reference:a}=e;return n.$$set=i=>{"offset"in i&&l(0,t=i.offset),"className"in i&&l(1,s=i.className),"triggeredBy"in i&&l(2,o=i.triggeredBy),"trigger"in i&&l(3,r=i.trigger),"placement"in i&&l(4,c=i.placement),"reference"in i&&l(5,a=i.reference)},[t,s,o,r,c,a]}class Es extends He{constructor(e){super(),je(this,e,ws,ks,Ne,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4,reference:5})}}function Hl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function jl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Pl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Tl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function zl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Is(n){let e,l,t,s,o,r,c=me(n[4]),a=[];for(let u=0;u<c.length;u+=1)a[u]=Gl(Hl(n,c,u));const i=u=>F(a[u],1,1,()=>{a[u]=null});return{c(){e=E("div");for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){e=I(u,"DIV",{id:!0,class:!0,role:!0});var f=C(e);for(let d=0;d<a.length;d+=1)a[d].l(f);f.forEach(v),this.h()},h(){h(e,"id",l=`${n[0]}-end`),h(e,"class",t=ie(ae("operation-col column residual",n[1]))+" svelte-cfq6hx"),h(e,"role","group")},m(u,f){N(u,e,f);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(e,null);s=!0,o||(r=[_e(e,"mouseenter",n[5]),_e(e,"mouseleave",n[6])],o=!0)},p(u,f){if(f&27){c=me(u[4]);let d;for(d=0;d<c.length;d+=1){const p=Hl(u,c,d);a[d]?(a[d].p(p,f),L(a[d],1)):(a[d]=Gl(p),a[d].c(),L(a[d],1),a[d].m(e,null))}for(Ae(),d=c.length;d<a.length;d+=1)i(d);Le()}(!s||f&1&&l!==(l=`${u[0]}-end`))&&h(e,"id",l),(!s||f&2&&t!==(t=ie(ae("operation-col column residual",u[1]))+" svelte-cfq6hx"))&&h(e,"class",t)},i(u){if(!s){for(let f=0;f<c.length;f+=1)L(a[f]);s=!0}},o(u){a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)F(a[f]);s=!1},d(u){u&&v(e),Se(a,u),o=!1,Re(r)}}}function Cs(n){let e,l,t,s,o,r,c,a,i=me(n[4]),u=[];for(let d=0;d<i.length;d+=1)u[d]=Fl(jl(n,i,d));const f=d=>F(u[d],1,1,()=>{u[d]=null});return t=new Es({props:{reference:`#${n[0]}-start`,triggeredBy:`[id^='${n[0]}-']`,offset:1}}),{c(){e=E("div");for(let d=0;d<u.length;d+=1)u[d].c();l=M(),te(t.$$.fragment),this.h()},l(d){e=I(d,"DIV",{id:!0,class:!0,role:!0});var p=C(e);for(let $=0;$<u.length;$+=1)u[$].l(p);l=B(p),le(t.$$.fragment,p),p.forEach(v),this.h()},h(){h(e,"id",s=`${n[0]}-start`),h(e,"class",o=ie(ae("operation-col column residual",n[1]))+" svelte-cfq6hx"),h(e,"role","group")},m(d,p){N(d,e,p);for(let $=0;$<u.length;$+=1)u[$]&&u[$].m(e,null);m(e,l),ne(t,e,null),r=!0,c||(a=[_e(e,"mouseenter",n[5]),_e(e,"mouseleave",n[6])],c=!0)},p(d,p){if(p&27){i=me(d[4]);let q;for(q=0;q<i.length;q+=1){const H=jl(d,i,q);u[q]?(u[q].p(H,p),L(u[q],1)):(u[q]=Fl(H),u[q].c(),L(u[q],1),u[q].m(e,l))}for(Ae(),q=i.length;q<u.length;q+=1)f(q);Le()}const $={};p&1&&($.reference=`#${d[0]}-start`),p&1&&($.triggeredBy=`[id^='${d[0]}-']`),t.$set($),(!r||p&1&&s!==(s=`${d[0]}-start`))&&h(e,"id",s),(!r||p&2&&o!==(o=ie(ae("operation-col column residual",d[1]))+" svelte-cfq6hx"))&&h(e,"class",o)},i(d){if(!r){for(let p=0;p<i.length;p+=1)L(u[p]);L(t.$$.fragment,d),r=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)F(u[p]);F(t.$$.fragment,d),r=!1},d(d){d&&v(e),Se(u,d),oe(t),c=!1,Re(a)}}}function qs(n){let e,l,t,s,o,r,c,a=me(n[4]),i=[];for(let f=0;f<a.length;f+=1)i[f]=Rl(Pl(n,a,f));const u=f=>F(i[f],1,1,()=>{i[f]=null});return t=new ps({props:{triggeredBy:`#${n[0]}`}}),{c(){e=E("div");for(let f=0;f<i.length;f+=1)i[f].c();l=M(),te(t.$$.fragment),this.h()},l(f){e=I(f,"DIV",{id:!0,class:!0,role:!0});var d=C(e);for(let p=0;p<i.length;p+=1)i[p].l(d);l=B(d),le(t.$$.fragment,d),d.forEach(v),this.h()},h(){h(e,"id",n[0]),h(e,"class",s=ie(ae("operation-col column ln",n[1]))+" svelte-cfq6hx"),h(e,"role","group")},m(f,d){N(f,e,d);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);m(e,l),ne(t,e,null),o=!0,r||(c=[_e(e,"mouseenter",n[11]),_e(e,"mouseleave",n[12])],r=!0)},p(f,d){if(d&26){a=me(f[4]);let $;for($=0;$<a.length;$+=1){const q=Pl(f,a,$);i[$]?(i[$].p(q,d),L(i[$],1)):(i[$]=Rl(q),i[$].c(),L(i[$],1),i[$].m(e,l))}for(Ae(),$=a.length;$<i.length;$+=1)u($);Le()}const p={};d&1&&(p.triggeredBy=`#${f[0]}`),t.$set(p),(!o||d&1)&&h(e,"id",f[0]),(!o||d&2&&s!==(s=ie(ae("operation-col column ln",f[1]))+" svelte-cfq6hx"))&&h(e,"class",s)},i(f){if(!o){for(let d=0;d<a.length;d+=1)L(i[d]);L(t.$$.fragment,f),o=!0}},o(f){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);F(t.$$.fragment,f),o=!1},d(f){f&&v(e),Se(i,f),oe(t),r=!1,Re(c)}}}function Ds(n){let e,l,t,s,o,r,c,a=me(n[4]),i=[];for(let f=0;f<a.length;f+=1)i[f]=Ol(Tl(n,a,f));const u=f=>F(i[f],1,1,()=>{i[f]=null});return t=new ds({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=E("div");for(let f=0;f<i.length;f+=1)i[f].c();l=M(),te(t.$$.fragment),this.h()},l(f){e=I(f,"DIV",{id:!0,class:!0,role:!0});var d=C(e);for(let p=0;p<i.length;p+=1)i[p].l(d);l=B(d),le(t.$$.fragment,d),d.forEach(v),this.h()},h(){h(e,"id",n[0]),h(e,"class",s=ie(ae("operation-col column dropout",n[1]))+" svelte-cfq6hx"),h(e,"role","group")},m(f,d){N(f,e,d);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);m(e,l),ne(t,e,null),o=!0,r||(c=[_e(e,"mouseenter",n[9]),_e(e,"mouseleave",n[10])],r=!0)},p(f,d){if(d&26){a=me(f[4]);let $;for($=0;$<a.length;$+=1){const q=Tl(f,a,$);i[$]?(i[$].p(q,d),L(i[$],1)):(i[$]=Ol(q),i[$].c(),L(i[$],1),i[$].m(e,l))}for(Ae(),$=a.length;$<i.length;$+=1)u($);Le()}const p={};d&1&&(p.triggeredBy=`#${f[0]}`),t.$set(p),(!o||d&1)&&h(e,"id",f[0]),(!o||d&2&&s!==(s=ie(ae("operation-col column dropout",f[1]))+" svelte-cfq6hx"))&&h(e,"class",s)},i(f){if(!o){for(let d=0;d<a.length;d+=1)L(i[d]);L(t.$$.fragment,f),o=!0}},o(f){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);F(t.$$.fragment,f),o=!1},d(f){f&&v(e),Se(i,f),oe(t),r=!1,Re(c)}}}function Vs(n){let e,l,t,s,o,r,c,a=me(n[4]),i=[];for(let f=0;f<a.length;f+=1)i[f]=Wl(zl(n,a,f));const u=f=>F(i[f],1,1,()=>{i[f]=null});return t=new $s({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=E("div");for(let f=0;f<i.length;f+=1)i[f].c();l=M(),te(t.$$.fragment),this.h()},l(f){e=I(f,"DIV",{id:!0,class:!0,role:!0});var d=C(e);for(let p=0;p<i.length;p+=1)i[p].l(d);l=B(d),le(t.$$.fragment,d),d.forEach(v),this.h()},h(){h(e,"id",n[0]),h(e,"class",s=ie(ae("operation-col column activation",n[1]))+" svelte-cfq6hx"),h(e,"role","group")},m(f,d){N(f,e,d);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);m(e,l),ne(t,e,null),o=!0,r||(c=[_e(e,"mouseenter",n[7]),_e(e,"mouseleave",n[8])],r=!0)},p(f,d){if(d&26){a=me(f[4]);let $;for($=0;$<a.length;$+=1){const q=zl(f,a,$);i[$]?(i[$].p(q,d),L(i[$],1)):(i[$]=Wl(q),i[$].c(),L(i[$],1),i[$].m(e,l))}for(Ae(),$=a.length;$<i.length;$+=1)u($);Le()}const p={};d&1&&(p.triggeredBy=`#${f[0]}`),t.$set(p),(!o||d&1)&&h(e,"id",f[0]),(!o||d&2&&s!==(s=ie(ae("operation-col column activation",f[1]))+" svelte-cfq6hx"))&&h(e,"class",s)},i(f){if(!o){for(let d=0;d<a.length;d+=1)L(i[d]);L(t.$$.fragment,f),o=!0}},o(f){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);F(t.$$.fragment,f),o=!1},d(f){f&&v(e),Se(i,f),oe(t),r=!1,Re(c)}}}function Gl(n){let e,l;return e=new At({props:{id:n[0],className:ae(n[1],{last:n[17]===n[4].length-1}),type:"residual-end",head:n[17]===0,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const o={};s&1&&(o.id=t[0]),s&18&&(o.className=ae(t[1],{last:t[17]===t[4].length-1})),s&8&&(o.active=t[3]),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function Fl(n){let e,l;return e=new At({props:{id:n[0],className:ae(n[1],{last:n[17]===n[4].length-1}),type:"residual-start",head:n[17]===0,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const o={};s&1&&(o.id=t[0]),s&18&&(o.className=ae(t[1],{last:t[17]===t[4].length-1})),s&8&&(o.active=t[3]),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function Rl(n){let e,l;return e=new At({props:{className:ae(n[1],{last:n[17]===n[4].length-1}),type:"ln",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const o={};s&18&&(o.className=ae(t[1],{last:t[17]===t[4].length-1})),s&16&&(o.tail=t[17]===t[4].length-1),s&8&&(o.active=t[3]),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function Ol(n){let e,l;return e=new At({props:{className:ae(n[1],{last:n[17]===n[4].length-1}),type:"dropout",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const o={};s&18&&(o.className=ae(t[1],{last:t[17]===t[4].length-1})),s&16&&(o.tail=t[17]===t[4].length-1),s&8&&(o.active=t[3]),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function Wl(n){let e,l;return e=new At({props:{className:ae(n[1],{last:n[17]===n[4].length-1}),type:"activation",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){te(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const o={};s&18&&(o.className=ae(t[1],{last:t[17]===t[4].length-1})),s&16&&(o.tail=t[17]===t[4].length-1),s&8&&(o.active=t[3]),e.$set(o)},i(t){l||(L(e.$$.fragment,t),l=!0)},o(t){F(e.$$.fragment,t),l=!1},d(t){oe(e,t)}}}function Ss(n){let e,l,t,s;const o=[Vs,Ds,qs,Cs,Is],r=[];function c(a,i){return a[2]==="activation"?0:a[2]==="dropout"?1:a[2]==="ln"?2:a[2]==="residual-start"?3:a[2]==="residual-end"?4:-1}return~(e=c(n))&&(l=r[e]=o[e](n)),{c(){l&&l.c(),t=at()},l(a){l&&l.l(a),t=at()},m(a,i){~e&&r[e].m(a,i),N(a,t,i),s=!0},p(a,[i]){let u=e;e=c(a),e===u?~e&&r[e].p(a,i):(l&&(Ae(),F(r[u],1,1,()=>{r[u]=null}),Le()),~e?(l=r[e],l?l.p(a,i):(l=r[e]=o[e](a),l.c()),L(l,1),l.m(t.parentNode,t)):l=null)},i(a){s||(L(l),s=!0)},o(a){F(l),s=!1},d(a){a&&v(t),~e&&r[e].d(a)}}}function As(n,e,l){let t;ye(n,ut,A=>l(4,t=A));let{id:s}=e,{className:o=void 0}=e,{type:r=void 0}=e,c=!1;const a=()=>{l(3,c=!0);const A=document.querySelector(`#${s}-start`),g=document.querySelector(`#${s}-end`),D=et(`.residual-connector.${s}`);D.style("opacity",1),f(D),A==null||A.classList.add("active"),g==null||g.classList.add("active")};let i;const u=()=>{l(3,c=!1);const A=document.querySelector(`#${s}-start`),g=document.querySelector(`#${s}-end`),D=et(`.residual-connector.${s}`);D.style("opacity",0),i&&(i.kill(),D.style("stroke-dashoffset",0)),A==null||A.classList.remove("active"),g==null||g.classList.remove("active")},f=A=>{i=lt.to(A.node(),{strokeDashoffset:-50,duration:1,repeat:-1,ease:"none"})},d=()=>{l(3,c=!0)},p=()=>{l(3,c=!1)},$=()=>{l(3,c=!0)},q=()=>{l(3,c=!1)},H=()=>{l(3,c=!0)},P=()=>{l(3,c=!1)};return n.$$set=A=>{"id"in A&&l(0,s=A.id),"className"in A&&l(1,o=A.className),"type"in A&&l(2,r=A.type)},[s,o,r,c,t,a,u,d,p,$,q,H,P]}class st extends He{constructor(e){super(),je(this,e,As,Ss,Ne,{id:0,className:1,type:2})}}function Zl(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Xl(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Kl(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Ql(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Yl(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Ul(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function Jl(n){let e,l="Token";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-6k2z6t"&&(e.textContent=l),this.h()},h(){h(e,"class","subtitle embedding-detail svelte-1iayxn1")},m(t,s){N(t,e,s)},d(t){t&&v(e)}}}function xl(n){let e,l,t=n[19]+"",s;return{c(){e=E("div"),l=E("span"),s=se(t),this.h()},l(o){e=I(o,"DIV",{class:!0});var r=C(e);l=I(r,"SPAN",{class:!0});var c=C(l);s=re(c,t),c.forEach(v),r.forEach(v),this.h()},h(){h(l,"class","label svelte-1iayxn1"),h(e,"class","cell svelte-1iayxn1"),ee(e,"last",n[21]===n[4].length-1)},m(o,r){N(o,e,r),m(e,l),m(l,s)},p(o,r){r&16&&t!==(t=o[19]+"")&&qe(s,t),r&16&&ee(e,"last",o[21]===o[4].length-1)},d(o){o&&v(e)}}}function en(n){let e,l,t,s,o,r="Token<br/>Embedding",c,a,i,u,f,d,p,$,q="Positional<br/>Encoding",H,P,A,g,D;e=new Je({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover",$$slots:{default:[Ls]},$$scope:{ctx:n}}}),c=new tl({props:{id:"token-embedding",$$slots:{default:[Ms]},$$scope:{ctx:n}}});let V=me(n[4]),_=[];for(let y=0;y<V.length;y+=1)_[y]=tn(Yl(n,V,y));const w=y=>F(_[y],1,1,()=>{_[y]=null});let R=me(n[4]),O=[];for(let y=0;y<R.length;y+=1)O[y]=ln(Ql(n,R,y));H=new tl({props:{id:"position-embedding",$$slots:{default:[Ns]},$$scope:{ctx:n}}});let z=me(n[4]),X=[];for(let y=0;y<z.length;y+=1)X[y]=nn(Kl(n,z,y));const Q=y=>F(X[y],1,1,()=>{X[y]=null});let Y=me(n[4]),U=[];for(let y=0;y<Y.length;y+=1)U[y]=on(Xl(n,Y,y));return{c(){te(e.$$.fragment),l=M(),t=E("div"),s=E("div"),o=E("span"),o.innerHTML=r,te(c.$$.fragment),a=M();for(let y=0;y<_.length;y+=1)_[y].c();i=M(),u=E("div");for(let y=0;y<O.length;y+=1)O[y].c();f=M(),d=E("div"),p=E("div"),$=E("span"),$.innerHTML=q,te(H.$$.fragment),P=M();for(let y=0;y<X.length;y+=1)X[y].c();A=M(),g=E("div");for(let y=0;y<U.length;y+=1)U[y].c();this.h()},l(y){le(e.$$.fragment,y),l=B(y),t=I(y,"DIV",{class:!0});var G=C(t);s=I(G,"DIV",{class:!0});var k=C(s);o=I(k,"SPAN",{"data-svelte-h":!0}),Ce(o)!=="svelte-1vtrff3"&&(o.innerHTML=r),le(c.$$.fragment,k),k.forEach(v),a=B(G);for(let S=0;S<_.length;S+=1)_[S].l(G);G.forEach(v),i=B(y),u=I(y,"DIV",{class:!0});var j=C(u);for(let S=0;S<O.length;S+=1)O[S].l(j);j.forEach(v),f=B(y),d=I(y,"DIV",{class:!0});var T=C(d);p=I(T,"DIV",{class:!0});var b=C(p);$=I(b,"SPAN",{"data-svelte-h":!0}),Ce($)!=="svelte-12blhrw"&&($.innerHTML=q),le(H.$$.fragment,b),b.forEach(v),P=B(T);for(let S=0;S<X.length;S+=1)X[S].l(T);T.forEach(v),A=B(y),g=I(y,"DIV",{class:!0});var J=C(g);for(let S=0;S<U.length;S+=1)U[S].l(J);J.forEach(v),this.h()},h(){h(s,"class","subtitle flex items-center gap-1 svelte-1iayxn1"),h(t,"class","column token-embedding embedding-detail svelte-1iayxn1"),h(u,"class","column symbol embedding-detail svelte-1iayxn1"),h(p,"class","subtitle flex gap-1 svelte-1iayxn1"),h(d,"class","column embedding-detail position-embedding svelte-1iayxn1"),h(g,"class","column symbol embedding-detail svelte-1iayxn1")},m(y,G){ne(e,y,G),N(y,l,G),N(y,t,G),m(t,s),m(s,o),ne(c,s,null),m(t,a);for(let k=0;k<_.length;k+=1)_[k]&&_[k].m(t,null);N(y,i,G),N(y,u,G);for(let k=0;k<O.length;k+=1)O[k]&&O[k].m(u,null);N(y,f,G),N(y,d,G),m(d,p),m(p,$),ne(H,p,null),m(d,P);for(let k=0;k<X.length;k+=1)X[k]&&X[k].m(d,null);N(y,A,G),N(y,g,G);for(let k=0;k<U.length;k+=1)U[k]&&U[k].m(g,null);D=!0},p(y,G){const k={};G&134217760&&(k.$$scope={dirty:G,ctx:y}),e.$set(k);const j={};if(G&134217728&&(j.$$scope={dirty:G,ctx:y}),c.$set(j),G&16){V=me(y[4]);let b;for(b=0;b<V.length;b+=1){const J=Yl(y,V,b);_[b]?(_[b].p(J,G),L(_[b],1)):(_[b]=tn(J),_[b].c(),L(_[b],1),_[b].m(t,null))}for(Ae(),b=V.length;b<_.length;b+=1)w(b);Le()}if(G&16){R=me(y[4]);let b;for(b=0;b<R.length;b+=1){const J=Ql(y,R,b);O[b]?O[b].p(J,G):(O[b]=ln(),O[b].c(),O[b].m(u,null))}for(;b<O.length;b+=1)O[b].d(1);O.length=R.length}const T={};if(G&134217728&&(T.$$scope={dirty:G,ctx:y}),H.$set(T),G&80){z=me(y[4]);let b;for(b=0;b<z.length;b+=1){const J=Kl(y,z,b);X[b]?(X[b].p(J,G),L(X[b],1)):(X[b]=nn(J),X[b].c(),L(X[b],1),X[b].m(d,null))}for(Ae(),b=z.length;b<X.length;b+=1)Q(b);Le()}if(G&16){Y=me(y[4]);let b;for(b=0;b<Y.length;b+=1){const J=Xl(y,Y,b);U[b]?U[b].p(J,G):(U[b]=on(),U[b].c(),U[b].m(g,null))}for(;b<U.length;b+=1)U[b].d(1);U.length=Y.length}},i(y){if(!D){L(e.$$.fragment,y),L(c.$$.fragment,y);for(let G=0;G<V.length;G+=1)L(_[G]);L(H.$$.fragment,y);for(let G=0;G<z.length;G+=1)L(X[G]);D=!0}},o(y){F(e.$$.fragment,y),F(c.$$.fragment,y),_=_.filter(Boolean);for(let G=0;G<_.length;G+=1)F(_[G]);F(H.$$.fragment,y),X=X.filter(Boolean);for(let G=0;G<X.length;G+=1)F(X[G]);D=!1},d(y){y&&(v(l),v(t),v(i),v(u),v(f),v(d),v(A),v(g)),oe(e,y),oe(c),Se(_,y),Se(O,y),oe(H),Se(X,y),Se(U,y)}}}function Ls(n){let e,l=n[5].dimension+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Ms(n){let e;return{c(){e=se("Token Embedding is")},l(l){e=re(l,"Token Embedding is")},m(l,t){N(l,e,t)},d(l){l&&v(e)}}}function Bs(n){let e,l="id",t;return{c(){e=E("span"),e.textContent=l,t=E("br"),this.h()},l(s){e=I(s,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1e13gni"&&(e.textContent=l),t=I(s,"BR",{}),this.h()},h(){h(e,"class","label svelte-1iayxn1")},m(s,o){N(s,e,o),N(s,t,o)},d(s){s&&(v(e),v(t))}}}function tn(n){let e,l,t='<div class="flex flex-col items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 31 9" fill="none" class="w-10 text-gray-300"><path fill="currentColor" d="M30.3886 4.74352C30.5839 4.54826 30.5839 4.23168 30.3886 4.03642L27.2067 0.854435C27.0114 0.659173 26.6948 0.659173 26.4996 0.854435C26.3043 1.0497 26.3043 1.36628 26.4996 1.56154L29.328 4.38997L26.4996 7.2184C26.3043 7.41366 26.3043 7.73024 26.4996 7.9255C26.6948 8.12076 27.0114 8.12076 27.2067 7.9255L30.3886 4.74352ZM0.31958 4.88997H30.0351V3.88997H0.31958V4.88997Z"></path></svg></div>',s,o,r,c,a,i,u,f,d=(Math.random()*1e4).toFixed()+"",p,$,q;c=new rt({props:{active:!0}});let H=n[21]===0&&Bs();return{c(){e=E("div"),l=E("div"),l.innerHTML=t,s=M(),o=E("div"),r=E("div"),te(c.$$.fragment),a=M(),i=E("span"),H&&H.c(),u=M(),f=E("span"),p=se(d),$=M(),this.h()},l(P){e=I(P,"DIV",{class:!0});var A=C(e);l=I(A,"DIV",{class:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-lh48yp"&&(l.innerHTML=t),s=B(A),o=I(A,"DIV",{class:!0});var g=C(o);r=I(g,"DIV",{class:!0});var D=C(r);le(c.$$.fragment,D),D.forEach(v),a=B(g),i=I(g,"SPAN",{class:!0});var V=C(i);H&&H.l(V),u=B(V),f=I(V,"SPAN",{class:!0});var _=C(f);p=re(_,d),_.forEach(v),V.forEach(v),g.forEach(v),$=B(A),A.forEach(v),this.h()},h(){h(l,"class","vocab-index ellipsis flex items-center text-right text-xs text-gray-400 svelte-1iayxn1"),h(r,"class",ie(`vector ${Kt}`)+" svelte-1iayxn1"),h(f,"class","val svelte-1iayxn1"),h(i,"class","index-val text-xs svelte-1iayxn1"),h(o,"class","cell flex items-center svelte-1iayxn1"),h(e,"class","token-id flex items-center")},m(P,A){N(P,e,A),m(e,l),m(e,s),m(e,o),m(o,r),ne(c,r,null),m(o,a),m(o,i),H&&H.m(i,null),m(i,u),m(i,f),m(f,p),m(e,$),q=!0},p:Be,i(P){q||(L(c.$$.fragment,P),q=!0)},o(P){F(c.$$.fragment,P),q=!1},d(P){P&&v(e),oe(c),H&&H.d()}}}function ln(n){let e,l="+";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-124y0va"&&(e.textContent=l),this.h()},h(){h(e,"class","cell svelte-1iayxn1")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function Ns(n){let e;return{c(){e=se("Positional Embedding is")},l(l){e=re(l,"Positional Embedding is")},m(l,t){N(l,e,t)},d(l){l&&v(e)}}}function Hs(n){let e,l="position",t;return{c(){e=E("span"),e.textContent=l,t=E("br"),this.h()},l(s){e=I(s,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-4n0g90"&&(e.textContent=l),t=I(s,"BR",{}),this.h()},h(){h(e,"class","label svelte-1iayxn1")},m(s,o){N(s,e,o),N(s,t,o)},d(s){s&&(v(e),v(t))}}}function nn(n){let e,l,t,s,o,r,c,a,i,u;t=new rt({props:{active:!0,colorScale:n[12]}});let f=n[21]===0&&Hs();return{c(){e=E("div"),l=E("div"),te(t.$$.fragment),s=M(),o=E("span"),f&&f.c(),r=M(),c=E("span"),a=se(n[21]),i=M(),this.h()},l(d){e=I(d,"DIV",{class:!0});var p=C(e);l=I(p,"DIV",{class:!0});var $=C(l);le(t.$$.fragment,$),$.forEach(v),s=B(p),o=I(p,"SPAN",{class:!0});var q=C(o);f&&f.l(q),r=B(q),c=I(q,"SPAN",{class:!0});var H=C(c);a=re(H,n[21]),H.forEach(v),q.forEach(v),i=B(p),p.forEach(v),this.h()},h(){h(l,"class",ie(`vector ${Kt}`)+" svelte-1iayxn1"),h(c,"class","val svelte-1iayxn1"),h(o,"class","index-val text-xs svelte-1iayxn1"),h(e,"class","cell flex items-center svelte-1iayxn1")},m(d,p){N(d,e,p),m(e,l),ne(t,l,null),m(e,s),m(e,o),f&&f.m(o,null),m(o,r),m(o,c),m(c,a),m(e,i),u=!0},p:Be,i(d){u||(L(t.$$.fragment,d),u=!0)},o(d){F(t.$$.fragment,d),u=!1},d(d){d&&v(e),oe(t),f&&f.d()}}}function on(n){let e,l="=";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=I(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1btrmmo"&&(e.textContent=l),this.h()},h(){h(e,"class","cell svelte-1iayxn1")},m(t,s){N(t,e,s)},p:Be,d(t){t&&v(e)}}}function js(n){let e,l=n[5].dimension+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&32&&l!==(l=o[5].dimension+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function sn(n){let e,l,t,s;return l=new rt({props:{active:n[3]||n[1]}}),{c(){e=E("div"),te(l.$$.fragment),t=M(),this.h()},l(o){e=I(o,"DIV",{class:!0});var r=C(e);le(l.$$.fragment,r),t=B(r),r.forEach(v),this.h()},h(){h(e,"class",ie(`vector ${Kt}`)+" svelte-1iayxn1"),ee(e,"last",n[21]===n[4].length-1)},m(o,r){N(o,e,r),ne(l,e,null),m(e,t),s=!0},p(o,r){const c={};r&10&&(c.active=o[3]||o[1]),l.$set(c),(!s||r&16)&&ee(e,"last",o[21]===o[4].length-1)},i(o){s||(L(l.$$.fragment,o),s=!0)},o(o){F(l.$$.fragment,o),s=!1},d(o){o&&v(e),oe(l)}}}function Ps(n){let e,l,t="<div>Embedding</div>",s,o,r,c,a,i,u,f,d,p,$,q,H,P,A,g,D,V,_,w,R,O,z,X,Q=n[1]&&Jl(),Y=me(n[4]),U=[];for(let T=0;T<Y.length;T+=1)U[T]=xl(Ul(n,Y,T));let y=n[1]&&en(n);$=new Je({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover",$$slots:{default:[js]},$$scope:{ctx:n}}});let G=me(n[4]),k=[];for(let T=0;T<G.length;T+=1)k[T]=sn(Zl(n,G,T));const j=T=>F(k[T],1,1,()=>{k[T]=null});return g=new st({props:{type:"dropout",id:"embedding-dropout"}}),V=new st({props:{type:"residual-start",id:"residual-first"}}),w=new st({props:{type:"ln",id:"embedding-ln"}}),{c(){e=E("div"),l=E("div"),l.innerHTML=t,s=M(),o=E("div"),r=E("div"),c=E("div"),Q&&Q.c(),a=M();for(let T=0;T<U.length;T+=1)U[T].c();i=M(),u=E("div"),f=M(),y&&y.c(),d=M(),p=E("div"),te($.$$.fragment),q=M(),H=E("div");for(let T=0;T<k.length;T+=1)k[T].c();P=M(),A=E("div"),te(g.$$.fragment),D=M(),te(V.$$.fragment),_=M(),te(w.$$.fragment),this.h()},l(T){e=I(T,"DIV",{class:!0,role:!0});var b=C(e);l=I(b,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-szi5cj"&&(l.innerHTML=t),s=B(b),o=I(b,"DIV",{class:!0});var J=C(o);r=I(J,"DIV",{class:!0});var S=C(r);c=I(S,"DIV",{class:!0});var he=C(c);Q&&Q.l(he),a=B(he);for(let W=0;W<U.length;W+=1)U[W].l(he);i=B(he),u=I(he,"DIV",{class:!0}),C(u).forEach(v),he.forEach(v),f=B(S),y&&y.l(S),S.forEach(v),d=B(J),p=I(J,"DIV",{class:!0});var de=C(p);le($.$$.fragment,de),q=B(de),H=I(de,"DIV",{class:!0});var Z=C(H);for(let W=0;W<k.length;W+=1)k[W].l(Z);Z.forEach(v),P=B(de),A=I(de,"DIV",{class:!0});var ge=C(A);le(g.$$.fragment,ge),D=B(ge),le(V.$$.fragment,ge),_=B(ge),le(w.$$.fragment,ge),ge.forEach(v),de.forEach(v),J.forEach(v),b.forEach(v),this.h()},h(){h(l,"class","title expandable svelte-1iayxn1"),h(l,"role","none"),h(u,"class","bounding embedding-bounding svelte-1iayxn1"),ee(u,"active",n[3]&&!n[1]),h(c,"class","column token-string relative svelte-1iayxn1"),h(r,"class","token-column resizable resize-watch flex"),h(H,"class","column vectors svelte-1iayxn1"),h(A,"class","operations flex svelte-1iayxn1"),h(p,"class","vector-column relative flex"),h(o,"class","content relative svelte-1iayxn1"),h(e,"class",R=ie(ae("embedding",n[0],{expanded:n[1]}))+" svelte-1iayxn1"),h(e,"role","none")},m(T,b){N(T,e,b),m(e,l),m(e,s),m(e,o),m(o,r),m(r,c),Q&&Q.m(c,null),m(c,a);for(let J=0;J<U.length;J+=1)U[J]&&U[J].m(c,null);m(c,i),m(c,u),m(r,f),y&&y.m(r,null),m(o,d),m(o,p),ne($,p,null),m(p,q),m(p,H);for(let J=0;J<k.length;J+=1)k[J]&&k[J].m(H,null);m(p,P),m(p,A),ne(g,A,null),m(A,D),ne(V,A,null),m(A,_),ne(w,A,null),n[13](e),O=!0,z||(X=[_e(l,"click",n[8]),_e(l,"keydown",n[8]),_e(l,"mouseenter",n[9]),_e(l,"mouseleave",n[10]),_e(e,"click",n[7]),_e(e,"keydown",n[7])],z=!0)},p(T,[b]){if(T[1]?Q||(Q=Jl(),Q.c(),Q.m(c,a)):Q&&(Q.d(1),Q=null),b&16){Y=me(T[4]);let S;for(S=0;S<Y.length;S+=1){const he=Ul(T,Y,S);U[S]?U[S].p(he,b):(U[S]=xl(he),U[S].c(),U[S].m(c,i))}for(;S<U.length;S+=1)U[S].d(1);U.length=Y.length}(!O||b&10)&&ee(u,"active",T[3]&&!T[1]),T[1]?y?(y.p(T,b),b&2&&L(y,1)):(y=en(T),y.c(),L(y,1),y.m(r,null)):y&&(Ae(),F(y,1,1,()=>{y=null}),Le());const J={};if(b&134217760&&(J.$$scope={dirty:b,ctx:T}),$.$set(J),b&26){G=me(T[4]);let S;for(S=0;S<G.length;S+=1){const he=Zl(T,G,S);k[S]?(k[S].p(he,b),L(k[S],1)):(k[S]=sn(he),k[S].c(),L(k[S],1),k[S].m(H,null))}for(Ae(),S=G.length;S<k.length;S+=1)j(S);Le()}(!O||b&3&&R!==(R=ie(ae("embedding",T[0],{expanded:T[1]}))+" svelte-1iayxn1"))&&h(e,"class",R)},i(T){if(!O){L(y),L($.$$.fragment,T);for(let b=0;b<G.length;b+=1)L(k[b]);L(g.$$.fragment,T),L(V.$$.fragment,T),L(w.$$.fragment,T),O=!0}},o(T){F(y),F($.$$.fragment,T),k=k.filter(Boolean);for(let b=0;b<k.length;b+=1)F(k[b]);F(g.$$.fragment,T),F(V.$$.fragment,T),F(w.$$.fragment,T),O=!1},d(T){T&&v(e),Q&&Q.d(),Se(U,T),y&&y.d(),oe($),Se(k,T),oe(g),oe(V),oe(w),n[13](null),z=!1,Re(X)}}}const Kt="bg-gray-300";function Ts(n,e,l){let t,s,o;ye(n,We,_=>l(11,t=_)),ye(n,ut,_=>l(4,s=_)),ye(n,yt,_=>l(5,o=_));const{theme:r}=mt(pt);let{className:c=void 0}=e;Tt("block-id","embedding");const a=Pt("block-id");let i=!1;const u=()=>{i||(We.set({id:a}),q())},f=_=>{_.stopPropagation(),_.preventDefault(),i?(We.set({id:null}),H()):(We.set({id:a}),q())};let d;function p(_){i&&!d.contains(_.target)&&We.set({id:null})}ct(()=>(document.body.addEventListener("click",p),()=>{document.body.removeEventListener("click",p)}));let $;const q=async()=>{$=vt.Flip.getState(".embedding .token-column"),l(1,i=!0),await Vt(),vt.Flip.from($,{duration:.5,ease:"power2.inOut"}),lt.to(".embedding-detail",{opacity:1,duration:.5,delay:.5})},H=async()=>{$=vt.Flip.getState(".embedding .token-column"),l(1,i=!1),await Vt(),vt.Flip.from($,{duration:.5,ease:"power2.inOut"})};let P=!1;function A(){l(3,P=!0)}function g(){l(3,P=!1)}const D=(_,w)=>Cn().domain([0,.5,1]).range([r.colors.red[400],"white",r.colors.blue[400]])(_);function V(_){Ue[_?"unshift":"push"](()=>{d=_,l(2,d)})}return n.$$set=_=>{"className"in _&&l(0,c=_.className)},n.$$.update=()=>{n.$$.dirty&2050&&t.id!==a&&i&&(l(1,i=!1),H())},[c,i,d,P,s,o,r,u,f,A,g,t,D,V]}class zs extends He{constructor(e){super(),je(this,e,Ts,Ps,Ne,{className:0})}}function rn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function an(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function cn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function Gs(n){let e,l=n[3].dimension+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&8&&l!==(l=o[3].dimension+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Fs(n){let e,l=n[3].dimension+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&8&&l!==(l=o[3].dimension+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function Rs(n){let e,l=n[3].dimension*4+"",t,s;return{c(){e=se("vector("),t=se(l),s=se(")")},l(o){e=re(o,"vector("),t=re(o,l),s=re(o,")")},m(o,r){N(o,e,r),N(o,t,r),N(o,s,r)},p(o,r){r&8&&l!==(l=o[3].dimension*4+"")&&qe(t,l)},d(o){o&&(v(e),v(t),v(s))}}}function un(n){let e,l,t=n[10]+"",s,o,r,c,a,i,u,f,d,p,$,q;c=new rt({props:{colorScale:"purple",active:n[2]===n[12]}});function H(){return n[8](n[12])}return{c(){e=E("div"),l=E("span"),s=se(t),o=M(),r=E("div"),te(c.$$.fragment),a=M(),i=E("div"),u=M(),f=E("div"),d=M(),this.h()},l(P){e=I(P,"DIV",{class:!0,role:!0});var A=C(e);l=I(A,"SPAN",{class:!0});var g=C(l);s=re(g,t),g.forEach(v),o=B(A),r=I(A,"DIV",{class:!0});var D=C(r);le(c.$$.fragment,D),a=B(D),i=I(D,"DIV",{class:!0}),C(i).forEach(v),u=B(D),f=I(D,"DIV",{class:!0}),C(f).forEach(v),D.forEach(v),d=B(A),A.forEach(v),this.h()},h(){h(l,"class","label float"),h(i,"class","sub-vector x1-12 head1"),h(f,"class","sub-vector head-rest grow"),h(r,"class",ie(`vector flex flex-col  ${Ws}`)+" svelte-16fqg1x"),h(e,"class","cell"),h(e,"role","group"),ee(e,"last",n[12]===n[5].length-1)},m(P,A){N(P,e,A),m(e,l),m(l,s),m(e,o),m(e,r),ne(c,r,null),m(r,a),m(r,i),m(r,u),m(r,f),m(e,d),p=!0,$||(q=[_e(e,"mouseenter",H),_e(e,"mouseleave",n[9])],$=!0)},p(P,A){n=P,(!p||A&32)&&t!==(t=n[10]+"")&&qe(s,t);const g={};A&4&&(g.active=n[2]===n[12]),c.$set(g),(!p||A&32)&&ee(e,"last",n[12]===n[5].length-1)},i(P){p||(L(c.$$.fragment,P),p=!0)},o(P){F(c.$$.fragment,P),p=!1},d(P){P&&v(e),oe(c),$=!1,Re(q)}}}function fn(n){let e,l,t,s,o,r;return t=new rt({props:{colorScale:"indigo"}}),{c(){e=E("div"),l=E("div"),te(t.$$.fragment),s=M(),this.h()},l(c){e=I(c,"DIV",{class:!0});var a=C(e);l=I(a,"DIV",{class:!0});var i=C(l);le(t.$$.fragment,i),i.forEach(v),s=B(a),a.forEach(v),this.h()},h(){h(l,"class",ie(ae(`vector x4 ${Zs} opacity-80`))+" svelte-16fqg1x"),h(e,"class",o=ie(ae("cell x4",{small:n[12]!==0&&n[12]!==n[5].length-1}))+" svelte-16fqg1x"),ee(e,"last",n[12]===n[5].length-1)},m(c,a){N(c,e,a),m(e,l),ne(t,l,null),m(e,s),r=!0},p(c,a){(!r||a&32&&o!==(o=ie(ae("cell x4",{small:c[12]!==0&&c[12]!==c[5].length-1}))+" svelte-16fqg1x"))&&h(e,"class",o),(!r||a&32)&&ee(e,"last",c[12]===c[5].length-1)},i(c){r||(L(t.$$.fragment,c),r=!0)},o(c){F(t.$$.fragment,c),r=!1},d(c){c&&v(e),oe(t)}}}function dn(n){let e,l,t,s,o;return t=new rt({props:{colorScale:"blue"}}),{c(){e=E("div"),l=E("div"),te(t.$$.fragment),s=M(),this.h()},l(r){e=I(r,"DIV",{class:!0});var c=C(e);l=I(c,"DIV",{class:!0});var a=C(l);le(t.$$.fragment,a),a.forEach(v),s=B(c),c.forEach(v),this.h()},h(){h(l,"class",ie(`vector ${Xs}`)+" svelte-16fqg1x"),h(e,"class","cell"),ee(e,"last",n[12]===n[5].length-1)},m(r,c){N(r,e,c),m(e,l),ne(t,l,null),m(e,s),o=!0},p(r,c){(!o||c&32)&&ee(e,"last",r[12]===r[5].length-1)},i(r){o||(L(t.$$.fragment,r),o=!0)},o(r){F(t.$$.fragment,r),o=!1},d(r){r&&v(e),oe(t)}}}function Os(n){let e,l,t="MLP",s,o,r,c,a,i,u,f,d,p,$,q,H,P,A,g,D,V,_,w,R,O,z,X,Q,Y,U,y,G,k,j,T,b,J,S,he,de,Z,ge;r=new Je({props:{triggeredBy:".mlp .first-layer .vector",placement:"right",class:"popover",$$slots:{default:[Gs]},$$scope:{ctx:n}}}),a=new Je({props:{triggeredBy:".mlp .out .vector",placement:"right",class:"popover",$$slots:{default:[Fs]},$$scope:{ctx:n}}}),u=new Je({props:{triggeredBy:".mlp .projections .vector",placement:"right",class:"popover",$$slots:{default:[Rs]},$$scope:{ctx:n}}});let W=me(n[5]),pe=[];for(let K=0;K<W.length;K+=1)pe[K]=un(cn(n,W,K));const Oe=K=>F(pe[K],1,1,()=>{pe[K]=null});g=new st({props:{type:"dropout",id:"mlp-first-dropout"}}),V=new st({props:{type:"residual-end",id:"residual-first"}}),w=new st({props:{type:"ln",id:"mlp-first-ln"}}),O=new st({props:{type:"residual-start",id:"residual-second"}});let ze=me(n[5]),we=[];for(let K=0;K<ze.length;K+=1)we[K]=fn(an(n,ze,K));const Ze=K=>F(we[K],1,1,()=>{we[K]=null});y=new st({props:{type:"activation",id:"mlp-activation",className:"x4"}}),j=new st({props:{type:"residual-end",id:"residual-second"}}),b=new st({props:{type:"ln",id:"mlp-second-ln"}});let Pe=me(n[5]),$e=[];for(let K=0;K<Pe.length;K+=1)$e[K]=dn(rn(n,Pe,K));const De=K=>F($e[K],1,1,()=>{$e[K]=null});return{c(){e=E("div"),l=E("div"),l.textContent=t,s=M(),o=E("div"),te(r.$$.fragment),c=M(),te(a.$$.fragment),i=M(),te(u.$$.fragment),f=M(),d=E("div"),p=M(),$=E("div"),q=M(),H=E("div"),P=E("div");for(let K=0;K<pe.length;K+=1)pe[K].c();A=M(),te(g.$$.fragment),D=M(),te(V.$$.fragment),_=M(),te(w.$$.fragment),R=M(),te(O.$$.fragment),z=M(),X=E("div"),Q=E("div"),Y=E("div");for(let K=0;K<we.length;K+=1)we[K].c();U=M(),te(y.$$.fragment),G=M(),k=E("div"),te(j.$$.fragment),T=M(),te(b.$$.fragment),J=M(),S=E("div");for(let K=0;K<$e.length;K+=1)$e[K].c();this.h()},l(K){e=I(K,"DIV",{class:!0});var ue=C(e);l=I(ue,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-50ab67"&&(l.textContent=t),s=B(ue),o=I(ue,"DIV",{class:!0});var be=C(o);le(r.$$.fragment,be),c=B(be),le(a.$$.fragment,be),i=B(be),le(u.$$.fragment,be),f=B(be),d=I(be,"DIV",{class:!0}),C(d).forEach(v),p=B(be),$=I(be,"DIV",{class:!0}),C($).forEach(v),q=B(be),H=I(be,"DIV",{class:!0});var Ve=C(H);P=I(Ve,"DIV",{class:!0});var tt=C(P);for(let Te=0;Te<pe.length;Te+=1)pe[Te].l(tt);tt.forEach(v),A=B(Ve),le(g.$$.fragment,Ve),D=B(Ve),le(V.$$.fragment,Ve),_=B(Ve),le(w.$$.fragment,Ve),R=B(Ve),le(O.$$.fragment,Ve),Ve.forEach(v),z=B(be),X=I(be,"DIV",{class:!0});var ce=C(X);Q=I(ce,"DIV",{class:!0});var Me=C(Q);Y=I(Me,"DIV",{class:!0});var nt=C(Y);for(let Te=0;Te<we.length;Te+=1)we[Te].l(nt);nt.forEach(v),U=B(Me),le(y.$$.fragment,Me),Me.forEach(v),G=B(ce),k=I(ce,"DIV",{class:!0});var Qe=C(k);le(j.$$.fragment,Qe),T=B(Qe),le(b.$$.fragment,Qe),J=B(Qe),S=I(Qe,"DIV",{class:!0});var Ge=C(S);for(let Te=0;Te<$e.length;Te+=1)$e[Te].l(Ge);Ge.forEach(v),Qe.forEach(v),ce.forEach(v),be.forEach(v),ue.forEach(v),this.h()},h(){h(l,"class","title"),h(l,"role","group"),h(d,"class","bounding transformer-bounding svelte-16fqg1x"),ee(d,"active",n[4]),h($,"class","bounding mlp-bounding svelte-16fqg1x"),ee($,"active",n[1]),h(P,"class","column initial"),h(H,"class","layer first-layer flex svelte-16fqg1x"),h(Y,"class","column"),h(Q,"class","projections flex"),h(S,"class","column out"),h(k,"class","ouputs flex"),h(X,"class","layer second-layer flex justify-between svelte-16fqg1x"),h(o,"class","content relative svelte-16fqg1x"),h(e,"class",he=ie(ae("mlp",n[0]))+" svelte-16fqg1x")},m(K,ue){N(K,e,ue),m(e,l),m(e,s),m(e,o),ne(r,o,null),m(o,c),ne(a,o,null),m(o,i),ne(u,o,null),m(o,f),m(o,d),m(o,p),m(o,$),m(o,q),m(o,H),m(H,P);for(let be=0;be<pe.length;be+=1)pe[be]&&pe[be].m(P,null);m(H,A),ne(g,H,null),m(H,D),ne(V,H,null),m(H,_),ne(w,H,null),m(H,R),ne(O,H,null),m(o,z),m(o,X),m(X,Q),m(Q,Y);for(let be=0;be<we.length;be+=1)we[be]&&we[be].m(Y,null);m(Q,U),ne(y,Q,null),m(X,G),m(X,k),ne(j,k,null),m(k,T),ne(b,k,null),m(k,J),m(k,S);for(let be=0;be<$e.length;be+=1)$e[be]&&$e[be].m(S,null);de=!0,Z||(ge=[_e(l,"mouseenter",n[6]),_e(l,"mouseleave",n[7])],Z=!0)},p(K,[ue]){const be={};ue&32776&&(be.$$scope={dirty:ue,ctx:K}),r.$set(be);const Ve={};ue&32776&&(Ve.$$scope={dirty:ue,ctx:K}),a.$set(Ve);const tt={};if(ue&32776&&(tt.$$scope={dirty:ue,ctx:K}),u.$set(tt),(!de||ue&16)&&ee(d,"active",K[4]),(!de||ue&2)&&ee($,"active",K[1]),ue&36){W=me(K[5]);let ce;for(ce=0;ce<W.length;ce+=1){const Me=cn(K,W,ce);pe[ce]?(pe[ce].p(Me,ue),L(pe[ce],1)):(pe[ce]=un(Me),pe[ce].c(),L(pe[ce],1),pe[ce].m(P,null))}for(Ae(),ce=W.length;ce<pe.length;ce+=1)Oe(ce);Le()}if(ue&32){ze=me(K[5]);let ce;for(ce=0;ce<ze.length;ce+=1){const Me=an(K,ze,ce);we[ce]?(we[ce].p(Me,ue),L(we[ce],1)):(we[ce]=fn(Me),we[ce].c(),L(we[ce],1),we[ce].m(Y,null))}for(Ae(),ce=ze.length;ce<we.length;ce+=1)Ze(ce);Le()}if(ue&32){Pe=me(K[5]);let ce;for(ce=0;ce<Pe.length;ce+=1){const Me=rn(K,Pe,ce);$e[ce]?($e[ce].p(Me,ue),L($e[ce],1)):($e[ce]=dn(Me),$e[ce].c(),L($e[ce],1),$e[ce].m(S,null))}for(Ae(),ce=Pe.length;ce<$e.length;ce+=1)De(ce);Le()}(!de||ue&1&&he!==(he=ie(ae("mlp",K[0]))+" svelte-16fqg1x"))&&h(e,"class",he)},i(K){if(!de){L(r.$$.fragment,K),L(a.$$.fragment,K),L(u.$$.fragment,K);for(let ue=0;ue<W.length;ue+=1)L(pe[ue]);L(g.$$.fragment,K),L(V.$$.fragment,K),L(w.$$.fragment,K),L(O.$$.fragment,K);for(let ue=0;ue<ze.length;ue+=1)L(we[ue]);L(y.$$.fragment,K),L(j.$$.fragment,K),L(b.$$.fragment,K);for(let ue=0;ue<Pe.length;ue+=1)L($e[ue]);de=!0}},o(K){F(r.$$.fragment,K),F(a.$$.fragment,K),F(u.$$.fragment,K),pe=pe.filter(Boolean);for(let ue=0;ue<pe.length;ue+=1)F(pe[ue]);F(g.$$.fragment,K),F(V.$$.fragment,K),F(w.$$.fragment,K),F(O.$$.fragment,K),we=we.filter(Boolean);for(let ue=0;ue<we.length;ue+=1)F(we[ue]);F(y.$$.fragment,K),F(j.$$.fragment,K),F(b.$$.fragment,K),$e=$e.filter(Boolean);for(let ue=0;ue<$e.length;ue+=1)F($e[ue]);de=!1},d(K){K&&v(e),oe(r),oe(a),oe(u),Se(pe,K),oe(g),oe(V),oe(w),oe(O),Se(we,K),oe(y),oe(j),oe(b),Se($e,K),Z=!1,Re(ge)}}}const Ws="bg-purple-200",Zs="bg-indigo-200",Xs="bg-blue-200";function Ks(n,e,l){let t,s,o;ye(n,yt,p=>l(3,t=p)),ye(n,Dt,p=>l(4,s=p)),ye(n,ut,p=>l(5,o=p));let{className:r=void 0}=e;Tt("block-id","mlp");let c=!1;function a(){l(1,c=!0)}function i(){l(1,c=!1)}let u=null;const f=p=>{l(2,u=p)},d=()=>{l(2,u=null)};return n.$$set=p=>{"className"in p&&l(0,r=p.className)},[r,c,u,t,s,o,a,i,f,d]}class Qs extends He{constructor(e){super(),je(this,e,Ks,Os,Ne,{className:0})}}const{theme:Ys}=mt(pt),Ye=(n,e,l={})=>{const{color:t="rgba(255,255,255,0)",duration:s=.2,ease:o="power1.in",offset:r={from:"0%",to:"100%"},position:c="+=0",...a}=l,{from:i="0%",to:u="100%"}=r,f=Array.isArray(e)?e.map(d=>d.getAttribute("stop-color")):e.getAttribute("stop-color");n.fromTo(e,{attr:{offset:i,"stop-color":t}},{attr:{offset:u,"stop-color":t},duration:s,ease:o,...a},c).to(e,{attr:{offset:u,"stop-color":d=>Array.isArray(e)?f[d]:f},duration:s,ease:o,...a},"-=50%")},qt=Ys.colors.gray[200],Us=async n=>new Promise(e=>{var Ze,Pe,$e,De,K,ue,be,Ve,tt,ce,Me,nt,Qe,Ge,Te,wt,Et,It,ve,ke,Fe,Xe;const l=lt.timeline({onComplete:e}),t=.02,s=document.querySelectorAll(".embedding .content .last");l.fromTo(s,{opacity:0},{opacity:1,duration:t});const o=document.querySelectorAll(".sankey .embedding .last");l.set(o,{opacity:.6});const r=(Ze=document.querySelector("#gray-blue-last"))==null?void 0:Ze.querySelectorAll("stop")[1];Ye(l,r,{duration:t*10});const c=document.querySelectorAll(".attention .column .vector.last");l.fromTo(c,{opacity:0},{opacity:1,duration:t});const a=document.querySelectorAll(".sankey-top .attention .last"),i=document.querySelectorAll(".sankey-back .attention .last"),u=document.querySelectorAll(".sankey-top .attention .to-attention-out");l.set(a,{opacity:1}),l.set([i,u],{opacity:.4});const f=(Pe=document.querySelector("#blue-blue-last"))==null?void 0:Pe.querySelectorAll("stop")[1],d=($e=document.querySelector("#red-red-last"))==null?void 0:$e.querySelectorAll("stop")[1],p=(De=document.querySelector("#green-green-last"))==null?void 0:De.querySelectorAll("stop")[1],$=(K=document.querySelector("#blue-blue2-last"))==null?void 0:K.querySelectorAll("stop")[1],q=(ue=document.querySelector("#red-red2-last"))==null?void 0:ue.querySelectorAll("stop")[1],H=(be=document.querySelector("#green-green2-last"))==null?void 0:be.querySelectorAll("stop")[1];Ye(l,[f,d,p,$,q,H],{duration:t*10});const P=document.querySelectorAll(".attention .head-block .qkv .column .last");l.fromTo(P,{opacity:0},{opacity:1,duration:t});const A=document.querySelectorAll(".sankey g.attention path.key-to-attention"),g=document.querySelectorAll(".sankey g.attention path.query-to-attention");document.querySelectorAll(".sankey g.attention path.to-attention-out");const D=document.querySelector(".attention .attention-result");[...A,...g].forEach(Ke=>{const ot=Ke.getTotalLength();Ke.style.strokeDasharray=ot,Ke.style.strokeDashoffset=ot});const V=.4,_=Number((V/n).toFixed(2));l.to(A,{strokeDashoffset:0,stagger:_,duration:V,ease:"power2.out"},"<+=50%").to(g,{strokeDashoffset:0,stagger:_,duration:V,ease:"power2.out"},"<").from(D.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:V/n,stagger:Number((V/Math.pow(n,2)).toFixed(2)),ease:"power2.out",duration:V},"<");const w=(Ve=document.querySelector("#green-purple"))==null?void 0:Ve.querySelectorAll("stop")[1],R=(tt=document.querySelector("#transparent-purple2"))==null?void 0:tt.querySelectorAll("stop")[1];Ye(l,[R,w],{});const O=document.querySelectorAll(".attention .head-block .head-out .column .cell");l.fromTo(O,{opacity:0},{opacity:1,duration:t});const z=(ce=document.querySelector("#purple-purple"))==null?void 0:ce.querySelectorAll("stop")[1],X=(Me=document.querySelector("#transparent-purple"))==null?void 0:Me.querySelectorAll("stop")[1],Q=(nt=document.querySelector("#purple-purple-last"))==null?void 0:nt.querySelectorAll("stop")[1],Y=(Qe=document.querySelector("#transparent-purple-last"))==null?void 0:Qe.querySelectorAll("stop")[1];Ye(l,[z,X],{color:qt}),Ye(l,[Q,Y]);const U=document.querySelectorAll(".mlp .first-layer .cell");l.fromTo(U,{opacity:0},{opacity:1,duration:t});const y=document.querySelectorAll(".sankey .mlp .last");l.set(y,{opacity:.4});const G=(Ge=document.querySelector("#purple-indigo"))==null?void 0:Ge.querySelectorAll("stop")[1],k=(Te=document.querySelector("#purple-indigo-last"))==null?void 0:Te.querySelectorAll("stop")[1];Ye(l,G,{color:qt}),Ye(l,k,{position:"<"});const j=document.querySelectorAll(".mlp .second-layer .projections .cell");l.fromTo(j,{opacity:0},{opacity:1,duration:t});const T=(wt=document.querySelector("#indigo-blue"))==null?void 0:wt.querySelectorAll("stop")[1],b=(Et=document.querySelector("#indigo-blue-last"))==null?void 0:Et.querySelectorAll("stop")[1];Ye(l,T,{color:qt}),Ye(l,b,{position:"<"});const J=document.querySelectorAll(".mlp .second-layer .ouputs .cell");l.fromTo(J,{opacity:0},{opacity:1,duration:t});const S=document.querySelectorAll(".sankey .transformer-blocks .last");l.set(S,{opacity:.6});const he=(It=document.querySelector("#blue-white-blue"))==null?void 0:It.querySelectorAll("stop")[1],de=(ve=document.querySelector("#blue-white-blue"))==null?void 0:ve.querySelectorAll("stop")[3],Z=(ke=document.querySelector("#blue-white-blue-last"))==null?void 0:ke.querySelectorAll("stop")[1],ge=(Fe=document.querySelector("#blue-white-blue-last"))==null?void 0:Fe.querySelectorAll("stop")[3],W=lt.timeline({});Ye(W,he,{color:qt,duration:t*5,offset:{to:"50%"},ease:"sine.inOut"}),Ye(W,Z,{duration:t*5,offset:{to:"50%"},ease:"sine.inOut",position:"<"}),Ye(W,de,{duration:t*5,color:qt,offset:{from:"50%"},ease:"sine.inOut"}),Ye(W,ge,{duration:t*5,offset:{from:"50%"},ease:"sine.inOut",position:"<"}),l.add(W);const pe=document.querySelectorAll(".transformer-blocks .cell");l.fromTo(pe,{opacity:0},{opacity:1,duration:t});const Oe=document.querySelectorAll(".sankey .linear-softmax .last");l.set(Oe,{opacity:.4});const ze=(Xe=document.querySelector("#blue-gray"))==null?void 0:Xe.querySelectorAll("stop")[1];Ye(l,ze,{offset:{to:"50%"}});const we=document.querySelectorAll(".softmax .content");l.fromTo(we,{opacity:0},{opacity:1,duration:t})}),Js=async()=>{};Nn.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";const Sn=20,xs=async(n,e)=>{el.set(!0);const{token_ids:l,input_tokens:t}=await lr(n);ut.set(t);const{outputs:s,prediction:o}=await or(l),r=En(o,e),c=In(r,Sn);kt.set({outputs:s,prediction:r,sampled:c}),await Us(t.length),zt.set(c),el.set(!1)},er=async(n,e)=>{const l=En(n,e),t=In(l,Sn);kt.update(s=>({...s,prediction:l})),await Js(),zt.set(t)},tr=n=>{const e=Math.max(...n),l=n.map(s=>Math.exp(s-e)),t=l.reduce((s,o)=>s+o,0);return l.map(s=>s/t)},lr=async n=>{const e=await wn.from_pretrained("Xenova/gpt2"),l=e.encode(n),t=l.map(s=>e.decode([s])).flat();return{token_ids:l,input_tokens:t}},nr=(n,e,l,t)=>{const s=Array.from(n).map((o,r)=>({tokenId:r,logit:o,probability:e[r]}));return s.sort((o,r)=>r.probability-o.probability),s.slice(0,t).map((o,r)=>({...o,rank:r,token:l.decode([o.tokenId])}))},or=async n=>{try{const e=new Hn("int64",n,[1,n.length]),l=Ln(yn);if(!l)throw new Error("Model session is not initialized.");const t={input:e},s=await l.run(t),o=s.linear_output.data,r=tr(o),c=await wn.from_pretrained("Xenova/gpt2"),i=nr(o,r,c,100),u=sr.reduce((f,d)=>{const p=s[d];console.log(p);const $={...p,data:bo([...p.cpuData],p.dims)};return f[d]=$,f},{});return console.log("out",u),{outputs:u,prediction:i}}catch(e){throw console.error("Error during inference:",e.message),e}},sr=["block_0_attn_head_0_attn","block_0_attn_head_0_attn_scaled","block_0_attn_head_0_attn_masked","block_0_attn_head_0_attn_softmax","block_0_attn_head_0_attn_dropout","linear_output"];async function rr(n){const e=await fetch(n);if(!e.ok)throw new Error(`Failed to fetch ${n}`);return e.arrayBuffer()}async function ar(n){const e=await Promise.all(n.map(o=>rr(o))),l=e.reduce((o,r)=>o+r.byteLength,0),t=new Uint8Array(l);let s=0;for(const o of e)t.set(new Uint8Array(o),s),s+=o.byteLength;return t.buffer}function hn(n){let e,l,t,s,o,r,c;return l=new Wn({}),{c(){e=E("div"),te(l.$$.fragment),this.h()},l(a){e=I(a,"DIV",{class:!0,style:!0,role:!0});var i=C(e);le(l.$$.fragment,i),i.forEach(v),this.h()},h(){h(e,"class","qkv-weight-popover svelte-6mb5yb"),h(e,"style",t=`left:${n[0].left}px;top:${n[0].top}px;`),h(e,"role","group")},m(a,i){N(a,e,i),ne(l,e,null),o=!0,r||(c=[_e(e,"mouseenter",n[3]),_e(e,"mouseleave",n[4])],r=!0)},p(a,i){(!o||i&1&&t!==(t=`left:${a[0].left}px;top:${a[0].top}px;`))&&h(e,"style",t)},i(a){o||(L(l.$$.fragment,a),a&&(s||St(()=>{s=Mn(e,it,{duration:300}),s.start()})),o=!0)},o(a){F(l.$$.fragment,a),o=!1},d(a){a&&v(e),oe(l),r=!1,Re(c)}}}function ir(n){let e,l,t=(n[2]==="embedding"||n[1])&&hn(n);return{c(){t&&t.c(),e=at()},l(s){t&&t.l(s),e=at()},m(s,o){t&&t.m(s,o),N(s,e,o),l=!0},p(s,[o]){s[2]==="embedding"||s[1]?t?(t.p(s,o),o&6&&L(t,1)):(t=hn(s),t.c(),L(t,1),t.m(e.parentNode,e)):t&&(Ae(),F(t,1,1,()=>{t=null}),Le())},i(s){l||(L(t),l=!0)},o(s){F(t),l=!1},d(s){s&&v(e),t&&t.d(s)}}}function cr(n,e,l){let t;ye(n,Wt,i=>l(2,t=i));let s,o={left:0,top:0},r=!1;return ct(()=>{const i=()=>{var q;const f=window.scrollX,d=(q=document.querySelector(".top-bar"))==null?void 0:q.offsetHeight,$=document.querySelector(".step.embedding .content").getBoundingClientRect();l(0,o={left:$.right+f,top:$.top-d})};return i(),s=new ResizeObserver(f=>{i()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(f=>s.observe(f)),()=>{s.disconnect()}}),[o,r,t,()=>{l(1,r=!0)},()=>{l(1,r=!1)}]}class ur extends He{constructor(e){super(),je(this,e,cr,ir,Ne,{})}}function vn(n){let e,l,t,s,o,r,c;return{c(){e=E("div"),t=M(),s=E("div"),this.h()},l(a){e=I(a,"DIV",{class:!0}),C(e).forEach(v),t=B(a),s=I(a,"DIV",{class:!0}),C(s).forEach(v),this.h()},h(){h(e,"class","dim svelte-1bok0ve"),h(s,"class",o=ie(ae("dim-partial",`${n[1].id||""}`))+" svelte-1bok0ve")},m(a,i){N(a,e,i),N(a,t,i),N(a,s,i),c=!0},p(a,i){(!c||i&2&&o!==(o=ie(ae("dim-partial",`${a[1].id||""}`))+" svelte-1bok0ve"))&&h(s,"class",o)},i(a){c||(a&&St(()=>{c&&(l||(l=Bt(e,it,{duration:100},!0)),l.run(1))}),a&&St(()=>{c&&(r||(r=Bt(s,it,{duration:100},!0)),r.run(1))}),c=!0)},o(a){a&&(l||(l=Bt(e,it,{duration:100},!1)),l.run(0)),a&&(r||(r=Bt(s,it,{duration:100},!1)),r.run(0)),c=!1},d(a){a&&(v(e),v(t),v(s)),a&&l&&l.end(),a&&r&&r.end()}}}function fr(n){let e,l,t,s,o,r,c,a,i,u,f,d,p,$,q,H,P,A,g,D,V,_=!!n[1].id&&vn(n);return s=new ho({}),a=new zs({props:{className:"step"}}),u=new Go({props:{className:"step"}}),d=new Qs({props:{className:"step"}}),$=new Jo({props:{className:"step"}}),H=new is({props:{className:"step"}}),g=new ur({}),{c(){e=E("div"),_&&_.c(),l=M(),t=E("div"),te(s.$$.fragment),o=M(),r=E("div"),c=E("div"),te(a.$$.fragment),i=M(),te(u.$$.fragment),f=M(),te(d.$$.fragment),p=M(),te($.$$.fragment),q=M(),te(H.$$.fragment),A=M(),te(g.$$.fragment),this.h()},l(w){e=I(w,"DIV",{class:!0,style:!0});var R=C(e);_&&_.l(R),l=B(R),t=I(R,"DIV",{class:!0});var O=C(t);le(s.$$.fragment,O),O.forEach(v),o=B(R),r=I(R,"DIV",{class:!0});var z=C(r);c=I(z,"DIV",{class:!0});var X=C(c);le(a.$$.fragment,X),i=B(X),le(u.$$.fragment,X),f=B(X),le(d.$$.fragment,X),p=B(X),le($.$$.fragment,X),q=B(X),le(H.$$.fragment,X),X.forEach(v),A=B(z),le(g.$$.fragment,z),z.forEach(v),R.forEach(v),this.h()},h(){h(t,"class","sankey opacity-1 svelte-1bok0ve"),h(c,"class","steps svelte-1bok0ve"),St(()=>n[6].call(c)),ee(c,"expanded",n[2]),h(r,"class","nodes resize-watch svelte-1bok0ve"),h(e,"class","main-section h-full w-full"),h(e,"style",D=`--vector-height: ${n[3]}px;--title-height: ${n[4]}px;--content-height:${n[0]-n[4]}px;`)},m(w,R){N(w,e,R),_&&_.m(e,null),m(e,l),m(e,t),ne(s,t,null),m(e,o),m(e,r),m(r,c),ne(a,c,null),m(c,i),ne(u,c,null),m(c,f),ne(d,c,null),m(c,p),ne($,c,null),m(c,q),ne(H,c,null),P=bn(c,n[6].bind(c)),m(r,A),ne(g,r,null),V=!0},p(w,[R]){w[1].id?_?(_.p(w,R),R&2&&L(_,1)):(_=vn(w),_.c(),L(_,1),_.m(e,l)):_&&(Ae(),F(_,1,1,()=>{_=null}),Le()),(!V||R&4)&&ee(c,"expanded",w[2]),(!V||R&9&&D!==(D=`--vector-height: ${w[3]}px;--title-height: ${w[4]}px;--content-height:${w[0]-w[4]}px;`))&&h(e,"style",D)},i(w){V||(L(_),L(s.$$.fragment,w),L(a.$$.fragment,w),L(u.$$.fragment,w),L(d.$$.fragment,w),L($.$$.fragment,w),L(H.$$.fragment,w),L(g.$$.fragment,w),V=!0)},o(w){F(_),F(s.$$.fragment,w),F(a.$$.fragment,w),F(u.$$.fragment,w),F(d.$$.fragment,w),F($.$$.fragment,w),F(H.$$.fragment,w),F(g.$$.fragment,w),V=!1},d(w){w&&v(e),_&&_.d(),oe(s),oe(a),oe(u),oe(d),oe($),oe(H),P(),oe(g)}}}function dr(n,e,l){let t,s,o,r,c;ye(n,ut,p=>l(5,t=p)),ye(n,kt,p=>l(7,s=p)),ye(n,Zt,p=>l(8,o=p)),ye(n,We,p=>l(1,r=p)),ye(n,jt,p=>l(3,c=p));let a=!1;ct(async()=>{const $=Array(63).fill(0).map((_,w)=>`${xn}/gpt2.onnx.part${w}`),q=await ar($),H=new Blob([q],{type:"application/octet-stream"}),P=URL.createObjectURL(H),A=await jn.create(P,{});yn.set(A),Pn.set(!1);const g=Tn.subscribe(_=>{xs(_.trim(),o)});let D=!0;const V=Zt.subscribe(_=>{if(D){D=!1;return}er(s==null?void 0:s.prediction,_)});return()=>{g(),V()}});let i=0,u=$t*5;const f=()=>{const p=$t*.5*(t.length-1),$=Math.min(Math.max((i-u-p)/t.length/zn,Gn),Fn);jt.set($),$n.set(t.length*$*3+p)};function d(){i=this.offsetHeight,l(0,i)}return n.$$.update=()=>{n.$$.dirty&2&&(r.id!==null?l(2,a=!0):l(2,a=!1)),n.$$.dirty&33&&(i||t.length)&&f()},[i,r,a,c,u,t,d]}class wr extends He{constructor(e){super(),je(this,e,dr,fr,Ne,{})}}export{wr as component,kr as universal};
