import{s as je,G as sl,D as dl,H as hl,I as Yn,J as Ln,M as Mn,N as Bn,O as Pn,a4 as De,b as U,a5 as qe,d as T,g as _,h as x,p as g,j as G,n as He,m as Ee,z as _t,C as zt,A as Je,e as B,c as P,q as Be,w as mt,u as oe,k as I,ad as ve,t as ue,o as Ce,f as de,P as Lt,af as Tn,v as ke,l as Ae,r as Fe,a9 as Qt,E as Jt,a7 as pl,ag as Kn}from"../chunks/scheduler.QcZkUrsu.js";import{S as Oe,i as Ge,c as ie,a as ae,m as ce,t as j,b as W,d as fe,g as Ne,e as Le,h as vl,j as Qn,f as At}from"../chunks/index.Bylzl8VN.js";import{r as It,a as Dt,t as bt,m as Bt,s as il,e as $e,u as yt,b as pe,g as xe,v as Pt,w as Kt,x as Gt,y as Hn,p as Rt,d as Mt,n as Wt,z as Jn,f as al,Z as eo,i as ml,M as to,A as jn,P as lo,j as no,k as oo,B as ro,C as so,D as io}from"../chunks/index.CHTeGXUK.js";import{b as el,d as ao,c as co}from"../chunks/transform.yYZBLT4W.js";import{s as Xt,a as lt,M as Nt,F as Et,f as it,Q as fo}from"../chunks/QKVWeightPopover.TSplBK5v.js";import{a as uo,i as On,b as ho,c as po,l as cl}from"../chunks/linear.D3KXbiNi.js";import{g as vo,a as mo,t as go,b as at}from"../chunks/index.LjCCkuxf.js";import{P as _o,a as tl,H as gl,A as Gn}from"../chunks/image.BDjwIzRI.js";import{b as bo}from"../chunks/paths.C8-dxonX.js";function $o(n){let e;const l=n[4].default,t=Ln(l,n,n[6],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,r){t&&t.m(o,r),e=!0},p(o,r){t&&t.p&&(!e||r&64)&&Mn(t,l,o,o[6],e?Pn(l,o[6],r,null):Bn(o[6]),null)},i(o){e||(j(t,o),e=!0)},o(o){W(t,o),e=!1},d(o){t&&t.d(o)}}}function wo(n){let e,l;const t=[{rounded:!0},{shadow:!0},n[1],{class:n[0]}];let o={$$slots:{default:[$o]},$$scope:{ctx:n}};for(let r=0;r<t.length;r+=1)o=sl(o,t[r]);return e=new _o({props:o}),e.$on("show",n[5]),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,s){ce(e,r,s),l=!0},p(r,[s]){const c=s&3?vo(t,[t[0],t[1],s&2&&mo(r[1]),s&1&&{class:r[0]}]):{};s&64&&(c.$$scope={dirty:s,ctx:r}),e.$set(c)},i(r){l||(j(e.$$.fragment,r),l=!0)},o(r){W(e.$$.fragment,r),l=!1},d(r){fe(e,r)}}}function ko(n,e,l){const t=["type","defaultClass"];let o=dl(e,t),{$$slots:r={},$$scope:s}=e,{type:c="dark"}=e,{defaultClass:i="py-2 px-3 text-sm font-medium"}=e;const a={dark:"bg-gray-900 text-white dark:bg-gray-700",light:"border-gray-200 bg-white text-gray-900",auto:" bg-white text-gray-900 dark:bg-gray-700 dark:text-white border-gray-200 dark:border-gray-700",custom:""};let u;function h(p){Yn.call(this,n,p)}return n.$$set=p=>{l(8,e=sl(sl({},e),hl(p))),l(1,o=dl(e,t)),"type"in p&&l(2,c=p.type),"defaultClass"in p&&l(3,i=p.defaultClass),"$$scope"in p&&l(6,s=p.$$scope)},n.$$.update=()=>{o.color?l(2,c="custom"):l(1,o.color="none",o),["light","auto"].includes(c)&&l(1,o.border=!0,o),l(0,u=go("tooltip",i,a[c],e.class))},e=hl(e),[u,o,c,i,r,h,s]}class et extends Oe{constructor(e){super(),Ge(this,e,ko,wo,je,{type:2,defaultClass:3})}}function zn(n=[],e){const l=n.map(s=>s.logit/e),t=l.map(s=>Math.exp(s)),o=t.reduce((s,c)=>s+c,0);return n.map((s,c)=>({...s,adjustedLogit:l[c],adjustedProbability:t[c]/o,adjustedExp:t[c]}))}function Rn(n,e){const l=n.slice(0,e),t=[];let o=0;for(const s of l)o+=s.probability,t.push(o);const r=Math.random();for(let s=0;s<t.length;s++)if(r<t[s])return l[s];return l[0]}const yo=!0,zs=Object.freeze(Object.defineProperty({__proto__:null,prerender:yo},Symbol.toStringTag,{value:"Module"}));function Eo(n,e){let l,t;for(const o of n)o!=null&&(l===void 0?o>=o&&(l=t=o):(l>o&&(l=o),t<o&&(t=o)));return[l,t]}function Io(n,e){let l;if(e===void 0)for(const t of n)t!=null&&(l<t||l===void 0&&t>=t)&&(l=t);else{let t=-1;for(let o of n)(o=e(o,++t,n))!=null&&(l<o||l===void 0&&o>=o)&&(l=o)}return l}function Do(n,e){e===void 0&&(e=n,n=el);for(var l=0,t=e.length-1,o=e[0],r=new Array(t<0?0:t);l<t;)r[l]=n(o,o=e[++l]);return function(s){var c=Math.max(0,Math.min(t-1,Math.floor(s*=t)));return r[c](s-c)}}function qo(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Co(){var n=0,e=.5,l=1,t=1,o,r,s,c,i,a=On,u,h=!1,p;function b(H){return isNaN(H=+H)?p:(H=.5+((H=+u(H))-r)*(t*H<t*r?c:i),a(h?Math.max(0,Math.min(1,H)):H))}b.domain=function(H){return arguments.length?([n,e,l]=H,o=u(n=+n),r=u(e=+e),s=u(l=+l),c=o===r?0:.5/(r-o),i=r===s?0:.5/(s-r),t=r<o?-1:1,b):[n,e,l]},b.clamp=function(H){return arguments.length?(h=!!H,b):h},b.interpolator=function(H){return arguments.length?(a=H,b):a};function N(H){return function(z){var F,V,R;return arguments.length?([F,V,R]=z,a=Do(H,[F,V,R]),b):[a(0),a(.5),a(1)]}}return b.range=N(el),b.rangeRound=N(po),b.unknown=function(H){return arguments.length?(p=H,b):p},function(H){return u=H,o=H(n),r=H(e),s=H(l),c=o===r?0:.5/(r-o),i=r===s?0:.5/(s-r),t=r<o?-1:1,b}}function Fn(){var n=uo(Co()(On));return n.copy=function(){return qo(n,Fn())},ho.apply(n,arguments)}const{theme:re}=It(Dt),ge=200,_l={"gray-blue":{0:re.colors.gray[ge],100:re.colors.blue[ge]},"gray-blue-last":{0:re.colors.gray[ge],100:re.colors.blue[ge]},"purple-indigo":{0:re.colors.purple[ge],100:re.colors.indigo[ge]},"purple-indigo-last":{0:re.colors.purple[ge],100:re.colors.indigo[ge]},"indigo-blue":{0:re.colors.indigo[ge],100:re.colors.blue[ge]},"indigo-blue-last":{0:re.colors.indigo[ge],100:re.colors.blue[ge]},"blue-white":{0:re.colors.blue[ge],100:re.colors.white},"red-white":{0:re.colors.red[ge],100:re.colors.white},"green-white":{0:re.colors.green[ge],100:re.colors.white},"red-purple":{0:re.colors.red[ge],100:re.colors.purple[ge]},"blue-purple":{90:re.colors.blue[ge],100:re.colors.purple[ge]},"green-purple":{0:re.colors.green[ge],100:re.colors.purple[ge]},"blue-gray":{0:re.colors.blue[ge],50:re.colors.gray[ge]},"blue-white-blue":{0:re.colors.blue[ge],40:re.colors.white,60:re.colors.white,100:re.colors.blue[ge]},"blue-white-blue-last":{0:re.colors.blue[ge],40:re.colors.white,60:re.colors.white,100:re.colors.blue[ge]},"transparent-purple":{0:{color:re.colors.purple[100],opacity:0},100:{color:re.colors.purple[100],opacity:1}},"transparent-purple2":{0:{color:re.colors.purple[400],opacity:0},100:{color:re.colors.purple[200],opacity:1}},"transparent-purple-last":{0:{color:re.colors.purple[100],opacity:0},100:{color:re.colors.purple[100],opacity:1}},"transparent-purple2-last":{0:{color:re.colors.purple[400],opacity:0},100:{color:re.colors.purple[200],opacity:1}},"blue-blue":{0:re.colors.blue[ge],100:re.colors.blue[ge]},"red-red":{0:re.colors.red[ge],100:re.colors.red[ge]},"green-green":{0:re.colors.green[ge],100:re.colors.green[ge]},"blue-blue2":{0:re.colors.blue[ge],100:re.colors.blue[ge]},"red-red2":{0:re.colors.red[ge],100:re.colors.red[ge]},"green-green2":{0:re.colors.green[ge],100:re.colors.green[ge]},"blue-blue-last":{0:re.colors.blue[ge],100:re.colors.blue[ge]},"red-red-last":{0:re.colors.red[ge],100:re.colors.red[ge]},"green-green-last":{0:re.colors.green[ge],100:re.colors.green[ge]},"blue-blue2-last":{0:re.colors.blue[ge],100:re.colors.blue[ge]},"red-red2-last":{0:re.colors.red[ge],100:re.colors.red[ge]},"green-green2-last":{0:re.colors.green[ge],100:re.colors.green[ge]},"gray-gray":{0:re.colors.gray[ge],100:re.colors.gray[ge]},"purple-purple":{0:re.colors.purple[ge],100:re.colors.purple[ge]},"purple-purple-last":{0:re.colors.purple[ge],100:re.colors.purple[ge]}};function So(n){let e,l,t,o,r;return{c(){e=De("svg"),t=U(),o=De("svg"),this.h()},l(s){e=qe(s,"svg",{id:!0,class:!0,style:!0}),T(e).forEach(_),t=x(s),o=qe(s,"svg",{class:!0,style:!0}),T(o).forEach(_),this.h()},h(){g(e,"id","back"),g(e,"class","sankey-back absolute left-0 top-0 h-full w-full"),g(e,"style",l=`z-index:${n[2].attention_head_num-1};`),g(o,"class","sankey-top absolute left-0 top-0 h-full w-full"),g(o,"style",r=`z-index:${n[2].attention_head_num};`)},m(s,c){G(s,e,c),n[4](e),G(s,t,c),G(s,o,c),n[5](o)},p(s,[c]){c&4&&l!==(l=`z-index:${s[2].attention_head_num-1};`)&&g(e,"style",l),c&4&&r!==(r=`z-index:${s[2].attention_head_num};`)&&g(o,"style",r)},i:He,o:He,d(s){s&&(_(e),_(t),_(o)),n[4](null),n[5](null)}}}const Vo=80;function Ao(n,e,l){let t,o,r;Ee(n,bt,C=>l(3,o=C)),Ee(n,Bt,C=>l(2,r=C));const{theme:s}=It(Dt);let c,i,a;const u={attention:[{from:".attention .query .head-rest",to:".head-block .query .vector",gradientId:"blue-blue2",opacity:.4},{from:".attention .key .head-rest",to:".head-block .key .vector",gradientId:"red-red2",opacity:.4},{from:".attention .value .head-rest",to:".head-block .value .vector",gradientId:"green-green2",opacity:.4},{from:".attention .head-out .vector",to:".mlp .initial .vector .head-rest",gradientId:"transparent-purple",opacity:.4}]},h=()=>{const q=lt(i).append("defs");Object.keys(_l).forEach(M=>{const f=_l[M],d=q.append("linearGradient").attr("id",M).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");Object.keys(f).forEach(m=>{let w,k;typeof f[m]!="string"?(w=f[m].color,k=f[m].opacity):(w=f[m],k=1),d.append("stop").attr("offset",`${m}%`).attr("stop-color",w).attr("stop-opacity",k)})})};let p=1,b;const N=(C,q)=>{clearTimeout(b),il.set(q);const M=lt(`g.${q}`).selectAll("path");p=M.nodes()[0].getAttribute("opacity"),M.transition().duration(200).style("opacity",Number(p)+.3)},H=(C,q)=>{b=setTimeout(()=>{il.set(null)},300),lt(`g.${q}`).selectAll("path").transition().duration(200).style("opacity",p)},z=async()=>{await zt();const C=lt(i),q=lt(c);[{dataMap:t,svg:C},{dataMap:u,svg:q}].forEach(({dataMap:M,svg:f})=>{f.selectAll("g.path-group").data(Object.keys(M)).join("g").attr("class",m=>`path-group ${m}`).on("mouseenter",N).on("mouseleave",H).selectAll("path.sankey-path").data(m=>M[m].map(k=>{const y=Xt(k.from).nodes(),A=Xt(k.to).nodes();return y.map((v,E)=>{const $=v.getBoundingClientRect(),D=A[E].getBoundingClientRect(),L=k.curve||Vo,O=(k.pathGenerator||F)($,D,L),X=A.length>1&&E===y.length-1;let he=k.gradientId;return X&&!k.unique&&document.getElementById(k.gradientId+"-last")&&(he=k.gradientId+"-last"),{id:k.id,isLast:E===y.length-1,path:O,fill:k.type==="stroke"?"none":k.gradientId?`url(#${he})`:k.fill,opacity:k.opacity,stroke:k.type==="stroke"?k.gradientId?`url(#${k.gradientId})`:k.fill:"none"}})}).flat()).join("path").attr("class",m=>`sankey-path ${m.id||""} ${m.isLast?"last":""}`).attr("fill",m=>m.fill).attr("stroke",m=>m.stroke).attr("stroke-width",2).attr("opacity",m=>m.opacity||1).attr("d",m=>m.path)})},F=(C,q,M)=>{const f=window.scrollY,d=window.scrollX;return`
        M ${C.right+d},${C.top+f}
        C ${C.right+d+M},${C.top+f} ${q.left+d-M},${q.top+f} ${q.left+d},${q.top+f}
        L ${q.left+d},${q.bottom+f}
        C ${q.left+d-M},${q.bottom+f} ${C.right+d+M},${C.bottom+f} ${C.right+d},${C.bottom+f}
        Z
    `};_t(()=>(h(),a=new ResizeObserver(q=>{z(),V()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(q=>a.observe(q)),()=>{a.disconnect()}));const V=()=>{const C=lt(i),q=Xt(".residual-start path.head").nodes(),M=Xt(".residual-end path.head").nodes(),f=q.map((d,m)=>{const w=d.getBoundingClientRect(),k=M[m].getBoundingClientRect(),y=w.right,A=w.top,v=k.left,E=k.top;return{x1:y,y1:A,x2:v,y2:E,id:d.id}});C.selectAll("line.residual-connector").data(f).join("line").attr("class",d=>`residual-connector ${d.id}`).attr("x1",d=>d.x1).attr("y1",d=>d.y1).attr("x2",d=>d.x2).attr("y2",d=>d.y2).attr("stroke",s.colors.gray[400]).attr("stroke-width",1).attr("stroke-dasharray","8,4").style("opacity",0)};function R(C){Je[C?"unshift":"push"](()=>{c=C,l(0,c)})}function ee(C){Je[C?"unshift":"push"](()=>{i=C,l(1,i)})}return n.$$.update=()=>{n.$$.dirty&8&&(t={embedding:[{from:".embedding .vector-column .column.vectors .vector",to:".attention .vector",gradientId:"gray-blue",opacity:.6,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX,m=30;return`
					M ${C.right+d},${C.top+f}
					L ${C.right+m+d},${C.top+f}
					C ${C.right+m+d+M},${C.top+f} ${q.left+d-M},${q.top+f} ${q.left+d},${q.top+f}
					L ${q.left+d},${q.bottom+f}
					C ${q.left+d-M},${q.bottom+f} ${C.right+m+d+M},${C.bottom+f} ${C.right+m+d},${C.bottom+f}
					L ${C.right+d},${C.bottom+f}
					Z
				`}}],attention:[{from:".attention .query .sub-vector.head1",to:".head-block .query .vector",gradientId:"blue-blue"},{from:".attention .key .sub-vector.head1",to:".head-block .key .vector",gradientId:"red-red"},{from:".attention .value .sub-vector.head1",to:".head-block .value .vector",gradientId:"green-green"},{from:".attention .head-out .vector",to:".mlp .initial .head1",gradientId:"purple-purple"},{from:".head-block .key .vector",to:".attention-initial .main g.g-row",id:"key-to-attention",type:"stroke",gradientId:"red-purple",unique:!0,curve:30,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX,m=C.top+f+C.height/2,w=q.top+f+q.height/2,k=C.right+d+M,y=q.left+d-M;return`
			    M ${C.right+d},${m}
			    C ${k},${m} ${y},${w} ${q.left+d},${w}
					L ${q.right+d},${w}
			`}},{from:".head-block .query .vector",to:`.attention-matrix.attention-initial .main g.g-row-${o.length-1} circle`,gradientId:"blue-purple",id:"query-to-attention",unique:!0,type:"stroke",curve:20,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX,m=C.top+f+C.height/2,w=q.left+d+q.width/2;return`
			    M ${C.right+d},${m}
			    L ${w-M},${m}
			    A ${M},${M} 0 0 1 ${w},${m+M}
			    L ${w},${q.bottom+f}
			`}},{from:".attention-matrix.attention-out .main svg",to:".attention .head-out",gradientId:"transparent-purple2",id:"to-attention-out",unique:!0,opacity:.4,curve:20,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX;return`
			    M ${C.right+d},${C.top+f}
			    C ${C.right+d+M},${C.top+f} ${q.left+d-M},${q.top+f} ${q.left+d},${q.top+f}
			    L ${q.left+d},${q.bottom+f}
			    C ${q.left+d-M},${q.bottom+f} ${C.right+d+M},${C.bottom+f} ${C.right+d},${C.bottom+f}
			    Z
			`}},{from:".head-block .value",to:".attention .head-out",gradientId:"green-purple",id:"to-attention-out",unique:!0,opacity:.4,curve:60,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX;return`
        M ${C.right+d},${C.top+f} 
        C ${q.left-M},${C.top+f} ${q.left+d-M},${C.top+f} ${q.left+d},${q.top+f}
        L ${q.left+d},${q.bottom+f}
        C ${q.left+d-M},${C.bottom+f} ${q.left-M},${C.bottom+f} ${C.right+d},${C.bottom+f}
        Z
    `}}],mlp:[{from:".mlp .column.initial .vector",to:".mlp .projections .vector",gradientId:"purple-indigo",curve:50,opacity:.4,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX,m=49;return`
					M ${C.right+d},${C.top+f}
					L ${C.right+m+d},${C.top+f}
					C ${C.right+m+d+M},${C.top+f} ${q.left+d-M},${q.top+f} ${q.left+d},${q.top+f}
					L ${q.left+d},${q.bottom+f}
					C ${q.left+d-M},${q.bottom+f} ${C.right+m+d+M},${C.bottom+f} ${C.right+m+d},${C.bottom+f}
					L ${C.right+d},${C.bottom+f}
					Z
				`}},{from:".mlp .projections .vector",to:".mlp .column.out .vector",gradientId:"indigo-blue",curve:50,opacity:.4,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX,m=20;return`
					M ${C.right+d},${C.top+f}
					C ${C.right+d+M},${C.top+f} ${q.left-m+d-M},${q.top+f} ${q.left-m+d},${q.top+f}
					L ${q.left+d},${q.top+f}
					L ${q.left+d},${q.bottom+f}
					L ${q.left-m+d},${q.bottom+f}
					C ${q.left-m+d-M},${q.bottom+f} ${C.right+d+M},${C.bottom+f} ${C.right+d},${C.bottom+f}
					L ${C.right+d},${C.bottom+f}
					Z
				`}}],"transformer-blocks":[{from:".mlp .out .vector",to:".transformer-blocks .column.final .vector",gradientId:"blue-white-blue",opacity:.6,pathGenerator:(C,q,M)=>{const f=window.scrollY,d=window.scrollX;return`
        M ${C.right+d},${C.top+f}
        C ${C.right+d+M},${C.top+f} ${q.left+d-M},${q.top+f} ${q.left+d},${q.top+f}
        L ${q.left+d},${q.bottom+f}
        C ${q.left+d-M},${q.bottom+f} ${C.right+d+M},${C.bottom+f} ${C.right+d},${C.bottom+f}
        Z
    `}}],"linear-softmax":[{from:".transformer-blocks .final .vector.last-token ",to:".softmax .content .vector",gradientId:"blue-gray",opacity:.4,unique:!0}]}),n.$$.dirty&8&&typeof window<"u"&&o&&(z(),V())},[c,i,r,o,R,ee]}class No extends Oe{constructor(e){super(),Ge(this,e,Ao,So,je,{})}}function bl(n,e,l){const t=n.slice();return t[6]=e[l],t[8]=l,t}function Lo(n){let e,l,t,o,r;return{c(){e=B("div"),l=B("div"),o=U(),this.h()},l(s){e=P(s,"DIV",{class:!0,style:!0});var c=T(e);l=P(c,"DIV",{class:!0,style:!0}),T(l).forEach(_),o=x(c),c.forEach(_),this.h()},h(){g(l,"class","card svelte-1k8s99h"),g(l,"style",t=`width: ${n[1].width}px; height: ${n[1].height}px;`),g(e,"class","rest absolute"),g(e,"style",r=`transform:translate(${n[8]*yt.x}px,${n[8]*yt.y}px) scale(${1-yt.scale*n[8]}); 
      z-index: ${n[2].attention_head_num-n[8]};opacity:${Math.max(.1,1-n[8]*wl)};`),oe(e,"first",n[8]===1)},m(s,c){G(s,e,c),I(e,l),I(e,o)},p(s,c){c&2&&t!==(t=`width: ${s[1].width}px; height: ${s[1].height}px;`)&&g(l,"style",t),c&4&&r!==(r=`transform:translate(${s[8]*yt.x}px,${s[8]*yt.y}px) scale(${1-yt.scale*s[8]}); 
      z-index: ${s[2].attention_head_num-s[8]};opacity:${Math.max(.1,1-s[8]*wl)};`)&&g(e,"style",r)},i:He,o:He,d(s){s&&_(e)}}}function Mo(n){let e,l,t;const o=n[4].default,r=Ln(o,n,n[3],null);return{c(){e=B("div"),r&&r.c(),l=U(),this.h()},l(s){e=P(s,"DIV",{class:!0});var c=T(e);r&&r.l(c),l=x(c),c.forEach(_),this.h()},h(){g(e,"class",ve("first-head-content")+" svelte-1k8s99h")},m(s,c){G(s,e,c),r&&r.m(e,null),I(e,l),n[5](e),t=!0},p(s,c){r&&r.p&&(!t||c&8)&&Mn(r,o,s,s[3],t?Pn(o,s[3],c,null):Bn(s[3]),null)},i(s){t||(j(r,s),t=!0)},o(s){W(r,s),t=!1},d(s){s&&_(e),r&&r.d(s),n[5](null)}}}function $l(n){let e,l,t,o;const r=[Mo,Lo],s=[];function c(i,a){return i[8]===0?0:1}return e=c(n),l=s[e]=r[e](n),{c(){l.c(),t=mt()},l(i){l.l(i),t=mt()},m(i,a){s[e].m(i,a),G(i,t,a),o=!0},p(i,a){l.p(i,a)},i(i){o||(j(l),o=!0)},o(i){W(l),o=!1},d(i){i&&_(t),s[e].d(i)}}}function Bo(n){let e,l,t=$e(Array(n[2].attention_head_num+1).fill(0)),o=[];for(let s=0;s<t.length;s+=1)o[s]=$l(bl(n,t,s));const r=s=>W(o[s],1,1,()=>{o[s]=null});return{c(){e=B("div");for(let s=0;s<o.length;s+=1)o[s].c();this.h()},l(s){e=P(s,"DIV",{class:!0});var c=T(e);for(let i=0;i<o.length;i+=1)o[i].l(c);c.forEach(_),this.h()},h(){g(e,"class","multi-head flex w-full svelte-1k8s99h")},m(s,c){G(s,e,c);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(e,null);l=!0},p(s,[c]){if(c&15){t=$e(Array(s[2].attention_head_num+1).fill(0));let i;for(i=0;i<t.length;i+=1){const a=bl(s,t,i);o[i]?(o[i].p(a,c),j(o[i],1)):(o[i]=$l(a),o[i].c(),j(o[i],1),o[i].m(e,null))}for(Ne(),i=t.length;i<o.length;i+=1)r(i);Le()}},i(s){if(!l){for(let c=0;c<t.length;c+=1)j(o[c]);l=!0}},o(s){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)W(o[c]);l=!1},d(s){s&&_(e),Be(o,s)}}}let wl=.1;function Po(n,e,l){let t;Ee(n,Bt,a=>l(2,t=a));let{$$slots:o={},$$scope:r}=e,s,c={width:0,height:0};_t(()=>{const a=new ResizeObserver(u=>{for(let h of u){const{width:p,height:b}=h.contentRect;l(1,c={width:p,height:b})}});return a.observe(s),()=>{a.unobserve(s)}});function i(a){Je[a?"unshift":"push"](()=>{s=a,l(0,s)})}return n.$$set=a=>{"$$scope"in a&&l(3,r=a.$$scope)},[s,c,t,r,o,i]}class To extends Oe{constructor(e){super(),Ge(this,e,Po,Bo,je,{})}}const Ho=(n,e)=>{const l=e.filter(o=>o!==1),t=(o,r)=>{if(r.length===1)return o.splice(0,r[0]);const s=r[0],c=r.slice(1);return Array.from({length:s},()=>t(o,c))};return t(n,l)},wt=n=>n.map((e,l)=>{let t=new Array(e.length).fill(-1/0);for(let o=0;o<=l&&o<e.length;o++)t[o]=e[o];return t});function jo(n){var Ht,jt;let e,l,t,o,r,s,c="QK<sup>T</sup>",i,a,u,h=((Ht=n[1][0])==null?void 0:Ht.toFixed(1))+"",p,b,N,H,z,F=((jt=n[1][1])==null?void 0:jt.toFixed(1))+"",V,R,ee,C,q,M,f,d,m,w,k,y,A,v="Scaling · Mask",E,$,D='<span class="val svelte-govu7o">-3.0</span> <div class="bar svelte-govu7o"></div> <span class="val svelte-govu7o">3.0</span>',L,S,O,X,he,J,se,_e,le,Xe,Q,te="Softmax · Dropout",Z,me,Pe='<span class="val svelte-govu7o">-1.0</span> <div class="bar svelte-govu7o"></div> <span class="val svelte-govu7o">1.0</span>',Y,ne,K,ye,tt,Se,ct="Attention",ft,Ze,ut,dt,Ve,Vt,Tt;return o=new Nt({props:{className:"main",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),m=new Nt({props:{className:"prev absolute top-0 left-0 pointer-events-none",data:n[2],showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[9]}}),k=new Nt({props:{className:"main opacity-0",data:wt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),se=new Nt({props:{className:"prev absolute top-0 left-0  pointer-events-none",data:wt(n[12]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[14]}}),le=new Nt({props:{className:"main opacity-0",data:wt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),ye=new Nt({props:{className:"main",data:wt(n[11]),showSize:!1,cellHeight:n[10],cellWidth:n[10],rowGap:3,colGap:3,shape:"circle",colorScale:n[15]}}),{c(){e=B("div"),l=B("div"),t=B("div"),ie(o.$$.fragment),r=U(),s=B("div"),s.innerHTML=c,i=U(),a=B("div"),u=B("span"),p=ue(h),b=U(),N=B("div"),H=U(),z=B("span"),V=ue(F),ee=U(),C=B("div"),q=De("svg"),M=De("path"),f=U(),d=B("div"),ie(m.$$.fragment),w=U(),ie(k.$$.fragment),y=U(),A=B("div"),A.textContent=v,E=U(),$=B("div"),$.innerHTML=D,L=U(),S=B("div"),O=De("svg"),X=De("path"),he=U(),J=B("div"),ie(se.$$.fragment),_e=U(),ie(le.$$.fragment),Xe=U(),Q=B("div"),Q.textContent=te,Z=U(),me=B("div"),me.innerHTML=Pe,ne=U(),K=B("div"),ie(ye.$$.fragment),tt=U(),Se=B("div"),Se.textContent=ct,this.h()},l(be){e=P(be,"DIV",{class:!0,style:!0});var Ie=T(e);l=P(Ie,"DIV",{role:!0,class:!0});var Re=T(l);t=P(Re,"DIV",{class:!0});var We=T(t);ae(o.$$.fragment,We),r=x(We),s=P(We,"DIV",{class:!0,"data-svelte-h":!0}),Ce(s)!=="svelte-1uhcjv4"&&(s.innerHTML=c),i=x(We),a=P(We,"DIV",{class:!0});var Ye=T(a);u=P(Ye,"SPAN",{class:!0});var ht=T(u);p=de(ht,h),ht.forEach(_),b=x(Ye),N=P(Ye,"DIV",{class:!0}),T(N).forEach(_),H=x(Ye),z=P(Ye,"SPAN",{class:!0});var Ue=T(z);V=de(Ue,F),Ue.forEach(_),Ye.forEach(_),We.forEach(_),ee=x(Re),C=P(Re,"DIV",{class:!0});var Me=T(C);q=qe(Me,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var Ot=T(q);M=qe(Ot,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(M).forEach(_),Ot.forEach(_),f=x(Me),d=P(Me,"DIV",{});var qt=T(d);ae(m.$$.fragment,qt),w=x(qt),ae(k.$$.fragment,qt),qt.forEach(_),y=x(Me),A=P(Me,"DIV",{class:!0,"data-svelte-h":!0}),Ce(A)!=="svelte-15vmxu9"&&(A.textContent=v),E=x(Me),$=P(Me,"DIV",{class:!0,"data-svelte-h":!0}),Ce($)!=="svelte-bz6asq"&&($.innerHTML=D),Me.forEach(_),L=x(Re),S=P(Re,"DIV",{class:!0});var $t=T(S);O=qe($t,"svg",{class:!0,"aria-hidden":!0,xmlns:!0,width:!0,height:!0,fill:!0,viewBox:!0});var ul=T(O);X=qe(ul,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),T(X).forEach(_),ul.forEach(_),he=x($t),J=P($t,"DIV",{});var Ut=T(J);ae(se.$$.fragment,Ut),_e=x(Ut),ae(le.$$.fragment,Ut),Ut.forEach(_),Xe=x($t),Q=P($t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(Q)!=="svelte-1fyrzav"&&(Q.textContent=te),Z=x($t),me=P($t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(me)!=="svelte-1lh8vbm"&&(me.innerHTML=Pe),$t.forEach(_),ne=x(Re),K=P(Re,"DIV",{class:!0});var xt=T(K);ae(ye.$$.fragment,xt),tt=x(xt),Se=P(xt,"DIV",{class:!0,"data-svelte-h":!0}),Ce(Se)!=="svelte-10aghm9"&&(Se.textContent=ct),xt.forEach(_),Re.forEach(_),Ie.forEach(_),this.h()},h(){g(s,"class","matrix-label svelte-govu7o"),g(u,"class","val svelte-govu7o"),g(N,"class","bar svelte-govu7o"),g(z,"class","val svelte-govu7o"),g(a,"class","color-scale svelte-govu7o"),g(t,"class",R=ve(pe("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":n[0]}))+" svelte-govu7o"),g(M,"stroke","currentColor"),g(M,"stroke-linecap","round"),g(M,"stroke-linejoin","round"),g(M,"stroke-width","2"),g(M,"d","M19 12H5m14 0-4 4m4-4-4-4"),g(q,"class","arrow svelte-govu7o"),g(q,"aria-hidden","true"),g(q,"xmlns","http://www.w3.org/2000/svg"),g(q,"width","24"),g(q,"height","24"),g(q,"fill","none"),g(q,"viewBox","0 0 24 24"),g(A,"class","matrix-label svelte-govu7o"),g($,"class","color-scale svelte-govu7o"),g(C,"class","attention-matrix attention-mask flex flex-col items-center svelte-govu7o"),g(X,"stroke","currentColor"),g(X,"stroke-linecap","round"),g(X,"stroke-linejoin","round"),g(X,"stroke-width","2"),g(X,"d","M19 12H5m14 0-4 4m4-4-4-4"),g(O,"class","arrow svelte-govu7o"),g(O,"aria-hidden","true"),g(O,"xmlns","http://www.w3.org/2000/svg"),g(O,"width","24"),g(O,"height","24"),g(O,"fill","none"),g(O,"viewBox","0 0 24 24"),g(Q,"class","matrix-label svelte-govu7o"),g(me,"class","color-scale svelte-govu7o"),g(S,"class",Y=ve(pe("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":n[0]}))+" svelte-govu7o"),g(Se,"class","matrix-label svelte-govu7o"),g(K,"class",ft=ve(pe("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!n[0],"attention-out":!n[0]}))+" svelte-govu7o"),Lt(()=>n[24].call(K)),g(l,"role","none"),g(l,"class",ut=ve(pe("attention-matrix-container relative flex",{active:n[0]}))+" svelte-govu7o"),g(e,"class","flex items-center gap-8 px-5"),g(e,"style",dt=`--attention-matrix-width: ${n[7]}px;`)},m(be,Ie){G(be,e,Ie),I(e,l),I(l,t),ce(o,t,null),I(t,r),I(t,s),I(t,i),I(t,a),I(a,u),I(u,p),I(a,b),I(a,N),I(a,H),I(a,z),I(z,V),n[20](t),I(l,ee),I(l,C),I(C,q),I(q,M),I(C,f),I(C,d),ce(m,d,null),I(d,w),ce(k,d,null),I(C,y),I(C,A),I(C,E),I(C,$),n[21](C),I(l,L),I(l,S),I(S,O),I(O,X),I(S,he),I(S,J),ce(se,J,null),I(J,_e),ce(le,J,null),I(S,Xe),I(S,Q),I(S,Z),I(S,me),n[22](S),I(l,ne),I(l,K),ce(ye,K,null),I(K,tt),I(K,Se),n[23](K),Ze=Tn(K,n[24].bind(K)),n[25](l),Ve=!0,Vt||(Tt=[ke(l,"click",n[13]),ke(l,"keydown",n[13])],Vt=!0)},p(be,Ie){var Ot,qt;const Re={};Ie[0]&4&&(Re.data=be[2]),Ie[0]&1024&&(Re.cellHeight=be[10]),Ie[0]&1024&&(Re.cellWidth=be[10]),Ie[0]&512&&(Re.colorScale=be[9]),o.$set(Re),(!Ve||Ie[0]&2)&&h!==(h=((Ot=be[1][0])==null?void 0:Ot.toFixed(1))+"")&&Ae(p,h),(!Ve||Ie[0]&2)&&F!==(F=((qt=be[1][1])==null?void 0:qt.toFixed(1))+"")&&Ae(V,F),(!Ve||Ie[0]&1&&R!==(R=ve(pe("attention-matrix attention-qk flex flex-col items-center",{"attention-initial":be[0]}))+" svelte-govu7o"))&&g(t,"class",R);const We={};Ie[0]&4&&(We.data=be[2]),Ie[0]&1024&&(We.cellHeight=be[10]),Ie[0]&1024&&(We.cellWidth=be[10]),Ie[0]&512&&(We.colorScale=be[9]),m.$set(We);const Ye={};Ie[0]&4096&&(Ye.data=wt(be[12])),Ie[0]&1024&&(Ye.cellHeight=be[10]),Ie[0]&1024&&(Ye.cellWidth=be[10]),k.$set(Ye);const ht={};Ie[0]&4096&&(ht.data=wt(be[12])),Ie[0]&1024&&(ht.cellHeight=be[10]),Ie[0]&1024&&(ht.cellWidth=be[10]),se.$set(ht);const Ue={};Ie[0]&2048&&(Ue.data=wt(be[11])),Ie[0]&1024&&(Ue.cellHeight=be[10]),Ie[0]&1024&&(Ue.cellWidth=be[10]),le.$set(Ue),(!Ve||Ie[0]&1&&Y!==(Y=ve(pe("attention-matrix attention-softmax flex flex-col items-center",{"attention-out":be[0]}))+" svelte-govu7o"))&&g(S,"class",Y);const Me={};Ie[0]&2048&&(Me.data=wt(be[11])),Ie[0]&1024&&(Me.cellHeight=be[10]),Ie[0]&1024&&(Me.cellWidth=be[10]),ye.$set(Me),(!Ve||Ie[0]&1&&ft!==(ft=ve(pe("attention-matrix attention-result flex flex-col items-center",{"attention-initial":!be[0],"attention-out":!be[0]}))+" svelte-govu7o"))&&g(K,"class",ft),(!Ve||Ie[0]&1&&ut!==(ut=ve(pe("attention-matrix-container relative flex",{active:be[0]}))+" svelte-govu7o"))&&g(l,"class",ut),(!Ve||Ie[0]&128&&dt!==(dt=`--attention-matrix-width: ${be[7]}px;`))&&g(e,"style",dt)},i(be){Ve||(j(o.$$.fragment,be),j(m.$$.fragment,be),j(k.$$.fragment,be),j(se.$$.fragment,be),j(le.$$.fragment,be),j(ye.$$.fragment,be),Ve=!0)},o(be){W(o.$$.fragment,be),W(m.$$.fragment,be),W(k.$$.fragment,be),W(se.$$.fragment,be),W(le.$$.fragment,be),W(ye.$$.fragment,be),Ve=!1},d(be){be&&_(e),fe(o),n[20](null),fe(m),fe(k),n[21](null),fe(se),fe(le),n[22](null),fe(ye),n[23](null),Ze(),n[25](null),Vt=!1,Fe(Tt)}}}let Oo=16,Go=20,zo=10;function Ro(n,e,l){let t,o,r,s,c,i,a,u,h,p;Ee(n,bt,S=>l(17,u=S)),Ee(n,xe,S=>l(18,h=S)),Ee(n,Pt,S=>l(19,p=S));const{theme:b}=It(Dt);let N,H,z,F,V=0,R=!1;const ee=Qt("block-id"),C=()=>{R||(xe.set({id:ee}),m())};let q;function M(S){R&&!q.contains(S.target)&&xe.set({id:null})}_t(()=>(document.body.addEventListener("click",M),()=>{document.body.removeEventListener("click",M)}));let f=at.timeline(),d=at.timeline();const m=()=>{l(0,R=!0),d.progress(1);const S=document.querySelectorAll("div.sankey g.attention path.key-to-attention"),O=document.querySelectorAll("div.sankey g.attention path.query-to-attention"),X=document.querySelectorAll("div.sankey g.attention path.to-attention-out");[...S,...O].forEach(se=>{const _e=se.getTotalLength();se.style.strokeDasharray=_e,se.style.strokeDashoffset=_e});const he=1.2,J=Number((he/u.length).toFixed(2));f.set([H.querySelector(".prev"),z.querySelector(".prev")],{opacity:1}).set([H.querySelector(".main"),z.querySelector(".main")],{opacity:0}),f.set(X,{opacity:0}),f.to(F,{opacity:0,display:"none",duration:.2}),f.set(N,{width:"auto",display:"flex",opacity:0}).to(N,{opacity:1,duration:.5}).to(S,{strokeDashoffset:0,stagger:J,duration:he,ease:"power2.out"}).to(O,{strokeDashoffset:0,stagger:J,duration:he,ease:"power2.out"},"<").from(N.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:he/u.length,stagger:Number((he/Math.pow(u.length,2)).toFixed(2)),ease:"power2.out",duration:he},"<"),f.set(H,{width:0,x:V*-1,opacity:0}).to(H,{opacity:1,display:"flex",width:V,x:0,duration:.5}).to(H.querySelector(".prev"),{opacity:0,duration:1}).to(H.querySelector(".main"),{opacity:1,duration:1},"<"),f.set(z,{width:0,x:V*-1,opacity:0}).to(z,{opacity:1,display:"flex",width:V,x:0,duration:.4}).to(z.querySelector(".prev"),{opacity:0,duration:1}).to(z.querySelector(".main"),{opacity:1,duration:1},"<"),f.to(X,{opacity:.4})},w=()=>{l(0,R=!1),f.progress(1),d.to([N,H,z],{opacity:0,display:"none",width:0,duration:.5}),d.to(F,{opacity:1,display:"flex",duration:.5},0)},k=(S,O)=>cl().domain([-3,3]).range(["white",b.colors.purple[700]])(S),y=(S,O)=>el("white",b.colors.purple[700])(S);function A(S){Je[S?"unshift":"push"](()=>{N=S,l(3,N)})}function v(S){Je[S?"unshift":"push"](()=>{H=S,l(4,H)})}function E(S){Je[S?"unshift":"push"](()=>{z=S,l(5,z)})}function $(S){Je[S?"unshift":"push"](()=>{F=S,l(6,F)})}function D(){V=this.offsetWidth,l(7,V)}function L(S){Je[S?"unshift":"push"](()=>{q=S,l(8,q)})}return n.$$.update=()=>{var S,O,X,he,J,se;n.$$.dirty[0]&131072&&l(16,t=Array(u.length).fill(0).map(_e=>Array(u.length).fill(-1/0))),n.$$.dirty[0]&589824&&l(2,o=((O=(S=p==null?void 0:p.outputs)==null?void 0:S.block_0_attn_head_0_attn)==null?void 0:O.data)||t),n.$$.dirty[0]&589824&&l(12,r=((he=(X=p==null?void 0:p.outputs)==null?void 0:X.block_0_attn_head_0_attn_masked)==null?void 0:he.data)||t),n.$$.dirty[0]&589824&&l(11,s=((se=(J=p==null?void 0:p.outputs)==null?void 0:J.block_0_attn_head_0_attn_dropout)==null?void 0:se.data)||t),n.$$.dirty[0]&131072&&l(10,c=Math.min(Go,Math.max(1/u.length*Oo*6,zo))),n.$$.dirty[0]&262145&&h.id!==ee&&R&&(l(0,R=!1),w()),n.$$.dirty[0]&4&&l(1,i=Eo(o.flat())),n.$$.dirty[0]&2&&l(9,a=(_e,le)=>cl().domain(i).range(["white",b.colors.purple[700]])(_e))},[R,i,o,N,H,z,F,V,q,a,c,s,r,C,k,y,t,u,h,p,A,v,E,$,D,L]}class Fo extends Oe{constructor(e){super(),Ge(this,e,Ro,jo,je,{},null,[-1,-1])}}function Uo(n){let e;return{c(){e=B("canvas"),this.h()},l(l){e=P(l,"CANVAS",{class:!0}),T(e).forEach(_),this.h()},h(){g(e,"class","svelte-ex5m8"),oe(e,"active",n[0])},m(l,t){G(l,e,t),n[4](e)},p(l,[t]){t&1&&oe(e,"active",l[0])},i:He,o:He,d(l){l&&_(e),n[4](null)}}}let xo=100;const ll=1;function Wo(n,e,l){const{theme:t}=It(Dt);let{active:o=!1}=e,{data:r=new Array(xo).fill(0).map(p=>Math.random())}=e,{colorScale:s=void 0}=e,c;const i=typeof s=="string"?s:"gray",a=typeof s=="function"?s:el(t.colors[i][100],t.colors[i][400]);function u(){const p=c.getContext("2d");if(!p)return;const b=c.parentElement.clientWidth,N=c.parentElement.clientHeight;p.clearRect(0,0,b,N);let H=4;l(1,c.width=b*H,c),l(1,c.height=N*H,c),l(1,c.style.width=`${b}px`,c),l(1,c.style.height=`${N}px`,c);for(let z=0;z<N/ll;z++){const F=r[z];p.fillStyle=a(F),p.fillRect(0,z*ll*H,b*H,ll*H)}}_t(()=>{const p=Kt.subscribe(u);return()=>{p()}});function h(p){Je[p?"unshift":"push"](()=>{c=p,l(1,c)})}return n.$$set=p=>{"active"in p&&l(0,o=p.active),"data"in p&&l(2,r=p.data),"colorScale"in p&&l(3,s=p.colorScale)},n.$$.update=()=>{n.$$.dirty&6&&r&&c&&u()},[o,c,r,s,h]}class vt extends Oe{constructor(e){super(),Ge(this,e,Wo,Uo,je,{active:0,data:2,colorScale:3})}}function kl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function yl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function El(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Il(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function Dl(n,e,l){const t=n.slice();return t[14]=e[l],t[16]=l,t}function ql(n){let e,l="Q";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-10ub4hf"&&(e.textContent=l)},m(t,o){G(t,e,o)},d(t){t&&_(e)}}}function Cl(n){let e,l="K";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-1c09r6x"&&(e.textContent=l)},m(t,o){G(t,e,o)},d(t){t&&_(e)}}}function Sl(n){let e,l="V";return{c(){e=B("span"),e.textContent=l},l(t){e=P(t,"SPAN",{"data-svelte-h":!0}),Ce(e)!=="svelte-j40kxg"&&(e.textContent=l)},m(t,o){G(t,e,o)},d(t){t&&_(e)}}}function Xo(n){let e,l=n[5].dimension*3+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension*3+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Vl(n){let e,l,t,o,r,s,c,i,a,u,h,p,b,N,H,z,F,V,R,ee,C,q,M,f,d,m;t=new vt({props:{colorScale:"blue",active:n[2]===n[16]}});let w=n[2]!==n[16]&&ql();u=new vt({props:{colorScale:"red",active:n[2]===n[16]}});let k=n[2]!==n[16]&&Cl();F=new vt({props:{colorScale:"green",active:n[2]===n[16]}});let y=n[2]!==n[16]&&Sl();function A(){return n[11](n[16])}return M=new et({props:{placement:"right",class:"popover",$$slots:{default:[Xo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),ie(t.$$.fragment),o=U(),r=B("div"),s=U(),c=B("div"),w&&w.c(),i=U(),a=B("div"),ie(u.$$.fragment),h=U(),p=B("div"),b=U(),N=B("div"),k&&k.c(),H=U(),z=B("div"),ie(F.$$.fragment),V=U(),R=B("div"),ee=U(),C=B("div"),y&&y.c(),q=U(),ie(M.$$.fragment),this.h()},l(v){e=P(v,"DIV",{class:!0,role:!0});var E=T(e);l=P(E,"DIV",{class:!0});var $=T(l);ae(t.$$.fragment,$),o=x($),r=P($,"DIV",{class:!0}),T(r).forEach(_),s=x($),c=P($,"DIV",{class:!0});var D=T(c);w&&w.l(D),D.forEach(_),$.forEach(_),i=x(E),a=P(E,"DIV",{class:!0});var L=T(a);ae(u.$$.fragment,L),h=x(L),p=P(L,"DIV",{class:!0}),T(p).forEach(_),b=x(L),N=P(L,"DIV",{class:!0});var S=T(N);k&&k.l(S),S.forEach(_),L.forEach(_),H=x(E),z=P(E,"DIV",{class:!0});var O=T(z);ae(F.$$.fragment,O),V=x(O),R=P(O,"DIV",{class:!0}),T(R).forEach(_),ee=x(O),C=P(O,"DIV",{class:!0});var X=T(C);y&&y.l(X),X.forEach(_),O.forEach(_),E.forEach(_),q=x(v),ae(M.$$.fragment,v),this.h()},h(){g(r,"class",ve(`sub-vector x1-12 head1 ${Un}`)+" svelte-1hsibq9"),g(c,"class","sub-vector head-rest grow svelte-1hsibq9"),g(l,"class",ve(`sub-vector query relative flex grow flex-col ${tr}`)+" svelte-1hsibq9"),g(p,"class",ve(`sub-vector x1-12 head1 ${xn}`)+" svelte-1hsibq9"),g(N,"class","sub-vector head-rest grow svelte-1hsibq9"),g(a,"class",ve(`sub-vector key relative flex grow flex-col ${lr}`)+" svelte-1hsibq9"),g(R,"class",ve(`sub-vector x1-12 head1 ${Wn}`)+" svelte-1hsibq9"),g(C,"class","sub-vector head-rest grow svelte-1hsibq9"),g(z,"class",ve(`sub-vector value relative flex grow flex-col ${nr}`)+" svelte-1hsibq9"),g(e,"class","qkv-weighted vector x3 flex flex-col"),g(e,"role","group"),oe(e,"last",n[16]===n[6].length-1)},m(v,E){G(v,e,E),I(e,l),ce(t,l,null),I(l,o),I(l,r),I(l,s),I(l,c),w&&w.m(c,null),I(e,i),I(e,a),ce(u,a,null),I(a,h),I(a,p),I(a,b),I(a,N),k&&k.m(N,null),I(e,H),I(e,z),ce(F,z,null),I(z,V),I(z,R),I(z,ee),I(z,C),y&&y.m(C,null),G(v,q,E),ce(M,v,E),f=!0,d||(m=[ke(e,"mouseenter",A),ke(e,"mouseleave",n[12])],d=!0)},p(v,E){n=v;const $={};E&4&&($.active=n[2]===n[16]),t.$set($),n[2]!==n[16]?w||(w=ql(),w.c(),w.m(c,null)):w&&(w.d(1),w=null);const D={};E&4&&(D.active=n[2]===n[16]),u.$set(D),n[2]!==n[16]?k||(k=Cl(),k.c(),k.m(N,null)):k&&(k.d(1),k=null);const L={};E&4&&(L.active=n[2]===n[16]),F.$set(L),n[2]!==n[16]?y||(y=Sl(),y.c(),y.m(C,null)):y&&(y.d(1),y=null),(!f||E&64)&&oe(e,"last",n[16]===n[6].length-1);const S={};E&2097184&&(S.$$scope={dirty:E,ctx:n}),M.$set(S)},i(v){f||(j(t.$$.fragment,v),j(u.$$.fragment,v),j(F.$$.fragment,v),j(M.$$.fragment,v),f=!0)},o(v){W(t.$$.fragment,v),W(u.$$.fragment,v),W(F.$$.fragment,v),W(M.$$.fragment,v),f=!1},d(v){v&&(_(e),_(q)),fe(t),w&&w.d(),fe(u),k&&k.d(),fe(F),y&&y.d(),fe(M,v),d=!1,Fe(m)}}}function Zo(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,o;return{c(){e=ue("Query, Head 1, vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"Query, Head 1, vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension/r[5].attention_head_num+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Al(n){let e,l,t=n[14]+"",o,r,s,c,i,a;return i=new et({props:{placement:"right",class:"popover",$$slots:{default:[Zo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),o=ue(t),r=U(),s=B("div"),c=U(),ie(i.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0});var h=T(e);l=P(h,"SPAN",{class:!0});var p=T(l);o=de(p,t),p.forEach(_),r=x(h),s=P(h,"DIV",{class:!0}),T(s).forEach(_),h.forEach(_),c=x(u),ae(i.$$.fragment,u),this.h()},h(){g(l,"class","label float svelte-1hsibq9"),g(s,"class",ve(`vector x1-12  ${Un}`)+" svelte-1hsibq9"),g(e,"class","head1 cell x1-12 text-xs"),oe(e,"last",n[16]===n[6].length-1)},m(u,h){G(u,e,h),I(e,l),I(l,o),I(e,r),I(e,s),G(u,c,h),ce(i,u,h),a=!0},p(u,h){(!a||h&64)&&t!==(t=u[14]+"")&&Ae(o,t),(!a||h&64)&&oe(e,"last",u[16]===u[6].length-1);const p={};h&2097184&&(p.$$scope={dirty:h,ctx:u}),i.$set(p)},i(u){a||(j(i.$$.fragment,u),a=!0)},o(u){W(i.$$.fragment,u),a=!1},d(u){u&&(_(e),_(c)),fe(i,u)}}}function Yo(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,o;return{c(){e=ue("Key, Head 1, vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"Key, Head 1, vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension/r[5].attention_head_num+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Nl(n){let e,l,t=n[14]+"",o,r,s,c,i,a,u;return a=new et({props:{placement:"right",class:"popover",$$slots:{default:[Yo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),o=ue(t),r=U(),s=B("div"),i=U(),ie(a.$$.fragment),this.h()},l(h){e=P(h,"DIV",{class:!0});var p=T(e);l=P(p,"SPAN",{class:!0});var b=T(l);o=de(b,t),b.forEach(_),r=x(p),s=P(p,"DIV",{class:!0}),T(s).forEach(_),p.forEach(_),i=x(h),ae(a.$$.fragment,h),this.h()},h(){g(l,"class","label float svelte-1hsibq9"),g(s,"class",ve(`vector x1-12 ${xn}`)+" svelte-1hsibq9"),g(e,"class",c="head1 cell x1-12 text-xs class:last="+(n[16]===n[6].length-1)+" svelte-1hsibq9")},m(h,p){G(h,e,p),I(e,l),I(l,o),I(e,r),I(e,s),G(h,i,p),ce(a,h,p),u=!0},p(h,p){(!u||p&64)&&t!==(t=h[14]+"")&&Ae(o,t),(!u||p&64&&c!==(c="head1 cell x1-12 text-xs class:last="+(h[16]===h[6].length-1)+" svelte-1hsibq9"))&&g(e,"class",c);const b={};p&2097184&&(b.$$scope={dirty:p,ctx:h}),a.$set(b)},i(h){u||(j(a.$$.fragment,h),u=!0)},o(h){W(a.$$.fragment,h),u=!1},d(h){h&&(_(e),_(i)),fe(a,h)}}}function Ko(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,o;return{c(){e=ue("Value, Head 1, vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"Value, Head 1, vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension/r[5].attention_head_num+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Ll(n){let e,l,t=n[14]+"",o,r,s,c,i,a;return i=new et({props:{placement:"right",class:"popover",$$slots:{default:[Ko]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),o=ue(t),r=U(),s=B("div"),c=U(),ie(i.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0});var h=T(e);l=P(h,"SPAN",{class:!0});var p=T(l);o=de(p,t),p.forEach(_),r=x(h),s=P(h,"DIV",{class:!0}),T(s).forEach(_),h.forEach(_),c=x(u),ae(i.$$.fragment,u),this.h()},h(){g(l,"class","label float svelte-1hsibq9"),g(s,"class",ve(`vector x1-12 ${Wn}`)+" svelte-1hsibq9"),g(e,"class","head1 cell x1-12 text-xs"),oe(e,"last",n[16]===n[6].length-1)},m(u,h){G(u,e,h),I(e,l),I(l,o),I(e,r),I(e,s),G(u,c,h),ce(i,u,h),a=!0},p(u,h){(!a||h&64)&&t!==(t=u[14]+"")&&Ae(o,t),(!a||h&64)&&oe(e,"last",u[16]===u[6].length-1);const p={};h&2097184&&(p.$$scope={dirty:h,ctx:u}),i.$set(p)},i(u){a||(j(i.$$.fragment,u),a=!0)},o(u){W(i.$$.fragment,u),a=!1},d(u){u&&(_(e),_(c)),fe(i,u)}}}function Qo(n){let e,l=n[5].dimension/n[5].attention_head_num+"",t,o;return{c(){e=ue("Attention Out, Head 1, vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"Attention Out, Head 1, vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension/r[5].attention_head_num+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Ml(n){let e,l,t,o,r;return o=new et({props:{placement:"right",class:"popover",$$slots:{default:[Qo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),t=U(),ie(o.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var c=T(e);l=P(c,"DIV",{class:!0}),T(l).forEach(_),c.forEach(_),t=x(s),ae(o.$$.fragment,s),this.h()},h(){g(l,"class",ve(`vector x1-12 ${or}`)+" svelte-1hsibq9"),g(e,"class","head1 cell x1-12"),oe(e,"last",n[16]===n[6].length-1)},m(s,c){G(s,e,c),I(e,l),G(s,t,c),ce(o,s,c),r=!0},p(s,c){(!r||c&64)&&oe(e,"last",s[16]===s[6].length-1);const i={};c&2097184&&(i.$$scope={dirty:c,ctx:s}),o.$set(i)},i(s){r||(j(o.$$.fragment,s),r=!0)},o(s){W(o.$$.fragment,s),r=!1},d(s){s&&(_(e),_(t)),fe(o,s)}}}function Jo(n){let e,l,t,o,r="Query",s,c,i,a,u="Key",h,p,b,N,H="Value",z,F,V,R,ee,C,q,M,f="Out",d,m,w,k,y=n[5].attention_head_num+"",A,v,E,$=$e(n[6]),D=[];for(let Q=0;Q<$.length;Q+=1)D[Q]=Al(Il(n,$,Q));const L=Q=>W(D[Q],1,1,()=>{D[Q]=null});let S=$e(n[6]),O=[];for(let Q=0;Q<S.length;Q+=1)O[Q]=Nl(El(n,S,Q));const X=Q=>W(O[Q],1,1,()=>{O[Q]=null});let he=$e(n[6]),J=[];for(let Q=0;Q<he.length;Q+=1)J[Q]=Ll(yl(n,he,Q));const se=Q=>W(J[Q],1,1,()=>{J[Q]=null});R=new Fo({});let _e=$e(n[6]),le=[];for(let Q=0;Q<_e.length;Q+=1)le[Q]=Ml(kl(n,_e,Q));const Xe=Q=>W(le[Q],1,1,()=>{le[Q]=null});return{c(){e=B("div"),l=B("div"),t=B("div"),o=B("div"),o.textContent=r,s=U();for(let Q=0;Q<D.length;Q+=1)D[Q].c();c=U(),i=B("div"),a=B("div"),a.textContent=u,h=U();for(let Q=0;Q<O.length;Q+=1)O[Q].c();p=U(),b=B("div"),N=B("div"),N.textContent=H,z=U();for(let Q=0;Q<J.length;Q+=1)J[Q].c();F=U(),V=B("div"),ie(R.$$.fragment),ee=U(),C=B("div"),q=B("div"),M=B("div"),M.textContent=f,d=U();for(let Q=0;Q<le.length;Q+=1)le[Q].c();m=U(),w=B("div"),k=ue("Head 1 of "),A=ue(y),this.h()},l(Q){e=P(Q,"DIV",{class:!0,style:!0});var te=T(e);l=P(te,"DIV",{class:!0});var Z=T(l);t=P(Z,"DIV",{class:!0});var me=T(t);o=P(me,"DIV",{class:!0,"data-svelte-h":!0}),Ce(o)!=="svelte-1a2739d"&&(o.textContent=r),s=x(me);for(let Se=0;Se<D.length;Se+=1)D[Se].l(me);me.forEach(_),c=x(Z),i=P(Z,"DIV",{class:!0});var Pe=T(i);a=P(Pe,"DIV",{class:!0,"data-svelte-h":!0}),Ce(a)!=="svelte-bmmhtu"&&(a.textContent=u),h=x(Pe);for(let Se=0;Se<O.length;Se+=1)O[Se].l(Pe);Pe.forEach(_),p=x(Z),b=P(Z,"DIV",{class:!0});var Y=T(b);N=P(Y,"DIV",{class:!0,"data-svelte-h":!0}),Ce(N)!=="svelte-17pe084"&&(N.textContent=H),z=x(Y);for(let Se=0;Se<J.length;Se+=1)J[Se].l(Y);Y.forEach(_),Z.forEach(_),F=x(te),V=P(te,"DIV",{class:!0});var ne=T(V);ae(R.$$.fragment,ne),ne.forEach(_),ee=x(te),C=P(te,"DIV",{class:!0});var K=T(C);q=P(K,"DIV",{class:!0});var ye=T(q);M=P(ye,"DIV",{class:!0,"data-svelte-h":!0}),Ce(M)!=="svelte-68unf9"&&(M.textContent=f),d=x(ye);for(let Se=0;Se<le.length;Se+=1)le[Se].l(ye);ye.forEach(_),K.forEach(_),m=x(te),w=P(te,"DIV",{class:!0});var tt=T(w);k=de(tt,"Head 1 of "),A=de(tt,y),tt.forEach(_),te.forEach(_),this.h()},h(){g(o,"class","title svelte-1hsibq9"),g(t,"class","column query"),g(a,"class","title svelte-1hsibq9"),g(i,"class","column key"),g(N,"class","title svelte-1hsibq9"),g(b,"class","column value"),g(l,"class","qkv flex h-full flex-col justify-center gap-[5rem] pl-[6rem]"),g(V,"class","resize-watch attention-matrix flex"),g(M,"class","title svelte-1hsibq9"),g(q,"class","column out"),g(C,"class","head-out mx-[2rem]"),g(w,"class","head-title absolute bottom-2 right-3 text-right text-gray-400"),g(e,"class","head-block flex w-full items-center justify-between px-2"),g(e,"style",v=`height:${n[7]}px;`)},m(Q,te){G(Q,e,te),I(e,l),I(l,t),I(t,o),I(t,s);for(let Z=0;Z<D.length;Z+=1)D[Z]&&D[Z].m(t,null);I(l,c),I(l,i),I(i,a),I(i,h);for(let Z=0;Z<O.length;Z+=1)O[Z]&&O[Z].m(i,null);I(l,p),I(l,b),I(b,N),I(b,z);for(let Z=0;Z<J.length;Z+=1)J[Z]&&J[Z].m(b,null);I(e,F),I(e,V),ce(R,V,null),I(e,ee),I(e,C),I(C,q),I(q,M),I(q,d);for(let Z=0;Z<le.length;Z+=1)le[Z]&&le[Z].m(q,null);I(e,m),I(e,w),I(w,k),I(w,A),E=!0},p(Q,te){if(te&96){$=$e(Q[6]);let Z;for(Z=0;Z<$.length;Z+=1){const me=Il(Q,$,Z);D[Z]?(D[Z].p(me,te),j(D[Z],1)):(D[Z]=Al(me),D[Z].c(),j(D[Z],1),D[Z].m(t,null))}for(Ne(),Z=$.length;Z<D.length;Z+=1)L(Z);Le()}if(te&96){S=$e(Q[6]);let Z;for(Z=0;Z<S.length;Z+=1){const me=El(Q,S,Z);O[Z]?(O[Z].p(me,te),j(O[Z],1)):(O[Z]=Nl(me),O[Z].c(),j(O[Z],1),O[Z].m(i,null))}for(Ne(),Z=S.length;Z<O.length;Z+=1)X(Z);Le()}if(te&96){he=$e(Q[6]);let Z;for(Z=0;Z<he.length;Z+=1){const me=yl(Q,he,Z);J[Z]?(J[Z].p(me,te),j(J[Z],1)):(J[Z]=Ll(me),J[Z].c(),j(J[Z],1),J[Z].m(b,null))}for(Ne(),Z=he.length;Z<J.length;Z+=1)se(Z);Le()}if(te&96){_e=$e(Q[6]);let Z;for(Z=0;Z<_e.length;Z+=1){const me=kl(Q,_e,Z);le[Z]?(le[Z].p(me,te),j(le[Z],1)):(le[Z]=Ml(me),le[Z].c(),j(le[Z],1),le[Z].m(q,null))}for(Ne(),Z=_e.length;Z<le.length;Z+=1)Xe(Z);Le()}(!E||te&32)&&y!==(y=Q[5].attention_head_num+"")&&Ae(A,y),(!E||te&128&&v!==(v=`height:${Q[7]}px;`))&&g(e,"style",v)},i(Q){if(!E){for(let te=0;te<$.length;te+=1)j(D[te]);for(let te=0;te<S.length;te+=1)j(O[te]);for(let te=0;te<he.length;te+=1)j(J[te]);j(R.$$.fragment,Q);for(let te=0;te<_e.length;te+=1)j(le[te]);E=!0}},o(Q){D=D.filter(Boolean);for(let te=0;te<D.length;te+=1)W(D[te]);O=O.filter(Boolean);for(let te=0;te<O.length;te+=1)W(O[te]);J=J.filter(Boolean);for(let te=0;te<J.length;te+=1)W(J[te]);W(R.$$.fragment,Q),le=le.filter(Boolean);for(let te=0;te<le.length;te+=1)W(le[te]);E=!1},d(Q){Q&&_(e),Be(D,Q),Be(O,Q),Be(J,Q),fe(R),Be(le,Q)}}}function er(n){let e,l,t="<div>Multi-head Self Attention</div>",o,r,s,c='<div class="bounding-title svelte-1hsibq9">Transformer Block 1</div>',i,a,u,h,p,b,N,H,z,F,V,R,ee=$e(n[6]),C=[];for(let M=0;M<ee.length;M+=1)C[M]=Vl(Dl(n,ee,M));const q=M=>W(C[M],1,1,()=>{C[M]=null});return H=new To({props:{$$slots:{default:[Jo]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,o=U(),r=B("div"),s=B("div"),s.innerHTML=c,i=U(),a=B("div"),h=U(),p=B("div");for(let M=0;M<C.length;M+=1)C[M].c();b=U(),N=B("div"),ie(H.$$.fragment),this.h()},l(M){e=P(M,"DIV",{class:!0});var f=T(e);l=P(f,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-n6swon"&&(l.innerHTML=t),o=x(f),r=P(f,"DIV",{class:!0});var d=T(r);s=P(d,"DIV",{class:!0,"data-svelte-h":!0}),Ce(s)!=="svelte-vte4ua"&&(s.innerHTML=c),i=x(d),a=P(d,"DIV",{class:!0,style:!0}),T(a).forEach(_),h=x(d),p=P(d,"DIV",{class:!0});var m=T(p);for(let k=0;k<C.length;k+=1)C[k].l(m);m.forEach(_),b=x(d),N=P(d,"DIV",{class:!0});var w=T(N);ae(H.$$.fragment,w),w.forEach(_),d.forEach(_),f.forEach(_),this.h()},h(){g(l,"class","title svelte-1hsibq9"),g(l,"role","group"),g(s,"class","bounding transformer-bounding svelte-1hsibq9"),oe(s,"active",n[4]),g(a,"class","bounding attention-bounding svelte-1hsibq9"),g(a,"style",u=`padding-bottom:${n[5].attention_head_num*yt.y}px`),oe(a,"active",n[1]&&!n[3]),g(p,"class","column"),g(N,"class","heads svelte-1hsibq9"),g(r,"class","content relative svelte-1hsibq9"),g(e,"class",z=ve(pe("attention",n[0],{expanded:n[3]}))+" svelte-1hsibq9")},m(M,f){G(M,e,f),I(e,l),I(e,o),I(e,r),I(r,s),I(r,i),I(r,a),I(r,h),I(r,p);for(let d=0;d<C.length;d+=1)C[d]&&C[d].m(p,null);I(r,b),I(r,N),ce(H,N,null),F=!0,V||(R=[ke(l,"mouseenter",n[8]),ke(l,"mouseleave",n[9])],V=!0)},p(M,[f]){if((!F||f&16)&&oe(s,"active",M[4]),(!F||f&32&&u!==(u=`padding-bottom:${M[5].attention_head_num*yt.y}px`))&&g(a,"style",u),(!F||f&10)&&oe(a,"active",M[1]&&!M[3]),f&100){ee=$e(M[6]);let m;for(m=0;m<ee.length;m+=1){const w=Dl(M,ee,m);C[m]?(C[m].p(w,f),j(C[m],1)):(C[m]=Vl(w),C[m].c(),j(C[m],1),C[m].m(p,null))}for(Ne(),m=ee.length;m<C.length;m+=1)q(m);Le()}const d={};f&2097376&&(d.$$scope={dirty:f,ctx:M}),H.$set(d),(!F||f&9&&z!==(z=ve(pe("attention",M[0],{expanded:M[3]}))+" svelte-1hsibq9"))&&g(e,"class",z)},i(M){if(!F){for(let f=0;f<ee.length;f+=1)j(C[f]);j(H.$$.fragment,M),F=!0}},o(M){C=C.filter(Boolean);for(let f=0;f<C.length;f+=1)W(C[f]);W(H.$$.fragment,M),F=!1},d(M){M&&_(e),Be(C,M),fe(H),V=!1,Fe(R)}}}const tr="bg-blue-200",lr="bg-red-200",nr="bg-green-200",Un="bg-blue-300",xn="bg-red-300",Wn="bg-green-300",or="bg-purple-300";function rr(n,e,l){let t,o,r,s,c,i;Ee(n,xe,F=>l(10,o=F)),Ee(n,Gt,F=>l(4,r=F)),Ee(n,Bt,F=>l(5,s=F)),Ee(n,bt,F=>l(6,c=F)),Ee(n,Hn,F=>l(7,i=F));let{className:a=void 0}=e;Jt("block-id","attention");const u=Qt("block-id");let h=!1;function p(){l(1,h=!0)}function b(){l(1,h=!1)}let N=null;const H=F=>{l(2,N=F)},z=()=>{l(2,N=null)};return n.$$set=F=>{"className"in F&&l(0,a=F.className)},n.$$.update=()=>{n.$$.dirty&1024&&l(3,t=o.id===u)},[a,h,N,t,r,s,c,i,p,b,o,H,z]}class sr extends Oe{constructor(e){super(),Ge(this,e,rr,er,je,{className:0})}}function ir(n){let e,l,t,o,r,s,c,i=n[3]&&Bl(n);return{c(){e=B("div"),l=B("div"),t=U(),o=De("svg"),i&&i.c(),r=De("path"),this.h()},l(a){e=P(a,"DIV",{class:!0});var u=T(e);l=P(u,"DIV",{class:!0}),T(l).forEach(_),t=x(u),o=qe(u,"svg",{class:!0});var h=T(o);i&&i.l(h),r=qe(h,"path",{d:!0,class:!0}),T(r).forEach(_),h.forEach(_),u.forEach(_),this.h()},h(){g(l,"class","cursor svelte-1jqlo12"),g(r,"d",s=`M0,0 L0,${n[6]}`),g(r,"class","svelte-1jqlo12"),g(o,"class","main svelte-1jqlo12"),g(e,"class",c=ve(pe("residual residual-end cell",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(a,u){G(a,e,u),I(e,l),I(e,t),I(e,o),i&&i.m(o,null),I(o,r)},p(a,u){a[3]?i?i.p(a,u):(i=Bl(a),i.c(),i.m(o,r)):i&&(i.d(1),i=null),u&64&&s!==(s=`M0,0 L0,${a[6]}`)&&g(r,"d",s),u&2&&c!==(c=ve(pe("residual residual-end cell",a[1]))+" svelte-1jqlo12")&&g(e,"class",c),u&34&&oe(e,"active",a[5])},d(a){a&&_(e),i&&i.d()}}}function ar(n){let e,l,t,o,r,s,c,i=n[3]&&Pl(n);return{c(){e=B("div"),l=B("div"),t=U(),o=De("svg"),i&&i.c(),r=De("path"),this.h()},l(a){e=P(a,"DIV",{class:!0});var u=T(e);l=P(u,"DIV",{class:!0}),T(l).forEach(_),t=x(u),o=qe(u,"svg",{class:!0});var h=T(o);i&&i.l(h),r=qe(h,"path",{d:!0,class:!0}),T(r).forEach(_),h.forEach(_),u.forEach(_),this.h()},h(){g(l,"class","cursor svelte-1jqlo12"),g(r,"d",s=`M0,0 L0,${n[6]}`),g(r,"class","svelte-1jqlo12"),g(o,"class","main svelte-1jqlo12"),g(e,"class",c=ve(pe("residual residual-start cell",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(a,u){G(a,e,u),I(e,l),I(e,t),I(e,o),i&&i.m(o,null),I(o,r)},p(a,u){a[3]?i?i.p(a,u):(i=Pl(a),i.c(),i.m(o,r)):i&&(i.d(1),i=null),u&64&&s!==(s=`M0,0 L0,${a[6]}`)&&g(r,"d",s),u&2&&c!==(c=ve(pe("residual residual-start cell",a[1]))+" svelte-1jqlo12")&&g(e,"class",c),u&34&&oe(e,"active",a[5])},d(a){a&&_(e),i&&i.d()}}}function cr(n){let e,l,t,o,r,s,c,i,a,u=n[4]&&Tl();return{c(){e=B("div"),l=B("div"),t=U(),o=De("svg"),r=De("circle"),s=De("path"),i=U(),u&&u.c(),this.h()},l(h){e=P(h,"DIV",{class:!0});var p=T(e);l=P(p,"DIV",{class:!0}),T(l).forEach(_),t=x(p),o=qe(p,"svg",{class:!0});var b=T(o);r=qe(b,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(r).forEach(_),s=qe(b,"path",{class:!0,d:!0}),T(s).forEach(_),b.forEach(_),i=x(p),u&&u.l(p),p.forEach(_),this.h()},h(){g(l,"class","cursor svelte-1jqlo12"),g(r,"class","icon svelte-1jqlo12"),g(r,"cx","50%"),g(r,"cy","50%"),g(r,"r","3"),g(s,"class","line svelte-1jqlo12"),g(s,"d",c=`
     M 0 0
    C 0 ${n[6]*.25}, ${n[6]*.2} ${n[6]*.25}, ${n[6]*.2} ${n[6]*.5}
    C ${n[6]*.2} ${n[6]*.75}, 0 ${n[6]*.75}, 0 ${n[6]}
  `),g(o,"class","main svelte-1jqlo12"),g(e,"class",a=ve(pe("cell ln",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(h,p){G(h,e,p),I(e,l),I(e,t),I(e,o),I(o,r),I(o,s),I(e,i),u&&u.m(e,null)},p(h,p){p&64&&c!==(c=`
     M 0 0
    C 0 ${h[6]*.25}, ${h[6]*.2} ${h[6]*.25}, ${h[6]*.2} ${h[6]*.5}
    C ${h[6]*.2} ${h[6]*.75}, 0 ${h[6]*.75}, 0 ${h[6]}
  `)&&g(s,"d",c),h[4]?u||(u=Tl(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),p&2&&a!==(a=ve(pe("cell ln",h[1]))+" svelte-1jqlo12")&&g(e,"class",a),p&34&&oe(e,"active",h[5])},d(h){h&&_(e),u&&u.d()}}}function fr(n){let e,l,t,o,r,s,c,i,a,u=n[4]&&Hl();return{c(){e=B("div"),l=B("div"),t=U(),o=De("svg"),r=De("path"),c=De("circle"),i=U(),u&&u.c(),this.h()},l(h){e=P(h,"DIV",{class:!0});var p=T(e);l=P(p,"DIV",{class:!0}),T(l).forEach(_),t=x(p),o=qe(p,"svg",{class:!0});var b=T(o);r=qe(b,"path",{class:!0,d:!0}),T(r).forEach(_),c=qe(b,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(c).forEach(_),b.forEach(_),i=x(p),u&&u.l(p),p.forEach(_),this.h()},h(){g(l,"class","cursor svelte-1jqlo12"),g(r,"class","line svelte-1jqlo12"),g(r,"d",s=`M0,0 L0,${n[6]}`),g(c,"class","icon svelte-1jqlo12"),g(c,"cx","50%"),g(c,"cy","50%"),g(c,"r","3"),g(o,"class","main svelte-1jqlo12"),g(e,"class",a=ve(pe("cell dropout",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(h,p){G(h,e,p),I(e,l),I(e,t),I(e,o),I(o,r),I(o,c),I(e,i),u&&u.m(e,null)},p(h,p){p&64&&s!==(s=`M0,0 L0,${h[6]}`)&&g(r,"d",s),h[4]?u||(u=Hl(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),p&2&&a!==(a=ve(pe("cell dropout",h[1]))+" svelte-1jqlo12")&&g(e,"class",a),p&34&&oe(e,"active",h[5])},d(h){h&&_(e),u&&u.d()}}}function ur(n){let e,l,t,o,r,s,c;return{c(){e=B("div"),l=B("div"),t=U(),o=De("svg"),r=De("path"),s=De("circle"),this.h()},l(i){e=P(i,"DIV",{class:!0});var a=T(e);l=P(a,"DIV",{class:!0}),T(l).forEach(_),t=x(a),o=qe(a,"svg",{class:!0});var u=T(o);r=qe(u,"path",{class:!0,d:!0}),T(r).forEach(_),s=qe(u,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(s).forEach(_),u.forEach(_),a.forEach(_),this.h()},h(){g(l,"class","cursor svelte-1jqlo12"),g(r,"class","line line1 svelte-1jqlo12"),g(r,"d","M0,0 L0,90%"),g(s,"class","icon svelte-1jqlo12"),g(s,"cx","50%"),g(s,"cy","50%"),g(s,"r","3"),g(o,"class","main svelte-1jqlo12"),g(e,"class",c=ve(pe("cell activation",n[1]))+" svelte-1jqlo12"),oe(e,"active",n[5])},m(i,a){G(i,e,a),I(e,l),I(e,t),I(e,o),I(o,r),I(o,s)},p(i,a){a&2&&c!==(c=ve(pe("cell activation",i[1]))+" svelte-1jqlo12")&&g(e,"class",c),a&34&&oe(e,"active",i[5])},d(i){i&&_(e)}}}function Bl(n){let e;return{c(){e=De("path"),this.h()},l(l){e=qe(l,"path",{id:!0,class:!0,d:!0}),T(e).forEach(_),this.h()},h(){g(e,"id",n[0]),g(e,"class","head svelte-1jqlo12"),g(e,"d","M0,0 Q0,-16 -30,-16")},m(l,t){G(l,e,t)},p(l,t){t&1&&g(e,"id",l[0])},d(l){l&&_(e)}}}function Pl(n){let e,l,t;return{c(){e=De("path"),l=De("text"),t=ue("Residual"),this.h()},l(o){e=qe(o,"path",{id:!0,class:!0,d:!0}),T(e).forEach(_),l=qe(o,"text",{x:!0,y:!0,dy:!0,dx:!0,class:!0});var r=T(l);t=de(r,"Residual"),r.forEach(_),this.h()},h(){g(e,"id",n[0]),g(e,"class","head svelte-1jqlo12"),g(e,"d","M0,0 Q0,-16 30,-16"),g(l,"x","30"),g(l,"y","-26"),g(l,"dy","4"),g(l,"dx","4"),g(l,"class","svelte-1jqlo12")},m(o,r){G(o,e,r),G(o,l,r),I(l,t)},p(o,r){r&1&&g(e,"id",o[0])},d(o){o&&(_(e),_(l))}}}function Tl(n){let e,l,t,o;return{c(){e=De("svg"),l=De("path"),t=De("text"),o=ue("Layer Normalization"),this.h()},l(r){e=qe(r,"svg",{class:!0,width:!0});var s=T(e);l=qe(s,"path",{d:!0,class:!0}),T(l).forEach(_),t=qe(s,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=T(t);o=de(c,"Layer Normalization"),c.forEach(_),s.forEach(_),this.h()},h(){g(l,"d","M27.3536 4.35355C27.5488 4.15829 27.5488 3.84171 27.3536 3.64645L24.1716 0.46447C23.9763 0.269208 23.6597 0.269208 23.4645 0.464471C23.2692 0.659733 23.2692 0.976316 23.4645 1.17158L26.2929 4L23.4645 6.82843C23.2692 7.02369 23.2692 7.34028 23.4645 7.53554C23.6597 7.7308 23.9763 7.7308 24.1716 7.53554L27.3536 4.35355ZM27 3.5C20.3125 3.50001 15.2969 6.63952 11.5638 11.7944C7.84616 16.9278 5.39057 24.0677 3.75991 32.1346C0.498061 48.2711 0.5 68.3247 0.5 84H1.5C1.5 68.2984 1.50194 48.352 4.74009 32.3328C6.35943 24.3218 8.77884 17.3448 12.3737 12.3809C15.9531 7.4384 20.6875 4.50001 27 4.5V3.5Z"),g(l,"class","svelte-1jqlo12"),g(t,"x","4"),g(t,"y","95"),g(t,"text-anchor","middle"),g(t,"class","svelte-1jqlo12"),g(e,"class","guide svelte-1jqlo12"),g(e,"width","27px"),oe(e,"active",!1)},m(r,s){G(r,e,s),I(e,l),I(e,t),I(t,o)},d(r){r&&_(e)}}}function Hl(n){let e,l,t,o;return{c(){e=De("svg"),l=De("path"),t=De("text"),o=ue("Dropout"),this.h()},l(r){e=qe(r,"svg",{class:!0,width:!0});var s=T(e);l=qe(s,"path",{d:!0,class:!0}),T(l).forEach(_),t=qe(s,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var c=T(t);o=de(c,"Dropout"),c.forEach(_),s.forEach(_),this.h()},h(){g(l,"d","M44.3186 4.46399C44.5314 4.28801 44.5613 3.97284 44.3853 3.76004L41.5175 0.292199C41.3416 0.0793953 41.0264 0.0495441 40.8136 0.225525C40.6008 0.401505 40.5709 0.716677 40.7469 0.929481L43.296 4.012L40.2135 6.56113C40.0007 6.73711 39.9709 7.05228 40.1468 7.26509C40.3228 7.47789 40.638 7.50774 40.8508 7.33176L44.3186 4.46399ZM44.0471 3.58091C38.7621 3.08034 27.8926 4.80481 18.3357 11.5838C8.74613 18.386 0.5 30.2626 0.5 50H1.5C1.5 30.5889 9.58721 19.0154 18.9143 12.3994C28.2741 5.76023 38.9045 4.0983 43.9529 4.57645L44.0471 3.58091Z"),g(l,"class","svelte-1jqlo12"),g(t,"x","4"),g(t,"y","60"),g(t,"text-anchor","middle"),g(t,"class","svelte-1jqlo12"),g(e,"class","guide svelte-1jqlo12"),g(e,"width","44px"),oe(e,"active",!1)},m(r,s){G(r,e,s),I(e,l),I(e,t),I(t,o)},d(r){r&&_(e)}}}function dr(n){let e;function l(r,s){if(r[2]==="activation")return ur;if(r[2]==="dropout")return fr;if(r[2]==="ln")return cr;if(r[2]==="residual-start")return ar;if(r[2]==="residual-end")return ir}let t=l(n),o=t&&t(n);return{c(){o&&o.c(),e=mt()},l(r){o&&o.l(r),e=mt()},m(r,s){o&&o.m(r,s),G(r,e,s)},p(r,[s]){t===(t=l(r))&&o?o.p(r,s):(o&&o.d(1),o=t&&t(r),o&&(o.c(),o.m(e.parentNode,e)))},i:He,o:He,d(r){r&&_(e),o&&o.d(r)}}}function hr(n,e,l){let t;Ee(n,Kt,u=>l(6,t=u));let{id:o=void 0}=e,{className:r=void 0}=e,{type:s=void 0}=e,{head:c=!1}=e,{tail:i=!1}=e,{active:a=!1}=e;return n.$$set=u=>{"id"in u&&l(0,o=u.id),"className"in u&&l(1,r=u.className),"type"in u&&l(2,s=u.type),"head"in u&&l(3,c=u.head),"tail"in u&&l(4,i=u.tail),"active"in u&&l(5,a=u.active)},[o,r,s,c,i,a,t]}class Ft extends Oe{constructor(e){super(),Ge(this,e,hr,dr,je,{id:0,className:1,type:2,head:3,tail:4,active:5})}}function jl(n,e,l){const t=n.slice();return t[7]=e[l],t[9]=l,t}function pr(n){let e,l=n[3].dimension+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&8&&l!==(l=r[3].dimension+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Ol(n){let e,l,t,o,r,s,c,i;return t=new vt({props:{colorScale:"blue"}}),s=new et({props:{placement:"right",class:"popover",$$slots:{default:[pr]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),ie(t.$$.fragment),r=U(),ie(s.$$.fragment),c=U(),this.h()},l(a){e=P(a,"DIV",{class:!0});var u=T(e);l=P(u,"DIV",{class:!0});var h=T(l);ae(t.$$.fragment,h),h.forEach(_),r=x(u),ae(s.$$.fragment,u),c=x(u),u.forEach(_),this.h()},h(){g(l,"class",o=ve(pe("vector shrink-0 bg-blue-200",{"last-token":n[9]===n[4].length-1}))+" svelte-1jtwro5"),g(e,"class","cell svelte-1jtwro5"),oe(e,"last",n[9]===n[4].length-1)},m(a,u){G(a,e,u),I(e,l),ce(t,l,null),I(e,r),ce(s,e,null),I(e,c),i=!0},p(a,u){(!i||u&16&&o!==(o=ve(pe("vector shrink-0 bg-blue-200",{"last-token":a[9]===a[4].length-1}))+" svelte-1jtwro5"))&&g(l,"class",o);const h={};u&1032&&(h.$$scope={dirty:u,ctx:a}),s.$set(h),(!i||u&16)&&oe(e,"last",a[9]===a[4].length-1)},i(a){i||(j(t.$$.fragment,a),j(s.$$.fragment,a),i=!0)},o(a){W(t.$$.fragment,a),W(s.$$.fragment,a),i=!1},d(a){a&&_(e),fe(t),fe(s)}}}function vr(n){let e,l,t,o,r,s,c,i=n[3].layer_num-1+"",a,u,h,p,b="Transformer<br/>Blocks",N,H,z,F,V,R,ee,C,q,M,f,d,m=$e(n[4]),w=[];for(let y=0;y<m.length;y+=1)w[y]=Ol(jl(n,m,y));const k=y=>W(w[y],1,1,()=>{w[y]=null});return{c(){e=B("div"),l=B("div"),t=U(),o=B("div"),r=B("div"),s=B("div"),c=B("div"),a=ue(i),u=ue(" more identical"),h=B("br"),p=B("span"),p.innerHTML=b,N=ue("."),H=U(),z=De("svg"),F=De("path"),V=U();for(let y=0;y<w.length;y+=1)w[y].c();R=U(),ee=B("div"),C=B("div"),this.h()},l(y){e=P(y,"DIV",{class:!0,role:!0});var A=T(e);l=P(A,"DIV",{class:!0}),T(l).forEach(_),t=x(A),o=P(A,"DIV",{class:!0});var v=T(o);r=P(v,"DIV",{class:!0});var E=T(r);s=P(E,"DIV",{class:!0});var $=T(s);c=P($,"DIV",{class:!0});var D=T(c);a=de(D,i),u=de(D," more identical"),h=P(D,"BR",{}),p=P(D,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(p)!=="svelte-m89yhc"&&(p.innerHTML=b),N=de(D,"."),D.forEach(_),H=x($),z=qe($,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var L=T(z);F=qe(L,"path",{d:!0,fill:!0}),T(F).forEach(_),L.forEach(_),$.forEach(_),V=x(E);for(let O=0;O<w.length;O+=1)w[O].l(E);E.forEach(_),R=x(v),ee=P(v,"DIV",{class:!0});var S=T(ee);C=P(S,"DIV",{class:!0}),T(C).forEach(_),S.forEach(_),v.forEach(_),A.forEach(_),this.h()},h(){g(l,"class","title"),g(p,"class","highlight svelte-1jtwro5"),g(c,"class","text svelte-1jtwro5"),oe(c,"active",n[2]),g(F,"d","M1.18221 4.58047C1.23103 4.62928 1.31017 4.62928 1.35899 4.58047L2.15448 3.78497C2.2033 3.73616 2.2033 3.65701 2.15448 3.6082C2.10567 3.55938 2.02652 3.55938 1.97771 3.6082L1.2706 4.3153L0.563493 3.6082C0.514677 3.55938 0.435531 3.55938 0.386716 3.6082C0.3379 3.65701 0.3379 3.73616 0.386716 3.78497L1.18221 4.58047ZM1.1456 0.285461V4.49208H1.3956V0.285461H1.1456Z"),g(F,"fill","currentColor"),g(z,"xmlns","http://www.w3.org/2000/svg"),g(z,"class","h-6 w-6 text-gray-300"),g(z,"viewBox","0 0 3 5"),g(z,"fill","none"),g(s,"class","guide flex flex-col items-start gap-1 svelte-1jtwro5"),g(r,"class","column final relative svelte-1jtwro5"),g(C,"class","prob-dim svelte-1jtwro5"),oe(C,"expanded",n[1].id==="softmax"),g(ee,"class","second-column svelte-1jtwro5"),g(o,"class","content svelte-1jtwro5"),g(e,"class",q=ve(pe("transformer-blocks",n[0],{expanded:n[1].id!==null}))+" svelte-1jtwro5"),g(e,"role","group")},m(y,A){G(y,e,A),I(e,l),I(e,t),I(e,o),I(o,r),I(r,s),I(s,c),I(c,a),I(c,u),I(c,h),I(c,p),I(c,N),I(s,H),I(s,z),I(z,F),I(r,V);for(let v=0;v<w.length;v+=1)w[v]&&w[v].m(r,null);I(o,R),I(o,ee),I(ee,C),M=!0,f||(d=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],f=!0)},p(y,[A]){if((!M||A&8)&&i!==(i=y[3].layer_num-1+"")&&Ae(a,i),(!M||A&4)&&oe(c,"active",y[2]),A&24){m=$e(y[4]);let v;for(v=0;v<m.length;v+=1){const E=jl(y,m,v);w[v]?(w[v].p(E,A),j(w[v],1)):(w[v]=Ol(E),w[v].c(),j(w[v],1),w[v].m(r,null))}for(Ne(),v=m.length;v<w.length;v+=1)k(v);Le()}(!M||A&2)&&oe(C,"expanded",y[1].id==="softmax"),(!M||A&3&&q!==(q=ve(pe("transformer-blocks",y[0],{expanded:y[1].id!==null}))+" svelte-1jtwro5"))&&g(e,"class",q)},i(y){if(!M){for(let A=0;A<m.length;A+=1)j(w[A]);M=!0}},o(y){w=w.filter(Boolean);for(let A=0;A<w.length;A+=1)W(w[A]);M=!1},d(y){y&&_(e),Be(w,y),f=!1,Fe(d)}}}function mr(n,e,l){let t,o,r,s;Ee(n,xe,u=>l(1,t=u)),Ee(n,Gt,u=>l(2,o=u)),Ee(n,Bt,u=>l(3,r=u)),Ee(n,bt,u=>l(4,s=u));let{className:c=void 0}=e;const i=()=>{Gt.set(!0)},a=()=>{Gt.set(!1)};return n.$$set=u=>{"className"in u&&l(0,c=u.className)},[c,t,o,r,s,i,a]}class gr extends Oe{constructor(e){super(),Ge(this,e,mr,vr,je,{className:0})}}function _r(n){let e,l,t,o;return{c(){e=B("div"),l=De("svg"),t=De("g"),o=De("g"),this.h()},l(r){e=P(r,"DIV",{class:!0});var s=T(e);l=qe(s,"svg",{class:!0});var c=T(l);t=qe(c,"g",{class:!0}),T(t).forEach(_),o=qe(c,"g",{class:!0}),T(o).forEach(_),c.forEach(_),s.forEach(_),this.h()},h(){g(t,"class","bars"),g(o,"class","bar-labels"),g(l,"class","h-full w-full"),g(e,"class","content-box probability grow svelte-8s3yoj")},m(r,s){G(r,e,s),I(e,l),I(l,t),I(l,o),n[7](l)},p:He,i:He,o:He,d(r){r&&_(e),n[7](null)}}}const Gl=4;let br=1;function $r(n,e,l){let t,o;Ee(n,Rt,H=>l(5,t=H)),Ee(n,Pt,H=>l(6,o=H));const{theme:r}=It(Dt);let{rowHeight:s}=e,{rowGap:c}=e,{hoveredIndex:i=null}=e,a,u=r.colors.gray[300],h=r.colors.purple[400],{drawBars:p=()=>{const H=o==null?void 0:o.prediction,z=lt(a);let F=cl().domain([0,Io(H,V=>V.adjustedProbability)]).range([0,(a==null?void 0:a.clientWidth)-Mt*3]);z.select("g.bars").selectAll("rect").data(H).join("rect").attr("x",0).attr("y",(V,R)=>R*s+R*c+s/2-Gl/2).attr("height",Gl).attr("width",V=>F(V.adjustedProbability)).attr("rx",1).attr("ry",1).attr("fill",(V,R)=>R===i?h:(t==null?void 0:t.rank)===R?Wt:u).on("mouseenter",function(V,R){l(1,i=R.rank),lt(this).style("cursor","pointer")}).on("mouseleave",()=>l(1,i=null)).transition().ease(ao).duration(500).attr("width",V=>F(V.adjustedProbability)),z.select("g.bar-labels").selectAll("text").data(H).join("text").attr("fill",(V,R)=>R===i?h:(t==null?void 0:t.rank)===R?Wt:u).on("mouseenter",function(V,R){l(1,i=R.rank),lt(this).style("cursor","pointer")}).on("mouseleave",()=>{l(1,i=null)}).attr("x",V=>.4*Mt+F(V.adjustedProbability)).attr("y",(V,R)=>R*s+R*c).attr("dy",s/2+3).attr("text-anchor","start").style("font-size","0.75rem").transition().duration(500).tween("text",function(V){const R=lt(this),ee=co(R.text().replace("%",""),V.adjustedProbability*100);return function(C){R.text(ee(C).toFixed(br)+"%")}})}}=e;_t(()=>{p()});const b=()=>{if(!a)return;const H=lt(a);H.selectAll("g.bars rect").attr("fill",(z,F)=>F===i?h:(t==null?void 0:t.rank)===F?Wt:u),H.selectAll("g.bar-labels text").attr("fill",(z,F)=>F===i?h:(t==null?void 0:t.rank)===F?Wt:u)};function N(H){Je[H?"unshift":"push"](()=>{a=H,l(0,a)})}return n.$$set=H=>{"rowHeight"in H&&l(2,s=H.rowHeight),"rowGap"in H&&l(3,c=H.rowGap),"hoveredIndex"in H&&l(1,i=H.hoveredIndex),"drawBars"in H&&l(4,p=H.drawBars)},n.$$.update=()=>{n.$$.dirty&81&&o&&a&&p(),n.$$.dirty&2&&i!==void 0&&b(),n.$$.dirty&32&&t&&b()},[a,i,s,c,p,t,o,N]}class wr extends Oe{constructor(e){super(),Ge(this,e,$r,_r,je,{rowHeight:2,rowGap:3,hoveredIndex:1,drawBars:4})}}function zl(n,e,l){const t=n.slice();return t[36]=e[l],t[38]=l,t}function Rl(n,e,l){const t=n.slice();return t[39]=e[l],t[38]=l,t}function Fl(n,e,l){const t=n.slice();return t[41]=e[l],t[38]=l,t}function kr(n){let e,l=n[9][n[38]]+"",t,o;return{c(){e=ue("Token ID: "),t=ue(l),o=U()},l(r){e=de(r,"Token ID: "),t=de(r,l),o=x(r)},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s[0]&512&&l!==(l=r[9][r[38]]+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Ul(n){let e,l=(n[41].token.trim()===""?" ":n[41].token)+"",t,o,r,s,c,i;function a(){return n[21](n[38])}return r=new et({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[kr]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ue(l),o=U(),ie(r.$$.fragment),this.h()},l(u){e=P(u,"DIV",{role:!0,class:!0});var h=T(e);t=de(h,l),h.forEach(_),o=x(u),ae(r.$$.fragment,u),this.h()},h(){var u;g(e,"role","group"),g(e,"class","text-box svelte-xhmodo"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,h){G(u,e,h),I(e,t),G(u,o,h),ce(r,u,h),s=!0,c||(i=[ke(e,"mouseenter",a),ke(e,"mouseleave",n[22])],c=!0)},p(u,h){var b;n=u,(!s||h[0]&4)&&l!==(l=(n[41].token.trim()===""?" ":n[41].token)+"")&&Ae(t,l),(!s||h[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!s||h[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!s||h[0]&2048)&&oe(e,"final_token_highlight",((b=n[11])==null?void 0:b.rank)===n[38]);const p={};h[0]&512|h[1]&4096&&(p.$$scope={dirty:h,ctx:n}),r.$set(p)},i(u){s||(j(r.$$.fragment,u),s=!0)},o(u){W(r.$$.fragment,u),s=!1},d(u){u&&(_(e),_(o)),fe(r,u),c=!1,Fe(i)}}}function xl(n){let e,l='<div class="title-box token-string !justify-end svelte-xhmodo"><div class="title-text svelte-xhmodo">Tokens</div></div> <div class="title-box logits svelte-xhmodo"><div class="title-text svelte-xhmodo">Logits</div></div> <div class="title-box exponents svelte-xhmodo"><div class="title-text svelte-xhmodo">Exponents</div></div> <div class="title-box probability svelte-xhmodo"><div class="title-text svelte-xhmodo">Probability</div></div>';return{c(){e=B("div"),e.innerHTML=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-16l107t"&&(e.innerHTML=l),this.h()},h(){g(e,"class","softmax-subtitle softmax-detail flex text-center text-xs opacity-0 svelte-xhmodo")},m(t,o){G(t,e,o)},d(t){t&&_(e)}}}function Wl(n){let e,l,t,o,r=$e(n[8]),s=[];for(let h=0;h<r.length;h+=1)s[h]=Zl(Rl(n,r,h));const c=h=>W(s[h],1,1,()=>{s[h]=null});let i=$e(n[7]),a=[];for(let h=0;h<i.length;h+=1)a[h]=Yl(zl(n,i,h));const u=h=>W(a[h],1,1,()=>{a[h]=null});return{c(){e=B("div");for(let h=0;h<s.length;h+=1)s[h].c();l=U(),t=B("div");for(let h=0;h<a.length;h+=1)a[h].c();this.h()},l(h){e=P(h,"DIV",{class:!0});var p=T(e);for(let N=0;N<s.length;N+=1)s[N].l(p);p.forEach(_),l=x(h),t=P(h,"DIV",{class:!0});var b=T(t);for(let N=0;N<a.length;N+=1)a[N].l(b);b.forEach(_),this.h()},h(){g(e,"class","content-box vector-box logits ml-2 svelte-xhmodo"),g(t,"class","content-box vector-box exponents svelte-xhmodo")},m(h,p){G(h,e,p);for(let b=0;b<s.length;b+=1)s[b]&&s[b].m(e,null);G(h,l,p),G(h,t,p);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(t,null);o=!0},p(h,p){if(p[0]&7456){r=$e(h[8]);let b;for(b=0;b<r.length;b+=1){const N=Rl(h,r,b);s[b]?(s[b].p(N,p),j(s[b],1)):(s[b]=Zl(N),s[b].c(),j(s[b],1),s[b].m(e,null))}for(Ne(),b=r.length;b<s.length;b+=1)c(b);Le()}if(p[0]&3488){i=$e(h[7]);let b;for(b=0;b<i.length;b+=1){const N=zl(h,i,b);a[b]?(a[b].p(N,p),j(a[b],1)):(a[b]=Yl(N),a[b].c(),j(a[b],1),a[b].m(t,null))}for(Ne(),b=i.length;b<a.length;b+=1)u(b);Le()}},i(h){if(!o){for(let p=0;p<r.length;p+=1)j(s[p]);for(let p=0;p<i.length;p+=1)j(a[p]);o=!0}},o(h){s=s.filter(Boolean);for(let p=0;p<s.length;p+=1)W(s[p]);a=a.filter(Boolean);for(let p=0;p<a.length;p+=1)W(a[p]);o=!1},d(h){h&&(_(e),_(l),_(t)),Be(s,h),Be(a,h)}}}function Xl(n){let e,l=n[39].toFixed(2)+"",t,o,r,s,c,i;function a(){return n[23](n[38])}return r=new et({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[yr]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ue(l),o=U(),ie(r.$$.fragment),this.h()},l(u){e=P(u,"DIV",{role:!0,class:!0});var h=T(e);t=de(h,l),h.forEach(_),o=x(u),ae(r.$$.fragment,u),this.h()},h(){var u;g(e,"role","group"),g(e,"class","text-box text-center svelte-xhmodo"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,h){G(u,e,h),I(e,t),G(u,o,h),ce(r,u,h),s=!0,c||(i=[ke(e,"mouseenter",a),ke(e,"mouseleave",n[24])],c=!0)},p(u,h){var b;n=u,(!s||h[0]&256)&&l!==(l=n[39].toFixed(2)+"")&&Ae(t,l),(!s||h[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!s||h[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!s||h[0]&2048)&&oe(e,"final_token_highlight",((b=n[11])==null?void 0:b.rank)===n[38]);const p={};h[0]&4352|h[1]&4096&&(p.$$scope={dirty:h,ctx:n}),r.$set(p)},i(u){s||(j(r.$$.fragment,u),s=!0)},o(u){W(r.$$.fragment,u),s=!1},d(u){u&&(_(e),_(o)),fe(r,u),c=!1,Fe(i)}}}function yr(n){let e=(n[39]*n[12]).toFixed(2)+"",l,t,o,r,s=n[39].toFixed(2)+"",c,i;return{c(){l=ue(e),t=ue(" ÷ "),o=ue(n[12]),r=ue(" = "),c=ue(s),i=U()},l(a){l=de(a,e),t=de(a," ÷ "),o=de(a,n[12]),r=de(a," = "),c=de(a,s),i=x(a)},m(a,u){G(a,l,u),G(a,t,u),G(a,o,u),G(a,r,u),G(a,c,u),G(a,i,u)},p(a,u){u[0]&4352&&e!==(e=(a[39]*a[12]).toFixed(2)+"")&&Ae(l,e),u[0]&4096&&Ae(o,a[12]),u[0]&256&&s!==(s=a[39].toFixed(2)+"")&&Ae(c,s)},d(a){a&&(_(l),_(t),_(o),_(r),_(c),_(i))}}}function Zl(n){let e,l,t=n[39]!==void 0&&Xl(n);return{c(){t&&t.c(),e=mt()},l(o){t&&t.l(o),e=mt()},m(o,r){t&&t.m(o,r),G(o,e,r),l=!0},p(o,r){o[39]!==void 0?t?(t.p(o,r),r[0]&256&&j(t,1)):(t=Xl(o),t.c(),j(t,1),t.m(e.parentNode,e)):t&&(Ne(),W(t,1,1,()=>{t=null}),Le())},i(o){l||(j(t),l=!0)},o(o){W(t),l=!1},d(o){o&&_(e),t&&t.d(o)}}}function Er(n){let e,l=n[8][n[38]].toFixed(2)+"",t,o,r=n[36].toFixed(2)+"",s,c;return{c(){e=ue("exp("),t=ue(l),o=ue(") = "),s=ue(r),c=U()},l(i){e=de(i,"exp("),t=de(i,l),o=de(i,") = "),s=de(i,r),c=x(i)},m(i,a){G(i,e,a),G(i,t,a),G(i,o,a),G(i,s,a),G(i,c,a)},p(i,a){a[0]&256&&l!==(l=i[8][i[38]].toFixed(2)+"")&&Ae(t,l),a[0]&128&&r!==(r=i[36].toFixed(2)+"")&&Ae(s,r)},d(i){i&&(_(e),_(t),_(o),_(s),_(c))}}}function Yl(n){let e,l=n[36].toExponential(2)+"",t,o,r,s,c,i;function a(){return n[25](n[38])}return r=new et({props:{class:"popover",placement:"left",type:"light",$$slots:{default:[Er]},$$scope:{ctx:n}}}),{c(){e=B("div"),t=ue(l),o=U(),ie(r.$$.fragment),this.h()},l(u){e=P(u,"DIV",{role:!0,class:!0});var h=T(e);t=de(h,l),h.forEach(_),o=x(u),ae(r.$$.fragment,u),this.h()},h(){var u;g(e,"role","group"),g(e,"class","text-box text-center svelte-xhmodo"),oe(e,"highlight",n[38]===n[5]),oe(e,"sample_highlight",n[10]===n[38]),oe(e,"final_token_highlight",((u=n[11])==null?void 0:u.rank)===n[38])},m(u,h){G(u,e,h),I(e,t),G(u,o,h),ce(r,u,h),s=!0,c||(i=[ke(e,"mouseenter",a),ke(e,"mouseleave",n[26])],c=!0)},p(u,h){var b;n=u,(!s||h[0]&128)&&l!==(l=n[36].toExponential(2)+"")&&Ae(t,l),(!s||h[0]&32)&&oe(e,"highlight",n[38]===n[5]),(!s||h[0]&1024)&&oe(e,"sample_highlight",n[10]===n[38]),(!s||h[0]&2048)&&oe(e,"final_token_highlight",((b=n[11])==null?void 0:b.rank)===n[38]);const p={};h[0]&384|h[1]&4096&&(p.$$scope={dirty:h,ctx:n}),r.$set(p)},i(u){s||(j(r.$$.fragment,u),s=!0)},o(u){W(r.$$.fragment,u),s=!1},d(u){u&&(_(e),_(o)),fe(r,u),c=!1,Fe(i)}}}function Ir(n){let e,l,t="<div>Probabilities</div>",o,r,s,c,i,a,u,h,p,b,N,H,z,F,V,R,ee,C,q,M,f,d=$e(n[2]),m=[];for(let $=0;$<d.length;$+=1)m[$]=Ul(Fl(n,d,$));const w=$=>W(m[$],1,1,()=>{m[$]=null});let k=n[1]&&xl(),y=n[1]&&Wl(n);function A($){n[27]($)}function v($){n[28]($)}let E={rowGap:n[16],rowHeight:n[15]};return n[5]!==void 0&&(E.hoveredIndex=n[5]),n[4]!==void 0&&(E.drawBars=n[4]),V=new wr({props:E}),Je.push(()=>vl(V,"hoveredIndex",A)),Je.push(()=>vl(V,"drawBars",v)),{c(){e=B("div"),l=B("div"),l.innerHTML=t,o=U(),r=B("div"),s=B("div"),c=U(),i=B("div"),a=B("div");for(let $=0;$<m.length;$+=1)m[$].c();u=U(),h=B("div"),p=U(),b=B("div"),k&&k.c(),N=U(),H=B("div"),z=B("div"),y&&y.c(),F=U(),ie(V.$$.fragment),this.h()},l($){e=P($,"DIV",{class:!0,role:!0});var D=T(e);l=P(D,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-1d64i2n"&&(l.innerHTML=t),o=x(D),r=P(D,"DIV",{class:!0,style:!0});var L=T(r);s=P(L,"DIV",{class:!0}),T(s).forEach(_),c=x(L),i=P(L,"DIV",{class:!0});var S=T(i);a=P(S,"DIV",{class:!0});var O=T(a);for(let se=0;se<m.length;se+=1)m[se].l(O);O.forEach(_),u=x(S),h=P(S,"DIV",{class:!0}),T(h).forEach(_),S.forEach(_),p=x(L),b=P(L,"DIV",{class:!0});var X=T(b);k&&k.l(X),N=x(X),H=P(X,"DIV",{class:!0});var he=T(H);z=P(he,"DIV",{class:!0});var J=T(z);y&&y.l(J),J.forEach(_),F=x(he),ae(V.$$.fragment,he),he.forEach(_),X.forEach(_),L.forEach(_),D.forEach(_),this.h()},h(){g(l,"class","title expandable svelte-xhmodo"),g(l,"role","none"),g(s,"class","bounding softmax-bounding svelte-xhmodo"),oe(s,"active",n[6]&&!n[1]),g(a,"class","content-box token-string svelte-xhmodo"),g(h,"class","vector vocab opacity-1 w-0"),g(i,"class","first-column relative flex justify-end"),g(z,"class","softmax-detail expandable flex gap-2 opacity-0"),g(H,"class","content-row flex gap-2"),g(b,"class","second-column flex flex-col svelte-xhmodo"),g(r,"class","content resize-watch relative svelte-xhmodo"),g(r,"style",`--softmax-row-height: ${n[15]}px;--softmax-row-gap: ${n[16]}px`),g(e,"class",C=ve(pe("softmax",n[0],{expanded:n[1]}))+" svelte-xhmodo"),g(e,"role","none")},m($,D){G($,e,D),I(e,l),I(e,o),I(e,r),I(r,s),I(r,c),I(r,i),I(i,a);for(let L=0;L<m.length;L+=1)m[L]&&m[L].m(a,null);I(i,u),I(i,h),I(r,p),I(r,b),k&&k.m(b,null),I(b,N),I(b,H),I(H,z),y&&y.m(z,null),I(H,F),ce(V,H,null),n[29](e),q=!0,M||(f=[ke(l,"click",n[14]),ke(l,"keydown",n[14]),ke(l,"mouseenter",n[17]),ke(l,"mouseleave",n[18]),ke(e,"click",n[13]),ke(e,"keydown",n[13])],M=!0)},p($,D){if((!q||D[0]&66)&&oe(s,"active",$[6]&&!$[1]),D[0]&3620){d=$e($[2]);let S;for(S=0;S<d.length;S+=1){const O=Fl($,d,S);m[S]?(m[S].p(O,D),j(m[S],1)):(m[S]=Ul(O),m[S].c(),j(m[S],1),m[S].m(a,null))}for(Ne(),S=d.length;S<m.length;S+=1)w(S);Le()}$[1]?k||(k=xl(),k.c(),k.m(b,N)):k&&(k.d(1),k=null),$[1]?y?(y.p($,D),D[0]&2&&j(y,1)):(y=Wl($),y.c(),j(y,1),y.m(z,null)):y&&(Ne(),W(y,1,1,()=>{y=null}),Le());const L={};!R&&D[0]&32&&(R=!0,L.hoveredIndex=$[5],pl(()=>R=!1)),!ee&&D[0]&16&&(ee=!0,L.drawBars=$[4],pl(()=>ee=!1)),V.$set(L),(!q||D[0]&3&&C!==(C=ve(pe("softmax",$[0],{expanded:$[1]}))+" svelte-xhmodo"))&&g(e,"class",C)},i($){if(!q){for(let D=0;D<d.length;D+=1)j(m[D]);j(y),j(V.$$.fragment,$),q=!0}},o($){m=m.filter(Boolean);for(let D=0;D<m.length;D+=1)W(m[D]);W(y),W(V.$$.fragment,$),q=!1},d($){$&&_(e),Be(m,$),k&&k.d(),y&&y.d(),fe(V),n[29](null),M=!1,Fe(f)}}}function Dr(n,e,l){let t,o,r,s,c,i,a,u,h;Ee(n,Pt,X=>l(19,c=X)),Ee(n,xe,X=>l(20,i=X)),Ee(n,Jn,X=>l(10,a=X)),Ee(n,Rt,X=>l(11,u=X)),Ee(n,al,X=>l(12,h=X));let{className:p=void 0}=e;It(Dt),Jt("block-id","softmax");const b=Qt("block-id");let N=!1;const H=()=>{N||(xe.set({id:b}),C())},z=X=>{X.stopPropagation(),X.preventDefault(),N?(xe.set({id:null}),q()):(xe.set({id:b}),C())};let F;function V(X){N&&!F.contains(X.target)&&xe.set({id:null})}_t(()=>(document.body.addEventListener("click",V),()=>{document.body.removeEventListener("click",V)}));let R,ee;const C=async()=>{R=Et.Flip.getState(".softmax .softmax-detail.expandable"),l(1,N=!0),await zt(),at.set(".steps",{justifyContent:"end"}),at.set(".softmax-detail",{opacity:0}),Et.Flip.from(R,{duration:.5,ease:"power2.inOut",onComplete:()=>{ee==null||ee()}}),at.to(".softmax-detail",{opacity:1,duration:.2,delay:.5})},q=async()=>{R=Et.Flip.getState(".softmax .softmax-detail.expandable"),l(1,N=!1),await zt(),await Et.Flip.from(R,{duration:.5,ease:"power2.inOut",onComplete:()=>{ee==null||ee()}}),at.to(".softmax-detail",{opacity:0,duration:.2}),at.set(".steps",{justifyContent:"start"})};let M=Mt*1.2,f=.4*Mt,d=null,m=!1;function w(){l(6,m=!0)}function k(){l(6,m=!1)}const y=X=>l(5,d=X),A=()=>l(5,d=null),v=X=>l(5,d=X),E=()=>l(5,d=null),$=X=>l(5,d=X),D=()=>l(5,d=null);function L(X){d=X,l(5,d)}function S(X){ee=X,l(4,ee)}function O(X){Je[X?"unshift":"push"](()=>{F=X,l(3,F)})}return n.$$set=X=>{"className"in X&&l(0,p=X.className)},n.$$.update=()=>{n.$$.dirty[0]&1048578&&i.id!==b&&N&&(l(1,N=!1),q()),n.$$.dirty[0]&524288&&l(2,t=(c==null?void 0:c.prediction)||[]),n.$$.dirty[0]&4&&l(9,o=t==null?void 0:t.map(X=>X.tokenId)),n.$$.dirty[0]&4&&l(8,r=(t==null?void 0:t.map(X=>X.adjustedLogit))||[]),n.$$.dirty[0]&4&&l(7,s=(t==null?void 0:t.map(X=>X.adjustedExp))||[])},[p,N,t,F,ee,d,m,s,r,o,a,u,h,H,z,M,f,w,k,c,i,y,A,v,E,$,D,L,S,O]}class qr extends Oe{constructor(e){super(),Ge(this,e,Dr,Ir,je,{className:0},null,[-1,-1])}}function Cr(n){let e,l="Drop out is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-ohkp45"&&(e.textContent=l),this.h()},h(){g(e,"class","dropout-content")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function Sr(n){let e,l;return e=new tl({props:{class:pe("popover dropout-popover text-sm",n[1]),title:"Drop out",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[Cr]},$$scope:{ctx:n}}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,[o]){const r={};o&2&&(r.class=pe("popover dropout-popover text-sm",t[1])),o&1&&(r.offset=t[0]),o&4&&(r.triggeredBy=t[2]),o&8&&(r.trigger=t[3]),o&16&&(r.placement=t[4]),o&32&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function Vr(n,e,l){let{offset:t=void 0}=e,{className:o=void 0}=e,{triggeredBy:r=void 0}=e,{trigger:s="hover"}=e,{placement:c="right"}=e;return n.$$set=i=>{"offset"in i&&l(0,t=i.offset),"className"in i&&l(1,o=i.className),"triggeredBy"in i&&l(2,r=i.triggeredBy),"trigger"in i&&l(3,s=i.trigger),"placement"in i&&l(4,c=i.placement)},[t,o,r,s,c]}class Ar extends Oe{constructor(e){super(),Ge(this,e,Vr,Sr,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Nr(n){let e,l="Layer normalization is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-qw3l61"&&(e.textContent=l),this.h()},h(){g(e,"class","ln-content")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function Lr(n){let e,l;return e=new tl({props:{class:pe("popover ln-popover text-sm",n[1]),title:"Layer Normalization",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[Nr]},$$scope:{ctx:n}}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,[o]){const r={};o&2&&(r.class=pe("popover ln-popover text-sm",t[1])),o&1&&(r.offset=t[0]),o&4&&(r.triggeredBy=t[2]),o&8&&(r.trigger=t[3]),o&16&&(r.placement=t[4]),o&32&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function Mr(n,e,l){let{offset:t=void 0}=e,{className:o=void 0}=e,{triggeredBy:r=void 0}=e,{trigger:s="hover"}=e,{placement:c="right"}=e;return n.$$set=i=>{"offset"in i&&l(0,t=i.offset),"className"in i&&l(1,o=i.className),"triggeredBy"in i&&l(2,r=i.triggeredBy),"trigger"in i&&l(3,s=i.trigger),"placement"in i&&l(4,c=i.placement)},[t,o,r,s,c]}class Br extends Oe{constructor(e){super(),Ge(this,e,Mr,Lr,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Pr(n){let e,l=`The GELU (Gaussian Error Linear Unit) activation function combines linear and non-linear
		behavior by scaling inputs using the Gaussian cumulative distribution function. It retains small
		negative values for smoother gradients and is effective in models like BERT.`;return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1ri460b"&&(e.textContent=l),this.h()},h(){g(e,"class","activation-content svelte-60plg2")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function Tr(n){let e,l;return e=new tl({props:{class:pe("popover activation-popover text-sm",n[1]),title:"GeLu Activation",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},$$slots:{default:[Pr]},$$scope:{ctx:n}}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,[o]){const r={};o&2&&(r.class=pe("popover activation-popover text-sm",t[1])),o&1&&(r.offset=t[0]),o&4&&(r.triggeredBy=t[2]),o&8&&(r.trigger=t[3]),o&16&&(r.placement=t[4]),o&32&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function Hr(n,e,l){let{offset:t=void 0}=e,{className:o=void 0}=e,{triggeredBy:r=void 0}=e,{trigger:s="hover"}=e,{placement:c="right"}=e;return n.$$set=i=>{"offset"in i&&l(0,t=i.offset),"className"in i&&l(1,o=i.className),"triggeredBy"in i&&l(2,r=i.triggeredBy),"trigger"in i&&l(3,s=i.trigger),"placement"in i&&l(4,c=i.placement)},[t,o,r,s,c]}class jr extends Oe{constructor(e){super(),Ge(this,e,Hr,Tr,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4})}}function Or(n){let e,l="Residual out is";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-124ixs1"&&(e.textContent=l),this.h()},h(){g(e,"class","residual-content")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function Gr(n){let e,l;return e=new tl({props:{class:pe("popover residual-popover text-sm",n[1]),title:"Residual",offset:n[0],triggeredBy:n[2],trigger:n[3],placement:n[4],arrow:!1,transition:it,params:{duration:0},reference:n[5],$$slots:{default:[Or]},$$scope:{ctx:n}}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,[o]){const r={};o&2&&(r.class=pe("popover residual-popover text-sm",t[1])),o&1&&(r.offset=t[0]),o&4&&(r.triggeredBy=t[2]),o&8&&(r.trigger=t[3]),o&16&&(r.placement=t[4]),o&32&&(r.reference=t[5]),o&64&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function zr(n,e,l){let{offset:t=void 0}=e,{className:o=void 0}=e,{triggeredBy:r=void 0}=e,{trigger:s="hover"}=e,{placement:c="right"}=e,{reference:i}=e;return n.$$set=a=>{"offset"in a&&l(0,t=a.offset),"className"in a&&l(1,o=a.className),"triggeredBy"in a&&l(2,r=a.triggeredBy),"trigger"in a&&l(3,s=a.trigger),"placement"in a&&l(4,c=a.placement),"reference"in a&&l(5,i=a.reference)},[t,o,r,s,c,i]}class Rr extends Oe{constructor(e){super(),Ge(this,e,zr,Gr,je,{offset:0,className:1,triggeredBy:2,trigger:3,placement:4,reference:5})}}function Kl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Ql(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Jl(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function en(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function tn(n,e,l){const t=n.slice();return t[15]=e[l],t[17]=l,t}function Fr(n){let e,l,t,o,r,s,c=$e(n[4]),i=[];for(let u=0;u<c.length;u+=1)i[u]=ln(Kl(n,c,u));const a=u=>W(i[u],1,1,()=>{i[u]=null});return{c(){e=B("div");for(let u=0;u<i.length;u+=1)i[u].c();this.h()},l(u){e=P(u,"DIV",{id:!0,class:!0,role:!0});var h=T(e);for(let p=0;p<i.length;p+=1)i[p].l(h);h.forEach(_),this.h()},h(){g(e,"id",l=`${n[0]}-end`),g(e,"class",t=ve(pe("operation-col column residual",n[1]))+" svelte-cfq6hx"),g(e,"role","group")},m(u,h){G(u,e,h);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);o=!0,r||(s=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],r=!0)},p(u,h){if(h&27){c=$e(u[4]);let p;for(p=0;p<c.length;p+=1){const b=Kl(u,c,p);i[p]?(i[p].p(b,h),j(i[p],1)):(i[p]=ln(b),i[p].c(),j(i[p],1),i[p].m(e,null))}for(Ne(),p=c.length;p<i.length;p+=1)a(p);Le()}(!o||h&1&&l!==(l=`${u[0]}-end`))&&g(e,"id",l),(!o||h&2&&t!==(t=ve(pe("operation-col column residual",u[1]))+" svelte-cfq6hx"))&&g(e,"class",t)},i(u){if(!o){for(let h=0;h<c.length;h+=1)j(i[h]);o=!0}},o(u){i=i.filter(Boolean);for(let h=0;h<i.length;h+=1)W(i[h]);o=!1},d(u){u&&_(e),Be(i,u),r=!1,Fe(s)}}}function Ur(n){let e,l,t,o,r,s,c,i,a=$e(n[4]),u=[];for(let p=0;p<a.length;p+=1)u[p]=nn(Ql(n,a,p));const h=p=>W(u[p],1,1,()=>{u[p]=null});return t=new Rr({props:{reference:`#${n[0]}-start`,triggeredBy:`[id^='${n[0]}-']`,offset:1}}),{c(){e=B("div");for(let p=0;p<u.length;p+=1)u[p].c();l=U(),ie(t.$$.fragment),this.h()},l(p){e=P(p,"DIV",{id:!0,class:!0,role:!0});var b=T(e);for(let N=0;N<u.length;N+=1)u[N].l(b);l=x(b),ae(t.$$.fragment,b),b.forEach(_),this.h()},h(){g(e,"id",o=`${n[0]}-start`),g(e,"class",r=ve(pe("operation-col column residual",n[1]))+" svelte-cfq6hx"),g(e,"role","group")},m(p,b){G(p,e,b);for(let N=0;N<u.length;N+=1)u[N]&&u[N].m(e,null);I(e,l),ce(t,e,null),s=!0,c||(i=[ke(e,"mouseenter",n[5]),ke(e,"mouseleave",n[6])],c=!0)},p(p,b){if(b&27){a=$e(p[4]);let H;for(H=0;H<a.length;H+=1){const z=Ql(p,a,H);u[H]?(u[H].p(z,b),j(u[H],1)):(u[H]=nn(z),u[H].c(),j(u[H],1),u[H].m(e,l))}for(Ne(),H=a.length;H<u.length;H+=1)h(H);Le()}const N={};b&1&&(N.reference=`#${p[0]}-start`),b&1&&(N.triggeredBy=`[id^='${p[0]}-']`),t.$set(N),(!s||b&1&&o!==(o=`${p[0]}-start`))&&g(e,"id",o),(!s||b&2&&r!==(r=ve(pe("operation-col column residual",p[1]))+" svelte-cfq6hx"))&&g(e,"class",r)},i(p){if(!s){for(let b=0;b<a.length;b+=1)j(u[b]);j(t.$$.fragment,p),s=!0}},o(p){u=u.filter(Boolean);for(let b=0;b<u.length;b+=1)W(u[b]);W(t.$$.fragment,p),s=!1},d(p){p&&_(e),Be(u,p),fe(t),c=!1,Fe(i)}}}function xr(n){let e,l,t,o,r,s,c,i=$e(n[4]),a=[];for(let h=0;h<i.length;h+=1)a[h]=on(Jl(n,i,h));const u=h=>W(a[h],1,1,()=>{a[h]=null});return t=new Br({props:{triggeredBy:`#${n[0]}`}}),{c(){e=B("div");for(let h=0;h<a.length;h+=1)a[h].c();l=U(),ie(t.$$.fragment),this.h()},l(h){e=P(h,"DIV",{id:!0,class:!0,role:!0});var p=T(e);for(let b=0;b<a.length;b+=1)a[b].l(p);l=x(p),ae(t.$$.fragment,p),p.forEach(_),this.h()},h(){g(e,"id",n[0]),g(e,"class",o=ve(pe("operation-col column ln",n[1]))+" svelte-cfq6hx"),g(e,"role","group")},m(h,p){G(h,e,p);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);I(e,l),ce(t,e,null),r=!0,s||(c=[ke(e,"mouseenter",n[11]),ke(e,"mouseleave",n[12])],s=!0)},p(h,p){if(p&26){i=$e(h[4]);let N;for(N=0;N<i.length;N+=1){const H=Jl(h,i,N);a[N]?(a[N].p(H,p),j(a[N],1)):(a[N]=on(H),a[N].c(),j(a[N],1),a[N].m(e,l))}for(Ne(),N=i.length;N<a.length;N+=1)u(N);Le()}const b={};p&1&&(b.triggeredBy=`#${h[0]}`),t.$set(b),(!r||p&1)&&g(e,"id",h[0]),(!r||p&2&&o!==(o=ve(pe("operation-col column ln",h[1]))+" svelte-cfq6hx"))&&g(e,"class",o)},i(h){if(!r){for(let p=0;p<i.length;p+=1)j(a[p]);j(t.$$.fragment,h),r=!0}},o(h){a=a.filter(Boolean);for(let p=0;p<a.length;p+=1)W(a[p]);W(t.$$.fragment,h),r=!1},d(h){h&&_(e),Be(a,h),fe(t),s=!1,Fe(c)}}}function Wr(n){let e,l,t,o,r,s,c,i=$e(n[4]),a=[];for(let h=0;h<i.length;h+=1)a[h]=rn(en(n,i,h));const u=h=>W(a[h],1,1,()=>{a[h]=null});return t=new Ar({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let h=0;h<a.length;h+=1)a[h].c();l=U(),ie(t.$$.fragment),this.h()},l(h){e=P(h,"DIV",{id:!0,class:!0,role:!0});var p=T(e);for(let b=0;b<a.length;b+=1)a[b].l(p);l=x(p),ae(t.$$.fragment,p),p.forEach(_),this.h()},h(){g(e,"id",n[0]),g(e,"class",o=ve(pe("operation-col column dropout",n[1]))+" svelte-cfq6hx"),g(e,"role","group")},m(h,p){G(h,e,p);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);I(e,l),ce(t,e,null),r=!0,s||(c=[ke(e,"mouseenter",n[9]),ke(e,"mouseleave",n[10])],s=!0)},p(h,p){if(p&26){i=$e(h[4]);let N;for(N=0;N<i.length;N+=1){const H=en(h,i,N);a[N]?(a[N].p(H,p),j(a[N],1)):(a[N]=rn(H),a[N].c(),j(a[N],1),a[N].m(e,l))}for(Ne(),N=i.length;N<a.length;N+=1)u(N);Le()}const b={};p&1&&(b.triggeredBy=`#${h[0]}`),t.$set(b),(!r||p&1)&&g(e,"id",h[0]),(!r||p&2&&o!==(o=ve(pe("operation-col column dropout",h[1]))+" svelte-cfq6hx"))&&g(e,"class",o)},i(h){if(!r){for(let p=0;p<i.length;p+=1)j(a[p]);j(t.$$.fragment,h),r=!0}},o(h){a=a.filter(Boolean);for(let p=0;p<a.length;p+=1)W(a[p]);W(t.$$.fragment,h),r=!1},d(h){h&&_(e),Be(a,h),fe(t),s=!1,Fe(c)}}}function Xr(n){let e,l,t,o,r,s,c,i=$e(n[4]),a=[];for(let h=0;h<i.length;h+=1)a[h]=sn(tn(n,i,h));const u=h=>W(a[h],1,1,()=>{a[h]=null});return t=new jr({props:{triggeredBy:`#${n[0]}`,offset:1}}),{c(){e=B("div");for(let h=0;h<a.length;h+=1)a[h].c();l=U(),ie(t.$$.fragment),this.h()},l(h){e=P(h,"DIV",{id:!0,class:!0,role:!0});var p=T(e);for(let b=0;b<a.length;b+=1)a[b].l(p);l=x(p),ae(t.$$.fragment,p),p.forEach(_),this.h()},h(){g(e,"id",n[0]),g(e,"class",o=ve(pe("operation-col column activation",n[1]))+" svelte-cfq6hx"),g(e,"role","group")},m(h,p){G(h,e,p);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);I(e,l),ce(t,e,null),r=!0,s||(c=[ke(e,"mouseenter",n[7]),ke(e,"mouseleave",n[8])],s=!0)},p(h,p){if(p&26){i=$e(h[4]);let N;for(N=0;N<i.length;N+=1){const H=tn(h,i,N);a[N]?(a[N].p(H,p),j(a[N],1)):(a[N]=sn(H),a[N].c(),j(a[N],1),a[N].m(e,l))}for(Ne(),N=i.length;N<a.length;N+=1)u(N);Le()}const b={};p&1&&(b.triggeredBy=`#${h[0]}`),t.$set(b),(!r||p&1)&&g(e,"id",h[0]),(!r||p&2&&o!==(o=ve(pe("operation-col column activation",h[1]))+" svelte-cfq6hx"))&&g(e,"class",o)},i(h){if(!r){for(let p=0;p<i.length;p+=1)j(a[p]);j(t.$$.fragment,h),r=!0}},o(h){a=a.filter(Boolean);for(let p=0;p<a.length;p+=1)W(a[p]);W(t.$$.fragment,h),r=!1},d(h){h&&_(e),Be(a,h),fe(t),s=!1,Fe(c)}}}function ln(n){let e,l;return e=new Ft({props:{id:n[0],className:pe(n[1],{last:n[17]===n[4].length-1}),type:"residual-end",head:n[17]===0,active:n[3]}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,o){const r={};o&1&&(r.id=t[0]),o&18&&(r.className=pe(t[1],{last:t[17]===t[4].length-1})),o&8&&(r.active=t[3]),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function nn(n){let e,l;return e=new Ft({props:{id:n[0],className:pe(n[1],{last:n[17]===n[4].length-1}),type:"residual-start",head:n[17]===0,active:n[3]}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,o){const r={};o&1&&(r.id=t[0]),o&18&&(r.className=pe(t[1],{last:t[17]===t[4].length-1})),o&8&&(r.active=t[3]),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function on(n){let e,l;return e=new Ft({props:{className:pe(n[1],{last:n[17]===n[4].length-1}),type:"ln",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,o){const r={};o&18&&(r.className=pe(t[1],{last:t[17]===t[4].length-1})),o&16&&(r.tail=t[17]===t[4].length-1),o&8&&(r.active=t[3]),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function rn(n){let e,l;return e=new Ft({props:{className:pe(n[1],{last:n[17]===n[4].length-1}),type:"dropout",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,o){const r={};o&18&&(r.className=pe(t[1],{last:t[17]===t[4].length-1})),o&16&&(r.tail=t[17]===t[4].length-1),o&8&&(r.active=t[3]),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function sn(n){let e,l;return e=new Ft({props:{className:pe(n[1],{last:n[17]===n[4].length-1}),type:"activation",tail:n[17]===n[4].length-1,active:n[3]}}),{c(){ie(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,o){ce(e,t,o),l=!0},p(t,o){const r={};o&18&&(r.className=pe(t[1],{last:t[17]===t[4].length-1})),o&16&&(r.tail=t[17]===t[4].length-1),o&8&&(r.active=t[3]),e.$set(r)},i(t){l||(j(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){fe(e,t)}}}function Zr(n){let e,l,t,o;const r=[Xr,Wr,xr,Ur,Fr],s=[];function c(i,a){return i[2]==="activation"?0:i[2]==="dropout"?1:i[2]==="ln"?2:i[2]==="residual-start"?3:i[2]==="residual-end"?4:-1}return~(e=c(n))&&(l=s[e]=r[e](n)),{c(){l&&l.c(),t=mt()},l(i){l&&l.l(i),t=mt()},m(i,a){~e&&s[e].m(i,a),G(i,t,a),o=!0},p(i,[a]){let u=e;e=c(i),e===u?~e&&s[e].p(i,a):(l&&(Ne(),W(s[u],1,1,()=>{s[u]=null}),Le()),~e?(l=s[e],l?l.p(i,a):(l=s[e]=r[e](i),l.c()),j(l,1),l.m(t.parentNode,t)):l=null)},i(i){o||(j(l),o=!0)},o(i){W(l),o=!1},d(i){i&&_(t),~e&&s[e].d(i)}}}function Yr(n,e,l){let t;Ee(n,bt,V=>l(4,t=V));let{id:o}=e,{className:r=void 0}=e,{type:s=void 0}=e,c=!1;const i=()=>{l(3,c=!0);const V=document.querySelector(`#${o}-start`),R=document.querySelector(`#${o}-end`),ee=lt(`.residual-connector.${o}`);ee.style("opacity",1),h(ee),V==null||V.classList.add("active"),R==null||R.classList.add("active")};let a;const u=()=>{l(3,c=!1);const V=document.querySelector(`#${o}-start`),R=document.querySelector(`#${o}-end`),ee=lt(`.residual-connector.${o}`);ee.style("opacity",0),a&&(a.kill(),ee.style("stroke-dashoffset",0)),V==null||V.classList.remove("active"),R==null||R.classList.remove("active")},h=V=>{a=at.to(V.node(),{strokeDashoffset:-50,duration:1,repeat:-1,ease:"none"})},p=()=>{l(3,c=!0)},b=()=>{l(3,c=!1)},N=()=>{l(3,c=!0)},H=()=>{l(3,c=!1)},z=()=>{l(3,c=!0)},F=()=>{l(3,c=!1)};return n.$$set=V=>{"id"in V&&l(0,o=V.id),"className"in V&&l(1,r=V.className),"type"in V&&l(2,s=V.type)},[o,r,s,c,t,i,u,p,b,N,H,z,F]}class pt extends Oe{constructor(e){super(),Ge(this,e,Yr,Zr,je,{id:0,className:1,type:2})}}function an(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function cn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function fn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function un(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function dn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function hn(n,e,l){const t=n.slice();return t[19]=e[l],t[21]=l,t}function pn(n){let e,l="Token";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-6k2z6t"&&(e.textContent=l),this.h()},h(){g(e,"class","subtitle embedding-detail svelte-1iayxn1")},m(t,o){G(t,e,o)},d(t){t&&_(e)}}}function vn(n){let e,l,t=n[19]+"",o;return{c(){e=B("div"),l=B("span"),o=ue(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var s=T(e);l=P(s,"SPAN",{class:!0});var c=T(l);o=de(c,t),c.forEach(_),s.forEach(_),this.h()},h(){g(l,"class","label svelte-1iayxn1"),g(e,"class","cell svelte-1iayxn1"),oe(e,"last",n[21]===n[4].length-1)},m(r,s){G(r,e,s),I(e,l),I(l,o)},p(r,s){s&16&&t!==(t=r[19]+"")&&Ae(o,t),s&16&&oe(e,"last",r[21]===r[4].length-1)},d(r){r&&_(e)}}}function mn(n){let e,l,t,o,r,s="Token<br/>Embedding",c,i,a,u,h,p,b,N,H="Positional<br/>Encoding",z,F,V,R,ee;e=new et({props:{triggeredBy:".embedding .vector",placement:"right",class:"popover",$$slots:{default:[Kr]},$$scope:{ctx:n}}}),c=new gl({props:{id:"token-embedding",$$slots:{default:[Qr]},$$scope:{ctx:n}}});let C=$e(n[4]),q=[];for(let v=0;v<C.length;v+=1)q[v]=gn(dn(n,C,v));const M=v=>W(q[v],1,1,()=>{q[v]=null});let f=$e(n[4]),d=[];for(let v=0;v<f.length;v+=1)d[v]=_n(un(n,f,v));z=new gl({props:{id:"position-embedding",$$slots:{default:[es]},$$scope:{ctx:n}}});let m=$e(n[4]),w=[];for(let v=0;v<m.length;v+=1)w[v]=bn(fn(n,m,v));const k=v=>W(w[v],1,1,()=>{w[v]=null});let y=$e(n[4]),A=[];for(let v=0;v<y.length;v+=1)A[v]=$n(cn(n,y,v));return{c(){ie(e.$$.fragment),l=U(),t=B("div"),o=B("div"),r=B("span"),r.innerHTML=s,ie(c.$$.fragment),i=U();for(let v=0;v<q.length;v+=1)q[v].c();a=U(),u=B("div");for(let v=0;v<d.length;v+=1)d[v].c();h=U(),p=B("div"),b=B("div"),N=B("span"),N.innerHTML=H,ie(z.$$.fragment),F=U();for(let v=0;v<w.length;v+=1)w[v].c();V=U(),R=B("div");for(let v=0;v<A.length;v+=1)A[v].c();this.h()},l(v){ae(e.$$.fragment,v),l=x(v),t=P(v,"DIV",{class:!0});var E=T(t);o=P(E,"DIV",{class:!0});var $=T(o);r=P($,"SPAN",{"data-svelte-h":!0}),Ce(r)!=="svelte-1vtrff3"&&(r.innerHTML=s),ae(c.$$.fragment,$),$.forEach(_),i=x(E);for(let X=0;X<q.length;X+=1)q[X].l(E);E.forEach(_),a=x(v),u=P(v,"DIV",{class:!0});var D=T(u);for(let X=0;X<d.length;X+=1)d[X].l(D);D.forEach(_),h=x(v),p=P(v,"DIV",{class:!0});var L=T(p);b=P(L,"DIV",{class:!0});var S=T(b);N=P(S,"SPAN",{"data-svelte-h":!0}),Ce(N)!=="svelte-12blhrw"&&(N.innerHTML=H),ae(z.$$.fragment,S),S.forEach(_),F=x(L);for(let X=0;X<w.length;X+=1)w[X].l(L);L.forEach(_),V=x(v),R=P(v,"DIV",{class:!0});var O=T(R);for(let X=0;X<A.length;X+=1)A[X].l(O);O.forEach(_),this.h()},h(){g(o,"class","subtitle flex items-center gap-1 svelte-1iayxn1"),g(t,"class","column token-embedding embedding-detail svelte-1iayxn1"),g(u,"class","column symbol embedding-detail svelte-1iayxn1"),g(b,"class","subtitle flex gap-1 svelte-1iayxn1"),g(p,"class","column embedding-detail position-embedding svelte-1iayxn1"),g(R,"class","column symbol embedding-detail svelte-1iayxn1")},m(v,E){ce(e,v,E),G(v,l,E),G(v,t,E),I(t,o),I(o,r),ce(c,o,null),I(t,i);for(let $=0;$<q.length;$+=1)q[$]&&q[$].m(t,null);G(v,a,E),G(v,u,E);for(let $=0;$<d.length;$+=1)d[$]&&d[$].m(u,null);G(v,h,E),G(v,p,E),I(p,b),I(b,N),ce(z,b,null),I(p,F);for(let $=0;$<w.length;$+=1)w[$]&&w[$].m(p,null);G(v,V,E),G(v,R,E);for(let $=0;$<A.length;$+=1)A[$]&&A[$].m(R,null);ee=!0},p(v,E){const $={};E&134217760&&($.$$scope={dirty:E,ctx:v}),e.$set($);const D={};if(E&134217728&&(D.$$scope={dirty:E,ctx:v}),c.$set(D),E&16){C=$e(v[4]);let S;for(S=0;S<C.length;S+=1){const O=dn(v,C,S);q[S]?(q[S].p(O,E),j(q[S],1)):(q[S]=gn(O),q[S].c(),j(q[S],1),q[S].m(t,null))}for(Ne(),S=C.length;S<q.length;S+=1)M(S);Le()}if(E&16){f=$e(v[4]);let S;for(S=0;S<f.length;S+=1){const O=un(v,f,S);d[S]?d[S].p(O,E):(d[S]=_n(),d[S].c(),d[S].m(u,null))}for(;S<d.length;S+=1)d[S].d(1);d.length=f.length}const L={};if(E&134217728&&(L.$$scope={dirty:E,ctx:v}),z.$set(L),E&80){m=$e(v[4]);let S;for(S=0;S<m.length;S+=1){const O=fn(v,m,S);w[S]?(w[S].p(O,E),j(w[S],1)):(w[S]=bn(O),w[S].c(),j(w[S],1),w[S].m(p,null))}for(Ne(),S=m.length;S<w.length;S+=1)k(S);Le()}if(E&16){y=$e(v[4]);let S;for(S=0;S<y.length;S+=1){const O=cn(v,y,S);A[S]?A[S].p(O,E):(A[S]=$n(),A[S].c(),A[S].m(R,null))}for(;S<A.length;S+=1)A[S].d(1);A.length=y.length}},i(v){if(!ee){j(e.$$.fragment,v),j(c.$$.fragment,v);for(let E=0;E<C.length;E+=1)j(q[E]);j(z.$$.fragment,v);for(let E=0;E<m.length;E+=1)j(w[E]);ee=!0}},o(v){W(e.$$.fragment,v),W(c.$$.fragment,v),q=q.filter(Boolean);for(let E=0;E<q.length;E+=1)W(q[E]);W(z.$$.fragment,v),w=w.filter(Boolean);for(let E=0;E<w.length;E+=1)W(w[E]);ee=!1},d(v){v&&(_(l),_(t),_(a),_(u),_(h),_(p),_(V),_(R)),fe(e,v),fe(c),Be(q,v),Be(d,v),fe(z),Be(w,v),Be(A,v)}}}function Kr(n){let e,l=n[5].dimension+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Qr(n){let e;return{c(){e=ue("Token Embedding is")},l(l){e=de(l,"Token Embedding is")},m(l,t){G(l,e,t)},d(l){l&&_(e)}}}function Jr(n){let e,l="id",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(o){e=P(o,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1e13gni"&&(e.textContent=l),t=P(o,"BR",{}),this.h()},h(){g(e,"class","label svelte-1iayxn1")},m(o,r){G(o,e,r),G(o,t,r)},d(o){o&&(_(e),_(t))}}}function gn(n){let e,l,t='<div class="flex flex-col items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 31 9" fill="none" class="w-10 text-gray-300"><path fill="currentColor" d="M30.3886 4.74352C30.5839 4.54826 30.5839 4.23168 30.3886 4.03642L27.2067 0.854435C27.0114 0.659173 26.6948 0.659173 26.4996 0.854435C26.3043 1.0497 26.3043 1.36628 26.4996 1.56154L29.328 4.38997L26.4996 7.2184C26.3043 7.41366 26.3043 7.73024 26.4996 7.9255C26.6948 8.12076 27.0114 8.12076 27.2067 7.9255L30.3886 4.74352ZM0.31958 4.88997H30.0351V3.88997H0.31958V4.88997Z"></path></svg></div>',o,r,s,c,i,a,u,h,p=(Math.random()*1e4).toFixed()+"",b,N,H;c=new vt({props:{active:!0}});let z=n[21]===0&&Jr();return{c(){e=B("div"),l=B("div"),l.innerHTML=t,o=U(),r=B("div"),s=B("div"),ie(c.$$.fragment),i=U(),a=B("span"),z&&z.c(),u=U(),h=B("span"),b=ue(p),N=U(),this.h()},l(F){e=P(F,"DIV",{class:!0});var V=T(e);l=P(V,"DIV",{class:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-lh48yp"&&(l.innerHTML=t),o=x(V),r=P(V,"DIV",{class:!0});var R=T(r);s=P(R,"DIV",{class:!0});var ee=T(s);ae(c.$$.fragment,ee),ee.forEach(_),i=x(R),a=P(R,"SPAN",{class:!0});var C=T(a);z&&z.l(C),u=x(C),h=P(C,"SPAN",{class:!0});var q=T(h);b=de(q,p),q.forEach(_),C.forEach(_),R.forEach(_),N=x(V),V.forEach(_),this.h()},h(){g(l,"class","vocab-index ellipsis flex items-center text-right text-xs text-gray-400 svelte-1iayxn1"),g(s,"class",ve(`vector ${fl}`)+" svelte-1iayxn1"),g(h,"class","val svelte-1iayxn1"),g(a,"class","index-val text-xs svelte-1iayxn1"),g(r,"class","cell flex items-center svelte-1iayxn1"),g(e,"class","token-id flex items-center")},m(F,V){G(F,e,V),I(e,l),I(e,o),I(e,r),I(r,s),ce(c,s,null),I(r,i),I(r,a),z&&z.m(a,null),I(a,u),I(a,h),I(h,b),I(e,N),H=!0},p:He,i(F){H||(j(c.$$.fragment,F),H=!0)},o(F){W(c.$$.fragment,F),H=!1},d(F){F&&_(e),fe(c),z&&z.d()}}}function _n(n){let e,l="+";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-124y0va"&&(e.textContent=l),this.h()},h(){g(e,"class","cell svelte-1iayxn1")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function es(n){let e;return{c(){e=ue("Positional Embedding is")},l(l){e=de(l,"Positional Embedding is")},m(l,t){G(l,e,t)},d(l){l&&_(e)}}}function ts(n){let e,l="position",t;return{c(){e=B("span"),e.textContent=l,t=B("br"),this.h()},l(o){e=P(o,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-4n0g90"&&(e.textContent=l),t=P(o,"BR",{}),this.h()},h(){g(e,"class","label svelte-1iayxn1")},m(o,r){G(o,e,r),G(o,t,r)},d(o){o&&(_(e),_(t))}}}function bn(n){let e,l,t,o,r,s,c,i,a,u;t=new vt({props:{active:!0,colorScale:n[12]}});let h=n[21]===0&&ts();return{c(){e=B("div"),l=B("div"),ie(t.$$.fragment),o=U(),r=B("span"),h&&h.c(),s=U(),c=B("span"),i=ue(n[21]),a=U(),this.h()},l(p){e=P(p,"DIV",{class:!0});var b=T(e);l=P(b,"DIV",{class:!0});var N=T(l);ae(t.$$.fragment,N),N.forEach(_),o=x(b),r=P(b,"SPAN",{class:!0});var H=T(r);h&&h.l(H),s=x(H),c=P(H,"SPAN",{class:!0});var z=T(c);i=de(z,n[21]),z.forEach(_),H.forEach(_),a=x(b),b.forEach(_),this.h()},h(){g(l,"class",ve(`vector ${fl}`)+" svelte-1iayxn1"),g(c,"class","val svelte-1iayxn1"),g(r,"class","index-val text-xs svelte-1iayxn1"),g(e,"class","cell flex items-center svelte-1iayxn1")},m(p,b){G(p,e,b),I(e,l),ce(t,l,null),I(e,o),I(e,r),h&&h.m(r,null),I(r,s),I(r,c),I(c,i),I(e,a),u=!0},p:He,i(p){u||(j(t.$$.fragment,p),u=!0)},o(p){W(t.$$.fragment,p),u=!1},d(p){p&&_(e),fe(t),h&&h.d()}}}function $n(n){let e,l="=";return{c(){e=B("div"),e.textContent=l,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1btrmmo"&&(e.textContent=l),this.h()},h(){g(e,"class","cell svelte-1iayxn1")},m(t,o){G(t,e,o)},p:He,d(t){t&&_(e)}}}function ls(n){let e,l=n[5].dimension+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function wn(n){let e,l,t,o,r;return l=new vt({props:{active:n[3]||n[1]}}),o=new et({props:{placement:"right",class:"popover",$$slots:{default:[ls]},$$scope:{ctx:n}}}),{c(){e=B("div"),ie(l.$$.fragment),t=U(),ie(o.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var c=T(e);ae(l.$$.fragment,c),c.forEach(_),t=x(s),ae(o.$$.fragment,s),this.h()},h(){g(e,"class",ve(`vector ${fl}`)+" svelte-1iayxn1"),oe(e,"last",n[21]===n[4].length-1)},m(s,c){G(s,e,c),ce(l,e,null),G(s,t,c),ce(o,s,c),r=!0},p(s,c){const i={};c&10&&(i.active=s[3]||s[1]),l.$set(i),(!r||c&16)&&oe(e,"last",s[21]===s[4].length-1);const a={};c&134217760&&(a.$$scope={dirty:c,ctx:s}),o.$set(a)},i(s){r||(j(l.$$.fragment,s),j(o.$$.fragment,s),r=!0)},o(s){W(l.$$.fragment,s),W(o.$$.fragment,s),r=!1},d(s){s&&(_(e),_(t)),fe(l),fe(o,s)}}}function ns(n){let e,l,t="<div>Embedding</div>",o,r,s,c,i,a,u,h,p,b,N,H,z,F,V,R,ee,C,q,M,f,d,m=n[1]&&pn(),w=$e(n[4]),k=[];for(let $=0;$<w.length;$+=1)k[$]=vn(hn(n,w,$));let y=n[1]&&mn(n),A=$e(n[4]),v=[];for(let $=0;$<A.length;$+=1)v[$]=wn(an(n,A,$));const E=$=>W(v[$],1,1,()=>{v[$]=null});return F=new pt({props:{type:"dropout",id:"embedding-dropout"}}),R=new pt({props:{type:"residual-start",id:"residual-first"}}),C=new pt({props:{type:"ln",id:"embedding-ln"}}),{c(){e=B("div"),l=B("div"),l.innerHTML=t,o=U(),r=B("div"),s=B("div"),c=B("div"),m&&m.c(),i=U();for(let $=0;$<k.length;$+=1)k[$].c();a=U(),u=B("div"),h=U(),y&&y.c(),p=U(),b=B("div"),N=B("div");for(let $=0;$<v.length;$+=1)v[$].c();H=U(),z=B("div"),ie(F.$$.fragment),V=U(),ie(R.$$.fragment),ee=U(),ie(C.$$.fragment),this.h()},l($){e=P($,"DIV",{class:!0,role:!0});var D=T(e);l=P(D,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-szi5cj"&&(l.innerHTML=t),o=x(D),r=P(D,"DIV",{class:!0});var L=T(r);s=P(L,"DIV",{class:!0});var S=T(s);c=P(S,"DIV",{class:!0});var O=T(c);m&&m.l(O),i=x(O);for(let se=0;se<k.length;se+=1)k[se].l(O);a=x(O),u=P(O,"DIV",{class:!0}),T(u).forEach(_),O.forEach(_),h=x(S),y&&y.l(S),S.forEach(_),p=x(L),b=P(L,"DIV",{class:!0});var X=T(b);N=P(X,"DIV",{class:!0});var he=T(N);for(let se=0;se<v.length;se+=1)v[se].l(he);he.forEach(_),H=x(X),z=P(X,"DIV",{class:!0});var J=T(z);ae(F.$$.fragment,J),V=x(J),ae(R.$$.fragment,J),ee=x(J),ae(C.$$.fragment,J),J.forEach(_),X.forEach(_),L.forEach(_),D.forEach(_),this.h()},h(){g(l,"class","title expandable svelte-1iayxn1"),g(l,"role","none"),g(u,"class","bounding embedding-bounding svelte-1iayxn1"),oe(u,"active",n[3]&&!n[1]),g(c,"class","column token-string relative svelte-1iayxn1"),g(s,"class","token-column resizable resize-watch flex"),g(N,"class","column vectors svelte-1iayxn1"),g(z,"class","operations flex svelte-1iayxn1"),g(b,"class","vector-column relative flex"),g(r,"class","content relative svelte-1iayxn1"),g(e,"class",q=ve(pe("embedding",n[0],{expanded:n[1]}))+" svelte-1iayxn1"),g(e,"role","none")},m($,D){G($,e,D),I(e,l),I(e,o),I(e,r),I(r,s),I(s,c),m&&m.m(c,null),I(c,i);for(let L=0;L<k.length;L+=1)k[L]&&k[L].m(c,null);I(c,a),I(c,u),I(s,h),y&&y.m(s,null),I(r,p),I(r,b),I(b,N);for(let L=0;L<v.length;L+=1)v[L]&&v[L].m(N,null);I(b,H),I(b,z),ce(F,z,null),I(z,V),ce(R,z,null),I(z,ee),ce(C,z,null),n[13](e),M=!0,f||(d=[ke(l,"click",n[8]),ke(l,"keydown",n[8]),ke(l,"mouseenter",n[9]),ke(l,"mouseleave",n[10]),ke(e,"click",n[7]),ke(e,"keydown",n[7])],f=!0)},p($,[D]){if($[1]?m||(m=pn(),m.c(),m.m(c,i)):m&&(m.d(1),m=null),D&16){w=$e($[4]);let L;for(L=0;L<w.length;L+=1){const S=hn($,w,L);k[L]?k[L].p(S,D):(k[L]=vn(S),k[L].c(),k[L].m(c,a))}for(;L<k.length;L+=1)k[L].d(1);k.length=w.length}if((!M||D&10)&&oe(u,"active",$[3]&&!$[1]),$[1]?y?(y.p($,D),D&2&&j(y,1)):(y=mn($),y.c(),j(y,1),y.m(s,null)):y&&(Ne(),W(y,1,1,()=>{y=null}),Le()),D&58){A=$e($[4]);let L;for(L=0;L<A.length;L+=1){const S=an($,A,L);v[L]?(v[L].p(S,D),j(v[L],1)):(v[L]=wn(S),v[L].c(),j(v[L],1),v[L].m(N,null))}for(Ne(),L=A.length;L<v.length;L+=1)E(L);Le()}(!M||D&3&&q!==(q=ve(pe("embedding",$[0],{expanded:$[1]}))+" svelte-1iayxn1"))&&g(e,"class",q)},i($){if(!M){j(y);for(let D=0;D<A.length;D+=1)j(v[D]);j(F.$$.fragment,$),j(R.$$.fragment,$),j(C.$$.fragment,$),M=!0}},o($){W(y),v=v.filter(Boolean);for(let D=0;D<v.length;D+=1)W(v[D]);W(F.$$.fragment,$),W(R.$$.fragment,$),W(C.$$.fragment,$),M=!1},d($){$&&_(e),m&&m.d(),Be(k,$),y&&y.d(),Be(v,$),fe(F),fe(R),fe(C),n[13](null),f=!1,Fe(d)}}}const fl="bg-gray-300";function os(n,e,l){let t,o,r;Ee(n,xe,q=>l(11,t=q)),Ee(n,bt,q=>l(4,o=q)),Ee(n,Bt,q=>l(5,r=q));const{theme:s}=It(Dt);let{className:c=void 0}=e;Jt("block-id","embedding");const i=Qt("block-id");let a=!1;const u=()=>{a||(xe.set({id:i}),H())},h=q=>{q.stopPropagation(),q.preventDefault(),a?(xe.set({id:null}),z()):(xe.set({id:i}),H())};let p;function b(q){a&&!p.contains(q.target)&&xe.set({id:null})}_t(()=>(document.body.addEventListener("click",b),()=>{document.body.removeEventListener("click",b)}));let N;const H=async()=>{N=Et.Flip.getState(".embedding .token-column"),l(1,a=!0),await zt(),Et.Flip.from(N,{duration:.5,ease:"power2.inOut"}),at.to(".embedding-detail",{opacity:1,duration:.5,delay:.5})},z=async()=>{N=Et.Flip.getState(".embedding .token-column"),l(1,a=!1),await zt(),Et.Flip.from(N,{duration:.5,ease:"power2.inOut"})};let F=!1;function V(){l(3,F=!0)}function R(){l(3,F=!1)}const ee=(q,M)=>Fn().domain([0,.5,1]).range([s.colors.red[400],"white",s.colors.blue[400]])(q);function C(q){Je[q?"unshift":"push"](()=>{p=q,l(2,p)})}return n.$$set=q=>{"className"in q&&l(0,c=q.className)},n.$$.update=()=>{n.$$.dirty&2050&&t.id!==i&&a&&(l(1,a=!1),z())},[c,a,p,F,o,r,s,u,h,V,R,t,ee,C]}class rs extends Oe{constructor(e){super(),Ge(this,e,os,ns,je,{className:0})}}function kn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function yn(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function En(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function In(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function ss(n){let e,l=n[5].dimension+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Dn(n){let e,l,t=n[10]+"",o,r,s,c,i,a,u,h,p,b,N,H,z;c=new vt({props:{colorScale:"purple",active:n[2]===n[12]}});function F(){return n[8](n[12])}return b=new et({props:{placement:"right",class:"popover",$$slots:{default:[ss]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("span"),o=ue(t),r=U(),s=B("div"),ie(c.$$.fragment),i=U(),a=B("div"),u=U(),h=B("div"),p=U(),ie(b.$$.fragment),this.h()},l(V){e=P(V,"DIV",{class:!0,role:!0});var R=T(e);l=P(R,"SPAN",{class:!0});var ee=T(l);o=de(ee,t),ee.forEach(_),r=x(R),s=P(R,"DIV",{class:!0});var C=T(s);ae(c.$$.fragment,C),i=x(C),a=P(C,"DIV",{class:!0}),T(a).forEach(_),u=x(C),h=P(C,"DIV",{class:!0}),T(h).forEach(_),C.forEach(_),R.forEach(_),p=x(V),ae(b.$$.fragment,V),this.h()},h(){g(l,"class","label float svelte-13p50c2"),g(a,"class","sub-vector x1-12 head1"),g(h,"class","sub-vector head-rest grow"),g(s,"class",ve(`vector flex flex-col  ${fs}`)+" svelte-13p50c2"),g(e,"class","cell"),g(e,"role","group"),oe(e,"last",n[12]===n[4].length-1)},m(V,R){G(V,e,R),I(e,l),I(l,o),I(e,r),I(e,s),ce(c,s,null),I(s,i),I(s,a),I(s,u),I(s,h),G(V,p,R),ce(b,V,R),N=!0,H||(z=[ke(e,"mouseenter",F),ke(e,"mouseleave",n[9])],H=!0)},p(V,R){n=V,(!N||R&16)&&t!==(t=n[10]+"")&&Ae(o,t);const ee={};R&4&&(ee.active=n[2]===n[12]),c.$set(ee),(!N||R&16)&&oe(e,"last",n[12]===n[4].length-1);const C={};R&65568&&(C.$$scope={dirty:R,ctx:n}),b.$set(C)},i(V){N||(j(c.$$.fragment,V),j(b.$$.fragment,V),N=!0)},o(V){W(c.$$.fragment,V),W(b.$$.fragment,V),N=!1},d(V){V&&(_(e),_(p)),fe(c),fe(b,V),H=!1,Fe(z)}}}function is(n){let e,l=n[5].dimension*4+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension*4+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function qn(n){let e,l,t,o,r,s,c;return t=new vt({props:{colorScale:"indigo"}}),s=new et({props:{placement:"right",class:"popover",$$slots:{default:[is]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),ie(t.$$.fragment),r=U(),ie(s.$$.fragment),this.h()},l(i){e=P(i,"DIV",{class:!0});var a=T(e);l=P(a,"DIV",{class:!0});var u=T(l);ae(t.$$.fragment,u),u.forEach(_),a.forEach(_),r=x(i),ae(s.$$.fragment,i),this.h()},h(){g(l,"class",ve(pe(`vector x4 ${us} opacity-80`))+" svelte-13p50c2"),g(e,"class",o=ve(pe("cell x4",{small:n[12]!==0&&n[12]!==n[4].length-1}))+" svelte-13p50c2"),oe(e,"last",n[12]===n[4].length-1)},m(i,a){G(i,e,a),I(e,l),ce(t,l,null),G(i,r,a),ce(s,i,a),c=!0},p(i,a){(!c||a&16&&o!==(o=ve(pe("cell x4",{small:i[12]!==0&&i[12]!==i[4].length-1}))+" svelte-13p50c2"))&&g(e,"class",o),(!c||a&16)&&oe(e,"last",i[12]===i[4].length-1);const u={};a&65568&&(u.$$scope={dirty:a,ctx:i}),s.$set(u)},i(i){c||(j(t.$$.fragment,i),j(s.$$.fragment,i),c=!0)},o(i){W(t.$$.fragment,i),W(s.$$.fragment,i),c=!1},d(i){i&&(_(e),_(r)),fe(t),fe(s,i)}}}function Cn(n){let e,l,t=n[10]+"",o,r;return{c(){e=B("div"),l=B("span"),o=ue(t),r=U(),this.h()},l(s){e=P(s,"DIV",{class:!0});var c=T(e);l=P(c,"SPAN",{class:!0});var i=T(l);o=de(i,t),i.forEach(_),r=x(c),c.forEach(_),this.h()},h(){g(l,"class","label float svelte-13p50c2"),g(e,"class","cell"),oe(e,"last",n[12]===n[4].length-1)},m(s,c){G(s,e,c),I(e,l),I(l,o),I(e,r)},p(s,c){c&16&&t!==(t=s[10]+"")&&Ae(o,t),c&16&&oe(e,"last",s[12]===s[4].length-1)},d(s){s&&_(e)}}}function as(n){let e,l=n[5].dimension+"",t,o;return{c(){e=ue("vector("),t=ue(l),o=ue(")")},l(r){e=de(r,"vector("),t=de(r,l),o=de(r,")")},m(r,s){G(r,e,s),G(r,t,s),G(r,o,s)},p(r,s){s&32&&l!==(l=r[5].dimension+"")&&Ae(t,l)},d(r){r&&(_(e),_(t),_(o))}}}function Sn(n){let e,l,t,o,r,s;return t=new vt({props:{colorScale:"blue"}}),r=new et({props:{placement:"right",class:"popover",$$slots:{default:[as]},$$scope:{ctx:n}}}),{c(){e=B("div"),l=B("div"),ie(t.$$.fragment),o=U(),ie(r.$$.fragment),this.h()},l(c){e=P(c,"DIV",{class:!0});var i=T(e);l=P(i,"DIV",{class:!0});var a=T(l);ae(t.$$.fragment,a),a.forEach(_),i.forEach(_),o=x(c),ae(r.$$.fragment,c),this.h()},h(){g(l,"class",ve(`vector ${ds}`)+" svelte-13p50c2"),g(e,"class","cell"),oe(e,"last",n[12]===n[4].length-1)},m(c,i){G(c,e,i),I(e,l),ce(t,l,null),G(c,o,i),ce(r,c,i),s=!0},p(c,i){(!s||i&16)&&oe(e,"last",c[12]===c[4].length-1);const a={};i&65568&&(a.$$scope={dirty:i,ctx:c}),r.$set(a)},i(c){s||(j(t.$$.fragment,c),j(r.$$.fragment,c),s=!0)},o(c){W(t.$$.fragment,c),W(r.$$.fragment,c),s=!1},d(c){c&&(_(e),_(o)),fe(t),fe(r,c)}}}function cs(n){let e,l,t="MLP",o,r,s,c,i,a,u,h,p,b,N,H,z,F,V,R,ee,C,q,M,f,d,m,w,k,y,A,v,E,$,D,L,S,O,X,he=$e(n[4]),J=[];for(let Y=0;Y<he.length;Y+=1)J[Y]=Dn(In(n,he,Y));const se=Y=>W(J[Y],1,1,()=>{J[Y]=null});b=new pt({props:{type:"dropout",id:"mlp-first-dropout"}}),H=new pt({props:{type:"residual-end",id:"residual-first"}}),F=new pt({props:{type:"ln",id:"mlp-first-ln"}}),R=new pt({props:{type:"residual-start",id:"residual-second"}});let _e=$e(n[4]),le=[];for(let Y=0;Y<_e.length;Y+=1)le[Y]=qn(En(n,_e,Y));const Xe=Y=>W(le[Y],1,1,()=>{le[Y]=null});d=new pt({props:{type:"activation",id:"mlp-activation",className:"x4"}});let Q=$e(n[4]),te=[];for(let Y=0;Y<Q.length;Y+=1)te[Y]=Cn(yn(n,Q,Y));A=new pt({props:{type:"residual-end",id:"residual-second"}}),E=new pt({props:{type:"ln",id:"mlp-second-ln"}});let Z=$e(n[4]),me=[];for(let Y=0;Y<Z.length;Y+=1)me[Y]=Sn(kn(n,Z,Y));const Pe=Y=>W(me[Y],1,1,()=>{me[Y]=null});return{c(){e=B("div"),l=B("div"),l.textContent=t,o=U(),r=B("div"),s=B("div"),c=U(),i=B("div"),a=U(),u=B("div"),h=B("div");for(let Y=0;Y<J.length;Y+=1)J[Y].c();p=U(),ie(b.$$.fragment),N=U(),ie(H.$$.fragment),z=U(),ie(F.$$.fragment),V=U(),ie(R.$$.fragment),ee=U(),C=B("div"),q=B("div"),M=B("div");for(let Y=0;Y<le.length;Y+=1)le[Y].c();f=U(),ie(d.$$.fragment),m=U(),w=B("div"),k=B("div");for(let Y=0;Y<te.length;Y+=1)te[Y].c();y=U(),ie(A.$$.fragment),v=U(),ie(E.$$.fragment),$=U(),D=B("div");for(let Y=0;Y<me.length;Y+=1)me[Y].c();this.h()},l(Y){e=P(Y,"DIV",{class:!0});var ne=T(e);l=P(ne,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),Ce(l)!=="svelte-50ab67"&&(l.textContent=t),o=x(ne),r=P(ne,"DIV",{class:!0});var K=T(r);s=P(K,"DIV",{class:!0}),T(s).forEach(_),c=x(K),i=P(K,"DIV",{class:!0}),T(i).forEach(_),a=x(K),u=P(K,"DIV",{class:!0});var ye=T(u);h=P(ye,"DIV",{class:!0});var tt=T(h);for(let Ve=0;Ve<J.length;Ve+=1)J[Ve].l(tt);tt.forEach(_),p=x(ye),ae(b.$$.fragment,ye),N=x(ye),ae(H.$$.fragment,ye),z=x(ye),ae(F.$$.fragment,ye),V=x(ye),ae(R.$$.fragment,ye),ye.forEach(_),ee=x(K),C=P(K,"DIV",{class:!0});var Se=T(C);q=P(Se,"DIV",{class:!0});var ct=T(q);M=P(ct,"DIV",{class:!0});var ft=T(M);for(let Ve=0;Ve<le.length;Ve+=1)le[Ve].l(ft);ft.forEach(_),f=x(ct),ae(d.$$.fragment,ct),ct.forEach(_),m=x(Se),w=P(Se,"DIV",{class:!0});var Ze=T(w);k=P(Ze,"DIV",{class:!0});var ut=T(k);for(let Ve=0;Ve<te.length;Ve+=1)te[Ve].l(ut);ut.forEach(_),y=x(Ze),ae(A.$$.fragment,Ze),v=x(Ze),ae(E.$$.fragment,Ze),$=x(Ze),D=P(Ze,"DIV",{class:!0});var dt=T(D);for(let Ve=0;Ve<me.length;Ve+=1)me[Ve].l(dt);dt.forEach(_),Ze.forEach(_),Se.forEach(_),K.forEach(_),ne.forEach(_),this.h()},h(){g(l,"class","title"),g(l,"role","group"),g(s,"class","bounding transformer-bounding svelte-13p50c2"),oe(s,"active",n[3]),g(i,"class","bounding mlp-bounding svelte-13p50c2"),oe(i,"active",n[1]),g(h,"class","column initial"),g(u,"class","layer first-layer flex svelte-13p50c2"),g(M,"class","column"),g(q,"class","projections flex"),g(k,"class","column out-label"),g(D,"class","column out"),g(w,"class","ouputs flex"),g(C,"class","layer second-layer flex justify-between svelte-13p50c2"),g(r,"class","content relative svelte-13p50c2"),g(e,"class",L=ve(pe("mlp",n[0]))+" svelte-13p50c2")},m(Y,ne){G(Y,e,ne),I(e,l),I(e,o),I(e,r),I(r,s),I(r,c),I(r,i),I(r,a),I(r,u),I(u,h);for(let K=0;K<J.length;K+=1)J[K]&&J[K].m(h,null);I(u,p),ce(b,u,null),I(u,N),ce(H,u,null),I(u,z),ce(F,u,null),I(u,V),ce(R,u,null),I(r,ee),I(r,C),I(C,q),I(q,M);for(let K=0;K<le.length;K+=1)le[K]&&le[K].m(M,null);I(q,f),ce(d,q,null),I(C,m),I(C,w),I(w,k);for(let K=0;K<te.length;K+=1)te[K]&&te[K].m(k,null);I(w,y),ce(A,w,null),I(w,v),ce(E,w,null),I(w,$),I(w,D);for(let K=0;K<me.length;K+=1)me[K]&&me[K].m(D,null);S=!0,O||(X=[ke(l,"mouseenter",n[6]),ke(l,"mouseleave",n[7])],O=!0)},p(Y,[ne]){if((!S||ne&8)&&oe(s,"active",Y[3]),(!S||ne&2)&&oe(i,"active",Y[1]),ne&52){he=$e(Y[4]);let K;for(K=0;K<he.length;K+=1){const ye=In(Y,he,K);J[K]?(J[K].p(ye,ne),j(J[K],1)):(J[K]=Dn(ye),J[K].c(),j(J[K],1),J[K].m(h,null))}for(Ne(),K=he.length;K<J.length;K+=1)se(K);Le()}if(ne&48){_e=$e(Y[4]);let K;for(K=0;K<_e.length;K+=1){const ye=En(Y,_e,K);le[K]?(le[K].p(ye,ne),j(le[K],1)):(le[K]=qn(ye),le[K].c(),j(le[K],1),le[K].m(M,null))}for(Ne(),K=_e.length;K<le.length;K+=1)Xe(K);Le()}if(ne&16){Q=$e(Y[4]);let K;for(K=0;K<Q.length;K+=1){const ye=yn(Y,Q,K);te[K]?te[K].p(ye,ne):(te[K]=Cn(ye),te[K].c(),te[K].m(k,null))}for(;K<te.length;K+=1)te[K].d(1);te.length=Q.length}if(ne&48){Z=$e(Y[4]);let K;for(K=0;K<Z.length;K+=1){const ye=kn(Y,Z,K);me[K]?(me[K].p(ye,ne),j(me[K],1)):(me[K]=Sn(ye),me[K].c(),j(me[K],1),me[K].m(D,null))}for(Ne(),K=Z.length;K<me.length;K+=1)Pe(K);Le()}(!S||ne&1&&L!==(L=ve(pe("mlp",Y[0]))+" svelte-13p50c2"))&&g(e,"class",L)},i(Y){if(!S){for(let ne=0;ne<he.length;ne+=1)j(J[ne]);j(b.$$.fragment,Y),j(H.$$.fragment,Y),j(F.$$.fragment,Y),j(R.$$.fragment,Y);for(let ne=0;ne<_e.length;ne+=1)j(le[ne]);j(d.$$.fragment,Y),j(A.$$.fragment,Y),j(E.$$.fragment,Y);for(let ne=0;ne<Z.length;ne+=1)j(me[ne]);S=!0}},o(Y){J=J.filter(Boolean);for(let ne=0;ne<J.length;ne+=1)W(J[ne]);W(b.$$.fragment,Y),W(H.$$.fragment,Y),W(F.$$.fragment,Y),W(R.$$.fragment,Y),le=le.filter(Boolean);for(let ne=0;ne<le.length;ne+=1)W(le[ne]);W(d.$$.fragment,Y),W(A.$$.fragment,Y),W(E.$$.fragment,Y),me=me.filter(Boolean);for(let ne=0;ne<me.length;ne+=1)W(me[ne]);S=!1},d(Y){Y&&_(e),Be(J,Y),fe(b),fe(H),fe(F),fe(R),Be(le,Y),fe(d),Be(te,Y),fe(A),fe(E),Be(me,Y),O=!1,Fe(X)}}}const fs="bg-purple-200",us="bg-indigo-200",ds="bg-blue-200";function hs(n,e,l){let t,o,r;Ee(n,Gt,b=>l(3,t=b)),Ee(n,bt,b=>l(4,o=b)),Ee(n,Bt,b=>l(5,r=b));let{className:s=void 0}=e;Jt("block-id","mlp");let c=!1;function i(){l(1,c=!0)}function a(){l(1,c=!1)}let u=null;const h=b=>{l(2,u=b)},p=()=>{l(2,u=null)};return n.$$set=b=>{"className"in b&&l(0,s=b.className)},[s,c,u,t,o,r,i,a,h,p]}class ps extends Oe{constructor(e){super(),Ge(this,e,hs,cs,je,{className:0})}}var vs=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,nl=Math.ceil,ot=Math.floor,Qe="[BigNumber Error] ",Vn=Qe+"Number primitive has more than 15 significant digits: ",st=1e14,we=14,ol=9007199254740991,rl=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],kt=1e7,ze=1e9;function Xn(n){var e,l,t,o=V.prototype={constructor:V,toString:null,valueOf:null},r=new V(1),s=20,c=4,i=-7,a=21,u=-1e7,h=1e7,p=!1,b=1,N=0,H={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},z="0123456789abcdefghijklmnopqrstuvwxyz",F=!0;function V(f,d){var m,w,k,y,A,v,E,$,D=this;if(!(D instanceof V))return new V(f,d);if(d==null){if(f&&f._isBigNumber===!0){D.s=f.s,!f.c||f.e>h?D.c=D.e=null:f.e<u?D.c=[D.e=0]:(D.e=f.e,D.c=f.c.slice());return}if((v=typeof f=="number")&&f*0==0){if(D.s=1/f<0?(f=-f,-1):1,f===~~f){for(y=0,A=f;A>=10;A/=10,y++);y>h?D.c=D.e=null:(D.e=y,D.c=[f]);return}$=String(f)}else{if(!vs.test($=String(f)))return t(D,$,v);D.s=$.charCodeAt(0)==45?($=$.slice(1),-1):1}(y=$.indexOf("."))>-1&&($=$.replace(".","")),(A=$.search(/e/i))>0?(y<0&&(y=A),y+=+$.slice(A+1),$=$.substring(0,A)):y<0&&(y=$.length)}else{if(Te(d,2,z.length,"Base"),d==10&&F)return D=new V(f),q(D,s+D.e+1,c);if($=String(f),v=typeof f=="number"){if(f*0!=0)return t(D,$,v,d);if(D.s=1/f<0?($=$.slice(1),-1):1,V.DEBUG&&$.replace(/^0\.0*|\./,"").length>15)throw Error(Vn+f)}else D.s=$.charCodeAt(0)===45?($=$.slice(1),-1):1;for(m=z.slice(0,d),y=A=0,E=$.length;A<E;A++)if(m.indexOf(w=$.charAt(A))<0){if(w=="."){if(A>y){y=E;continue}}else if(!k&&($==$.toUpperCase()&&($=$.toLowerCase())||$==$.toLowerCase()&&($=$.toUpperCase()))){k=!0,A=-1,y=0;continue}return t(D,String(f),v,d)}v=!1,$=l($,d,10,D.s),(y=$.indexOf("."))>-1?$=$.replace(".",""):y=$.length}for(A=0;$.charCodeAt(A)===48;A++);for(E=$.length;$.charCodeAt(--E)===48;);if($=$.slice(A,++E)){if(E-=A,v&&V.DEBUG&&E>15&&(f>ol||f!==ot(f)))throw Error(Vn+D.s*f);if((y=y-A-1)>h)D.c=D.e=null;else if(y<u)D.c=[D.e=0];else{if(D.e=y,D.c=[],A=(y+1)%we,y<0&&(A+=we),A<E){for(A&&D.c.push(+$.slice(0,A)),E-=we;A<E;)D.c.push(+$.slice(A,A+=we));A=we-($=$.slice(A)).length}else A-=E;for(;A--;$+="0");D.c.push(+$)}}else D.c=[D.e=0]}V.clone=Xn,V.ROUND_UP=0,V.ROUND_DOWN=1,V.ROUND_CEIL=2,V.ROUND_FLOOR=3,V.ROUND_HALF_UP=4,V.ROUND_HALF_DOWN=5,V.ROUND_HALF_EVEN=6,V.ROUND_HALF_CEIL=7,V.ROUND_HALF_FLOOR=8,V.EUCLID=9,V.config=V.set=function(f){var d,m;if(f!=null)if(typeof f=="object"){if(f.hasOwnProperty(d="DECIMAL_PLACES")&&(m=f[d],Te(m,0,ze,d),s=m),f.hasOwnProperty(d="ROUNDING_MODE")&&(m=f[d],Te(m,0,8,d),c=m),f.hasOwnProperty(d="EXPONENTIAL_AT")&&(m=f[d],m&&m.pop?(Te(m[0],-ze,0,d),Te(m[1],0,ze,d),i=m[0],a=m[1]):(Te(m,-ze,ze,d),i=-(a=m<0?-m:m))),f.hasOwnProperty(d="RANGE"))if(m=f[d],m&&m.pop)Te(m[0],-ze,-1,d),Te(m[1],1,ze,d),u=m[0],h=m[1];else if(Te(m,-ze,ze,d),m)u=-(h=m<0?-m:m);else throw Error(Qe+d+" cannot be zero: "+m);if(f.hasOwnProperty(d="CRYPTO"))if(m=f[d],m===!!m)if(m)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))p=m;else throw p=!m,Error(Qe+"crypto unavailable");else p=m;else throw Error(Qe+d+" not true or false: "+m);if(f.hasOwnProperty(d="MODULO_MODE")&&(m=f[d],Te(m,0,9,d),b=m),f.hasOwnProperty(d="POW_PRECISION")&&(m=f[d],Te(m,0,ze,d),N=m),f.hasOwnProperty(d="FORMAT"))if(m=f[d],typeof m=="object")H=m;else throw Error(Qe+d+" not an object: "+m);if(f.hasOwnProperty(d="ALPHABET"))if(m=f[d],typeof m=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(m))F=m.slice(0,10)=="0123456789",z=m;else throw Error(Qe+d+" invalid: "+m)}else throw Error(Qe+"Object expected: "+f);return{DECIMAL_PLACES:s,ROUNDING_MODE:c,EXPONENTIAL_AT:[i,a],RANGE:[u,h],CRYPTO:p,MODULO_MODE:b,POW_PRECISION:N,FORMAT:H,ALPHABET:z}},V.isBigNumber=function(f){if(!f||f._isBigNumber!==!0)return!1;if(!V.DEBUG)return!0;var d,m,w=f.c,k=f.e,y=f.s;e:if({}.toString.call(w)=="[object Array]"){if((y===1||y===-1)&&k>=-ze&&k<=ze&&k===ot(k)){if(w[0]===0){if(k===0&&w.length===1)return!0;break e}if(d=(k+1)%we,d<1&&(d+=we),String(w[0]).length==d){for(d=0;d<w.length;d++)if(m=w[d],m<0||m>=st||m!==ot(m))break e;if(m!==0)return!0}}}else if(w===null&&k===null&&(y===null||y===1||y===-1))return!0;throw Error(Qe+"Invalid BigNumber: "+f)},V.maximum=V.max=function(){return ee(arguments,-1)},V.minimum=V.min=function(){return ee(arguments,1)},V.random=function(){var f=9007199254740992,d=Math.random()*f&2097151?function(){return ot(Math.random()*f)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(m){var w,k,y,A,v,E=0,$=[],D=new V(r);if(m==null?m=s:Te(m,0,ze),A=nl(m/we),p)if(crypto.getRandomValues){for(w=crypto.getRandomValues(new Uint32Array(A*=2));E<A;)v=w[E]*131072+(w[E+1]>>>11),v>=9e15?(k=crypto.getRandomValues(new Uint32Array(2)),w[E]=k[0],w[E+1]=k[1]):($.push(v%1e14),E+=2);E=A/2}else if(crypto.randomBytes){for(w=crypto.randomBytes(A*=7);E<A;)v=(w[E]&31)*281474976710656+w[E+1]*1099511627776+w[E+2]*4294967296+w[E+3]*16777216+(w[E+4]<<16)+(w[E+5]<<8)+w[E+6],v>=9e15?crypto.randomBytes(7).copy(w,E):($.push(v%1e14),E+=7);E=A/7}else throw p=!1,Error(Qe+"crypto unavailable");if(!p)for(;E<A;)v=d(),v<9e15&&($[E++]=v%1e14);for(A=$[--E],m%=we,A&&m&&(v=rl[we-m],$[E]=ot(A/v)*v);$[E]===0;$.pop(),E--);if(E<0)$=[y=0];else{for(y=-1;$[0]===0;$.splice(0,1),y-=we);for(E=1,v=$[0];v>=10;v/=10,E++);E<we&&(y-=we-E)}return D.e=y,D.c=$,D}}(),V.sum=function(){for(var f=1,d=arguments,m=new V(d[0]);f<d.length;)m=m.plus(d[f++]);return m},l=function(){var f="0123456789";function d(m,w,k,y){for(var A,v=[0],E,$=0,D=m.length;$<D;){for(E=v.length;E--;v[E]*=w);for(v[0]+=y.indexOf(m.charAt($++)),A=0;A<v.length;A++)v[A]>k-1&&(v[A+1]==null&&(v[A+1]=0),v[A+1]+=v[A]/k|0,v[A]%=k)}return v.reverse()}return function(m,w,k,y,A){var v,E,$,D,L,S,O,X,he=m.indexOf("."),J=s,se=c;for(he>=0&&(D=N,N=0,m=m.replace(".",""),X=new V(w),S=X.pow(m.length-he),N=D,X.c=d(gt(nt(S.c),S.e,"0"),10,k,f),X.e=X.c.length),O=d(m,w,k,A?(v=z,f):(v=f,z)),$=D=O.length;O[--D]==0;O.pop());if(!O[0])return v.charAt(0);if(he<0?--$:(S.c=O,S.e=$,S.s=y,S=e(S,X,J,se,k),O=S.c,L=S.r,$=S.e),E=$+J+1,he=O[E],D=k/2,L=L||E<0||O[E+1]!=null,L=se<4?(he!=null||L)&&(se==0||se==(S.s<0?3:2)):he>D||he==D&&(se==4||L||se==6&&O[E-1]&1||se==(S.s<0?8:7)),E<1||!O[0])m=L?gt(v.charAt(1),-J,v.charAt(0)):v.charAt(0);else{if(O.length=E,L)for(--k;++O[--E]>k;)O[E]=0,E||(++$,O=[1].concat(O));for(D=O.length;!O[--D];);for(he=0,m="";he<=D;m+=v.charAt(O[he++]));m=gt(m,$,v.charAt(0))}return m}}(),e=function(){function f(w,k,y){var A,v,E,$,D=0,L=w.length,S=k%kt,O=k/kt|0;for(w=w.slice();L--;)E=w[L]%kt,$=w[L]/kt|0,A=O*E+$*S,v=S*E+A%kt*kt+D,D=(v/y|0)+(A/kt|0)+O*$,w[L]=v%y;return D&&(w=[D].concat(w)),w}function d(w,k,y,A){var v,E;if(y!=A)E=y>A?1:-1;else for(v=E=0;v<y;v++)if(w[v]!=k[v]){E=w[v]>k[v]?1:-1;break}return E}function m(w,k,y,A){for(var v=0;y--;)w[y]-=v,v=w[y]<k[y]?1:0,w[y]=v*A+w[y]-k[y];for(;!w[0]&&w.length>1;w.splice(0,1));}return function(w,k,y,A,v){var E,$,D,L,S,O,X,he,J,se,_e,le,Xe,Q,te,Z,me,Pe=w.s==k.s?1:-1,Y=w.c,ne=k.c;if(!Y||!Y[0]||!ne||!ne[0])return new V(!w.s||!k.s||(Y?ne&&Y[0]==ne[0]:!ne)?NaN:Y&&Y[0]==0||!ne?Pe*0:Pe/0);for(he=new V(Pe),J=he.c=[],$=w.e-k.e,Pe=y+$+1,v||(v=st,$=rt(w.e/we)-rt(k.e/we),Pe=Pe/we|0),D=0;ne[D]==(Y[D]||0);D++);if(ne[D]>(Y[D]||0)&&$--,Pe<0)J.push(1),L=!0;else{for(Q=Y.length,Z=ne.length,D=0,Pe+=2,S=ot(v/(ne[0]+1)),S>1&&(ne=f(ne,S,v),Y=f(Y,S,v),Z=ne.length,Q=Y.length),Xe=Z,se=Y.slice(0,Z),_e=se.length;_e<Z;se[_e++]=0);me=ne.slice(),me=[0].concat(me),te=ne[0],ne[1]>=v/2&&te++;do{if(S=0,E=d(ne,se,Z,_e),E<0){if(le=se[0],Z!=_e&&(le=le*v+(se[1]||0)),S=ot(le/te),S>1)for(S>=v&&(S=v-1),O=f(ne,S,v),X=O.length,_e=se.length;d(O,se,X,_e)==1;)S--,m(O,Z<X?me:ne,X,v),X=O.length,E=1;else S==0&&(E=S=1),O=ne.slice(),X=O.length;if(X<_e&&(O=[0].concat(O)),m(se,O,_e,v),_e=se.length,E==-1)for(;d(ne,se,Z,_e)<1;)S++,m(se,Z<_e?me:ne,_e,v),_e=se.length}else E===0&&(S++,se=[0]);J[D++]=S,se[0]?se[_e++]=Y[Xe]||0:(se=[Y[Xe]],_e=1)}while((Xe++<Q||se[0]!=null)&&Pe--);L=se[0]!=null,J[0]||J.splice(0,1)}if(v==st){for(D=1,Pe=J[0];Pe>=10;Pe/=10,D++);q(he,y+(he.e=D+$*we-1)+1,A,L)}else he.e=$,he.r=+L;return he}}();function R(f,d,m,w){var k,y,A,v,E;if(m==null?m=c:Te(m,0,8),!f.c)return f.toString();if(k=f.c[0],A=f.e,d==null)E=nt(f.c),E=w==1||w==2&&(A<=i||A>=a)?Yt(E,A):gt(E,A,"0");else if(f=q(new V(f),d,m),y=f.e,E=nt(f.c),v=E.length,w==1||w==2&&(d<=y||y<=i)){for(;v<d;E+="0",v++);E=Yt(E,y)}else if(d-=A,E=gt(E,y,"0"),y+1>v){if(--d>0)for(E+=".";d--;E+="0");}else if(d+=y-v,d>0)for(y+1==v&&(E+=".");d--;E+="0");return f.s<0&&k?"-"+E:E}function ee(f,d){for(var m,w,k=1,y=new V(f[0]);k<f.length;k++)w=new V(f[k]),(!w.s||(m=Ct(y,w))===d||m===0&&y.s===d)&&(y=w);return y}function C(f,d,m){for(var w=1,k=d.length;!d[--k];d.pop());for(k=d[0];k>=10;k/=10,w++);return(m=w+m*we-1)>h?f.c=f.e=null:m<u?f.c=[f.e=0]:(f.e=m,f.c=d),f}t=function(){var f=/^(-?)0([xbo])(?=\w[\w.]*$)/i,d=/^([^.]+)\.$/,m=/^\.([^.]+)$/,w=/^-?(Infinity|NaN)$/,k=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,A,v,E){var $,D=v?A:A.replace(k,"");if(w.test(D))y.s=isNaN(D)?null:D<0?-1:1;else{if(!v&&(D=D.replace(f,function(L,S,O){return $=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!E||E==$?S:L}),E&&($=E,D=D.replace(d,"$1").replace(m,"0.$1")),A!=D))return new V(D,$);if(V.DEBUG)throw Error(Qe+"Not a"+(E?" base "+E:"")+" number: "+A);y.s=null}y.c=y.e=null}}();function q(f,d,m,w){var k,y,A,v,E,$,D,L=f.c,S=rl;if(L){e:{for(k=1,v=L[0];v>=10;v/=10,k++);if(y=d-k,y<0)y+=we,A=d,E=L[$=0],D=ot(E/S[k-A-1]%10);else if($=nl((y+1)/we),$>=L.length)if(w){for(;L.length<=$;L.push(0));E=D=0,k=1,y%=we,A=y-we+1}else break e;else{for(E=v=L[$],k=1;v>=10;v/=10,k++);y%=we,A=y-we+k,D=A<0?0:ot(E/S[k-A-1]%10)}if(w=w||d<0||L[$+1]!=null||(A<0?E:E%S[k-A-1]),w=m<4?(D||w)&&(m==0||m==(f.s<0?3:2)):D>5||D==5&&(m==4||w||m==6&&(y>0?A>0?E/S[k-A]:0:L[$-1])%10&1||m==(f.s<0?8:7)),d<1||!L[0])return L.length=0,w?(d-=f.e+1,L[0]=S[(we-d%we)%we],f.e=-d||0):L[0]=f.e=0,f;if(y==0?(L.length=$,v=1,$--):(L.length=$+1,v=S[we-y],L[$]=A>0?ot(E/S[k-A]%S[A])*v:0),w)for(;;)if($==0){for(y=1,A=L[0];A>=10;A/=10,y++);for(A=L[0]+=v,v=1;A>=10;A/=10,v++);y!=v&&(f.e++,L[0]==st&&(L[0]=1));break}else{if(L[$]+=v,L[$]!=st)break;L[$--]=0,v=1}for(y=L.length;L[--y]===0;L.pop());}f.e>h?f.c=f.e=null:f.e<u&&(f.c=[f.e=0])}return f}function M(f){var d,m=f.e;return m===null?f.toString():(d=nt(f.c),d=m<=i||m>=a?Yt(d,m):gt(d,m,"0"),f.s<0?"-"+d:d)}return o.absoluteValue=o.abs=function(){var f=new V(this);return f.s<0&&(f.s=1),f},o.comparedTo=function(f,d){return Ct(this,new V(f,d))},o.decimalPlaces=o.dp=function(f,d){var m,w,k,y=this;if(f!=null)return Te(f,0,ze),d==null?d=c:Te(d,0,8),q(new V(y),f+y.e+1,d);if(!(m=y.c))return null;if(w=((k=m.length-1)-rt(this.e/we))*we,k=m[k])for(;k%10==0;k/=10,w--);return w<0&&(w=0),w},o.dividedBy=o.div=function(f,d){return e(this,new V(f,d),s,c)},o.dividedToIntegerBy=o.idiv=function(f,d){return e(this,new V(f,d),0,1)},o.exponentiatedBy=o.pow=function(f,d){var m,w,k,y,A,v,E,$,D,L=this;if(f=new V(f),f.c&&!f.isInteger())throw Error(Qe+"Exponent not an integer: "+M(f));if(d!=null&&(d=new V(d)),v=f.e>14,!L.c||!L.c[0]||L.c[0]==1&&!L.e&&L.c.length==1||!f.c||!f.c[0])return D=new V(Math.pow(+M(L),v?f.s*(2-Zt(f)):+M(f))),d?D.mod(d):D;if(E=f.s<0,d){if(d.c?!d.c[0]:!d.s)return new V(NaN);w=!E&&L.isInteger()&&d.isInteger(),w&&(L=L.mod(d))}else{if(f.e>9&&(L.e>0||L.e<-1||(L.e==0?L.c[0]>1||v&&L.c[1]>=24e7:L.c[0]<8e13||v&&L.c[0]<=9999975e7)))return y=L.s<0&&Zt(f)?-0:0,L.e>-1&&(y=1/y),new V(E?1/y:y);N&&(y=nl(N/we+2))}for(v?(m=new V(.5),E&&(f.s=1),$=Zt(f)):(k=Math.abs(+M(f)),$=k%2),D=new V(r);;){if($){if(D=D.times(L),!D.c)break;y?D.c.length>y&&(D.c.length=y):w&&(D=D.mod(d))}if(k){if(k=ot(k/2),k===0)break;$=k%2}else if(f=f.times(m),q(f,f.e+1,1),f.e>14)$=Zt(f);else{if(k=+M(f),k===0)break;$=k%2}L=L.times(L),y?L.c&&L.c.length>y&&(L.c.length=y):w&&(L=L.mod(d))}return w?D:(E&&(D=r.div(D)),d?D.mod(d):y?q(D,N,c,A):D)},o.integerValue=function(f){var d=new V(this);return f==null?f=c:Te(f,0,8),q(d,d.e+1,f)},o.isEqualTo=o.eq=function(f,d){return Ct(this,new V(f,d))===0},o.isFinite=function(){return!!this.c},o.isGreaterThan=o.gt=function(f,d){return Ct(this,new V(f,d))>0},o.isGreaterThanOrEqualTo=o.gte=function(f,d){return(d=Ct(this,new V(f,d)))===1||d===0},o.isInteger=function(){return!!this.c&&rt(this.e/we)>this.c.length-2},o.isLessThan=o.lt=function(f,d){return Ct(this,new V(f,d))<0},o.isLessThanOrEqualTo=o.lte=function(f,d){return(d=Ct(this,new V(f,d)))===-1||d===0},o.isNaN=function(){return!this.s},o.isNegative=function(){return this.s<0},o.isPositive=function(){return this.s>0},o.isZero=function(){return!!this.c&&this.c[0]==0},o.minus=function(f,d){var m,w,k,y,A=this,v=A.s;if(f=new V(f,d),d=f.s,!v||!d)return new V(NaN);if(v!=d)return f.s=-d,A.plus(f);var E=A.e/we,$=f.e/we,D=A.c,L=f.c;if(!E||!$){if(!D||!L)return D?(f.s=-d,f):new V(L?A:NaN);if(!D[0]||!L[0])return L[0]?(f.s=-d,f):new V(D[0]?A:c==3?-0:0)}if(E=rt(E),$=rt($),D=D.slice(),v=E-$){for((y=v<0)?(v=-v,k=D):($=E,k=L),k.reverse(),d=v;d--;k.push(0));k.reverse()}else for(w=(y=(v=D.length)<(d=L.length))?v:d,v=d=0;d<w;d++)if(D[d]!=L[d]){y=D[d]<L[d];break}if(y&&(k=D,D=L,L=k,f.s=-f.s),d=(w=L.length)-(m=D.length),d>0)for(;d--;D[m++]=0);for(d=st-1;w>v;){if(D[--w]<L[w]){for(m=w;m&&!D[--m];D[m]=d);--D[m],D[w]+=st}D[w]-=L[w]}for(;D[0]==0;D.splice(0,1),--$);return D[0]?C(f,D,$):(f.s=c==3?-1:1,f.c=[f.e=0],f)},o.modulo=o.mod=function(f,d){var m,w,k=this;return f=new V(f,d),!k.c||!f.s||f.c&&!f.c[0]?new V(NaN):!f.c||k.c&&!k.c[0]?new V(k):(b==9?(w=f.s,f.s=1,m=e(k,f,0,3),f.s=w,m.s*=w):m=e(k,f,0,b),f=k.minus(m.times(f)),!f.c[0]&&b==1&&(f.s=k.s),f)},o.multipliedBy=o.times=function(f,d){var m,w,k,y,A,v,E,$,D,L,S,O,X,he,J,se=this,_e=se.c,le=(f=new V(f,d)).c;if(!_e||!le||!_e[0]||!le[0])return!se.s||!f.s||_e&&!_e[0]&&!le||le&&!le[0]&&!_e?f.c=f.e=f.s=null:(f.s*=se.s,!_e||!le?f.c=f.e=null:(f.c=[0],f.e=0)),f;for(w=rt(se.e/we)+rt(f.e/we),f.s*=se.s,E=_e.length,L=le.length,E<L&&(X=_e,_e=le,le=X,k=E,E=L,L=k),k=E+L,X=[];k--;X.push(0));for(he=st,J=kt,k=L;--k>=0;){for(m=0,S=le[k]%J,O=le[k]/J|0,A=E,y=k+A;y>k;)$=_e[--A]%J,D=_e[A]/J|0,v=O*$+D*S,$=S*$+v%J*J+X[y]+m,m=($/he|0)+(v/J|0)+O*D,X[y--]=$%he;X[y]=m}return m?++w:X.splice(0,1),C(f,X,w)},o.negated=function(){var f=new V(this);return f.s=-f.s||null,f},o.plus=function(f,d){var m,w=this,k=w.s;if(f=new V(f,d),d=f.s,!k||!d)return new V(NaN);if(k!=d)return f.s=-d,w.minus(f);var y=w.e/we,A=f.e/we,v=w.c,E=f.c;if(!y||!A){if(!v||!E)return new V(k/0);if(!v[0]||!E[0])return E[0]?f:new V(v[0]?w:k*0)}if(y=rt(y),A=rt(A),v=v.slice(),k=y-A){for(k>0?(A=y,m=E):(k=-k,m=v),m.reverse();k--;m.push(0));m.reverse()}for(k=v.length,d=E.length,k-d<0&&(m=E,E=v,v=m,d=k),k=0;d;)k=(v[--d]=v[d]+E[d]+k)/st|0,v[d]=st===v[d]?0:v[d]%st;return k&&(v=[k].concat(v),++A),C(f,v,A)},o.precision=o.sd=function(f,d){var m,w,k,y=this;if(f!=null&&f!==!!f)return Te(f,1,ze),d==null?d=c:Te(d,0,8),q(new V(y),f,d);if(!(m=y.c))return null;if(k=m.length-1,w=k*we+1,k=m[k]){for(;k%10==0;k/=10,w--);for(k=m[0];k>=10;k/=10,w++);}return f&&y.e+1>w&&(w=y.e+1),w},o.shiftedBy=function(f){return Te(f,-ol,ol),this.times("1e"+f)},o.squareRoot=o.sqrt=function(){var f,d,m,w,k,y=this,A=y.c,v=y.s,E=y.e,$=s+4,D=new V("0.5");if(v!==1||!A||!A[0])return new V(!v||v<0&&(!A||A[0])?NaN:A?y:1/0);if(v=Math.sqrt(+M(y)),v==0||v==1/0?(d=nt(A),(d.length+E)%2==0&&(d+="0"),v=Math.sqrt(+d),E=rt((E+1)/2)-(E<0||E%2),v==1/0?d="5e"+E:(d=v.toExponential(),d=d.slice(0,d.indexOf("e")+1)+E),m=new V(d)):m=new V(v+""),m.c[0]){for(E=m.e,v=E+$,v<3&&(v=0);;)if(k=m,m=D.times(k.plus(e(y,k,$,1))),nt(k.c).slice(0,v)===(d=nt(m.c)).slice(0,v))if(m.e<E&&--v,d=d.slice(v-3,v+1),d=="9999"||!w&&d=="4999"){if(!w&&(q(k,k.e+s+2,0),k.times(k).eq(y))){m=k;break}$+=4,v+=4,w=1}else{(!+d||!+d.slice(1)&&d.charAt(0)=="5")&&(q(m,m.e+s+2,1),f=!m.times(m).eq(y));break}}return q(m,m.e+s+1,c,f)},o.toExponential=function(f,d){return f!=null&&(Te(f,0,ze),f++),R(this,f,d,1)},o.toFixed=function(f,d){return f!=null&&(Te(f,0,ze),f=f+this.e+1),R(this,f,d)},o.toFormat=function(f,d,m){var w,k=this;if(m==null)f!=null&&d&&typeof d=="object"?(m=d,d=null):f&&typeof f=="object"?(m=f,f=d=null):m=H;else if(typeof m!="object")throw Error(Qe+"Argument not an object: "+m);if(w=k.toFixed(f,d),k.c){var y,A=w.split("."),v=+m.groupSize,E=+m.secondaryGroupSize,$=m.groupSeparator||"",D=A[0],L=A[1],S=k.s<0,O=S?D.slice(1):D,X=O.length;if(E&&(y=v,v=E,E=y,X-=y),v>0&&X>0){for(y=X%v||v,D=O.substr(0,y);y<X;y+=v)D+=$+O.substr(y,v);E>0&&(D+=$+O.slice(y)),S&&(D="-"+D)}w=L?D+(m.decimalSeparator||"")+((E=+m.fractionGroupSize)?L.replace(new RegExp("\\d{"+E+"}\\B","g"),"$&"+(m.fractionGroupSeparator||"")):L):D}return(m.prefix||"")+w+(m.suffix||"")},o.toFraction=function(f){var d,m,w,k,y,A,v,E,$,D,L,S,O=this,X=O.c;if(f!=null&&(v=new V(f),!v.isInteger()&&(v.c||v.s!==1)||v.lt(r)))throw Error(Qe+"Argument "+(v.isInteger()?"out of range: ":"not an integer: ")+M(v));if(!X)return new V(O);for(d=new V(r),$=m=new V(r),w=E=new V(r),S=nt(X),y=d.e=S.length-O.e-1,d.c[0]=rl[(A=y%we)<0?we+A:A],f=!f||v.comparedTo(d)>0?y>0?d:$:v,A=h,h=1/0,v=new V(S),E.c[0]=0;D=e(v,d,0,1),k=m.plus(D.times(w)),k.comparedTo(f)!=1;)m=w,w=k,$=E.plus(D.times(k=$)),E=k,d=v.minus(D.times(k=d)),v=k;return k=e(f.minus(m),w,0,1),E=E.plus(k.times($)),m=m.plus(k.times(w)),E.s=$.s=O.s,y=y*2,L=e($,w,y,c).minus(O).abs().comparedTo(e(E,m,y,c).minus(O).abs())<1?[$,w]:[E,m],h=A,L},o.toNumber=function(){return+M(this)},o.toPrecision=function(f,d){return f!=null&&Te(f,1,ze),R(this,f,d,2)},o.toString=function(f){var d,m=this,w=m.s,k=m.e;return k===null?w?(d="Infinity",w<0&&(d="-"+d)):d="NaN":(f==null?d=k<=i||k>=a?Yt(nt(m.c),k):gt(nt(m.c),k,"0"):f===10&&F?(m=q(new V(m),s+k+1,c),d=gt(nt(m.c),m.e,"0")):(Te(f,2,z.length,"Base"),d=l(gt(nt(m.c),k,"0"),10,f,w,!0)),w<0&&m.c[0]&&(d="-"+d)),d},o.valueOf=o.toJSON=function(){return M(this)},o._isBigNumber=!0,o[Symbol.toStringTag]="BigNumber",o[Symbol.for("nodejs.util.inspect.custom")]=o.valueOf,n!=null&&V.set(n),V}function rt(n){var e=n|0;return n>0||n===e?e:e-1}function nt(n){for(var e,l,t=1,o=n.length,r=n[0]+"";t<o;){for(e=n[t++]+"",l=we-e.length;l--;e="0"+e);r+=e}for(o=r.length;r.charCodeAt(--o)===48;);return r.slice(0,o+1||1)}function Ct(n,e){var l,t,o=n.c,r=e.c,s=n.s,c=e.s,i=n.e,a=e.e;if(!s||!c)return null;if(l=o&&!o[0],t=r&&!r[0],l||t)return l?t?0:-c:s;if(s!=c)return s;if(l=s<0,t=i==a,!o||!r)return t?0:!o^l?1:-1;if(!t)return i>a^l?1:-1;for(c=(i=o.length)<(a=r.length)?i:a,s=0;s<c;s++)if(o[s]!=r[s])return o[s]>r[s]^l?1:-1;return i==a?0:i>a^l?1:-1}function Te(n,e,l,t){if(n<e||n>l||n!==ot(n))throw Error(Qe+(t||"Argument")+(typeof n=="number"?n<e||n>l?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Zt(n){var e=n.c.length-1;return rt(n.e/we)==e&&n.c[e]%2!=0}function Yt(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function gt(n,e,l){var t,o;if(e<0){for(o=l+".";++e;o+=l);n=o+n}else if(t=n.length,++e>t){for(o=l,e-=t;--e;o+=l);n+=o}else e<t&&(n=n.slice(0,e)+"."+n.slice(e));return n}Xn();const{theme:ms}=It(Dt),Ke=(n,e,l={})=>{const{color:t="rgba(255,255,255,0)",duration:o=.2,ease:r="power1.in",offset:s={from:"0%",to:"100%"},position:c="+=0",...i}=l,{from:a="0%",to:u="100%"}=s,h=Array.isArray(e)?e.map(p=>p.getAttribute("stop-color")):e.getAttribute("stop-color");n.fromTo(e,{attr:{offset:a,"stop-color":t}},{attr:{offset:u,"stop-color":t},duration:o,ease:r,...i},c).to(e,{attr:{offset:u,"stop-color":p=>Array.isArray(e)?h[p]:h},duration:o,ease:r,...i},"-=50%")},St=ms.colors.gray[100],gs=async n=>new Promise(e=>{var Y,ne,K,ye,tt,Se,ct,ft,Ze,ut,dt,Ve,Vt,Tt,Ht,jt,be,Ie,Re,We,Ye,ht;const l=at.timeline({onComplete:e}),t=.02,o=document.querySelectorAll(".embedding .content .last");l.fromTo(o,{opacity:0},{opacity:1,duration:t});const r=document.querySelectorAll(".sankey .embedding .last");l.set(r,{opacity:.6});const s=(Y=document.querySelector("#gray-blue-last"))==null?void 0:Y.querySelectorAll("stop")[1];Ke(l,s,{duration:t*10});const c=document.querySelectorAll(".attention .column .vector.last");l.fromTo(c,{opacity:0},{opacity:1,duration:t});const i=document.querySelectorAll(".sankey-top .attention .last"),a=document.querySelectorAll(".sankey-back .attention .last"),u=document.querySelectorAll(".sankey-top .attention .to-attention-out");l.set(i,{opacity:1}),l.set(a,{opacity:.4}),l.set(u,{opacity:.4});const h=(ne=document.querySelector("#blue-blue-last"))==null?void 0:ne.querySelectorAll("stop")[1],p=(K=document.querySelector("#red-red-last"))==null?void 0:K.querySelectorAll("stop")[1],b=(ye=document.querySelector("#green-green-last"))==null?void 0:ye.querySelectorAll("stop")[1],N=(tt=document.querySelector("#blue-blue2-last"))==null?void 0:tt.querySelectorAll("stop")[1],H=(Se=document.querySelector("#red-red2-last"))==null?void 0:Se.querySelectorAll("stop")[1],z=(ct=document.querySelector("#green-green2-last"))==null?void 0:ct.querySelectorAll("stop")[1];Ke(l,[h,p,b,N,H,z],{duration:t*10});const F=document.querySelectorAll(".attention .head-block .qkv .column .last");l.fromTo(F,{opacity:0},{opacity:1,duration:t});const V=document.querySelectorAll(".sankey g.attention path.key-to-attention"),R=document.querySelectorAll(".sankey g.attention path.query-to-attention");document.querySelectorAll(".sankey g.attention path.to-attention-out");const ee=document.querySelector(".attention .attention-result");[...V,...R].forEach(Ue=>{const Me=Ue.getTotalLength();Ue.style.strokeDasharray=Me,Ue.style.strokeDashoffset=Me});const C=.4,q=Number(Math.max(C/n,.02).toFixed(2)),M=Math.max(C,.02*n);l.to(V,{strokeDashoffset:0,stagger:q,duration:M,ease:"power2.out"},"<+=50%").to(R,{strokeDashoffset:0,stagger:q,duration:M,ease:"power2.out"},"<").from(ee.querySelectorAll("svg circle"),{scale:0,transformOrigin:"50% 50%",opacity:0,delay:M/n,stagger:Number((M/Math.pow(n,2)).toFixed(2)),ease:"power2.out",duration:M},"<");const f=(ft=document.querySelector("#green-purple"))==null?void 0:ft.querySelectorAll("stop")[1],d=(Ze=document.querySelector("#transparent-purple2"))==null?void 0:Ze.querySelectorAll("stop")[1];Ke(l,[d,f],{color:St});const m=document.querySelectorAll(".attention .head-block .head-out .column .cell"),w=document.querySelector(".attention .head-block .head-out .title");l.fromTo([m,w],{opacity:(Ue,Me)=>Me.classList.contains("last")?0:.2},{opacity:1,duration:t});const k=(ut=document.querySelector("#purple-purple"))==null?void 0:ut.querySelectorAll("stop")[1],y=(dt=document.querySelector("#transparent-purple"))==null?void 0:dt.querySelectorAll("stop")[1],A=(Ve=document.querySelector("#purple-purple-last"))==null?void 0:Ve.querySelectorAll("stop")[1],v=(Vt=document.querySelector("#transparent-purple-last"))==null?void 0:Vt.querySelectorAll("stop")[1];Ke(l,[k,y],{color:St}),Ke(l,[A,v]);const E=document.querySelectorAll(".mlp .first-layer .cell");l.fromTo(E,{opacity:(Ue,Me)=>Me.classList.contains("last")?0:.2},{opacity:1,duration:t});const $=document.querySelectorAll(".sankey .mlp .last");l.set($,{opacity:.4});const D=(Tt=document.querySelector("#purple-indigo"))==null?void 0:Tt.querySelectorAll("stop")[1],L=(Ht=document.querySelector("#purple-indigo-last"))==null?void 0:Ht.querySelectorAll("stop")[1];Ke(l,D,{color:St}),Ke(l,L,{position:"<"});const S=document.querySelectorAll(".mlp .second-layer .projections .cell");l.fromTo(S,{opacity:(Ue,Me)=>Me.classList.contains("last")?0:.2},{opacity:1,duration:t});const O=(jt=document.querySelector("#indigo-blue"))==null?void 0:jt.querySelectorAll("stop")[1],X=(be=document.querySelector("#indigo-blue-last"))==null?void 0:be.querySelectorAll("stop")[1];Ke(l,O,{color:St}),Ke(l,X,{position:"<"});const he=document.querySelectorAll(".mlp .second-layer .ouputs .cell");l.fromTo(he,{opacity:(Ue,Me)=>Me.classList.contains("last")?0:.2},{opacity:1,duration:t});const J=document.querySelectorAll(".sankey .transformer-blocks .last");l.set(J,{opacity:.6});const se=(Ie=document.querySelector("#blue-white-blue"))==null?void 0:Ie.querySelectorAll("stop")[1],_e=(Re=document.querySelector("#blue-white-blue"))==null?void 0:Re.querySelectorAll("stop")[3],le=(We=document.querySelector("#blue-white-blue-last"))==null?void 0:We.querySelectorAll("stop")[1],Xe=(Ye=document.querySelector("#blue-white-blue-last"))==null?void 0:Ye.querySelectorAll("stop")[3],Q=at.timeline({});Ke(Q,se,{color:St,duration:t*5,offset:{to:"50%"},ease:"sine.inOut"}),Ke(Q,le,{duration:t*5,offset:{to:"50%"},ease:"sine.inOut",position:"<"}),Ke(Q,_e,{duration:t*5,color:St,offset:{from:"50%"},ease:"sine.inOut"}),Ke(Q,Xe,{duration:t*5,offset:{from:"50%"},ease:"sine.inOut",position:"<"}),l.add(Q);const te=document.querySelectorAll(".transformer-blocks .cell");l.fromTo(te,{opacity:(Ue,Me)=>Me.classList.contains("last")?0:.2},{opacity:1,duration:t});const Z=document.querySelectorAll(".sankey .linear-softmax .last");l.set(Z,{opacity:.4});const me=(ht=document.querySelector("#blue-gray"))==null?void 0:ht.querySelectorAll("stop")[1];Ke(l,me,{offset:{to:"50%"},color:St});const Pe=document.querySelectorAll(".softmax .content");l.fromTo(Pe,{opacity:0},{opacity:1,duration:t})}),_s=async()=>{};eo.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";const Zn=20,bs=async(n,e)=>{ml.set(!0);const{token_ids:l,input_tokens:t}=await ks(n);bt.set(t);const{outputs:o,prediction:r}=await Es(l),s=zn(r,e),c=Rn(s,Zn);Pt.set({outputs:o,prediction:s,sampled:c}),await gs(t.length),Rt.set(c),ml.set(!1)},$s=async(n,e)=>{const l=zn(n,e),t=Rn(l,Zn);Pt.update(o=>({...o,prediction:l})),await _s(),Rt.set(t)},ws=n=>{const e=Math.max(...n),l=n.map(o=>Math.exp(o-e)),t=l.reduce((o,r)=>o+r,0);return l.map(o=>o/t)},ks=async n=>{const e=await Gn.from_pretrained("Xenova/gpt2"),l=e.encode(n),t=l.map(o=>e.decode([o])).flat();return{token_ids:l,input_tokens:t}},ys=(n,e,l,t)=>{const o=Array.from(n).map((r,s)=>({tokenId:s,logit:r,probability:e[s]}));return o.sort((r,s)=>s.probability-r.probability),o.slice(0,t).map((r,s)=>({...r,rank:s,token:l.decode([r.tokenId])}))},Es=async n=>{try{const e=new to("int64",n,[1,n.length]),l=Kn(jn);if(!l)throw new Error("Model session is not initialized.");const t={input:e},o=await l.run(t),r=o.linear_output.data,s=ws(r),c=await Gn.from_pretrained("Xenova/gpt2"),a=ys(r,s,c,100);return{outputs:Is.reduce((h,p)=>{const b=o[p],N={...b,data:Ho([...b.cpuData],b.dims)};return h[p]=N,h},{}),prediction:a}}catch(e){throw console.error("Error during inference:",e.message),e}},Is=["block_0_attn_head_0_attn","block_0_attn_head_0_attn_scaled","block_0_attn_head_0_attn_masked","block_0_attn_head_0_attn_softmax","block_0_attn_head_0_attn_dropout","linear_output"];async function Ds(n){const e=await fetch(n);if(!e.ok)throw new Error(`Failed to fetch ${n}`);return e.arrayBuffer()}async function qs(n){const e=await Promise.all(n.map(r=>Ds(r))),l=e.reduce((r,s)=>r+s.byteLength,0),t=new Uint8Array(l);let o=0;for(const r of e)t.set(new Uint8Array(r),o),o+=r.byteLength;return t.buffer}function An(n){let e,l,t,o,r,s,c;return l=new fo({}),{c(){e=B("div"),ie(l.$$.fragment),this.h()},l(i){e=P(i,"DIV",{class:!0,style:!0,role:!0});var a=T(e);ae(l.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","qkv-weight-popover svelte-6mb5yb"),g(e,"style",t=`left:${n[0].left}px;top:${n[0].top}px;`),g(e,"role","group")},m(i,a){G(i,e,a),ce(l,e,null),r=!0,s||(c=[ke(e,"mouseenter",n[3]),ke(e,"mouseleave",n[4])],s=!0)},p(i,a){(!r||a&1&&t!==(t=`left:${i[0].left}px;top:${i[0].top}px;`))&&g(e,"style",t)},i(i){r||(j(l.$$.fragment,i),i&&(o||Lt(()=>{o=Qn(e,it,{duration:300}),o.start()})),r=!0)},o(i){W(l.$$.fragment,i),r=!1},d(i){i&&_(e),fe(l),s=!1,Fe(c)}}}function Cs(n){let e,l,t=(n[2]==="embedding"||n[1])&&An(n);return{c(){t&&t.c(),e=mt()},l(o){t&&t.l(o),e=mt()},m(o,r){t&&t.m(o,r),G(o,e,r),l=!0},p(o,[r]){o[2]==="embedding"||o[1]?t?(t.p(o,r),r&6&&j(t,1)):(t=An(o),t.c(),j(t,1),t.m(e.parentNode,e)):t&&(Ne(),W(t,1,1,()=>{t=null}),Le())},i(o){l||(j(t),l=!0)},o(o){W(t),l=!1},d(o){o&&_(e),t&&t.d(o)}}}function Ss(n,e,l){let t;Ee(n,il,a=>l(2,t=a));let o,r={left:0,top:0},s=!1;return _t(()=>{const a=()=>{var H;const h=window.scrollX,p=(H=document.querySelector(".top-bar"))==null?void 0:H.offsetHeight,N=document.querySelector(".step.embedding .content").getBoundingClientRect();l(0,r={left:N.right+h,top:N.top-p})};return a(),o=new ResizeObserver(h=>{a()}),(document==null?void 0:document.querySelectorAll(".resize-watch")).forEach(h=>o.observe(h)),()=>{o.disconnect()}}),[r,s,t,()=>{l(1,s=!0)},()=>{l(1,s=!1)}]}class Vs extends Oe{constructor(e){super(),Ge(this,e,Ss,Cs,je,{})}}function Nn(n){let e,l,t,o,r,s,c,i,a,u,h;return{c(){e=B("div"),t=U(),o=B("div"),c=U(),i=B("div"),this.h()},l(p){e=P(p,"DIV",{class:!0}),T(e).forEach(_),t=x(p),o=P(p,"DIV",{class:!0}),T(o).forEach(_),c=x(p),i=P(p,"DIV",{class:!0}),T(i).forEach(_),this.h()},h(){g(e,"class","dim svelte-p1rtu3"),g(o,"class",r=ve(pe("dim-partial left",`${n[2].id||""}`))+" svelte-p1rtu3"),g(i,"class",a=ve(pe("dim-partial right",`${n[2].id||""}`))+" svelte-p1rtu3")},m(p,b){G(p,e,b),G(p,t,b),G(p,o,b),G(p,c,b),G(p,i,b),h=!0},p(p,b){(!h||b&4&&r!==(r=ve(pe("dim-partial left",`${p[2].id||""}`))+" svelte-p1rtu3"))&&g(o,"class",r),(!h||b&4&&a!==(a=ve(pe("dim-partial right",`${p[2].id||""}`))+" svelte-p1rtu3"))&&g(i,"class",a)},i(p){h||(p&&Lt(()=>{h&&(l||(l=At(e,it,{duration:100},!0)),l.run(1))}),p&&Lt(()=>{h&&(s||(s=At(o,it,{duration:100},!0)),s.run(1))}),p&&Lt(()=>{h&&(u||(u=At(i,it,{duration:100},!0)),u.run(1))}),h=!0)},o(p){p&&(l||(l=At(e,it,{duration:100},!1)),l.run(0)),p&&(s||(s=At(o,it,{duration:100},!1)),s.run(0)),p&&(u||(u=At(i,it,{duration:100},!1)),u.run(0)),h=!1},d(p){p&&(_(e),_(t),_(o),_(c),_(i)),p&&l&&l.end(),p&&s&&s.end(),p&&u&&u.end()}}}function As(n){let e,l,t,o,r,s,c,i,a,u,h,p,b,N,H,z,F,V,R,ee,C,q=!!n[2].id&&Nn(n);return o=new No({}),i=new rs({props:{className:"step"}}),u=new sr({props:{className:"step"}}),p=new ps({props:{className:"step"}}),N=new gr({props:{className:"step"}}),z=new qr({props:{className:"step"}}),R=new Vs({}),{c(){e=B("div"),q&&q.c(),l=U(),t=B("div"),ie(o.$$.fragment),r=U(),s=B("div"),c=B("div"),ie(i.$$.fragment),a=U(),ie(u.$$.fragment),h=U(),ie(p.$$.fragment),b=U(),ie(N.$$.fragment),H=U(),ie(z.$$.fragment),V=U(),ie(R.$$.fragment),this.h()},l(M){e=P(M,"DIV",{class:!0,style:!0});var f=T(e);q&&q.l(f),l=x(f),t=P(f,"DIV",{class:!0});var d=T(t);ae(o.$$.fragment,d),d.forEach(_),r=x(f),s=P(f,"DIV",{class:!0});var m=T(s);c=P(m,"DIV",{class:!0});var w=T(c);ae(i.$$.fragment,w),a=x(w),ae(u.$$.fragment,w),h=x(w),ae(p.$$.fragment,w),b=x(w),ae(N.$$.fragment,w),H=x(w),ae(z.$$.fragment,w),w.forEach(_),V=x(m),ae(R.$$.fragment,m),m.forEach(_),f.forEach(_),this.h()},h(){g(t,"class","sankey opacity-1 svelte-p1rtu3"),oe(t,"attention",n[2].id==="attention"),g(c,"class","steps svelte-p1rtu3"),Lt(()=>n[7].call(c)),oe(c,"expanded",!!n[2].id),g(s,"class","nodes resize-watch svelte-p1rtu3"),g(e,"class","main-section h-full w-full"),g(e,"style",ee=`--vector-height: ${n[1]}px;--title-height: ${n[3]}px;--content-height:${n[0]-n[3]}px;`)},m(M,f){G(M,e,f),q&&q.m(e,null),I(e,l),I(e,t),ce(o,t,null),I(e,r),I(e,s),I(s,c),ce(i,c,null),I(c,a),ce(u,c,null),I(c,h),ce(p,c,null),I(c,b),ce(N,c,null),I(c,H),ce(z,c,null),F=Tn(c,n[7].bind(c)),I(s,V),ce(R,s,null),C=!0},p(M,[f]){M[2].id?q?(q.p(M,f),f&4&&j(q,1)):(q=Nn(M),q.c(),j(q,1),q.m(e,l)):q&&(Ne(),W(q,1,1,()=>{q=null}),Le()),(!C||f&4)&&oe(t,"attention",M[2].id==="attention"),(!C||f&4)&&oe(c,"expanded",!!M[2].id),(!C||f&3&&ee!==(ee=`--vector-height: ${M[1]}px;--title-height: ${M[3]}px;--content-height:${M[0]-M[3]}px;`))&&g(e,"style",ee)},i(M){C||(j(q),j(o.$$.fragment,M),j(i.$$.fragment,M),j(u.$$.fragment,M),j(p.$$.fragment,M),j(N.$$.fragment,M),j(z.$$.fragment,M),j(R.$$.fragment,M),C=!0)},o(M){W(q),W(o.$$.fragment,M),W(i.$$.fragment,M),W(u.$$.fragment,M),W(p.$$.fragment,M),W(N.$$.fragment,M),W(z.$$.fragment,M),W(R.$$.fragment,M),C=!1},d(M){M&&_(e),q&&q.d(),fe(o),fe(i),fe(u),fe(p),fe(N),fe(z),F(),fe(R)}}}function Ns(n,e,l){let t,o,r,s,c,i;Ee(n,bt,b=>l(4,t=b)),Ee(n,Pt,b=>l(5,o=b)),Ee(n,al,b=>l(8,r=b)),Ee(n,Rt,b=>l(6,s=b)),Ee(n,Kt,b=>l(1,c=b)),Ee(n,xe,b=>l(2,i=b)),_t(async()=>{const N=Array(63).fill(0).map((q,M)=>`${bo}/gpt2.onnx.part${M}`),H=await qs(N),z=new Blob([H],{type:"application/octet-stream"}),F=URL.createObjectURL(z),V=await lo.create(F,{});jn.set(V),no.set(!1);const R=oo.subscribe(q=>{bs(q.trim(),r)});let ee=!0;const C=al.subscribe(q=>{if(ee){ee=!1;return}$s(o==null?void 0:o.prediction,q)});return()=>{R(),C()}});let a=0,u=Mt*5;const h=()=>{const b=Mt*.5*(t.length-1),N=Math.min(Math.max((a-u-b)/t.length/ro,so),io);Kt.set(N),Hn.set(t.length*N*3+b)};function p(){a=this.offsetHeight,l(0,a)}return n.$$.update=()=>{n.$$.dirty&32&&console.log("data",o),n.$$.dirty&64&&console.log("p tkn",s),n.$$.dirty&17&&(a||t.length)&&h()},[a,c,i,u,t,o,s,p]}class Rs extends Oe{constructor(e){super(),Ge(this,e,Ns,As,je,{})}}export{Rs as component,zs as universal};
