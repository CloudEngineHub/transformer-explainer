import{y as Mt,a as It,e as d,b,c as f,o as L,h as k,p as v,j as qe,g as p,m as $t,t as _,d as w,f as y,k as e,v as St,l as O,q as bt,n as qt}from"../chunks/scheduler.CknTtfwd.js";import{S as Tt,i as At,c as we,a as $e,m as be,t as ke,b as Ce,d as De}from"../chunks/index.Cb0qHW9x.js";import{t as Bt,m as Rt,r as Ht,a as zt,e as Ge,b as kt}from"../chunks/index.SZUUYpd_.js";import{a as Ct}from"../chunks/PositionalEncodingPopover.svelte_svelte_type_style_lang.DKq7mr22.js";import{P as Wt,g as Lt}from"../chunks/index.BH8hwKuQ.js";import{M as Oe,s as Me,a as ye}from"../chunks/WeightPopover.svelte_svelte_type_style_lang.B-4ULxpN.js";function Nt(s,{delay:t=0,duration:a=400,easing:r=Mt}={}){const h=+getComputedStyle(s).opacity;return{delay:t,duration:a,easing:r,css:n=>`opacity: ${n*h}`}}function Dt(s,t,a){const r=s.slice();return r[16]=t[a],r[18]=a,r}function Vt(s,t,a){const r=s.slice();return r[16]=t[a],r[18]=a,r}function xt(s){let t,a,r=s[16]+"",h;return{c(){t=d("div"),a=d("span"),h=_(r),this.h()},l(n){t=f(n,"DIV",{class:!0});var o=w(t);a=f(o,"SPAN",{});var $=w(a);h=y($,r),$.forEach(p),o.forEach(p),this.h()},h(){v(t,"class","label svelte-128v0r")},m(n,o){qe(n,t,o),e(t,a),e(a,h)},p(n,o){o&2&&r!==(r=n[16]+"")&&O(h,r)},d(n){n&&p(t)}}}function Et(s){let t,a,r=s[16]+"",h;return{c(){t=d("div"),a=d("span"),h=_(r),this.h()},l(n){t=f(n,"DIV",{class:!0});var o=w(t);a=f(o,"SPAN",{});var $=w(a);h=y($,r),$.forEach(p),o.forEach(p),this.h()},h(){v(t,"class","label svelte-128v0r")},m(n,o){qe(n,t,o),e(t,a),e(a,h)},p(n,o){o&2&&r!==(r=n[16]+"")&&O(h,r)},d(n){n&&p(t)}}}function Pt(s){let t,a,r="click",h,n,o="",$,m,N,S,E,T,P,Be="Token Embedding",Ve,q,xe,c,I,G,oe,U=s[4].dimension+"",F,J,X,C,ne='<div class="symbol">Ã—</div>',Y,D,A,Re="QKV Weights",Ke,ie,Z,Qe,R,Ue,He,Fe,Ee=s[4].dimension*3+"",ze,Je,Xe,ee,ft='<div class="symbol">+</div>',Ye,H,te,ht="QKV Bias",Ze,le,et,j,tt,Ie=s[4].dimension*3+"",We,lt,st,se,mt='<div class="symbol">=</div>',at,ce,K,rt,z,ae,ut="QKV Vectors",ot,ve,Q,nt,W,it,Le,ct,Te=s[4].dimension*3+"",Ne,vt,B,dt,pt,de=Ge(s[1]),V=[];for(let l=0;l<de.length;l+=1)V[l]=xt(Vt(s,de,l));q=new Oe({props:{className:"token-embedding",data:s[3],showSize:!1,cellHeight:kt*.8,cellWidth:2,rowGap:je,colorScale:s[7]}}),Z=new Oe({props:{className:"qkv-weights",data:s[5],showSize:!1,groupBy:"col",cellHeight:3,cellWidth:3,rowGap:0,colorScale:s[8]}}),le=new Oe({props:{className:"qkv-bias",data:s[6],showSize:!1,groupBy:"col",cellHeight:2,cellWidth:8,rowGap:0,colorScale:s[7]}});let fe=Ge(s[1]),x=[];for(let l=0;l<fe.length;l+=1)x[l]=Et(Dt(s,fe,l));return Q=new Oe({props:{className:"qkv-output",data:s[2],showSize:!1,cellHeight:kt*.8,cellWidth:2,rowGap:je,colorScale:s[8]}}),{c(){t=d("div"),a=d("button"),a.textContent=r,h=b(),n=d("button"),n.innerHTML=o,$=b(),m=d("div"),N=d("div"),S=d("div");for(let l=0;l<V.length;l+=1)V[l].c();E=b(),T=d("div"),P=d("div"),P.textContent=Be,Ve=b(),we(q.$$.fragment),xe=b(),c=d("div"),I=_("("),G=_(s[0]),oe=_(","),F=_(U),J=_(")"),X=b(),C=d("div"),C.innerHTML=ne,Y=b(),D=d("div"),A=d("div"),A.textContent=Re,Ke=b(),ie=d("div"),we(Z.$$.fragment),Qe=b(),R=d("div"),Ue=_("("),He=_(s[0]),Fe=_(","),ze=_(Ee),Je=_(")"),Xe=b(),ee=d("div"),ee.innerHTML=ft,Ye=b(),H=d("div"),te=d("div"),te.textContent=ht,Ze=b(),we(le.$$.fragment),et=b(),j=d("div"),tt=_("("),We=_(Ie),lt=_(")"),st=b(),se=d("div"),se.innerHTML=mt,at=b(),ce=d("div"),K=d("div");for(let l=0;l<x.length;l+=1)x[l].c();rt=b(),z=d("div"),ae=d("div"),ae.textContent=ut,ot=b(),ve=d("div"),we(Q.$$.fragment),nt=b(),W=d("div"),it=_("("),Le=_(s[0]),ct=_(","),Ne=_(Te),vt=_(")"),this.h()},l(l){t=f(l,"DIV",{class:!0});var g=w(t);a=f(g,"BUTTON",{class:!0,"data-svelte-h":!0}),L(a)!=="svelte-15gkrpg"&&(a.textContent=r),h=k(g),n=f(g,"BUTTON",{class:!0,"data-svelte-h":!0}),L(n)!=="svelte-18k3ubz"&&(n.innerHTML=o),$=k(g),m=f(g,"DIV",{class:!0});var i=w(m);N=f(i,"DIV",{class:!0});var Ae=w(N);S=f(Ae,"DIV",{class:!0,style:!0});var u=w(S);for(let re=0;re<V.length;re+=1)V[re].l(u);u.forEach(p),Ae.forEach(p),E=k(i),T=f(i,"DIV",{class:!0});var M=w(T);P=f(M,"DIV",{class:!0,"data-svelte-h":!0}),L(P)!=="svelte-gt1kh9"&&(P.textContent=Be),Ve=k(M),$e(q.$$.fragment,M),xe=k(M),c=f(M,"DIV",{class:!0});var he=w(c);I=y(he,"("),G=y(he,s[0]),oe=y(he,","),F=y(he,U),J=y(he,")"),he.forEach(p),M.forEach(p),X=k(i),C=f(i,"DIV",{class:!0,"data-svelte-h":!0}),L(C)!=="svelte-tenuq0"&&(C.innerHTML=ne),Y=k(i),D=f(i,"DIV",{class:!0});var me=w(D);A=f(me,"DIV",{class:!0,"data-svelte-h":!0}),L(A)!=="svelte-1efpcrm"&&(A.textContent=Re),Ke=k(me),ie=f(me,"DIV",{class:!0});var gt=w(ie);$e(Z.$$.fragment,gt),gt.forEach(p),Qe=k(me),R=f(me,"DIV",{class:!0});var ue=w(R);Ue=y(ue,"("),He=y(ue,s[0]),Fe=y(ue,","),ze=y(ue,Ee),Je=y(ue,")"),ue.forEach(p),me.forEach(p),Xe=k(i),ee=f(i,"DIV",{class:!0,"data-svelte-h":!0}),L(ee)!=="svelte-fkvh9k"&&(ee.innerHTML=ft),Ye=k(i),H=f(i,"DIV",{class:!0});var pe=w(H);te=f(pe,"DIV",{class:!0,"data-svelte-h":!0}),L(te)!=="svelte-kbpln6"&&(te.textContent=ht),Ze=k(pe),$e(le.$$.fragment,pe),et=k(pe),j=f(pe,"DIV",{class:!0});var Pe=w(j);tt=y(Pe,"("),We=y(Pe,Ie),lt=y(Pe,")"),Pe.forEach(p),pe.forEach(p),st=k(i),se=f(i,"DIV",{class:!0,"data-svelte-h":!0}),L(se)!=="svelte-13z61j6"&&(se.innerHTML=mt),at=k(i),ce=f(i,"DIV",{class:!0});var _t=w(ce);K=f(_t,"DIV",{class:!0,style:!0});var yt=w(K);for(let re=0;re<x.length;re+=1)x[re].l(yt);yt.forEach(p),_t.forEach(p),rt=k(i),z=f(i,"DIV",{class:!0});var ge=w(z);ae=f(ge,"DIV",{class:!0,"data-svelte-h":!0}),L(ae)!=="svelte-8xjhsf"&&(ae.textContent=ut),ot=k(ge),ve=f(ge,"DIV",{class:!0});var wt=w(ve);$e(Q.$$.fragment,wt),wt.forEach(p),nt=k(ge),W=f(ge,"DIV",{class:!0});var _e=w(W);it=y(_e,"("),Le=y(_e,s[0]),ct=y(_e,","),Ne=y(_e,Te),vt=y(_e,")"),_e.forEach(p),ge.forEach(p),i.forEach(p),g.forEach(p),this.h()},h(){v(a,"class","play-control svelte-128v0r"),v(n,"class","play-control svelte-128v0r"),v(S,"class","tokens svelte-128v0r"),v(S,"style",`gap:${je}px`),v(N,"class","matrix flex flex-col items-center svelte-128v0r"),v(P,"class","title self-end svelte-128v0r"),v(c,"class","size svelte-128v0r"),v(T,"class","matrix flex flex-col items-center svelte-128v0r"),v(C,"class","operator svelte-128v0r"),v(A,"class","title svelte-128v0r"),v(ie,"class","flex gap-0"),v(R,"class","size svelte-128v0r"),v(D,"class","matrix flex flex-col items-center svelte-128v0r"),v(ee,"class","operator svelte-128v0r"),v(te,"class","title svelte-128v0r"),v(j,"class","size svelte-128v0r"),v(H,"class","matrix flex flex-col items-center svelte-128v0r"),v(se,"class","operator svelte-128v0r"),v(K,"class","tokens svelte-128v0r"),v(K,"style",`gap:${je}px`),v(ce,"class","matrix flex flex-col items-center svelte-128v0r"),v(ae,"class","title svelte-128v0r"),v(ve,"class","flex"),v(W,"class","size svelte-128v0r"),v(z,"class","matrix flex flex-col items-center svelte-128v0r"),v(m,"class","weight-popover-content flex items-center justify-start svelte-128v0r"),v(t,"class","weight-content")},m(l,g){qe(l,t,g),e(t,a),e(t,h),e(t,n),e(t,$),e(t,m),e(m,N),e(N,S);for(let i=0;i<V.length;i+=1)V[i]&&V[i].m(S,null);e(m,E),e(m,T),e(T,P),e(T,Ve),be(q,T,null),e(T,xe),e(T,c),e(c,I),e(c,G),e(c,oe),e(c,F),e(c,J),e(m,X),e(m,C),e(m,Y),e(m,D),e(D,A),e(D,Ke),e(D,ie),be(Z,ie,null),e(D,Qe),e(D,R),e(R,Ue),e(R,He),e(R,Fe),e(R,ze),e(R,Je),e(m,Xe),e(m,ee),e(m,Ye),e(m,H),e(H,te),e(H,Ze),be(le,H,null),e(H,et),e(H,j),e(j,tt),e(j,We),e(j,lt),e(m,st),e(m,se),e(m,at),e(m,ce),e(ce,K);for(let i=0;i<x.length;i+=1)x[i]&&x[i].m(K,null);e(m,rt),e(m,z),e(z,ae),e(z,ot),e(z,ve),be(Q,ve,null),e(z,nt),e(z,W),e(W,it),e(W,Le),e(W,ct),e(W,Ne),e(W,vt),B=!0,dt||(pt=St(a,"click",s[12]),dt=!0)},p(l,g){if(g&2){de=Ge(l[1]);let u;for(u=0;u<de.length;u+=1){const M=Vt(l,de,u);V[u]?V[u].p(M,g):(V[u]=xt(M),V[u].c(),V[u].m(S,null))}for(;u<V.length;u+=1)V[u].d(1);V.length=de.length}const i={};if(g&8&&(i.data=l[3]),q.$set(i),(!B||g&1)&&O(G,l[0]),(!B||g&16)&&U!==(U=l[4].dimension+"")&&O(F,U),(!B||g&1)&&O(He,l[0]),(!B||g&16)&&Ee!==(Ee=l[4].dimension*3+"")&&O(ze,Ee),(!B||g&16)&&Ie!==(Ie=l[4].dimension*3+"")&&O(We,Ie),g&2){fe=Ge(l[1]);let u;for(u=0;u<fe.length;u+=1){const M=Dt(l,fe,u);x[u]?x[u].p(M,g):(x[u]=Et(M),x[u].c(),x[u].m(K,null))}for(;u<x.length;u+=1)x[u].d(1);x.length=fe.length}const Ae={};g&4&&(Ae.data=l[2]),Q.$set(Ae),(!B||g&1)&&O(Le,l[0]),(!B||g&16)&&Te!==(Te=l[4].dimension*3+"")&&O(Ne,Te)},i(l){B||(ke(q.$$.fragment,l),ke(Z.$$.fragment,l),ke(le.$$.fragment,l),ke(Q.$$.fragment,l),B=!0)},o(l){Ce(q.$$.fragment,l),Ce(Z.$$.fragment,l),Ce(le.$$.fragment,l),Ce(Q.$$.fragment,l),B=!1},d(l){l&&p(t),bt(V,l),De(q),De(Z),De(le),bt(x,l),De(Q),dt=!1,pt()}}}function Gt(s){let t,a="click",r,h,n;return h=new Wt({props:{triggeredBy:".btn",trigger:"click",open:!0,class:"weight-popover popover bg-white text-sm font-light text-gray-500",placement:"right-start",arrow:!1,transition:Nt,params:{duration:300},title:"Weight Multiplication",$$slots:{default:[Pt]},$$scope:{ctx:s}}}),{c(){t=d("button"),t.textContent=a,r=b(),we(h.$$.fragment),this.h()},l(o){t=f(o,"BUTTON",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-1333ynp"&&(t.textContent=a),r=k(o),$e(h.$$.fragment,o),this.h()},h(){v(t,"class","btn")},m(o,$){qe(o,t,$),qe(o,r,$),be(h,o,$),n=!0},p(o,[$]){const m={};$&1048607&&(m.$$scope={dirty:$,ctx:o}),h.$set(m)},i(o){n||(ke(h.$$.fragment,o),n=!0)},o(o){Ce(h.$$.fragment,o),n=!1},d(o){o&&(p(t),p(r)),De(h,o)}}}const je=6,Se=20;function Ot(s,t,a){let r,h,n,o,$;$t(s,Bt,c=>a(1,o=c)),$t(s,Rt,c=>a(4,$=c));const{theme:m}=Ht(zt);let{triggeredBy:N}=t,{title:S=void 0}=t,E=Lt.timeline({});const T=Array(Se*3).fill(0).map(c=>Array(Se).fill(0).map(I=>Math.random())),P=Array(1).fill(0).map(c=>Array(Se*3).fill(0).map(I=>Math.random())),Be=(c,I)=>Ct("white",m.colors.gray[400])(c),Ve=(c,I)=>{let G=I<20?"blue":I<40?"red":"green";return Ct("white",m.colors[G][400])(c)};m.colors.red[500];const q=()=>{const c=Me(".weight-popover-content .token-embedding g.g-row").nodes(),I=Me(".weight-popover-content .qkv-weights g.g-col").nodes(),G=Me(".weight-popover-content .qkv-bias rect").nodes(),oe=Me(".weight-popover-content .qkv-output g.g-row").nodes();E.set(G,{opacity:.1});const U=ye(oe[0]).selectAll("rect").nodes(),F=ye(c[0]).selectAll("rect").nodes();U.forEach((X,C)=>{const ne=ye(I[C]).selectAll("rect").nodes();E.set(F,{opacity:.1}),F.forEach((Y,D)=>{const A=D===0&&C===0;E.fromTo(Y,{opacity:.1},{opacity:1,duration:A?1:.005},"<50%"),E.fromTo(ne[D],{opacity:.1},{opacity:1,duration:A?1:.005},"<50%")}),E.to(G[C],{opacity:1,duration:C===0?1:.005},"<50%"),E.from(X,{opacity:0,duration:C===0?1:.005},"<50%")});let J=0;oe.forEach(function(X,C){if(C===0)return;const ne=ye(X).selectAll("rect").nodes(),Y=ye(c[C]).selectAll("rect").nodes();if(J!==null&&J!==C){E.fromTo(Y,{opacity:.1},{opacity:1,duration:.01},"<50%");const D=Me(".weight-popover-content .qkv-weights g.g-col rect").nodes();E.set(D,{opacity:.1})}ne.forEach((D,A)=>{const Re=ye(I[A]).selectAll("rect").nodes();E.fromTo(Re,{opacity:.1},{opacity:1,duration:.01},"<50%"),E.from(D,{opacity:0,duration:.01},"<50%")}),J=C})},xe=()=>{q()};return s.$$set=c=>{"triggeredBy"in c&&a(10,N=c.triggeredBy),"title"in c&&a(11,S=c.title)},s.$$.update=()=>{s.$$.dirty&2&&a(0,r=o.length),s.$$.dirty&1&&a(3,h=Array(r).fill(0).map(c=>Array(Se).fill(0).map(I=>Math.random()))),s.$$.dirty&1&&a(2,n=Array(r).fill(0).map(c=>Array(Se*3).fill(0).map(I=>Math.random())))},[r,o,n,h,$,T,P,Be,Ve,q,N,S,xe]}class jt extends Tt{constructor(t){super(),At(this,t,Ot,Gt,It,{triggeredBy:10,title:11})}}function Kt(s){let t,a;return t=new jt({props:{open:!0,triggeredBy:"body"}}),{c(){we(t.$$.fragment)},l(r){$e(t.$$.fragment,r)},m(r,h){be(t,r,h),a=!0},p:qt,i(r){a||(ke(t.$$.fragment,r),a=!0)},o(r){Ce(t.$$.fragment,r),a=!1},d(r){De(t,r)}}}class Zt extends Tt{constructor(t){super(),At(this,t,null,Kt,It,{})}}export{Zt as component};
